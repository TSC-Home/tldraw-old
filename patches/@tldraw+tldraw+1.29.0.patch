diff --git a/node_modules/@tldraw/tldraw/dist/Tldraw.d.ts b/node_modules/@tldraw/tldraw/dist/Tldraw.d.ts
index b915982..0be50c4 100644
--- a/node_modules/@tldraw/tldraw/dist/Tldraw.d.ts
+++ b/node_modules/@tldraw/tldraw/dist/Tldraw.d.ts
@@ -1,8 +1,3 @@
-import '@fontsource/caveat-brush';
-import '@fontsource/crimson-pro';
-import '@fontsource/recursive';
-import '@fontsource/source-code-pro';
-import '@fontsource/source-sans-pro';
 import { CursorComponent } from '@tldraw/core';
 import { TDCallbacks } from './state';
 import { TDDocument } from './types';
diff --git a/node_modules/@tldraw/tldraw/dist/index.js b/node_modules/@tldraw/tldraw/dist/index.js
index 3fda75c..ef616ce 100644
--- a/node_modules/@tldraw/tldraw/dist/index.js
+++ b/node_modules/@tldraw/tldraw/dist/index.js
@@ -1,4 +1,4 @@
-var Zp=Object.create;var ur=Object.defineProperty,Xp=Object.defineProperties,qp=Object.getOwnPropertyDescriptor,Jp=Object.getOwnPropertyDescriptors,Qp=Object.getOwnPropertyNames,Jr=Object.getOwnPropertySymbols,eu=Object.getPrototypeOf,ai=Object.prototype.hasOwnProperty,Xa=Object.prototype.propertyIsEnumerable;var ii=(r,e,t)=>e in r?ur(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,S=(r,e)=>{for(var t in e||(e={}))ai.call(e,t)&&ii(r,t,e[t]);if(Jr)for(var t of Jr(e))Xa.call(e,t)&&ii(r,t,e[t]);return r},w=(r,e)=>Xp(r,Jp(e)),qa=r=>ur(r,"__esModule",{value:!0});var ot=(r,e)=>{var t={};for(var n in r)ai.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&Jr)for(var n of Jr(r))e.indexOf(n)<0&&Xa.call(r,n)&&(t[n]=r[n]);return t};var Ja=(r,e)=>{for(var t in e)ur(r,t,{get:e[t],enumerable:!0})},Mo=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Qp(e))!ai.call(r,o)&&(t||o!=="default")&&ur(r,o,{get:()=>e[o],enumerable:!(n=qp(e,o))||n.enumerable});return r},V=(r,e)=>Mo(qa(ur(r!=null?Zp(eu(r)):{},"default",!e&&r&&r.__esModule?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r),tu=(r=>(e,t)=>r&&r.get(e)||(t=Mo(qa({}),e,1),r&&r.set(e,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var l=(r,e,t)=>(ii(r,typeof e!="symbol"?e+"":e,t),t);var ue=(r,e,t)=>new Promise((n,o)=>{var s=i=>{try{d(t.next(i))}catch(c){o(c)}},a=i=>{try{d(t.throw(i))}catch(c){o(c)}},d=i=>i.done?n(i.value):Promise.resolve(i.value).then(s,a);d((t=t.apply(r,e)).next())});var gce={};Ja(gce,{AlignStyle:()=>Gt,AlignType:()=>hr,Arrow:()=>Qo,ColorStyle:()=>is,DashStyle:()=>Sn,Decoration:()=>fr,DistributeType:()=>gr,Draw:()=>Ws,Ellipse:()=>Ns,FlipType:()=>ss,FontSize:()=>rl,FontStyle:()=>Ao,Group:()=>Ac,Image:()=>Lc,MoveType:()=>rs,Rectangle:()=>Vs,SessionType:()=>Ne,SizeStyle:()=>Sr,Sticky:()=>Pr,StretchType:()=>mr,TDAssetType:()=>as,TDEventHandler:()=>os,TDExportBackground:()=>Lo,TDExportType:()=>go,TDShapeType:()=>De,TDStatus:()=>Bt,TDUserStatus:()=>ol,TLDR:()=>k,Text:()=>Rc,Tldraw:()=>dce,TldrawApp:()=>zn,Triangle:()=>$s,Video:()=>Hc,getShapeUtil:()=>ua,shapeUtils:()=>Rn,useFileSystem:()=>nl});var fMe=require("@fontsource/caveat-brush"),SMe=require("@fontsource/crimson-pro"),bMe=require("@fontsource/recursive"),TMe=require("@fontsource/source-code-pro"),yMe=require("@fontsource/source-sans-pro"),Vp=require("@tldraw/core"),be=V(require("react")),$p=require("react-error-boundary"),Np=require("react-intl");var Ge=V(require("@radix-ui/react-context-menu")),lt=require("@radix-ui/react-icons"),C=V(require("react")),Ye=require("react-intl");var Qr=require("@stitches/react"),{styled:H,createTheme:nu}=(0,Qr.createStitches)({themeMap:S({},Qr.defaultThemeMap),theme:{colors:{bounds:"rgba(65, 132, 244, 1.000)",boundsBg:"rgba(65, 132, 244, 0.05)",hover:"#ececec",overlay:"rgba(0, 0, 0, 0.15)",overlayContrast:"rgba(255, 255, 255, 0.15)",panel:"#fefefe",panelContrast:"#ffffff",selected:"rgba(66, 133, 244, 1.000)",selectedContrast:"#fefefe",text:"#333333",tooltip:"#1d1d1d",tooltipContrast:"#ffffff",warn:"rgba(255, 100, 100, 1)",canvas:"rgb(248, 249, 250)"},shadows:{2:"0px 1px 1px rgba(0, 0, 0, 0.14)",3:"0px 2px 3px rgba(0, 0, 0, 0.14)",4:"0px 4px 5px -1px rgba(0, 0, 0, 0.14)",8:"0px 12px 17px rgba(0, 0, 0, 0.14)",12:"0px 12px 17px rgba(0, 0, 0, 0.14)",24:"0px 24px 38px rgba(0, 0, 0, 0.14)",key:"1px 1px rgba(0,0,0,1)",panel:`0px 0px 16px -1px rgba(0, 0, 0, 0.05), 
+var Zp=Object.create;var ur=Object.defineProperty,Xp=Object.defineProperties,qp=Object.getOwnPropertyDescriptor,Jp=Object.getOwnPropertyDescriptors,Qp=Object.getOwnPropertyNames,Jr=Object.getOwnPropertySymbols,eu=Object.getPrototypeOf,ai=Object.prototype.hasOwnProperty,Xa=Object.prototype.propertyIsEnumerable;var ii=(r,e,t)=>e in r?ur(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,S=(r,e)=>{for(var t in e||(e={}))ai.call(e,t)&&ii(r,t,e[t]);if(Jr)for(var t of Jr(e))Xa.call(e,t)&&ii(r,t,e[t]);return r},w=(r,e)=>Xp(r,Jp(e)),qa=r=>ur(r,"__esModule",{value:!0});var ot=(r,e)=>{var t={};for(var n in r)ai.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&Jr)for(var n of Jr(r))e.indexOf(n)<0&&Xa.call(r,n)&&(t[n]=r[n]);return t};var Ja=(r,e)=>{for(var t in e)ur(r,t,{get:e[t],enumerable:!0})},Mo=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Qp(e))!ai.call(r,o)&&(t||o!=="default")&&ur(r,o,{get:()=>e[o],enumerable:!(n=qp(e,o))||n.enumerable});return r},V=(r,e)=>Mo(qa(ur(r!=null?Zp(eu(r)):{},"default",!e&&r&&r.__esModule?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r),tu=(r=>(e,t)=>r&&r.get(e)||(t=Mo(qa({}),e,1),r&&r.set(e,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var l=(r,e,t)=>(ii(r,typeof e!="symbol"?e+"":e,t),t);var ue=(r,e,t)=>new Promise((n,o)=>{var s=i=>{try{d(t.next(i))}catch(c){o(c)}},a=i=>{try{d(t.throw(i))}catch(c){o(c)}},d=i=>i.done?n(i.value):Promise.resolve(i.value).then(s,a);d((t=t.apply(r,e)).next())});var gce={};Ja(gce,{AlignStyle:()=>Gt,AlignType:()=>hr,Arrow:()=>Qo,ColorStyle:()=>is,DashStyle:()=>Sn,Decoration:()=>fr,DistributeType:()=>gr,Draw:()=>Ws,Ellipse:()=>Ns,FlipType:()=>ss,FontSize:()=>rl,FontStyle:()=>Ao,Group:()=>Ac,Image:()=>Lc,MoveType:()=>rs,Rectangle:()=>Vs,SessionType:()=>Ne,SizeStyle:()=>Sr,Sticky:()=>Pr,StretchType:()=>mr,TDAssetType:()=>as,TDEventHandler:()=>os,TDExportBackground:()=>Lo,TDExportType:()=>go,TDShapeType:()=>De,TDStatus:()=>Bt,TDUserStatus:()=>ol,TLDR:()=>k,Text:()=>Rc,Tldraw:()=>dce,TldrawApp:()=>zn,Triangle:()=>$s,Video:()=>Hc,getShapeUtil:()=>ua,shapeUtils:()=>Rn,useFileSystem:()=>nl});Vp=require("@tldraw/core"),be=V(require("react")),$p=require("react-error-boundary"),Np=require("react-intl");var Ge=V(require("@radix-ui/react-context-menu")),lt=require("@radix-ui/react-icons"),C=V(require("react")),Ye=require("react-intl");var Qr=require("@stitches/react"),{styled:H,createTheme:nu}=(0,Qr.createStitches)({themeMap:S({},Qr.defaultThemeMap),theme:{colors:{bounds:"rgba(65, 132, 244, 1.000)",boundsBg:"rgba(65, 132, 244, 0.05)",hover:"#ececec",overlay:"rgba(0, 0, 0, 0.15)",overlayContrast:"rgba(255, 255, 255, 0.15)",panel:"#fefefe",panelContrast:"#ffffff",selected:"rgba(66, 133, 244, 1.000)",selectedContrast:"#fefefe",text:"#333333",tooltip:"#1d1d1d",tooltipContrast:"#ffffff",warn:"rgba(255, 100, 100, 1)",canvas:"rgb(248, 249, 250)"},shadows:{2:"0px 1px 1px rgba(0, 0, 0, 0.14)",3:"0px 2px 3px rgba(0, 0, 0, 0.14)",4:"0px 4px 5px -1px rgba(0, 0, 0, 0.14)",8:"0px 12px 17px rgba(0, 0, 0, 0.14)",12:"0px 12px 17px rgba(0, 0, 0, 0.14)",24:"0px 24px 38px rgba(0, 0, 0, 0.14)",key:"1px 1px rgba(0,0,0,1)",panel:`0px 0px 16px -1px rgba(0, 0, 0, 0.05), 
         0px 0px 16px -8px rgba(0, 0, 0, 0.05), 
         0px 0px 16px -12px rgba(0, 0, 0, 0.12),
         0px 0px 2px 0px rgba(0, 0, 0, 0.08)`},space:{0:"2px",1:"3px",2:"4px",3:"8px",4:"12px",5:"16px",6:"32px",7:"48px"},fontSizes:{0:"10px",1:"12px",2:"13px",3:"16px",4:"18px"},fonts:{ui:'"Recursive", system-ui, sans-serif',body:'"Recursive", system-ui, sans-serif',mono:'"Recursive Mono", monospace'},fontWeights:{},lineHeights:{},letterSpacings:{},sizes:{},borderWidths:{0:"$1"},borderStyles:{},radii:{0:"2px",1:"4px",2:"8px",3:"12px",4:"16px"},zIndices:{},transitions:{}},media:{micro:"(max-width: 370px)",sm:"(min-width: 640px)",md:"(min-width: 768px)",lg:"(min-width: 1024px)"},utils:{zStrokeWidth:()=>r=>Array.isArray(r)?{strokeWidth:`calc(${r[0]}px / var(--camera-zoom))`}:{strokeWidth:`calc(${r}px / var(--camera-zoom))`}}}),li=nu({colors:{bounds:"rgba(38, 150, 255, 1.000)",boundsBg:"rgba(38, 150, 255, 0.05)",hover:"#444A50",overlay:"rgba(0, 0, 0, 0.15)",overlayContrast:"rgba(255, 255, 255, 0.15)",panel:"#363D44",panelContrast:"#49555f",selected:"rgba(38, 150, 255, 1.000)",selectedContrast:"#fefefe",text:"#f8f9fa",tooltip:"#1d1d1d",tooltipContrast:"#ffffff",canvas:"#212529"},shadows:{2:"0px 1px 1px rgba(0, 0, 0, 0.24)",3:"0px 2px 3px rgba(0, 0, 0, 0.24)",4:"0px 4px 5px -1px rgba(0, 0, 0, 0.24)",8:"0px 12px 17px rgba(0, 0, 0, 0.24)",12:"0px 12px 17px rgba(0, 0, 0, 0.24)",24:"0px 24px 38px rgba(0, 0, 0, 0.24)",panel:`0px 0px 16px -1px rgba(0, 0, 0, 0.05), 
@@ -12,7 +12,7 @@ var Zp=Object.create;var ur=Object.defineProperty,Xp=Object.defineProperties,qp=
 `,t-1)+1,a=ct.findLineEnd(o,n),d=e.value.slice(s,a),i=d.replace(/(^|\n)(\t| {1,2})/g,"$1"),c=d.length-i.length;e.setSelectionRange(s,a),ct.insert(e,i);let u=/\t| {1,2}/.exec(o.slice(s,t)),p=u?u[0].length:0,m=t-p;e.setSelectionRange(t-p,Math.max(m,n-c))}};var it=V(require("react"));var to=it.memo(function({font:e,text:t,color:n,offsetX:o=0,offsetY:s=0,scale:a=1,isEditing:d=!1,onBlur:i,onChange:c}){let u=it.useRef(null),p=it.useRef(!1),m=it.useCallback(y=>{c(k.normalizeText(y.currentTarget.value))},[c]),h=it.useCallback(y=>{if(y.key==="Escape"){y.preventDefault(),y.stopPropagation(),i==null||i();return}if(y.key==="Tab"&&t.length===0){y.preventDefault();return}if(!(y.key==="Meta"||y.metaKey))y.stopPropagation();else if(y.key==="z"&&y.metaKey){y.shiftKey?document.execCommand("redo",!1):document.execCommand("undo",!1),y.stopPropagation(),y.preventDefault();return}(y.metaKey||y.ctrlKey)&&y.key==="="&&y.preventDefault(),y.key==="Tab"&&(y.preventDefault(),y.shiftKey?ct.unindent(y.currentTarget):ct.indent(y.currentTarget),c==null||c(k.normalizeText(y.currentTarget.value)))},[c]),g=it.useCallback(y=>{y.currentTarget.setSelectionRange(0,0),i==null||i()},[i]),f=it.useCallback(y=>{!d||!p.current||document.activeElement===y.currentTarget&&y.currentTarget.select()},[d]),T=it.useCallback(y=>{d&&y.stopPropagation()},[d]),x=it.useRef(d);it.useEffect(()=>{d?(x.current=!0,requestAnimationFrame(()=>{p.current=!0;let y=u.current;y&&(y.focus(),y.select())})):x.current&&(i==null||i(),x.current=!1)},[d,i]);let b=it.useRef(null);return it.useLayoutEffect(()=>{let y=b.current;if(!y)return;let R=Qn(t,e);y.style.transform=`scale(${a}, ${a}) translate(${o}px, ${s}px)`,y.style.width=R[0]+1+"px",y.style.height=R[1]+1+"px"},[t,e,s,o,a]),it.createElement(sde,null,it.createElement(ide,{ref:b,hasText:!!t,isEditing:d,style:{font:e,color:n}},d?it.createElement(ade,{ref:u,style:{font:e,color:n},name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:t,color:n,onFocus:f,onChange:m,onKeyDown:h,onBlur:g,onPointerDown:T,onContextMenu:xt,onCopy:xt,onPaste:xt,onCut:xt}):t,"\u200B"))}),sde=H("div",{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",userSelect:"none",variants:{isGhost:{false:{opacity:1},true:{transition:"opacity .2s",opacity:.3}}}}),Kd={whiteSpace:"pre-wrap",overflowWrap:"break-word",letterSpacing:Yt},ide=H("div",S({position:"absolute",padding:"4px",zIndex:1,minHeight:1,minWidth:1,lineHeight:1,outline:0,fontWeight:"500",textAlign:"center",backfaceVisibility:"hidden",userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",variants:{hasText:{false:{pointerEvents:"none"},true:{pointerEvents:"all"}},isEditing:{false:{userSelect:"none"},true:{background:"$boundsBg",userSelect:"text",WebkitUserSelect:"text"}}}},Kd)),ade=H("textarea",w(S({position:"absolute",top:0,left:0,zIndex:1,width:"100%",height:"100%",border:"none",padding:"4px",resize:"none",textAlign:"inherit",minHeight:"inherit",minWidth:"inherit",lineHeight:"inherit",outline:0,fontWeight:"inherit",overflow:"hidden",backfaceVisibility:"hidden",display:"inline-block",pointerEvents:"all",background:"$boundsBg",userSelect:"text",WebkitUserSelect:"text",fontSmooth:"always",WebkitFontSmoothing:"subpixel-antialiased",MozOsxFontSmoothing:"auto"},Kd),{"&:focus":{outline:"none",border:"none"}}));var _o=V(require("@tldraw/vec"));function no(r,e,{initialShape:t,transformOrigin:n,scaleX:o,scaleY:s}){if(r.rotation||t.isAspectRatioLocked){let a=_o.default.toFixed(_o.default.mul(t.size,Math.min(Math.abs(o),Math.abs(s)))),d=_o.default.toFixed([e.minX+(e.width-r.size[0])*(o<0?1-n[0]:n[0]),e.minY+(e.height-r.size[1])*(s<0?1-n[1]:n[1])]),i=o<0&&s>=0||s<0&&o>=0?t.rotation?-t.rotation:0:t.rotation;return{size:a,point:d,rotation:i}}else return{point:_o.default.toFixed([e.minX,e.minY]),size:_o.default.toFixed([e.width,e.height])}}var Ui=V(require("@tldraw/vec"));function oo(r,e){return{size:Ui.default.toFixed([e.width,e.height]),point:Ui.default.toFixed([e.minX,e.minY])}}var we=class extends Xt.TLShapeUtil{constructor(){super(...arguments);l(this,"canBind",!1);l(this,"canEdit",!1);l(this,"canClone",!1);l(this,"isAspectRatioLocked",!1);l(this,"hideResizeHandles",!1);l(this,"bindingDistance",16);l(this,"hitTestPoint",(e,t)=>Xt.Utils.pointInBounds(t,this.getRotatedBounds(e)));l(this,"hitTestLineSegment",(e,t,n)=>{let o=Xt.Utils.getBoundsFromPoints([t,n]),s=this.getBounds(e);return Xt.Utils.boundsContain(s,o)||e.rotation?(0,Yo.intersectLineSegmentPolyline)(t,n,Xt.Utils.getRotatedCorners(this.getBounds(e))).didIntersect:(0,Yo.intersectLineSegmentBounds)(t,n,this.getBounds(e)).length>0});l(this,"create",e=>(this.refMap.set(e.id,_d.createRef()),this.getShape(e)));l(this,"getCenter",e=>Xt.Utils.getBoundsCenter(this.getBounds(e)));l(this,"getExpandedBounds",e=>Xt.Utils.expandBounds(this.getBounds(e),this.bindingDistance));l(this,"getBindingPoint",(e,t,n,o,s,a)=>{let d=this.getBounds(e),i=this.getExpandedBounds(e);if(!Xt.Utils.pointInBounds(n,i))return;let c=(0,Yo.intersectRayBounds)(o,s,i).filter(T=>T.didIntersect).map(T=>T.points[0]);if(!c.length)return;let u=this.getCenter(e),p=c.sort((T,x)=>kn.Vec.dist(x,o)-kn.Vec.dist(T,o))[0],m=kn.Vec.med(n,p),h,g;a?(h=kn.Vec.dist(n,u)<16/2?u:n,g=0):(kn.Vec.distanceToLineSegment(n,m,u)<16/2?h=u:h=m,Xt.Utils.pointInBounds(n,d)?g=this.bindingDistance:g=Math.max(this.bindingDistance,Xt.Utils.getBoundsSides(d).map(T=>kn.Vec.distanceToLineSegment(T[1][0],T[1][1],n)).sort((T,x)=>T-x)[0]));let f=kn.Vec.divV(kn.Vec.sub(h,[i.minX,i.minY]),[i.width,i.height]);return{point:kn.Vec.clampV(f,0,1),distance:g}});l(this,"mutate",(e,t)=>t);l(this,"transform",(e,t,n)=>w(S({},e),{point:[t.minX,t.minY]}));l(this,"transformSingle",(e,t,n)=>this.transform(e,t,n));l(this,"updateChildren");l(this,"onChildrenChange");l(this,"onHandleChange");l(this,"onRightPointHandle");l(this,"onDoubleClickHandle");l(this,"onDoubleClickBoundsHandle");l(this,"onSessionComplete");l(this,"getSvgElement",(e,t)=>{var s,a,d,i,c;let n=(s=document.getElementById(e.id+"_svg"))==null?void 0:s.cloneNode(!0);if(!n)return;if((i=(d=(a=e.label)==null?void 0:a.trim())==null?void 0:d.length)!=null?i:0>0){let u=e,p=document.createElementNS("http://www.w3.org/2000/svg","g"),m=Mt(e.style),h=Qn(e.label,m),g=yo(e.style.size,e.style.font)*((c=e.style.scale)!=null?c:1),f=wn(e.style.font).slice(1,-1),T=eo(u.label,g,f,"middle",h[0],!1),x=this.getBounds(e);return T.setAttribute("transform",`translate(${x.width/2-h[0]/2}, ${x.height/2-h[1]/2})`),T.setAttribute("fill",Te(e.style,t).stroke),T.setAttribute("transform-origin","center center"),p.setAttribute("text-align","center"),p.setAttribute("text-anchor","middle"),p.appendChild(n),p.appendChild(T),p}return n})}};var Fn=require("@tldraw/core"),Is=require("@tldraw/intersect"),Re=V(require("@tldraw/vec")),Ki=V(require("perfect-freehand"));function Xd(r,e,t,n){return["M",r[0],r[1],"A",t[2],t[2],0,0,n<0?0:1,e[0],e[1]].join(" ")}function kr(r,e){let{start:t,end:n}=r,o=Re.default.dist(t.point,n.point),s=Re.default.med(t.point,n.point),a=o/2*e,d=Re.default.uni(Re.default.vec(t.point,n.point));return Re.default.toFixed(Math.abs(a)<10?s:Re.default.add(s,Re.default.mul(Re.default.per(d),a)))}function qd(r,e,t,n,o,s){let a=Fn.Utils.rng(r),d=Te(e).strokeWidth,i=o?Re.default.nudge(t,n,d):t,c=s?Re.default.nudge(n,t,d):n,u=(0,Ki.default)([i,c],{size:d,thinning:.618+a()*.2,easing:bo.easeOutQuad,simulatePressure:!0,streamline:0,last:!0});return Fn.Utils.getSvgPathFromStroke(u)}function Jd(r,e,t,n,o,s,a,d,i,c){let u=Fn.Utils.rng(r),p=Te(e).strokeWidth,m=o?Re.default.rotWith(t,a,p/i):t,h=s?Re.default.rotWith(n,a,-(p/i)):n,g=Re.default.angle(a,m),f=Re.default.angle(a,h),T=[],x=8+Math.floor(Math.abs(i)/20*1+u()/2);for(let y=0;y<x;y++){let R=c(y/x),K=Fn.Utils.lerpAngles(g,f,R);T.push(Re.default.toFixed(Re.default.nudgeAtAngle(a,K,d)))}let b=(0,Ki.default)([m,...T,h],{size:1+p,thinning:.618+u()*.2,easing:bo.easeOutQuad,simulatePressure:!1,streamline:0,last:!0});return Fn.Utils.getSvgPathFromStroke(b)}function jn(r,e,t){return Fn.Utils.circleFromThreePoints(r,t,e)}function Cs(r,e,t,n,o){let s=(0,Is.intersectCircleCircle)(r,e*.618,t,n).points;if(!s)return k.warn("Could not find an intersection for the arrow head."),{left:r,right:r};let a=o?s[0]:s[1],d=a?Re.default.nudge(Re.default.rotWith(a,r,Math.PI/6),r,e*-.382):r,i=a?Re.default.nudge(Re.default.rotWith(a,r,-Math.PI/6),r,e*-.382):r;return{left:d,right:i}}function Ds(r,e,t){let n=(0,Is.intersectCircleLineSegment)(r,t,r,e).points;if(!n)return k.warn("Could not find an intersection for the arrow head."),{left:r,right:r};let o=n[0],s=o?Re.default.rotWith(o,r,Math.PI/6):r,a=o?Re.default.rotWith(o,r,-Math.PI/6):r;return{left:s,right:a}}function Yd(r,e,t,n,o){let{left:s,right:a}=Cs(r,e,t,n,o);return`M ${s} L ${r} ${a}`}function Zd(r,e,t){let{left:n,right:o}=Ds(r,e,t);return`M ${n} L ${r} ${o}`}function Qd(r,e,t,n,o,s){let{strokeWidth:a}=Te(r,!1),d=Re.default.dist(e,n),i=Math.min(d/3,a*8),c=[];if(Re.default.dist(t,Re.default.toFixed(Re.default.med(e,n)))<1)c.push(`M ${e} L ${n}`),o&&c.push(Zd(e,n,i)),s&&c.push(Zd(n,e,i));else{let p=jn(e,t,n),m=[p[0],p[1]],h=p[2],g=xo(m,h,e,n);c.push(`M ${e} A ${h} ${h} 0 0 ${g>0?"1":"0"} ${n}`),o&&c.push(Yd(e,i,m,h,g<0)),s&&c.push(Yd(n,i,m,h,g>=0))}return c.join(" ")}function vr(r,e,t){if(Re.default.dist2(e,Re.default.med(r,t))<=4)return[r,t];let n=[],o=jn(r,e,t),s=[o[0],o[1]],a=o[2],d=Re.default.angle(s,r),i=Re.default.angle(s,t);for(let c=0;c<20;c++){let u=c/19,p=Fn.Utils.lerpAngles(d,i,u);n.push(Re.default.nudgeAtAngle(s,p,a))}return n}function ec(r,e,t){if(t===r||t===e)return!0;let n=Math.PI*2,o=(e-r+n)%n,s=(t-r+n)%n;return o<=Math.PI!=s>o}function xo(r,e,t,n){let o=Fn.Utils.getSweep(r,t,n);return e*(2*Math.PI)*(o/(2*Math.PI))}var _i=require("@tldraw/core"),tc=V(require("@tldraw/vec")),vn=V(require("react"));var Ps=V(require("react"));function Zo({left:r,middle:e,right:t,stroke:n,strokeWidth:o}){return Ps.createElement("g",null,Ps.createElement("path",{className:"tl-stroke-hitarea",d:`M ${r} L ${e} ${t}`}),Ps.createElement("path",{d:`M ${r} L ${e} ${t}`,fill:"none",stroke:n,strokeWidth:o,strokeLinecap:"round",strokeLinejoin:"round",pointerEvents:"none"}))}var nc=vn.memo(function({id:e,style:t,start:n,bend:o,end:s,arrowBend:a,decorationStart:d,decorationEnd:i,isDraw:c,isDarkMode:u}){let p=tc.default.dist(n,s);if(p<2)return null;let m=Te(t,u),{strokeWidth:h}=m,g=1+h*1.618,f=jn(n,o,s),T=[f[0],f[1]],x=f[2],b=xo(T,x,n,s),y=_i.Utils.rng(e),R=bo[y()>0?"easeInOutSine":"easeInOutCubic"],K=c?Jd(e,t,n,s,d,i,T,x,b,R):Xd(n,s,f,a),{strokeDasharray:L,strokeDashoffset:v}=_i.Utils.getPerfectDashProps(Math.abs(b),g,t.dash,2,!1),I=Math.min(p/3,h*8),J=d?Cs(n,I,T,x,b<0):null,ce=i?Cs(s,I,T,x,b>=0):null;return vn.createElement(vn.Fragment,null,vn.createElement("path",{className:"tl-stroke-hitarea",d:K}),vn.createElement("path",{d:K,fill:c?m.stroke:"none",stroke:m.stroke,strokeWidth:c?0:g,strokeDasharray:L,strokeDashoffset:v,strokeLinecap:"round",strokeLinejoin:"round",pointerEvents:"none"}),J&&vn.createElement(Zo,{left:J.left,middle:n,right:J.right,stroke:m.stroke,strokeWidth:g}),ce&&vn.createElement(Zo,{left:ce.left,middle:s,right:ce.right,stroke:m.stroke,strokeWidth:g}))});var oc=require("@tldraw/core"),Ms=V(require("@tldraw/vec")),In=V(require("react"));var rc=In.memo(function({id:e,style:t,start:n,end:o,decorationStart:s,decorationEnd:a,isDraw:d,isDarkMode:i}){let c=Ms.default.dist(n,o);if(c<2)return null;let u=Te(t,i),{strokeWidth:p}=u,m=1+p*1.618,h=d?qd(e,t,n,o,s,a):"M"+Ms.default.toFixed(n)+"L"+Ms.default.toFixed(o),{strokeDasharray:g,strokeDashoffset:f}=oc.Utils.getPerfectDashProps(c,p*1.618,t.dash,2,!1),T=Math.min(c/3,p*8),x=s?Ds(n,o,T):null,b=a?Ds(o,n,T):null;return In.createElement(In.Fragment,null,In.createElement("path",{className:"tl-stroke-hitarea",d:h}),In.createElement("path",{d:h,fill:u.stroke,stroke:u.stroke,strokeWidth:d?m/2:m,strokeDasharray:g,strokeDashoffset:f,strokeLinecap:"round",strokeLinejoin:"round",pointerEvents:"stroke"}),x&&In.createElement(Zo,{left:x.left,middle:n,right:x.right,stroke:u.stroke,strokeWidth:m}),b&&In.createElement(Zo,{left:b.left,middle:o,right:b.right,stroke:u.stroke,strokeWidth:m}))});var Yi=class extends we{constructor(){super(...arguments);l(this,"type","arrow");l(this,"hideBounds",!0);l(this,"canEdit",!0);l(this,"pathCache",new WeakMap);l(this,"getShape",e=>{var t,n,o,s;return S({id:"id",type:"arrow",name:"Arrow",parentId:"page",childIndex:1,point:[0,0],rotation:0,bend:0,handles:{start:S({id:"start",index:0,point:[0,0],canBind:!0},(t=e.handles)==null?void 0:t.start),end:S({id:"end",index:1,point:[1,1],canBind:!0},(n=e.handles)==null?void 0:n.end),bend:S({id:"bend",index:2,point:[.5,.5]},(o=e.handles)==null?void 0:o.bend)},decorations:(s=e.decorations)!=null?s:{end:"arrow"},style:S(w(S({},gt),{isFilled:!1}),e.style),label:"",labelPoint:[.5,.5]},e)});l(this,"Component",we.Component(({shape:e,isEditing:t,isGhost:n,meta:o,events:s,onShapeChange:a,onShapeBlur:d},i)=>{var de,He;let{id:c,label:u="",handles:{start:p,bend:m,end:h},decorations:g={},style:f}=e,T=(He=(de=u==null?void 0:u.trim())==null?void 0:de.length)!=null?He:0>0,x=fe.Vec.dist(m.point,fe.Vec.toFixed(fe.Vec.med(p.point,h.point)))<1,b=Mt(f),y=Te(f,o.isDarkMode),R=T||t?Qn(u,b):[0,0],K=this.getBounds(e),L=qe.useMemo(()=>{let{start:Pe,bend:Me,end:Ue}=e.handles;if(x)return fe.Vec.dist(Pe.point,Ue.point);let Ke=jn(Pe.point,Me.point,Ue.point),Kt=Ke.slice(0,2),gn=Ke[2],dr=xo(Kt,gn,Pe.point,Ue.point);return Math.abs(dr)},[e.handles]),v=Math.max(.5,Math.min(1,Math.max(L/(R[1]+128),L/(R[0]+128)))),I=qe.useMemo(()=>{let Pe=this.getBounds(e);return fe.Vec.sub(e.handles.bend.point,fe.Vec.toFixed([Pe.width/2,Pe.height/2]))},[e,v]),J=qe.useCallback(Pe=>{a==null||a({id:c,label:Pe})},[a]),ce=x?rc:nc;return qe.createElement(lde,S({ref:i},s),qe.createElement(to,{font:b,text:u,color:y.stroke,offsetX:I[0],offsetY:I[1],scale:v,isEditing:t,onChange:J,onBlur:d}),qe.createElement(Ht.SVGContainer,{id:e.id+"_svg"},qe.createElement("defs",null,qe.createElement("mask",{id:e.id+"_clip"},qe.createElement("rect",{x:-100,y:-100,width:K.width+200,height:K.height+200,fill:"white"}),qe.createElement("rect",{x:K.width/2-R[0]/2*v+I[0],y:K.height/2-R[1]/2*v+I[1],width:R[0]*v,height:R[1]*v,rx:4*v,ry:4*v,fill:"black",opacity:1}))),qe.createElement("g",{pointerEvents:"none",opacity:n?.3:1,mask:T||t?`url(#${e.id}_clip)`:""},qe.createElement(ce,{id:c,style:f,start:p.point,end:h.point,bend:m.point,arrowBend:e.bend,decorationStart:g==null?void 0:g.start,decorationEnd:g==null?void 0:g.end,isDraw:f.dash==="draw",isDarkMode:o.isDarkMode}))))}));l(this,"Indicator",we.Indicator(({shape:e,bounds:t})=>{var T,x;let{style:n,decorations:o,label:s,handles:{start:a,bend:d,end:i}}=e,c=(x=(T=s==null?void 0:s.trim())==null?void 0:T.length)!=null?x:0>0,u=Mt(n),p=c?Qn(s,u):[0,0],m=fe.Vec.dist(d.point,fe.Vec.toFixed(fe.Vec.med(a.point,i.point)))<1,h=qe.useMemo(()=>{let{start:b,bend:y,end:R}=e.handles;if(m)return fe.Vec.dist(b.point,R.point);let K=jn(b.point,y.point,R.point),L=K.slice(0,2),v=K[2],I=xo(L,v,b.point,R.point);return Math.abs(I)},[e.handles]),g=Math.max(.5,Math.min(1,Math.max(h/(p[1]+128),h/(p[0]+128)))),f=qe.useMemo(()=>{let b=this.getBounds(e);return fe.Vec.sub(e.handles.bend.point,[b.width/2,b.height/2])},[e,g]);return qe.createElement(qe.Fragment,null,c&&qe.createElement(jd,{id:e.id,scale:g,offset:f,bounds:t,labelSize:p}),qe.createElement("path",{d:Qd(n,a.point,d.point,i.point,o==null?void 0:o.start,o==null?void 0:o.end),mask:c?`url(#${e.id}_clip)`:""}),c&&qe.createElement("rect",{x:t.width/2-p[0]/2*g+f[0],y:t.height/2-p[1]/2*g+f[1],width:p[0]*g,height:p[1]*g,rx:4*g,ry:4*g,fill:"transparent"}))}));l(this,"getBounds",e=>{let t=Ht.Utils.getFromCache(this.boundsCache,e,()=>{let{handles:{start:n,bend:o,end:s}}=e;return Ht.Utils.getBoundsFromPoints(vr(n.point,o.point,s.point))});return Ht.Utils.translateBounds(t,e.point)});l(this,"getRotatedBounds",e=>{let{handles:{start:t,bend:n,end:o}}=e,s=vr(t.point,n.point,o.point),{minX:a,minY:d,maxX:i,maxY:c}=Ht.Utils.getBoundsFromPoints(s);return e.rotation!==0&&(s=s.map(u=>fe.Vec.rotWith(u,[(a+i)/2,(d+c)/2],e.rotation||0))),Ht.Utils.translateBounds(Ht.Utils.getBoundsFromPoints(s),e.point)});l(this,"getCenter",e=>{let{start:t,end:n}=e.handles;return fe.Vec.add(e.point,fe.Vec.med(t.point,n.point))});l(this,"shouldRender",(e,t)=>t.decorations!==e.decorations||t.handles!==e.handles||t.style!==e.style||t.label!==e.label);l(this,"hitTestPoint",(e,t)=>{let{handles:{start:n,bend:o,end:s}}=e,a=fe.Vec.sub(t,e.point),d=vr(n.point,o.point,s.point);for(let i=1;i<d.length;i++)if(fe.Vec.distanceToLineSegment(d[i-1],d[i],a)<1)return!0;return!1});l(this,"hitTestLineSegment",(e,t,n)=>{let{handles:{start:o,bend:s,end:a}}=e,d=fe.Vec.sub(t,e.point),i=fe.Vec.sub(n,e.point),c=vr(o.point,s.point,a.point);for(let u=1;u<c.length;u++)if((0,Xo.intersectLineSegmentLineSegment)(c[u-1],c[u],d,i).didIntersect)return!0;return!1});l(this,"hitTestBounds",(e,t)=>{let{start:n,end:o,bend:s}=e.handles,a=fe.Vec.add(e.point,n.point),d=fe.Vec.add(e.point,o.point);if(Ht.Utils.pointInBounds(a,t)||Ht.Utils.pointInBounds(d,t))return!0;if(fe.Vec.isEqual(fe.Vec.med(n.point,o.point),s.point))return(0,Xo.intersectLineSegmentBounds)(a,d,t).length>0;{let[i,c,u]=jn(n.point,s.point,o.point),p=fe.Vec.add(e.point,[i,c]);return(0,Xo.intersectArcBounds)(p,u,a,d,t).length>0}});l(this,"transform",(e,t,{initialShape:n,scaleX:o,scaleY:s})=>{let a=this.getBounds(n),d=["start","end"],i=S({},n.handles);d.forEach(p=>{if(p==="bend")return;let[m,h]=i[p].point,g=m/a.width,f=h/a.height;i[p]=w(S({},i[p]),{point:[t.width*(o<0?1-g:g),t.height*(s<0?1-f:f)]})});let c=o>0&&s<0||o<0&&s>0?-n.bend:n.bend,u=kr(i,c);return i.bend.point=u,{point:fe.Vec.toFixed([t.minX,t.minY]),handles:i,bend:c}});l(this,"onDoubleClickHandle",(e,t)=>{var n,o;switch(t){case"bend":return{bend:0,handles:w(S({},e.handles),{bend:w(S({},e.handles.bend),{point:kr(e.handles,e.bend)})})};case"start":return{decorations:w(S({},e.decorations),{start:((n=e.decorations)==null?void 0:n.start)?void 0:"arrow"})};case"end":return{decorations:w(S({},e.decorations),{end:((o=e.decorations)==null?void 0:o.end)?void 0:"arrow"})}}return this});l(this,"onHandleChange",(e,t)=>{let n=Ht.Utils.deepMerge(e.handles,t),o=e.bend;if(n=Ht.Utils.deepMerge(n,{start:{point:fe.Vec.toFixed(n.start.point)},end:{point:fe.Vec.toFixed(n.end.point)}}),fe.Vec.isEqual(n.start.point,n.end.point))return;if("bend"in t){let{start:c,end:u,bend:p}=n,m=fe.Vec.dist(c.point,u.point),h=fe.Vec.med(c.point,u.point),g=fe.Vec.angle(c.point,u.point),f=fe.Vec.uni(fe.Vec.vec(c.point,u.point)),T=fe.Vec.add(h,fe.Vec.mul(fe.Vec.per(f),m)),x=fe.Vec.sub(h,fe.Vec.mul(fe.Vec.per(f),m)),b=fe.Vec.nearestPointOnLineSegment(T,x,p.point,!0),R=fe.Vec.dist(h,b)/(m/2);o=Ht.Utils.clamp(R,-.99,.99);let K=fe.Vec.angle(c.point,b);fe.Vec.isEqual(h,kr(n,o))?o=0:ec(g,g+Math.PI,K)&&(o*=-1)}let s={point:e.point,bend:o,handles:w(S({},n),{bend:w(S({},n.bend),{point:kr(n,o)})})},a=e.point,d=this.getBounds(S({},s)),i=fe.Vec.sub([d.minX,d.minY],a);return fe.Vec.isEqual(i,[0,0])||(Object.values(s.handles).forEach(c=>{c.point=fe.Vec.toFixed(fe.Vec.sub(c.point,i))}),s.point=fe.Vec.toFixed(fe.Vec.add(s.point,i))),s});l(this,"getSvgElement",(e,t)=>{var s,a,d,i,c;let n=(s=document.getElementById(e.id+"_svg"))==null?void 0:s.cloneNode(!0);if(!n)return;if((i=(d=(a=e.label)==null?void 0:a.trim())==null?void 0:d.length)!=null?i:0>0){let u=e,p=document.createElementNS("http://www.w3.org/2000/svg","g"),m=Mt(e.style),h=Qn(e.label,m),g=yo(e.style.size,e.style.font)*((c=e.style.scale)!=null?c:1),f=wn(e.style.font).slice(1,-1),T=eo(u.label,g,f,"start",h[0],!1),x,{start:b,bend:y,end:R}=e.handles;if(fe.Vec.dist(y.point,fe.Vec.toFixed(fe.Vec.med(b.point,R.point)))<1)x=fe.Vec.dist(b.point,R.point);else{let de=jn(b.point,y.point,R.point),He=de.slice(0,2),Pe=de[2],Me=xo(He,Pe,b.point,R.point);x=Math.abs(Me)}let L=Math.max(.5,Math.min(1,Math.max(x/(h[1]+128),x/(h[0]+128)))),v=this.getBounds(e),I=fe.Vec.sub(e.handles.bend.point,[v.width/2,v.height/2]),J=v.width/2-h[0]/2*L+I[0],ce=v.height/2-h[1]/2*L+I[1];return T.setAttribute("transform",`translate(${J}, ${ce})`),T.setAttribute("fill",Te(e.style,t).stroke),T.setAttribute("transform-origin","center center"),p.setAttribute("text-align","center"),p.setAttribute("text-anchor","middle"),p.appendChild(n),p.appendChild(T),p}return n})}},lde=H("div",{width:"100%",height:"100%"});var Qe=require("@tldraw/core"),Gn=require("@tldraw/intersect"),Cn=require("@tldraw/vec"),ft=V(require("react"));var Es=require("@tldraw/core"),sc=V(require("@tldraw/vec")),Ir=require("perfect-freehand");var dde={easing:r=>Math.sin(r*Math.PI/2),simulatePressure:!0},cde={easing:r=>r*r,simulatePressure:!1};function Zi(r){let e=Te(r.style);return w(S({size:1+e.strokeWidth*1.5,thinning:.65,streamline:.65,smoothing:.65},r.points[1][2]===.5?dde:cde),{last:r.isComplete})}function ic(r){return r.points.length<2?"":Es.Utils.getSvgPathFromStroke((0,Ir.getStrokePoints)(r.points,Zi(r)).map(e=>e.point))}function ac(r,e){return(0,Ir.getStrokePoints)(r.points,e)}function lc(r){if(r.points.length<2)return"";let e=Zi(r),t=ac(r,e);return Es.Utils.getSvgPathFromStroke((0,Ir.getStrokeOutlinePoints)(t,e))}function Xi(r){let{points:e}=r;if(e.length<2)return"M 0 0 L 0 0";let t=Zi(r),n=ac(r,t),o=e[e.length-1];return sc.default.isEqual(n[0].point,o)||n.push({point:o}),Es.Utils.getSvgPathFromStrokePoints(n)}var qi=class extends we{constructor(){super(...arguments);l(this,"type","draw");l(this,"pointsBoundsCache",new WeakMap([]));l(this,"shapeBoundsCache",new Map);l(this,"rotatedCache",new WeakMap([]));l(this,"pointCache",{});l(this,"canClone",!0);l(this,"getShape",e=>Qe.Utils.deepMerge({id:"id",type:"draw",name:"Draw",parentId:"page",childIndex:1,point:[0,0],rotation:0,style:gt,points:[],isComplete:!1},e));l(this,"Component",we.Component(({shape:e,meta:t,isSelected:n,isGhost:o,events:s},a)=>{let{points:d,style:i,isComplete:c}=e,u=ft.useMemo(()=>ic(e),[d,i.size]),p=ft.useMemo(()=>i.dash==="draw"?lc(e):Xi(e),[d,i.size,i.dash,c]),m=Te(i,t.isDarkMode),{stroke:h,fill:g,strokeWidth:f}=m,T=this.getBounds(e);if(T.width<=f/2&&T.height<=f/2){let L=1+f;return ft.createElement(Qe.SVGContainer,S({ref:a,id:e.id+"_svg"},s),ft.createElement("circle",{r:L,fill:h,stroke:h,pointerEvents:"all",opacity:o?.3:1}))}let b=i.isFilled&&d.length>3&&Cn.Vec.dist(d[0],d[d.length-1])<f*2;if(e.style.dash==="draw")return ft.createElement(Qe.SVGContainer,S({ref:a,id:e.id+"_svg"},s),ft.createElement("g",{opacity:o?.3:1},ft.createElement("path",{className:b||n?"tl-fill-hitarea":"tl-stroke-hitarea",d:p}),b&&ft.createElement("path",{d:u,stroke:"none",fill:g,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none"}),ft.createElement("path",{d:p,fill:h,stroke:h,strokeWidth:f/2,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none"})));let y={["draw"]:"none",["solid"]:"none",["dotted"]:`0.1 ${f*4}`,["dashed"]:`${f*4} ${f*4}`}[i.dash],R={["draw"]:"none",["solid"]:"none",["dotted"]:"0",["dashed"]:"0"}[i.dash],K=1+f*1.5;return ft.createElement(Qe.SVGContainer,S({ref:a,id:e.id+"_svg"},s),ft.createElement("g",{opacity:o?.3:1},ft.createElement("path",{className:b&&n?"tl-fill-hitarea":"tl-stroke-hitarea",d:p}),ft.createElement("path",{d:p,fill:b?g:"none",stroke:"none",strokeWidth:Math.min(4,f*2),strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none"}),ft.createElement("path",{d:p,fill:"none",stroke:h,strokeWidth:K,strokeDasharray:y,strokeDashoffset:R,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none"})))}));l(this,"Indicator",we.Indicator(({shape:e})=>{let{points:t}=e,n=ft.useMemo(()=>Xi(e),[t]),o=this.getBounds(e);return o.width<4&&o.height<4?ft.createElement("circle",{x:o.width/2,y:o.height/2,r:1}):ft.createElement("path",{d:n})}));l(this,"transform",(e,t,{initialShape:n,scaleX:o,scaleY:s})=>{let a=Qe.Utils.getFromCache(this.boundsCache,n,()=>Qe.Utils.getBoundsFromPoints(n.points)),d=n.points.map(([u,p,m])=>[t.width*(o<0?1-u/a.width:u/a.width),t.height*(s<0?1-p/a.height:p/a.height),m]),i=Qe.Utils.getBoundsFromPoints(e.points),c=Cn.Vec.sub([t.minX,t.minY],[i.minX,i.minY]);return{points:d,point:c}});l(this,"getBounds",e=>{let t=!this.pointsBoundsCache.has(e.points),n=this.pointCache[e.id]!==e.point;if(t){let o=Qe.Utils.getBoundsFromPoints(e.points);this.pointsBoundsCache.set(e.points,o),this.shapeBoundsCache.set(e.id,Qe.Utils.translateBounds(o,e.point)),this.pointCache[e.id]=e.point}else n&&!t&&(this.pointCache[e.id]=e.point,this.shapeBoundsCache.set(e.id,Qe.Utils.translateBounds(this.pointsBoundsCache.get(e.points),e.point)));return this.shapeBoundsCache.get(e.id)});l(this,"shouldRender",(e,t)=>t.points!==e.points||t.style!==e.style||t.isComplete!==e.isComplete);l(this,"hitTestPoint",(e,t)=>{let n=Cn.Vec.sub(t,e.point);return Qe.Utils.pointInPolyline(n,e.points)});l(this,"hitTestLineSegment",(e,t,n)=>{let{points:o,point:s}=e,a=Cn.Vec.sub(t,s),d=Cn.Vec.sub(n,s),i=this.getBounds(e);if(i.width<8&&i.height<8)return Cn.Vec.distanceToLineSegment(t,n,Qe.Utils.getBoundsCenter(i))<5;if((0,Gn.intersectLineSegmentBounds)(a,d,i)){for(let c=1;c<o.length;c++)if((0,Gn.intersectLineSegmentLineSegment)(o[c-1],o[c],a,d).didIntersect)return!0}return!1});l(this,"hitTestBounds",(e,t)=>{if(!e.rotation){let s=this.getBounds(e);return Qe.Utils.boundsContain(t,s)||(Qe.Utils.boundsContain(s,t)||(0,Gn.intersectBoundsBounds)(s,t).length>0)&&(0,Gn.intersectBoundsPolyline)(Qe.Utils.translateBounds(t,Cn.Vec.neg(e.point)),e.points).length>0}let n=this.getRotatedBounds(e),o=Qe.Utils.getFromCache(this.rotatedCache,e,()=>{let s=Qe.Utils.getBoundsCenter(Qe.Utils.getBoundsFromPoints(e.points));return e.points.map(a=>Cn.Vec.rotWith(a,s,e.rotation||0))});return Qe.Utils.boundsContain(t,n)||(0,Gn.intersectBoundsPolyline)(Qe.Utils.translateBounds(t,Cn.Vec.neg(e.point)),o).length>0})}};var qt=require("@tldraw/core"),so=require("@tldraw/intersect"),It=require("@tldraw/vec"),Dn=V(require("react"));var Ji=require("@tldraw/core"),ro=V(require("react"));var dc=ro.memo(function({radius:e,style:t,isSelected:n,isDarkMode:o}){let{stroke:s,strokeWidth:a,fill:d}=Te(t,o),i=1+a*1.618,c=Math.max(0,e[0]-i/2),u=Math.max(0,e[1]-i/2),p=Ji.Utils.perimeterOfEllipse(c,u),{strokeDasharray:m,strokeDashoffset:h}=Ji.Utils.getPerfectDashProps(p<64?p*2:p,a*1.618,t.dash,4);return ro.createElement(ro.Fragment,null,ro.createElement("ellipse",{className:t.isFilled||n?"tl-fill-hitarea":"tl-stroke-hitarea",cx:e[0],cy:e[1],rx:e[0],ry:e[1]}),ro.createElement("ellipse",{cx:e[0],cy:e[1],rx:c,ry:u,fill:d,stroke:s,strokeWidth:i,strokeDasharray:m,strokeDashoffset:h,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round"}))});var Vn=V(require("react"));var wo=require("@tldraw/core"),Bs=require("perfect-freehand");function cc(r,e,t){let{strokeWidth:n}=Te(t),o=wo.Utils.rng(r),s=e[0]+o()*n*2,a=e[1]+o()*n*2,d=wo.Utils.perimeterOfEllipse(s,a),i=[],c=Math.PI+Math.PI*o(),u=Math.abs(o()),p=Math.max(16,d/10);for(let m=0;m<p;m++){let h=bo.easeInOutSine(m/(p+1)),g=c*2+Math.PI*(2+u)*h,f=Math.cos(g),T=Math.sin(g);i.push([s*f+e[0],a*T+e[1],h+.5+o()/2])}return(0,Bs.getStrokePoints)(i,{size:1+n*2,thinning:.618,end:{taper:d/8},start:{taper:d/12},streamline:0,simulatePressure:!0})}function pc(r,e,t){let{strokeWidth:n}=Te(t),o=wo.Utils.rng(r),s=e[0]+o()*n*2,a=e[1]+o()*n*2,d=wo.Utils.perimeterOfEllipse(s,a);return wo.Utils.getSvgPathFromStroke((0,Bs.getStrokeOutlinePoints)(cc(r,e,t),{size:2+n*2,thinning:.618,end:{taper:d/8},start:{taper:d/12},streamline:0,simulatePressure:!0}))}function Rs(r,e,t){return wo.Utils.getSvgPathFromStrokePoints(cc(r,e,t))}var uc=Vn.memo(function({id:e,radius:t,style:n,isSelected:o,isDarkMode:s}){let{stroke:a,strokeWidth:d,fill:i}=Te(n,s),c=pc(e,t,n);return Vn.createElement(Vn.Fragment,null,Vn.createElement("ellipse",{className:n.isFilled||o?"tl-fill-hitarea":"tl-stroke-hitarea",cx:t[0],cy:t[1],rx:t[0],ry:t[1]}),n.isFilled&&Vn.createElement("path",{d:Rs(e,t,n),stroke:"none",fill:i,pointerEvents:"none"}),Vn.createElement("path",{d:c,fill:a,stroke:a,strokeWidth:d,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round"}))});var Qi=class extends we{constructor(){super(...arguments);l(this,"type","ellipse");l(this,"canBind",!0);l(this,"canClone",!0);l(this,"canEdit",!0);l(this,"getShape",e=>qt.Utils.deepMerge({id:"id",type:"ellipse",name:"Ellipse",parentId:"page",childIndex:1,point:[0,0],radius:[1,1],rotation:0,style:gt,label:"",labelPoint:[.5,.5]},e));l(this,"Component",we.Component(({shape:e,isGhost:t,isSelected:n,isBinding:o,isEditing:s,meta:a,bounds:d,events:i,onShapeChange:c,onShapeBlur:u},p)=>{let{id:m,radius:h,style:g,label:f="",labelPoint:T=No}=e,x=Mt(e.style),b=Te(g,a.isDarkMode),y=b.strokeWidth,R=1+y*1.618,K=Math.max(0,h[0]-R/2),L=Math.max(0,h[1]-R/2),v=g.dash==="draw"?uc:dc,I=Dn.useCallback(J=>c==null?void 0:c({id:m,label:J}),[c]);return Dn.createElement(pde,S({ref:p},i),Dn.createElement(to,{isEditing:s,onChange:I,onBlur:u,font:x,text:f,color:b.stroke,offsetX:(T[0]-.5)*d.width,offsetY:(T[1]-.5)*d.height}),Dn.createElement(qt.SVGContainer,{id:e.id+"_svg",opacity:t?.3:1},o&&Dn.createElement("ellipse",{className:"tl-binding-indicator",cx:h[0],cy:h[1],rx:K,ry:L,strokeWidth:this.bindingDistance}),Dn.createElement(v,{id:m,radius:h,style:g,isSelected:n,isDarkMode:a.isDarkMode})))}));l(this,"Indicator",we.Indicator(({shape:e})=>{let{id:t,radius:n,style:o}=e,a=Te(o).strokeWidth,d=1+a*1.618,i=Math.max(0,n[0]-d/2),c=Math.max(0,n[1]-d/2);return o.dash==="draw"?Dn.createElement("path",{d:Rs(t,n,o)}):Dn.createElement("ellipse",{cx:n[0],cy:n[1],rx:i,ry:c})}));l(this,"hitTestPoint",(e,t)=>qt.Utils.pointInBounds(t,this.getRotatedBounds(e))&&qt.Utils.pointInEllipse(t,this.getCenter(e),e.radius[0],e.radius[1],e.rotation||0));l(this,"hitTestLineSegment",(e,t,n)=>(0,so.intersectLineSegmentEllipse)(t,n,this.getCenter(e),e.radius[0],e.radius[1],e.rotation||0).didIntersect);l(this,"getBounds",e=>qt.Utils.getFromCache(this.boundsCache,e,()=>qt.Utils.getRotatedEllipseBounds(e.point[0],e.point[1],e.radius[0],e.radius[1],0)));l(this,"getRotatedBounds",e=>qt.Utils.getRotatedEllipseBounds(e.point[0],e.point[1],e.radius[0],e.radius[1],e.rotation));l(this,"hitTestBounds",(e,t)=>{let n=this.getBounds(e);return qt.Utils.boundsContained(n,t)||(0,so.intersectEllipseBounds)(this.getCenter(e),e.radius[0],e.radius[1],e.rotation||0,t).length>0});l(this,"shouldRender",(e,t)=>t.radius!==e.radius||t.style!==e.style||t.label!==e.label);l(this,"getCenter",e=>It.Vec.add(e.point,e.radius));l(this,"getBindingPoint",(e,t,n,o,s,a)=>{{let d=this.getExpandedBounds(e),i=this.getCenter(e),c,u;if(!qt.Utils.pointInEllipse(n,i,e.radius[0]+this.bindingDistance,e.radius[1]+this.bindingDistance))return;if(a)It.Vec.dist(n,this.getCenter(e))<12?c=[.5,.5]:c=It.Vec.divV(It.Vec.sub(n,[d.minX,d.minY]),[d.width,d.height]),u=0;else{let p=(0,so.intersectRayEllipse)(o,s,i,e.radius[0],e.radius[1],e.rotation||0).points.sort((h,g)=>It.Vec.dist(h,o)-It.Vec.dist(g,o))[0];if(p||(p=(0,so.intersectLineSegmentEllipse)(n,i,i,e.radius[0],e.radius[1],e.rotation||0).points.sort((h,g)=>It.Vec.dist(h,n)-It.Vec.dist(g,n))[0]),!p)return;let m=It.Vec.med(n,p);if(It.Vec.distanceToLineSegment(n,m,this.getCenter(e))<12?c=[.5,.5]:c=It.Vec.divV(It.Vec.sub(m,[d.minX,d.minY]),[d.width,d.height]),qt.Utils.pointInEllipse(n,i,e.radius[0],e.radius[1],e.rotation||0))u=this.bindingDistance/2;else{let h=(0,so.intersectLineSegmentEllipse)(n,i,i,e.radius[0],e.radius[1],e.rotation||0).points[0];if(!h)return;u=Math.max(this.bindingDistance/2,It.Vec.dist(n,h))}}return{point:c,distance:u}}});l(this,"transform",(e,t,{scaleX:n,scaleY:o,initialShape:s})=>{let{rotation:a=0}=s;return{point:[t.minX,t.minY],radius:[t.width/2,t.height/2],rotation:n<0&&o>=0||o<0&&n>=0?-(a||0):a||0}});l(this,"transformSingle",(e,t)=>({point:It.Vec.toFixed([t.minX,t.minY]),radius:It.Vec.div([t.width,t.height],2)}))}},pde=H("div",{width:"100%",height:"100%"});var As=require("@tldraw/core"),$n=V(require("react"));var ea=class extends we{constructor(){super(...arguments);l(this,"type","group");l(this,"canBind",!0);l(this,"getShape",e=>As.Utils.deepMerge({id:"id",type:"group",name:"Group",parentId:"page",childIndex:1,point:[0,0],size:[100,100],rotation:0,children:[],style:gt},e));l(this,"Component",we.Component(({shape:e,isBinding:t,isGhost:n,isHovered:o,isSelected:s,events:a},d)=>{let{id:i,size:c}=e,u=2,p=Math.max(0,c[0]-u/2),m=Math.max(0,c[1]-u/2),g=[[[u/2,u/2],[p,u/2],p-u/2],[[p,u/2],[p,m],m-u/2],[[p,m],[u/2,m],p-u/2],[[u/2,m],[u/2,u/2],m-u/2]].map(([f,T],x)=>$n.createElement("line",{key:i+"_"+x,x1:f[0],y1:f[1],x2:T[0],y2:T[1]}));return $n.createElement(As.SVGContainer,S({ref:d},a),t&&$n.createElement("rect",{className:"tl-binding-indicator",strokeWidth:this.bindingDistance}),$n.createElement("g",{opacity:n?.3:1},$n.createElement("rect",{x:0,y:0,width:c[0],height:c[1],fill:"transparent",pointerEvents:"all"}),$n.createElement(hc,{stroke:"black",opacity:o||s?1:0,strokeLinecap:"round",pointerEvents:"stroke"},g)))}));l(this,"Indicator",we.Indicator(({shape:e})=>{let{id:t,size:n}=e,o=2,s=Math.max(0,n[0]-o/2),a=Math.max(0,n[1]-o/2),i=[[[o/2,o/2],[s,o/2],s-o/2],[[s,o/2],[s,a],a-o/2],[[s,a],[o/2,a],s-o/2],[[o/2,a],[o/2,o/2],a-o/2]].map(([c,u],p)=>$n.createElement("line",{key:t+"_"+p,x1:c[0],y1:c[1],x2:u[0],y2:u[1]}));return $n.createElement(hc,{strokeLinecap:"round",pointerEvents:"stroke"},i)}));l(this,"getBounds",e=>Zt(e,this.boundsCache));l(this,"shouldRender",(e,t)=>t.size!==e.size||t.style!==e.style)}},hc=H("g",{strokeWidth:"calc(1.5px * var(--tl-scale))",strokeDasharray:"calc(1px * var(--tl-scale)), calc(3px * var(--tl-scale))"});var ta=require("@stitches/react"),Ls=require("@tldraw/core"),ln=V(require("react"));var na=class extends we{constructor(){super(...arguments);l(this,"type","image");l(this,"canBind",!0);l(this,"canClone",!0);l(this,"isAspectRatioLocked",!0);l(this,"showCloneHandles",!1);l(this,"getShape",e=>Ls.Utils.deepMerge({id:"image",type:"image",name:"Image",parentId:"page",childIndex:1,point:[0,0],size:[1,1],rotation:0,style:w(S({},gt),{isFilled:!0}),assetId:"assetId"},e));l(this,"Component",we.Component(({shape:e,asset:t={src:""},isBinding:n,isGhost:o,meta:s,events:a,onShapeChange:d},i)=>{let{size:c,style:u}=e,{bindingDistance:p}=this,m=ln.useRef(null),h=ln.useRef(null);return ln.useLayoutEffect(()=>{let g=h.current;if(!g)return;let[f,T]=c;g.style.width=`${f}px`,g.style.height=`${T}px`},[c]),ln.createElement(Ls.HTMLContainer,S({ref:i},a),n&&ln.createElement("div",{className:"tl-binding-indicator",style:{position:"absolute",top:`calc(${-p}px * var(--tl-zoom))`,left:`calc(${-p}px * var(--tl-zoom))`,width:`calc(100% + ${p*2}px * var(--tl-zoom))`,height:`calc(100% + ${p*2}px * var(--tl-zoom))`,backgroundColor:"var(--tl-selectFill)"}}),ln.createElement(ude,{ref:h,isDarkMode:s.isDarkMode,isFilled:u.isFilled,isGhost:o},ln.createElement(hde,{id:e.id+"_image",ref:m,src:t.src,alt:"tl_image_asset",draggable:!1})))}));l(this,"Indicator",we.Indicator(({shape:e})=>{let{size:[t,n]}=e;return ln.createElement("rect",{x:0,y:0,rx:2,ry:2,width:Math.max(1,t),height:Math.max(1,n)})}));l(this,"getBounds",e=>Zt(e,this.boundsCache));l(this,"shouldRender",(e,t)=>t.size!==e.size||t.style!==e.style);l(this,"transform",no);l(this,"transformSingle",oo);l(this,"getSvgElement",e=>{let t=this.getBounds(e),n=document.createElementNS("http://www.w3.org/2000/svg","image");return n.setAttribute("width",`${t.width}`),n.setAttribute("height",`${t.height}`),n.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),n})}},ude=(0,ta.styled)("div",{pointerEvents:"all",position:"relative",fontFamily:"sans-serif",fontSize:"2em",height:"100%",width:"100%",borderRadius:"3px",perspective:"800px",overflow:"hidden",p:{userSelect:"none"},img:{userSelect:"none"},variants:{isGhost:{false:{opacity:1},true:{transition:"opacity .2s",opacity:.3}},isFilled:{true:{},false:{}},isDarkMode:{true:{},false:{}}},compoundVariants:[{isFilled:!0,isDarkMode:!0,css:{boxShadow:"2px 3px 12px -2px rgba(0,0,0,.3), 1px 1px 4px rgba(0,0,0,.3), 1px 1px 2px rgba(0,0,0,.3)"}},{isFilled:!0,isDarkMode:!1,css:{boxShadow:"2px 3px 12px -2px rgba(0,0,0,.2), 1px 1px 4px rgba(0,0,0,.16),  1px 1px 2px rgba(0,0,0,.16)"}}]}),hde=(0,ta.styled)("img",{position:"absolute",top:0,left:0,width:"100%",height:"100%",maxWidth:"100%",minWidth:"100%",pointerEvents:"none",objectFit:"cover",userSelect:"none",borderRadius:2});var Os=require("@tldraw/core"),Mn=V(require("react"));var mc=V(require("react"));function gc({strokeWidth:r,size:e}){return mc.createElement("rect",{className:"tl-binding-indicator",x:r,y:r,width:Math.max(0,e[0]-r/2),height:Math.max(0,e[1]-r/2),strokeWidth:16*2})}var fc=require("@tldraw/core"),Pn=V(require("react"));var Sc=Pn.memo(function({id:e,style:t,size:n,isSelected:o,isDarkMode:s}){let{stroke:a,strokeWidth:d,fill:i}=Te(t,s),c=1+d*1.618,u=Math.max(0,n[0]-c/2),p=Math.max(0,n[1]-c/2),h=[[[c/2,c/2],[u,c/2],u-c/2],[[u,c/2],[u,p],p-c/2],[[u,p],[c/2,p],u-c/2],[[c/2,p],[c/2,c/2],p-c/2]].map(([g,f,T],x)=>{let{strokeDasharray:b,strokeDashoffset:y}=fc.Utils.getPerfectDashProps(T,d*1.618,t.dash);return Pn.createElement("line",{key:e+"_"+x,x1:g[0],y1:g[1],x2:f[0],y2:f[1],strokeDasharray:b,strokeDashoffset:y})});return Pn.createElement(Pn.Fragment,null,Pn.createElement("rect",{className:o||t.isFilled?"tl-fill-hitarea":"tl-stroke-hitarea",x:c/2,y:c/2,width:u,height:p,strokeWidth:16}),t.isFilled&&Pn.createElement("rect",{x:c/2,y:c/2,width:u,height:p,fill:i,pointerEvents:"none"}),Pn.createElement("g",{pointerEvents:"none",stroke:a,strokeWidth:c,strokeLinecap:"round"},h))});var Nn=V(require("react"));var Cr=require("@tldraw/core"),kt=V(require("@tldraw/vec")),Hs=V(require("perfect-freehand"));function mde(r,e,t){let n=Te(e),o=Cr.Utils.rng(r),s=n.strokeWidth,a=Math.max(0,t[0]),d=Math.max(0,t[1]),i=Array.from(Array(4)).map(()=>[o()*s*.75,o()*s*.75]),c=kt.default.add([s/2,s/2],i[0]),u=kt.default.add([a-s/2,s/2],i[1]),p=kt.default.add([a-s/2,d-s/2],i[2]),m=kt.default.add([s/2,d-s/2],i[3]),h=Math.round(Math.abs(o()*2*4)),g=Math.min(a/4,s*2),f=Math.min(d/4,s*2),T=Math.max(8,Math.floor(a/16)),x=Math.max(8,Math.floor(d/16)),b=Cr.Utils.rotateArray([kt.default.pointsBetween(kt.default.add(c,[g,0]),kt.default.sub(u,[g,0]),T),kt.default.pointsBetween(kt.default.add(u,[0,f]),kt.default.sub(p,[0,f]),x),kt.default.pointsBetween(kt.default.sub(p,[g,0]),kt.default.add(m,[g,0]),T),kt.default.pointsBetween(kt.default.sub(m,[0,f]),kt.default.add(c,[0,f]),x)],h);return{points:[...b.flat(),...b[0]].slice(5,Math.floor((h%2===0?T:x)/-2)+3)}}function bc(r,e,t){let{points:n}=mde(r,e,t),{strokeWidth:o}=Te(e);return{points:n,options:{size:o,thinning:.65,streamline:.3,smoothing:1,simulatePressure:!1,last:!0}}}function Tc(r,e,t){let{points:n,options:o}=bc(r,e,t),s=(0,Hs.default)(n,o);return Cr.Utils.getSvgPathFromStroke(s)}function zs(r,e,t){let{points:n,options:o}=bc(r,e,t);return Cr.Utils.getSvgPathFromStrokePoints((0,Hs.getStrokePoints)(n,o))}var yc=Nn.memo(function({id:e,style:t,size:n,isSelected:o,isDarkMode:s}){let{isFilled:a}=t,{stroke:d,strokeWidth:i,fill:c}=Te(t,s),u=Tc(e,t,n),p=zs(e,t,n);return Nn.createElement(Nn.Fragment,null,Nn.createElement("path",{className:t.isFilled||o?"tl-fill-hitarea":"tl-stroke-hitarea",d:p}),a&&Nn.createElement("path",{d:p,fill:c,pointerEvents:"none"}),Nn.createElement("path",{d:u,fill:d,stroke:d,strokeWidth:i,pointerEvents:"none"}))});var oa=class extends we{constructor(){super(...arguments);l(this,"type","rectangle");l(this,"canBind",!0);l(this,"canClone",!0);l(this,"canEdit",!0);l(this,"getShape",e=>Os.Utils.deepMerge({id:"id",type:"rectangle",name:"Rectangle",parentId:"page",childIndex:1,point:[0,0],size:[1,1],rotation:0,style:gt,label:"",labelPoint:[.5,.5]},e));l(this,"Component",we.Component(({shape:e,isEditing:t,isBinding:n,isSelected:o,isGhost:s,meta:a,bounds:d,events:i,onShapeBlur:c,onShapeChange:u},p)=>{let{id:m,size:h,style:g,label:f="",labelPoint:T=No}=e,x=Mt(g),b=Te(g,a.isDarkMode),y=g.dash==="draw"?yc:Sc,R=Mn.useCallback(K=>u==null?void 0:u({id:m,label:K}),[u]);return Mn.createElement(gde,S({ref:p},i),Mn.createElement(to,{isEditing:t,onChange:R,onBlur:c,font:x,text:f,color:b.stroke,offsetX:(T[0]-.5)*d.width,offsetY:(T[1]-.5)*d.height}),Mn.createElement(Os.SVGContainer,{id:e.id+"_svg",opacity:s?.3:1},n&&Mn.createElement(gc,{strokeWidth:b.strokeWidth,size:h}),Mn.createElement(y,{id:m,style:g,size:h,isSelected:o,isDarkMode:a.isDarkMode})))}));l(this,"Indicator",we.Indicator(({shape:e})=>{let{id:t,style:n,size:o}=e,a=Te(n,!1).strokeWidth;return n.dash==="draw"?Mn.createElement("path",{d:zs(t,n,o)}):Mn.createElement("rect",{x:a,y:a,rx:1,ry:1,width:Math.max(1,o[0]-a*2),height:Math.max(1,o[1]-a*2)})}));l(this,"getBounds",e=>Zt(e,this.boundsCache));l(this,"shouldRender",(e,t)=>t.size!==e.size||t.style!==e.style||t.label!==e.label);l(this,"transform",no);l(this,"transformSingle",oo)}},gde=H("div",{width:"100%",height:"100%"});var Fs=require("@tldraw/core"),xc=require("@tldraw/vec"),et=V(require("react"));var sa=class extends we{constructor(){super(...arguments);l(this,"type","sticky");l(this,"canBind",!0);l(this,"canEdit",!0);l(this,"canClone",!0);l(this,"hideResizeHandles",!0);l(this,"showCloneHandles",!0);l(this,"getShape",e=>Fs.Utils.deepMerge({id:"id",type:"sticky",name:"Sticky",parentId:"page",childIndex:1,point:[0,0],size:[200,200],text:"",rotation:0,style:Ko},e));l(this,"Component",we.Component(({shape:e,meta:t,events:n,isGhost:o,isBinding:s,isEditing:a,onShapeBlur:d,onShapeChange:i},c)=>{let u=Wd(e.style),{color:p,fill:m}=Wi(e.style,t.isDarkMode),h=et.useRef(null),g=et.useRef(null),f=et.useRef(null),T=et.useRef(!1),x=et.useCallback(I=>{I.stopPropagation()},[]),b=et.useCallback(I=>{i==null||i({id:e.id,type:e.type,text:k.normalizeText(I)})},[e.id]),y=et.useCallback(I=>{b(I.currentTarget.value)},[i,b]),R=et.useCallback(I=>{if(I.key==="Escape"){I.preventDefault(),I.stopPropagation(),d==null||d();return}if(I.key==="Tab"&&e.text.length===0){I.preventDefault();return}if(!(I.key==="Meta"||I.metaKey))I.stopPropagation();else if(I.key==="z"&&I.metaKey){I.shiftKey?document.execCommand("redo",!1):document.execCommand("undo",!1),I.stopPropagation(),I.preventDefault();return}(I.metaKey||I.ctrlKey)&&I.key==="="&&I.preventDefault(),I.key==="Tab"&&(I.preventDefault(),I.shiftKey?ct.unindent(I.currentTarget):ct.indent(I.currentTarget),i==null||i(w(S({},e),{text:k.normalizeText(I.currentTarget.value)})))},[e,i]),K=et.useCallback(I=>{I.currentTarget.setSelectionRange(0,0),d==null||d()},[]),L=et.useCallback(I=>{!a||!T.current||I.currentTarget.select()},[a]);et.useEffect(()=>{if(a){T.current=!0;let I=g.current;I.focus(),I.select()}},[a]),et.useEffect(()=>{let I=f.current,{size:J}=e,{offsetHeight:ce}=I,de=ra-En*2,He=J[1]-En*2;if(ce===He)return;if(ce>de){i==null||i({id:e.id,size:[J[0],ce+En*2]});return}if(ce<de&&J[1]>ra){i==null||i({id:e.id,size:[J[0],ra]});return}let Pe=g.current;Pe==null||Pe.focus()},[e.text,e.size[1],e.style]);let v={font:u,color:p,textShadow:t.isDarkMode?"0.5px 0.5px 2px rgba(255, 255, 255,.25)":"0.5px 0.5px 2px rgba(255, 255, 255,.5)"};return et.createElement(Fs.HTMLContainer,S({ref:c},n),et.createElement(fde,{ref:h,isDarkMode:t.isDarkMode,isGhost:o,style:S({backgroundColor:m},v)},s&&et.createElement("div",{className:"tl-binding-indicator",style:{position:"absolute",top:-this.bindingDistance,left:-this.bindingDistance,width:`calc(100% + ${this.bindingDistance*2}px)`,height:`calc(100% + ${this.bindingDistance*2}px)`,backgroundColor:"var(--tl-selectFill)"}}),et.createElement(Sde,{ref:f,isEditing:a,alignment:e.style.textAlign},e.text,"\u200B"),a&&et.createElement(bde,{ref:g,onPointerDown:x,value:e.text,onChange:y,onKeyDown:R,onFocus:L,onBlur:K,tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,spellCheck:!0,alignment:e.style.textAlign,onContextMenu:xt,onCopy:xt,onPaste:xt,onCut:xt})))}));l(this,"Indicator",we.Indicator(({shape:e})=>{let{size:[t,n]}=e;return et.createElement("rect",{x:0,y:0,rx:3,ry:3,width:Math.max(1,t),height:Math.max(1,n)})}));l(this,"getBounds",e=>Zt(e,this.boundsCache));l(this,"shouldRender",(e,t)=>t.size!==e.size||t.style!==e.style||t.text!==e.text);l(this,"transform",(e,t,{scaleX:n,scaleY:o,transformOrigin:s})=>({point:xc.Vec.toFixed([t.minX+(t.width-e.size[0])*(n<0?1-s[0]:s[0]),t.minY+(t.height-e.size[1])*(o<0?1-s[1]:s[1])])}));l(this,"transformSingle",e=>e);l(this,"getSvgElement",(e,t)=>{var p,m;let n=this.getBounds(e),o=Wi(e.style,t),s=Ni(e.style.size)*((p=e.style.scale)!=null?p:1),a=wn(e.style.font).slice(1,-1),d=(m=e.style.textAlign)!=null?m:"start",i=eo(e.text,s,a,d,n.width-En*2,!0);i.setAttribute("fill",o.color),i.setAttribute("transform",`translate(${En}, ${En})`);let c=document.createElementNS("http://www.w3.org/2000/svg","g"),u=document.createElementNS("http://www.w3.org/2000/svg","rect");return u.setAttribute("width",n.width+""),u.setAttribute("height",n.height+""),u.setAttribute("fill",o.fill),u.setAttribute("rx","3"),u.setAttribute("ry","3"),c.appendChild(u),c.appendChild(i),c})}},En=16,ra=200,fde=H("div",{pointerEvents:"all",position:"relative",backgroundColor:"rgba(255, 220, 100)",fontFamily:"sans-serif",height:"100%",width:"100%",padding:En+"px",borderRadius:"3px",perspective:"800px",variants:{isGhost:{false:{opacity:1},true:{transition:"opacity .2s",opacity:.3}},isDarkMode:{true:{boxShadow:"2px 3px 12px -2px rgba(0,0,0,.3), 1px 1px 4px rgba(0,0,0,.3), 1px 1px 2px rgba(0,0,0,.3)"},false:{boxShadow:"2px 3px 12px -2px rgba(0,0,0,.2), 1px 1px 4px rgba(0,0,0,.16),  1px 1px 2px rgba(0,0,0,.16)"}}}}),wc={whiteSpace:"pre-wrap",overflowWrap:"break-word",letterSpacing:Yt},Sde=H("div",S({position:"absolute",top:En,left:En,width:`calc(100% - ${En*2}px)`,height:"fit-content",font:"inherit",pointerEvents:"none",userSelect:"none",variants:{isEditing:{true:{opacity:1},false:{opacity:1}},alignment:{["start"]:{textAlign:"left"},["middle"]:{textAlign:"center"},["end"]:{textAlign:"right"},["justify"]:{textAlign:"justify"}}}},wc)),bde=H("textarea",w(S({width:"100%",height:"100%",border:"none",overflow:"hidden",background:"none",outline:"none",textAlign:"left",font:"inherit",padding:0,color:"transparent",verticalAlign:"top",resize:"none",caretColor:"black"},wc),{variants:{alignment:{["start"]:{textAlign:"left"},["middle"]:{textAlign:"center"},["end"]:{textAlign:"right"},["justify"]:{textAlign:"justify"}}},"&:focus":{outline:"none",border:"none"}}));var qo=require("@tldraw/core"),Wn=require("@tldraw/vec"),tt=V(require("react"));var ia=class extends we{constructor(){super(...arguments);l(this,"type","text");l(this,"isAspectRatioLocked",!0);l(this,"canEdit",!0);l(this,"canBind",!0);l(this,"canClone",!0);l(this,"bindingDistance",16/2);l(this,"getShape",e=>qo.Utils.deepMerge({id:"id",type:"text",name:"Text",parentId:"page",childIndex:1,point:[0,0],rotation:0,text:" ",style:Ko},e));l(this,"texts",new Map);l(this,"Component",we.Component(({shape:e,isBinding:t,isGhost:n,isEditing:o,onShapeBlur:s,onShapeChange:a,meta:d,events:i},c)=>{let{text:u,style:p}=e,m=Te(p,d.isDarkMode),h=Mt(e.style),g=tt.useRef(null),f=tt.useRef(!1),T=tt.useRef(u);tt.useLayoutEffect(()=>{if(u!==T.current){let v=[0,0];this.texts.set(e.id,u);let I=this.getBounds(e),J=this.getBounds(e);switch(e.style.textAlign){case"start":break;case"middle":{v=Wn.Vec.div([J.width-I.width,0],2);break}case"end":{v=[J.width-I.width,0];break}}T.current=u,a==null||a(w(S({},e),{id:e.id,point:Wn.Vec.sub(e.point,v),text:u}))}},[u]);let x=tt.useCallback(v=>{let I=[0,0],J=k.normalizeText(v.currentTarget.value),ce=this.getBounds(e);this.texts.set(e.id,J);let de=this.getBounds(w(S({},e),{text:J}));switch(e.style.textAlign){case"start":break;case"middle":{I=Wn.Vec.div([de.width-ce.width,0],2);break}case"end":{I=[de.width-ce.width,0];break}}T.current=J,a==null||a(w(S({},e),{id:e.id,point:Wn.Vec.sub(e.point,I),text:J}))},[e.id,e.point]),b=tt.useCallback(v=>{if(v.key==="Escape"){v.preventDefault(),v.stopPropagation(),s==null||s();return}if(v.key==="Tab"&&e.text.length===0){v.preventDefault();return}if(v.key==="Enter"&&(v.metaKey||v.ctrlKey)){v.preventDefault(),v.stopPropagation(),g.current.blur();return}if(!(v.key==="Meta"||v.metaKey))v.stopPropagation();else if(v.key==="z"&&v.metaKey){v.shiftKey?document.execCommand("redo",!1):document.execCommand("undo",!1),v.stopPropagation(),v.preventDefault();return}(v.metaKey||v.ctrlKey)&&v.key==="="&&v.preventDefault(),v.key==="Tab"&&(v.preventDefault(),v.shiftKey?ct.unindent(v.currentTarget):ct.indent(v.currentTarget),a==null||a(w(S({},e),{text:k.normalizeText(v.currentTarget.value)})))},[e,a]),y=tt.useCallback(v=>{v.currentTarget.setSelectionRange(0,0),s==null||s()},[]),R=tt.useCallback(v=>{!o||!f.current||document.activeElement===v.currentTarget&&v.currentTarget.select()},[o]),K=tt.useCallback(v=>{o&&v.stopPropagation()},[o]),L=tt.useRef(o);return tt.useEffect(()=>{o?(L.current=!0,this.texts.set(e.id,u),requestAnimationFrame(()=>{f.current=!0;let v=g.current;v&&(v.focus(),v.select())})):L.current&&(L.current=!1,s==null||s())},[o]),tt.createElement(qo.HTMLContainer,S({ref:c},i),tt.createElement(yde,{isGhost:n,isEditing:o,onPointerDown:K},tt.createElement(xde,{style:{font:h,color:m.stroke,textAlign:zd(p.textAlign)}},t&&tt.createElement("div",{className:"tl-binding-indicator",style:{position:"absolute",top:-this.bindingDistance,left:-this.bindingDistance,width:`calc(100% + ${this.bindingDistance*2}px)`,height:`calc(100% + ${this.bindingDistance*2}px)`,backgroundColor:"var(--tl-selectFill)"}}),o?tt.createElement(wde,{ref:g,style:{font:h,color:m.stroke},name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:u,color:m.stroke,onFocus:R,onChange:x,onKeyDown:b,onBlur:y,onPointerDown:K,onContextMenu:xt,onCopy:xt,onPaste:xt,onCut:xt}):u,"\u200B")))}));l(this,"Indicator",we.Indicator(({shape:e})=>{let{width:t,height:n}=this.getBounds(e);return tt.createElement("rect",{x:0,y:0,width:t,height:n})}));l(this,"getBounds",e=>{let t=qo.Utils.getFromCache(this.boundsCache,e,()=>{var s;if(!io)return{minX:0,minY:0,maxX:10,maxY:10,width:10,height:10};io.parentNode||document.body.appendChild(io),io.style.font=Mt(e.style),io.textContent=(s=this.texts.get(e.id))!=null?s:e.text;let n=io.offsetWidth||1,o=io.offsetHeight||1;return{minX:0,maxX:n,minY:0,maxY:o,width:n,height:o}});return qo.Utils.translateBounds(t,e.point)});l(this,"shouldRender",(e,t)=>t.text!==e.text||t.style.scale!==e.style.scale||t.style!==e.style);l(this,"transform",(e,t,{initialShape:n,scaleX:o,scaleY:s})=>{let{rotation:a=0,style:{scale:d=1}}=n,i=d*Math.abs(Math.min(o,s));return{point:[t.minX,t.minY],rotation:o<0&&s>=0||s<0&&o>=0?-(a||0):a,style:w(S({},n.style),{scale:i})}});l(this,"transformSingle",(e,t,{initialShape:n,scaleX:o,scaleY:s})=>{let{style:{scale:a=1}}=n;return{point:Wn.Vec.toFixed([t.minX,t.minY]),style:w(S({},n.style),{scale:a*Math.max(Math.abs(s),Math.abs(o))})}});l(this,"onDoubleClickBoundsHandle",e=>{let t=this.getCenter(e),n=this.getCenter(w(S({},e),{style:w(S({},e.style),{scale:1})}));return{style:w(S({},e.style),{scale:1}),point:Wn.Vec.toFixed(Wn.Vec.add(e.point,Wn.Vec.sub(t,n)))}});l(this,"getSvgElement",(e,t)=>{var c,u;let n=this.getBounds(e),o=Te(e.style,t),s=yo(e.style.size,e.style.font)*((c=e.style.scale)!=null?c:1),a=wn(e.style.font).slice(1,-1),d=(u=e.style.textAlign)!=null?u:"middle",i=eo(e.text,s,a,d,n.width,!1);return i.setAttribute("fill",o.stroke),i})}},io;function Tde(){var e;(e=document.getElementById("__textMeasure"))==null||e.remove();let r=document.createElement("pre");return r.id="__textMeasure",Object.assign(r.style,{whiteSpace:"pre",width:"auto",border:"1px solid transparent",padding:"4px",margin:"0px",letterSpacing:Yt,opacity:"0",position:"absolute",top:"-500px",left:"0px",zIndex:"9999",pointerEvents:"none",userSelect:"none",alignmentBaseline:"mathematical",dominantBaseline:"mathematical"}),r.tabIndex=-1,document.body.appendChild(r),r}typeof window!="undefined"&&(io=Tde());var yde=H("div",{width:"100%",height:"100%",variants:{isGhost:{false:{opacity:1},true:{transition:"opacity .2s",opacity:.3}},isEditing:{false:{pointerEvents:"all",userSelect:"all"},true:{pointerEvents:"none",userSelect:"none"}}}}),kc={whiteSpace:"pre-wrap",overflowWrap:"break-word"},xde=H("div",S({position:"absolute",width:"100%",height:"100%",padding:"4px",zIndex:1,minHeight:1,minWidth:1,lineHeight:1,letterSpacing:Yt,outline:0,fontWeight:"500",backfaceVisibility:"hidden",userSelect:"none",pointerEvents:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",isEditing:{false:{},true:{pointerEvents:"all",background:"$boundsBg",userSelect:"text",WebkitUserSelect:"text"}}},kc)),wde=H("textarea",w(S({position:"absolute",top:0,left:0,zIndex:1,width:"100%",height:"100%",border:"none",padding:"4px",resize:"none",textAlign:"inherit",minHeight:"inherit",minWidth:"inherit",lineHeight:"inherit",letterSpacing:"inherit",outline:0,fontWeight:"inherit",overflow:"hidden",backfaceVisibility:"hidden",display:"inline-block",pointerEvents:"all",background:"$boundsBg",userSelect:"text",WebkitUserSelect:"text"},kc),{"&:focus":{outline:"none",border:"none"}}));var cn=require("@tldraw/core"),Jo=require("@tldraw/intersect"),Ct=V(require("@tldraw/vec")),pn=V(require("react"));var la=require("@tldraw/core"),Dc=V(require("@tldraw/vec")),Bn=V(require("react"));var Dr=require("@tldraw/core"),ao=V(require("@tldraw/vec")),js=V(require("perfect-freehand"));function dn(r,e=0,t=0){let[n,o]=r,s=[[n/2,0],[n,o],[0,o]];return e&&(s=$d(s,e)),t&&(s=s.map(a=>ao.default.rotWith(a,[n/2,o/2],t))),s}function aa(r){let[e,t]=r,n=[[e/2,0],[e,t],[0,t]];return[(n[0][0]+n[1][0]+n[2][0])/3,(n[0][1]+n[1][1]+n[2][1])/3]}function kde(r,e,t){let[n,o]=e,s=Dr.Utils.rng(r),a=Array.from(Array(3)).map(()=>[s()*t*.75,s()*t*.75]),d=[ao.default.add([n/2,0],a[0]),ao.default.add([n,o],a[1]),ao.default.add([0,o],a[2])],i=Math.round(Math.abs(s()*2*3)),c=Dr.Utils.rotateArray([ao.default.pointsBetween(d[0],d[1],32),ao.default.pointsBetween(d[1],d[2],32),ao.default.pointsBetween(d[2],d[0],32)],i);return{points:[...c.flat(),...c[0]]}}function vc(r,e,t){let{strokeWidth:n}=Te(t),{points:o}=kde(r,e,n);return{points:o,options:{size:n,thinning:.65,streamline:.3,smoothing:1,simulatePressure:!1,last:!0}}}function Ic(r,e,t){let{points:n,options:o}=vc(r,e,t),s=(0,js.default)(n,o);return Dr.Utils.getSvgPathFromStroke(s)}function Cc(r,e,t){let{points:n,options:o}=vc(r,e,t);return Dr.Utils.getSvgPathFromStrokePoints((0,js.getStrokePoints)(n,o))}var Pc=Bn.memo(function({id:e,size:t,style:n,isSelected:o,isDarkMode:s}){let{stroke:a,strokeWidth:d,fill:i}=Te(n,s),c=1+d*1.618,u=dn(t),m=la.Utils.pointsToLineSegments(u,!0).map(([g,f],T)=>{let{strokeDasharray:x,strokeDashoffset:b}=la.Utils.getPerfectDashProps(Dc.default.dist(g,f),d*1.618,n.dash);return Bn.createElement("line",{key:e+"_"+T,x1:g[0],y1:g[1],x2:f[0],y2:f[1],stroke:a,strokeWidth:c,strokeLinecap:"round",strokeDasharray:x,strokeDashoffset:b})}),h=u.join();return Bn.createElement(Bn.Fragment,null,Bn.createElement("polygon",{className:n.isFilled||o?"tl-fill-hitarea":"tl-stroke-hitarea",points:h}),n.isFilled&&Bn.createElement("polygon",{fill:i,points:h,pointerEvents:"none"}),Bn.createElement("g",{pointerEvents:"stroke"},m))});var Un=V(require("react"));var Mc=Un.memo(function({id:e,size:t,style:n,isSelected:o,isDarkMode:s}){let{stroke:a,strokeWidth:d,fill:i}=Te(n,s),c=Ic(e,t,n),u=Cc(e,t,n);return Un.createElement(Un.Fragment,null,Un.createElement("path",{className:n.isFilled||o?"tl-fill-hitarea":"tl-stroke-hitarea",d:u}),n.isFilled&&Un.createElement("path",{d:u,fill:i,pointerEvents:"none"}),Un.createElement("path",{d:c,fill:a,stroke:a,strokeWidth:d,pointerEvents:"none"}))});var Ec=V(require("react"));function Bc({size:r}){let e=dn(r).join();return Ec.createElement("polygon",{className:"tl-binding-indicator",points:e,strokeWidth:16*2})}var da=class extends we{constructor(){super(...arguments);l(this,"type","triangle");l(this,"canBind",!0);l(this,"canClone",!0);l(this,"canEdit",!0);l(this,"getShape",e=>cn.Utils.deepMerge({id:"id",type:"triangle",name:"Triangle",parentId:"page",childIndex:1,point:[0,0],size:[1,1],rotation:0,style:gt,label:"",labelPoint:[.5,.5]},e));l(this,"Component",we.Component(({shape:e,bounds:t,isBinding:n,isEditing:o,isSelected:s,isGhost:a,meta:d,events:i,onShapeChange:c,onShapeBlur:u},p)=>{let{id:m,label:h="",size:g,style:f,labelPoint:T=No}=e,x=Mt(f),b=Te(f,d.isDarkMode),y=f.dash==="draw"?Mc:Pc,R=pn.useCallback(L=>c==null?void 0:c({id:m,label:L}),[c]),K=pn.useMemo(()=>{let L=Ct.default.div(g,2);return(aa(g)[1]-L[1])*.72},[g]);return pn.createElement(vde,S({ref:p},i),pn.createElement(to,{font:x,text:h,color:b.stroke,offsetX:(T[0]-.5)*t.width,offsetY:K+(T[1]-.5)*t.height,isEditing:o,onChange:R,onBlur:u}),pn.createElement(cn.SVGContainer,{id:e.id+"_svg",opacity:a?.3:1},n&&pn.createElement(Bc,{size:g}),pn.createElement(y,{id:m,style:f,size:g,isSelected:s,isDarkMode:d.isDarkMode})))}));l(this,"Indicator",we.Indicator(({shape:e})=>{let{size:t}=e;return pn.createElement("polygon",{points:dn(t).join()})}));l(this,"shouldRender",(e,t)=>t.size!==e.size||t.style!==e.style||t.label!==e.label);l(this,"getBounds",e=>Zt(e,this.boundsCache));l(this,"getExpandedBounds",e=>cn.Utils.getBoundsFromPoints(dn(e.size,this.bindingDistance).map(t=>Ct.default.add(t,e.point))));l(this,"hitTestLineSegment",(e,t,n)=>(0,Jo.intersectLineSegmentPolyline)(t,n,this.getPoints(e)).didIntersect);l(this,"hitTestBounds",(e,t)=>cn.Utils.boundsContained(this.getBounds(e),t)||(0,Jo.intersectBoundsPolygon)(t,this.getPoints(e)).length>0);l(this,"getBindingPoint",(e,t,n,o,s,a)=>{let d=this.getExpandedBounds(e);if(!cn.Utils.pointInBounds(n,d))return;let i=dn(e.size).map(b=>Ct.default.add(b,e.point)),c=dn(e.size,this.bindingDistance).map(b=>Ct.default.add(b,e.point)),u=cn.Utils.pointsToLineSegments(i,!0).map(([b,y])=>Ct.default.distanceToLineSegment(b,y,n)).sort((b,y)=>b-y)[0];if(!(cn.Utils.pointInPolygon(n,c)||u<this.bindingDistance))return;let p=cn.Utils.pointsToLineSegments(c.concat([c[0]])).map(b=>(0,Jo.intersectRayLineSegment)(o,s,b[0],b[1])).filter(b=>b.didIntersect).flatMap(b=>b.points);if(!p.length)return;let m=Ct.default.add(aa(e.size),e.point),h=p.sort((b,y)=>Ct.default.dist(y,o)-Ct.default.dist(b,o))[0],g=Ct.default.med(n,h),f,T;a?(f=Ct.default.dist(n,m)<16/2?m:n,T=0):(Ct.default.distanceToLineSegment(n,g,m)<16/2?f=m:f=g,cn.Utils.pointInPolygon(n,i)?T=this.bindingDistance:T=Math.max(this.bindingDistance,u));let x=Ct.default.divV(Ct.default.sub(f,[d.minX,d.minY]),[d.width,d.height]);return{point:Ct.default.clampV(x,0,1),distance:T}});l(this,"transform",no);l(this,"transformSingle",oo)}getPoints(e){let{rotation:t=0,point:[n,o],size:[s,a]}=e;return[[n+s/2,o],[n,o+a],[n+s,o+a]].map(d=>Ct.default.rotWith(d,this.getCenter(e),t))}},vde=H("div",{width:"100%",height:"100%"});var ca=require("@stitches/react"),Gs=require("@tldraw/core"),yt=V(require("react"));var pa=class extends we{constructor(){super(...arguments);l(this,"type","video");l(this,"canBind",!0);l(this,"canEdit",!0);l(this,"canClone",!0);l(this,"isAspectRatioLocked",!0);l(this,"showCloneHandles",!1);l(this,"isStateful",!0);l(this,"getShape",e=>Gs.Utils.deepMerge({id:"video",type:"video",name:"Video",parentId:"page",childIndex:1,point:[0,0],size:[1,1],rotation:0,style:gt,assetId:"assetId",isPlaying:!0,currentTime:0},e));l(this,"Component",we.Component(({shape:e,asset:t={src:""},isBinding:n,isEditing:o,isGhost:s,meta:a,events:d,onShapeChange:i},c)=>{let u=yt.useRef(null),p=yt.useRef(null),{currentTime:m=0,size:h,isPlaying:g,style:f}=e;yt.useLayoutEffect(()=>{let y=p.current;if(!y)return;let[R,K]=h;y.style.width=`${R}px`,y.style.height=`${K}px`},[h]),yt.useLayoutEffect(()=>{let y=u.current;!y||(g?y.play():y.pause())},[g]),yt.useLayoutEffect(()=>{let y=u.current;!y||m!==y.currentTime&&(y.currentTime=m)},[m]);let T=yt.useCallback(()=>{i==null||i({id:e.id,isPlaying:!0})},[]),x=yt.useCallback(()=>{i==null||i({id:e.id,isPlaying:!1})},[]),b=yt.useCallback(()=>{let y=u.current;!y||!o||i==null||i({id:e.id,currentTime:y.currentTime})},[o]);return yt.createElement(Gs.HTMLContainer,S({ref:c},d),n&&yt.createElement("div",{className:"tl-binding-indicator",style:{position:"absolute",top:-this.bindingDistance,left:-this.bindingDistance,width:`calc(100% + ${this.bindingDistance*2}px)`,height:`calc(100% + ${this.bindingDistance*2}px)`,backgroundColor:"var(--tl-selectFill)"}}),yt.createElement(Ide,{ref:p,isDarkMode:a.isDarkMode,isGhost:s,isFilled:f.isFilled},yt.createElement(Cde,{ref:u,id:e.id+"_video",muted:!0,loop:!0,playsInline:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:o,autoPlay:g,onPlay:T,onPause:x,onTimeUpdate:b},yt.createElement("source",{src:t.src}))))}));l(this,"Indicator",we.Indicator(({shape:e})=>{let{size:[t,n]}=e;return yt.createElement("rect",{x:0,y:0,rx:2,ry:2,width:Math.max(1,t),height:Math.max(1,n)})}));l(this,"getBounds",e=>Zt(e,this.boundsCache));l(this,"shouldRender",(e,t)=>t.size!==e.size||t.style!==e.style||t.isPlaying!==e.isPlaying);l(this,"getSvgElement",e=>{let t=this.getBounds(e),n=document.createElementNS("http://www.w3.org/2000/svg","image");return n.setAttribute("width",`${t.width}`),n.setAttribute("height",`${t.height}`),n.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),n});l(this,"transform",no);l(this,"transformSingle",oo)}},Ide=(0,ca.styled)("div",{pointerEvents:"all",position:"relative",fontFamily:"sans-serif",fontSize:"2em",height:"100%",width:"100%",borderRadius:"3px",perspective:"800px",overflow:"hidden",p:{userSelect:"none"},img:{userSelect:"none"},variants:{isGhost:{false:{opacity:1},true:{transition:"opacity .2s",opacity:.3}},isFilled:{true:{},false:{}},isDarkMode:{true:{},false:{}}},compoundVariants:[{isFilled:!0,isDarkMode:!0,css:{boxShadow:"2px 3px 12px -2px rgba(0,0,0,.3), 1px 1px 4px rgba(0,0,0,.3), 1px 1px 2px rgba(0,0,0,.3)"}},{isFilled:!0,isDarkMode:!1,css:{boxShadow:"2px 3px 12px -2px rgba(0,0,0,.2), 1px 1px 4px rgba(0,0,0,.16),  1px 1px 2px rgba(0,0,0,.16)"}}]}),Cde=(0,ca.styled)("video",{position:"absolute",top:0,left:0,width:"100%",height:"100%",maxWidth:"100%",minWidth:"100%",pointerEvents:"none",objectFit:"cover",userSelect:"none",borderRadius:2});var Vs=new oa,$s=new da,Ns=new Qi,Ws=new qi,Qo=new Yi,Rc=new ia,Ac=new ea,Pr=new sa,Lc=new na,Hc=new pa,Rn={["rectangle"]:Vs,["triangle"]:$s,["ellipse"]:Ns,["draw"]:Ws,["arrow"]:Qo,["text"]:Rc,["group"]:Ac,["sticky"]:Pr,["image"]:Lc,["video"]:Hc},ua=r=>typeof r=="string"?Rn[r]:Rn[r.type];var zc=!1,me=class{static getShapeUtil(e){return ua(e)}static getSelectedShapes(e,t){let n=me.getPage(e,t);return me.getSelectedIds(e,t).map(s=>n.shapes[s])}static screenToWorld(e,t){let n=me.getPageState(e,e.appState.currentPageId).camera;return Se.Vec.sub(Se.Vec.div(t,n.zoom),n.point)}static getCameraZoom(e){return zt.Utils.clamp(e,.1,5)}static getPage(e,t){return e.document.pages[t]}static getPageState(e,t){return e.document.pageStates[t]}static getSelectedIds(e,t){return me.getPageState(e,t).selectedIds}static getShapes(e,t){return Object.values(me.getPage(e,t).shapes)}static getCamera(e,t){return me.getPageState(e,t).camera}static getShape(e,t,n){return me.getPage(e,n).shapes[t]}static getCenter(e){return me.getShapeUtil(e).getCenter(e)}static getBounds(e){return me.getShapeUtil(e).getBounds(e)}static getRotatedBounds(e){return me.getShapeUtil(e).getRotatedBounds(e)}static getSelectedBounds(e){return zt.Utils.getCommonBounds(me.getSelectedShapes(e,e.appState.currentPageId).map(t=>me.getShapeUtil(t).getBounds(t)))}static getParentId(e,t,n){return me.getShape(e,t,n).parentId}static getDocumentBranch(e,t,n){let o=me.getShape(e,t,n);return o.children===void 0?[t]:[t,...o.children.flatMap(s=>me.getDocumentBranch(e,s,n))]}static getSelectedBranchSnapshot(e,t,n){let o=me.getPage(e,t),s=me.getSelectedIds(e,t).flatMap(a=>me.getDocumentBranch(e,a,t).map(d=>o.shapes[d])).filter(a=>!a.isLocked).map(zt.Utils.deepClone);return n!==void 0?s.map(a=>S({id:a.id},n(a))):s}static getSelectedShapeSnapshot(e,t,n){let o=me.getSelectedShapes(e,t).filter(s=>!s.isLocked).map(zt.Utils.deepClone);return n!==void 0?o.map(s=>S({id:s.id},n(s))):o}static getAllEffectedShapeIds(e,t,n){let o=me.getPage(e,n),s=new Set(t);return t.forEach(a=>{let d=o.shapes[a];function i(u){u.children!==void 0&&u.children.filter(p=>!s.has(p)).forEach(p=>{s.add(p),i(o.shapes[p])})}i(d);function c(u){let p=u.parentId;p!==o.id&&(s.has(p)||(s.add(p),c(o.shapes[p])))}c(d),s.forEach(u=>{Object.values(o.bindings).filter(p=>p.fromId===u||p.toId===u).forEach(p=>s.add(p.fromId===u?p.toId:p.fromId))})}),Array.from(s.values())}static getLinkedShapeIds(e,t,n,o=!0){let s=me.getSelectedIds(e,t),a=me.getPage(e,t),d=new Set(s),i=new Set,c=[...s],u=new Set(Object.values(a.shapes).filter(p=>{var m;return p.type==="arrow"&&(p.handles.start.bindingId||((m=p.handles)==null?void 0:m.end.bindingId))}));for(;c.length;){let p=c.pop();if(!(p&&u.size))break;i.has(p)||(i.add(p),u.forEach(m=>{var b,y;let{handles:{start:{bindingId:h},end:{bindingId:g}}}=m,f=h?a.bindings[h]:null,T=g?a.bindings[g]:null,x=!1;f&&f.toId===p?(n==="center"?x=!0:((b=m.decorations)==null?void 0:b.start)&&T?x=n==="left":x=n==="right",x&&(o&&d.add(m.id),d.add(p),T&&(d.add(T.toId),c.push(T.toId)))):T&&T.toId===p&&(n==="center"?x=!0:((y=m.decorations)==null?void 0:y.end)&&f?x=n==="left":x=n==="right",x&&(o&&d.add(m.id),d.add(p),f&&(d.add(f.toId),c.push(f.toId)))),(!f||d.has(f.toId))&&(!T||d.has(T.toId))&&u.delete(m)}))}return Array.from(d.values())}static getChildIndexAbove(e,t,n){let o=e.document.pages[n],s=o.shapes[t],a;if(s.parentId===o.id)a=Object.values(o.shapes).filter(c=>c.parentId===o.id).sort((c,u)=>c.childIndex-u.childIndex);else{let c=o.shapes[s.parentId];if(!c.children)throw Error("No children in parent!");a=c.children.map(u=>o.shapes[u]).sort((u,p)=>u.childIndex-p.childIndex)}let d=a.indexOf(s),i=a[d+1];return i?i.childIndex:s.childIndex+1}static getBeforeShape(e,t){return Object.fromEntries(Object.keys(t).map(n=>[n,e[n]]))}static mutateShapes(e,t,n,o,s=!1){let a={},d={};t.forEach((c,u)=>{let p=me.getShape(e,c,o);if(p.isLocked)return;(p==null?void 0:p.type)==="group"&&(t.length===1||s)&&p.children.forEach((h,g)=>{let f=me.getShape(e,h,o);if(f.isLocked)return;let T=n(f,g);T&&(a[h]=me.getBeforeShape(f,T),d[h]=T)});let m=n(p,u);m&&(a[c]=me.getBeforeShape(p,m),d[c]=m)});let i=zt.Utils.deepMerge(e,{document:{pages:{[e.appState.currentPageId]:{shapes:d}}}});return{before:a,after:d,data:i}}static createShapes(e,t,n){let o={document:{pages:{[n]:{shapes:S({},Object.fromEntries(t.flatMap(a=>{let d=[[a.id,void 0]];if(a.parentId!==n){let i=me.getShape(e,a.parentId,n);if(!i.children)throw Error("No children in parent!");d.push([i.id,{children:i.children}])}return d})))}}}},s={document:{pages:{[n]:{shapes:{shapes:S({},Object.fromEntries(t.flatMap(a=>{let d=[[a.id,a]];if(a.parentId!==n){let i=me.getShape(e,a.parentId,n);if(!i.children)throw Error("No children in parent!");d.push([i.id,{children:[...i.children,a.id]}])}return d})))}}}}};return{before:o,after:s}}static deleteShapes(e,t,n){n=n||e.appState.currentPageId;let o=me.getPage(e,n),s=typeof t[0]=="string"?t:t.map(i=>i.id),a={document:{pages:{[n]:{shapes:S({},Object.fromEntries(s.flatMap(i=>{let c=o.shapes[i],u=[[c.id,c]];if(c.parentId!==n){let p=o.shapes[c.parentId];if(!p.children)throw Error("No children in parent!");u.push([p.id,{children:p.children}])}return u}))),bindings:S({},Object.fromEntries(Object.values(o.bindings).filter(i=>s.includes(i.fromId)||s.includes(i.toId)).map(i=>[i.id,i])))}}}},d={document:{pages:{[n]:{shapes:S({},Object.fromEntries(s.flatMap(i=>{let c=o.shapes[i],u=[[c.id,void 0]];if(c.parentId!==o.id){let p=o.shapes[c.parentId];if(!p.children)throw Error("No children in parent!");u.push([p.id,{children:p.children.filter(m=>m!==c.id)}])}return u})))}}}};return{before:a,after:d}}static onSessionComplete(e){var n,o;let t=(o=(n=me.getShapeUtil(e)).onSessionComplete)==null?void 0:o.call(n,e);return t?S(S({},e),t):e}static onChildrenChange(e,t,n){var s,a;if(!t.children)return;let o=(a=(s=me.getShapeUtil(t)).onChildrenChange)==null?void 0:a.call(s,t,t.children.map(d=>me.getShape(e,d,n)));return o?S(S({},t),o):t}static updateArrowBindings(e,t){var a,d,i,c,u,p;let n={start:wt(t.handles.start),end:wt(t.handles.end)},o={isBound:!1,handle:t.handles.start,point:Se.Vec.add(t.handles.start.point,t.point)},s={isBound:!1,handle:t.handles.end,point:Se.Vec.add(t.handles.end.point,t.point)};if(t.handles.start.bindingId){let m=((a=t.decorations)==null?void 0:a.start)!==void 0,h=t.handles.start,g=e.bindings[t.handles.start.bindingId];if(!g)throw Error("Could not find a binding to match the start handle's bindingId: "+t.handles.start.bindingId);let f=e.shapes[g.toId],T=me.getShapeUtil(f),x=T.getBounds(f),b=T.getExpandedBounds(f),y=m?zt.Utils.expandBounds(x,g.distance):x,{minX:R,minY:K,width:L,height:v}=b,I=Se.Vec.add([R,K],Se.Vec.mulV([L,v],Se.Vec.rotWith(g.point,[.5,.5],f.rotation||0)));o={isBound:!0,hasDecoration:m,binding:g,handle:h,point:I,util:T,target:f,bounds:x,expandedBounds:b,intersectBounds:y,center:T.getCenter(f)}}if(t.handles.end.bindingId){let m=((d=t.decorations)==null?void 0:d.end)!==void 0,h=t.handles.end,g=e.bindings[t.handles.end.bindingId];if(!g)throw Error("Could not find a binding to match the end handle's bindingId");let f=e.shapes[g.toId],T=me.getShapeUtil(f),x=T.getBounds(f),b=T.getExpandedBounds(f),y=m?zt.Utils.expandBounds(x,g.distance):x,{minX:R,minY:K,width:L,height:v}=b,I=Se.Vec.add([R,K],Se.Vec.mulV([L,v],Se.Vec.rotWith(g.point,[.5,.5],f.rotation||0)));s={isBound:!0,hasDecoration:m,binding:g,handle:h,point:I,util:T,target:f,bounds:x,expandedBounds:b,intersectBounds:y,center:T.getCenter(f)}}for(let m of["end","start"]){let h=m==="start"?o:s,g=m==="start"?s:o;if(h.isBound)if(!h.binding.distance)n[m].point=Se.Vec.sub(h.point,t.point);else{let f=Se.Vec.uni(Se.Vec.sub(h.point,g.point));switch(h.target.type){case"ellipse":{let T=(0,lo.intersectRayEllipse)(g.point,f,h.center,h.target.radius[0]+(h.hasDecoration?h.binding.distance:0),h.target.radius[1]+(h.hasDecoration?h.binding.distance:0),h.target.rotation||0).points.sort((x,b)=>Se.Vec.dist(x,g.point)-Se.Vec.dist(b,g.point));T[0]!==void 0&&(n[m].point=Se.Vec.toFixed(Se.Vec.sub(T[0],t.point)));break}case"triangle":{let T=h.target.point,x=dn(h.target.size,h.hasDecoration?16:0,h.target.rotation).map(y=>Se.Vec.add(y,T)),b=zt.Utils.pointsToLineSegments(x,!0).map(([y,R])=>(0,lo.intersectRayLineSegment)(g.point,f,y,R)).filter(y=>y.didIntersect).flatMap(y=>y.points).sort((y,R)=>Se.Vec.dist(y,g.point)-Se.Vec.dist(R,g.point));b[0]!==void 0&&(n[m].point=Se.Vec.toFixed(Se.Vec.sub(b[0],t.point)));break}default:{let T=(0,lo.intersectRayBounds)(g.point,f,h.intersectBounds,h.target.rotation).filter(b=>b.didIntersect).map(b=>b.points[0]).sort((b,y)=>Se.Vec.dist(b,g.point)-Se.Vec.dist(y,g.point));if(!T[0])continue;let x;if(g.isBound&&(x=(0,lo.intersectRayBounds)(g.point,f,g.intersectBounds,g.target.rotation).filter(y=>y.didIntersect).map(y=>y.points[0]).sort((y,R)=>Se.Vec.dist(y,g.point)-Se.Vec.dist(R,g.point))[0]),g.isBound&&(T.length<2||x&&T[0]&&Math.ceil(Se.Vec.dist(T[0],x))<16*2.5||zt.Utils.boundsContain(h.expandedBounds,g.expandedBounds)||zt.Utils.boundsCollide(h.expandedBounds,g.expandedBounds))){let b=Se.Vec.uni(Se.Vec.sub(g.point,h.point)),y=(0,lo.intersectRayBounds)(h.point,b,h.bounds,h.target.rotation).filter(R=>R.didIntersect).map(R=>R.points[0]);if(!y[0])continue;n[m].point=Se.Vec.toFixed(Se.Vec.sub(y[0],t.point)),n[m==="start"?"end":"start"].point=Se.Vec.toFixed(Se.Vec.add(Se.Vec.sub(y[0],t.point),Se.Vec.mul(b,Math.min(Se.Vec.dist(y[0],g.point),16*2.5*(zt.Utils.boundsContain(g.bounds,h.intersectBounds)?-1:1)))))}else if(!g.isBound&&(T[0]&&Se.Vec.dist(T[0],g.point)<16*2.5||zt.Utils.pointInBounds(g.point,h.intersectBounds))){let b=Se.Vec.uni(Se.Vec.sub(h.center,g.point));return(c=(i=me.getShapeUtil(t)).onHandleChange)==null?void 0:c.call(i,t,{[m]:w(S({},t.handles[m]),{point:Se.Vec.toFixed(Se.Vec.add(Se.Vec.sub(g.point,t.point),Se.Vec.mul(b,16*2.5)))})})}else T[0]&&(n[m].point=Se.Vec.toFixed(Se.Vec.sub(T[0],t.point)))}}}}return(p=(u=me.getShapeUtil(t)).onHandleChange)==null?void 0:p.call(u,t,n)}static transform(e,t,n){let o=me.getShapeUtil(e).transform(e,t,n);return o?S(S({},e),o):e}static transformSingle(e,t,n){let o=me.getShapeUtil(e).transformSingle(e,t,n);return o?S(S({},e),o):e}static getRotatedShapeMutation(e,t,n,o){var c,u;let s=Se.Vec.sub(t,e.point),a=Se.Vec.rotWith(t,n,o),d=Se.Vec.toFixed(Se.Vec.sub(a,s));if(e.handles!==void 0)return(u=(c=this.getShapeUtil(e)).onHandleChange)==null?void 0:u.call(c,w(S({},e),{point:d}),Object.fromEntries(Object.entries(e.handles).map(([m,h])=>{let g=Se.Vec.toFixed(Se.Vec.rotWith(h.point,s,o));return[m,w(S({},h),{point:g})]})));let i=zt.Utils.clampRadians((e.rotation||0)+o);return{point:d,rotation:i}}static updateParents(e,t,n){let o=me.getPage(e,t);if(n.length===0)return;let{shapes:s}=me.getPage(e,t),a=Array.from(new Set(n.map(d=>s[d].parentId).values())).filter(d=>d!==o.id);for(let d of a){let i=s[d];if(!i.children)throw Error("A shape is parented to a shape without a children array.");me.onChildrenChange(e,i,t)}me.updateParents(e,t,a)}static getBinding(e,t,n){return me.getPage(e,n).bindings[t]}static getBindings(e,t){let n=me.getPage(e,t);return Object.values(n.bindings)}static getBindableShapeIds(e){return me.getShapes(e,e.appState.currentPageId).filter(t=>me.getShapeUtil(t).canBind).sort((t,n)=>n.childIndex-t.childIndex).map(t=>t.id)}static getBindingsWithShapeIds(e,t,n){return Array.from(new Set(me.getBindings(e,n).filter(o=>t.includes(o.toId)||t.includes(o.fromId))).values())}static getRelatedBindings(e,t,n){let o=new Set(t),s=me.getPage(e,n),a=Object.values(s.bindings),d=new Set(a.filter(u=>o.has(u.toId)||o.has(u.fromId))),i=d.size,c=-1;for(;c!==0;)d.forEach(u=>{let p=u.fromId;for(let m of a)m.fromId===p&&d.add(m),m.toId===p&&d.add(m)}),c=d.size-i,i=d.size;return Array.from(d.values())}static normalizeText(e){return e.replace(me.fixNewLines,`
 `).split(`
 `).map(t=>t||" ").join(`
-`)}static assertShapeHasProperty(e,t){if(e[t]===void 0)throw new Error}static warn(e){zc&&console.warn(e)}static error(e){zc&&console.error(e)}static getSvgString(e,t=1){let n=e.cloneNode(!0);return e.setAttribute("width",+e.getAttribute("width")*t+""),e.setAttribute("height",+e.getAttribute("height")*t+""),new XMLSerializer().serializeToString(n).replaceAll("&#10;      ","").replaceAll(/((\s|")[0-9]*\.[0-9]{2})([0-9]*)(\b|"|\))/g,"$1")}static getSvgAsDataUrl(e,t=1){let n=me.getSvgString(e,t);return`data:image/svg+xml;base64,${window.btoa(unescape(n))}`}static getImageForSvg(o){return ue(this,arguments,function*(e,t="png",n={}){let{scale:s=2,quality:a=1}=n,d=me.getSvgString(e,s);if(!d)return;let i=yield new Promise(u=>{let p=new Image;p.crossOrigin="anonymous";let h=`data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent(d)))}`;p.onload=()=>{let g=document.createElement("canvas"),f=g.getContext("2d"),T=p.width,x=p.height;g.width=T,g.height=x,f.drawImage(p,0,0,T,x),URL.revokeObjectURL(h),u(g)},p.onerror=()=>{console.warn("Could not convert that SVG to an image.")},p.src=h});return yield new Promise(u=>i.toBlob(p=>u(p),"image/"+t,a))})}},k=me;l(k,"copyStringToClipboard",e=>{try{navigator.clipboard&&navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([e],{type:"text/plain"})})])}catch(t){let n=document.createElement("textarea");n.setAttribute("position","fixed"),n.setAttribute("top","0"),n.setAttribute("readonly","true"),n.setAttribute("contenteditable","true"),n.style.position="fixed",n.value=e,document.body.appendChild(n),n.focus(),n.select();try{let o=document.createRange();o.selectNodeContents(n);let s=window.getSelection();s&&(s.removeAllRanges(),s.addRange(o),n.setSelectionRange(0,n.value.length)),document.execCommand("copy")}catch(o){}finally{document.body.removeChild(n)}}}),l(k,"flattenShape",(e,t)=>{var n;return[t,...((n=t.children)!=null?n:[]).map(o=>me.getShape(e,o,e.appState.currentPageId)).sort((o,s)=>o.childIndex-s.childIndex).flatMap(o=>me.flattenShape(e,o))]}),l(k,"flattenPage",(e,t)=>Object.values(e.document.pages[t].shapes).sort((n,o)=>n.childIndex-o.childIndex).reduce((n,o)=>[...n,...me.flattenShape(e,o)],[])),l(k,"getTopChildIndex",(e,t)=>{let n=me.getShapes(e,t);return n.length===0?1:n.filter(o=>o.parentId===t).sort((o,s)=>s.childIndex-o.childIndex)[0].childIndex+1}),l(k,"fixNewLines",/\r?\n|\r/g);var Dde=r=>r.room,Fc=function(){let e=ge(),t=e.useStore(Dde),[n,o]=Le.useState(!1),s=Le.useRef(0),a=Le.useCallback(()=>{o(!0),k.copyStringToClipboard(window.location.href),clearTimeout(s.current),s.current=setTimeout(()=>o(!1),1200)},[]),d=Le.useCallback(()=>{o(!0);let u=window.location.href.split("/");u[u.length-2]="v",u[u.length-1]=Us.Utils.lns(u[u.length-1]),k.copyStringToClipboard(u.join("/")),clearTimeout(s.current),s.current=setTimeout(()=>o(!1),1200)},[]),i=Le.useCallback(()=>ue(this,null,function*(){e.isDirty?e.fileSystemHandle?window.confirm("Do you want to save changes to your current project?")&&(yield e.saveProject()):window.confirm("Do you want to save your current project?")&&(yield e.saveProject()):e.fileSystemHandle||window.confirm("Do you want to save your current project?")&&(yield e.saveProject())}),[]),c=Le.useCallback(()=>ue(this,null,function*(){var p;let u=Us.Utils.deepClone(e.document);e.setIsLoading(!0);try{if(e.callbacks.onAssetUpload)for(let h in u.assets){let g=u.assets[h];if(g.src.includes("base64")){let f=Pde(g.src,((p=g.fileName)!=null?p:g.type==="video")?"image.png":"image.mp4"),T=yield e.callbacks.onAssetUpload(e,f,h);T?g.src=T:g.src=""}}let m=yield fetch("/api/create",{method:"POST",mode:"no-cors",headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json"},body:JSON.stringify({roomId:Us.Utils.uniqueId(),pageId:e.currentPageId,document:u})}).then(h=>h.json());(m==null?void 0:m.url)?window.location.href=m.url:k.warn(m==null?void 0:m.message)}catch(m){k.warn(m.message)}e.setIsLoading(!1)}),[]);return Le.createElement(Oc.Root,{dir:"ltr"},Le.createElement(fs,{id:"TD-MultiplayerMenuIcon",isActive:!!t},Le.createElement(Ld,null)),Le.createElement(At,{variant:"menu",id:"TD-MultiplayerMenu",side:"bottom",align:"start",sideOffset:4},Le.createElement(ve,{id:"TD-Multiplayer-CopyInviteLink",onClick:a,disabled:!t},Le.createElement(Mr.FormattedMessage,{id:"copy.invite.link"}),Le.createElement(bt,null,n?Le.createElement(er.CheckIcon,null):Le.createElement(er.ClipboardIcon,null))),Le.createElement(ve,{id:"TD-Multiplayer-CopyReadOnlyLink",onClick:d,disabled:!t},Le.createElement(Mr.FormattedMessage,{id:"copy.readonly.link"}),Le.createElement(bt,null,n?Le.createElement(er.CheckIcon,null):Le.createElement(er.ClipboardIcon,null))),Le.createElement(Ee,null),Le.createElement(ve,{id:"TD-Multiplayer-CreateMultiplayerProject",onClick:i},Le.createElement("a",{href:`${window.location.origin}/r`},Le.createElement(Mr.FormattedMessage,{id:"create.multiplayer.project"}))),Le.createElement(ve,{id:"TD-Multiplayer-CopyToMultiplayerProject",onClick:c},Le.createElement(Mr.FormattedMessage,{id:"copy.multiplayer.project"}))))};function Pde(r,e){var d,i;let t=r.split(","),n=(i=(d=t[0])==null?void 0:d.match(/:(.*?);/))==null?void 0:i[1],o=window.atob(t[1]),s=o.length,a=new Uint8Array(s);for(;s--;)a[s]=o.charCodeAt(s);return new File([a],e,{type:n})}var Jt=V(require("@radix-ui/react-dropdown-menu")),_s=require("@radix-ui/react-icons"),ke=V(require("react")),Er=require("react-intl");var Ot=V(require("@radix-ui/react-alert-dialog")),Ks=require("@radix-ui/react-icons"),Ce=V(require("react")),tr=require("react-intl");var Mde=r=>Object.keys(r.document.pages).length>1;function Gc({page:r,onOpen:e,onClose:t}){let n=ge(),o=(0,tr.useIntl)(),[s,a]=Ce.useState(!1),[d,i]=Ce.useState(r.name||"Page"),c=n.useStore(Mde),u=Ce.useRef(null),p=Ce.useCallback(()=>{a(!1)},[]),m=Ce.useCallback(()=>{n.duplicatePage(r.id)},[n]),h=Ce.useCallback(()=>{window.confirm("Are you sure you want to delete this page?")&&n.deletePage(r.id)},[n]),g=Ce.useCallback(L=>{if(a(L),L){e==null||e();return}},[n]);function f(L){L.stopPropagation()}let T=Ce.useRef(r.name||"Page"),x=Ce.useRef(T.current),b=Ce.useCallback(L=>{let v=L.target.value.trimStart();x.current=v,i(v)},[]),y=Ce.useCallback(L=>{switch(L.key){case"Enter":{x.current===T.current||(T.current=x.current,n.renamePage(r.id,x.current.trim())),a(!1);break}case"Escape":{if(x.current===T.current){a(!1);return}x.current=T.current,i(T.current),requestAnimationFrame(()=>{let v=u.current;v&&(v.focus(),v.setSelectionRange(0,v.value.length))});break}}},[]),R=Ce.useRef(!1);Ce.useEffect(()=>(s?(R.current=!0,T.current=r.name||"Page",x.current=T.current,requestAnimationFrame(()=>{let L=u.current;L&&(L.focus(),L.setSelectionRange(0,L.value.length))})):R.current&&(t==null||t()),()=>{x.current!==T.current&&(T.current=x.current,n.renamePage(r.id,x.current))}),[s]);let K=Vt();return Ce.createElement(Ot.Root,{open:s,onOpenChange:g},Ce.createElement(Ot.Trigger,{asChild:!0,"data-shy":"true"},Ce.createElement(Ho,{bp:rt},Ce.createElement(bt,null,Ce.createElement(Ks.MixerVerticalIcon,null)))),Ce.createElement(Ot.Portal,{container:K.current},Ce.createElement(Bde,{onPointerDown:p}),Ce.createElement(Ede,{dir:"ltr",onKeyDown:f,onKeyUp:f},Ce.createElement(hs,{ref:u,placeholder:o.formatMessage({id:"page.name"}),value:d,onChange:b,onKeyDown:y,icon:Ce.createElement(Ks.Pencil1Icon,null)}),Ce.createElement(Ee,null),Ce.createElement(jc,{onSelect:m},Ce.createElement(tr.FormattedMessage,{id:"duplicate"})),Ce.createElement(jc,{disabled:!c,onSelect:h},Ce.createElement(tr.FormattedMessage,{id:"delete"})),Ce.createElement(Ee,null),Ce.createElement(Ot.Cancel,{asChild:!0},Ce.createElement($e,null,Ce.createElement(tr.FormattedMessage,{id:"cancel"}))))))}var Ede=H(Ot.Content,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",minWidth:240,maxWidth:"fit-content",maxHeight:"85vh",marginTop:"-5vh",pointerEvents:"all",backgroundColor:"$panel",padding:"$1",borderRadius:"$2",font:"$ui",zIndex:999999,"&:focus":{outline:"none"}}),Bde=H(Ot.Overlay,{backgroundColor:"rgba(0, 0, 0, .15)",position:"absolute",pointerEvents:"all",inset:0,zIndex:999998});function jc(t){var n=t,{onSelect:r}=n,e=ot(n,["onSelect"]);return Ce.createElement(Ot.Action,{asChild:!0,onClick:r,onSelect:r},Ce.createElement($e,S({},e)))}var Rde=r=>Object.values(r.document.pages).sort((e,t)=>(e.childIndex||0)-(t.childIndex||0)),Ade=r=>r.document.pages[r.appState.currentPageId].name,Lde=r=>r.document.pages[r.appState.currentPageId].id;function Vc(){let r=ge(),e=(0,Er.useIntl)(),t=ke.useRef(!1),[n,o]=ke.useState(!1);ke.useEffect(()=>{t.current!==n&&(t.current=n)},[n]);let s=ke.useCallback(()=>{o(!1)},[o]),a=ke.useCallback(i=>{t.current!==i&&o(i)},[o]),d=r.useStore(Ade);return ke.createElement(Jt.Root,{dir:"ltr",open:n,onOpenChange:a},ke.createElement(Jt.Trigger,{dir:"ltr",asChild:!0,id:"TD-Page"},ke.createElement(Ie,{variant:"text"},d||e.formatMessage({id:"page"}))),ke.createElement(At,{variant:"menu",align:"start",sideOffset:4},n&&ke.createElement(Hde,{onClose:s})))}function Hde({onClose:r}){let e=ge(),t=(0,Er.useIntl)(),n=e.useStore(Rde),o=e.useStore(Lde),s=t.formatMessage({id:"page"}),a=ke.useCallback(()=>{let f=s+" "+(Object.keys(e.document.pages).length+1);e.createPage(void 0,f)},[e]),d=ke.useCallback(f=>{r(),e.changePage(f)},[e]),[i,c]=ke.useState(null),[u,p]=ke.useState(null),m=ke.useCallback(f=>{c(f.currentTarget.id),p(n.findIndex(T=>T.id===f.currentTarget.id)),f.dataTransfer.effectAllowed="move"},[]),h=ke.useCallback(f=>{f.preventDefault();let T=n.findIndex(y=>y.id===f.currentTarget.id),x=f.currentTarget.getBoundingClientRect();T=(f.clientY-x.top)/x.height<.5?T:T+1,p(T)},[i,n]),g=ke.useCallback(()=>{i!==null&&u!==null&&e.movePage(i,u),c(null),p(null)},[i,u]);return ke.createElement(ke.Fragment,null,ke.createElement(Jt.RadioGroup,{dir:"ltr",value:o,onValueChange:d},n.map((f,T)=>ke.createElement(zde,{key:f.id,isDropAbove:T===u&&T===0,isDropBelow:u!==null&&T===u-1},ke.createElement(Jt.RadioItem,{title:f.name||s,value:f.id,key:f.id,id:f.id,asChild:!0,onDragOver:h,onDragStart:m,onDrop:g,draggable:!0},ke.createElement(Ode,null,ke.createElement("span",{id:f.id},f.name||s),ke.createElement(Jt.ItemIndicator,null,ke.createElement(bt,null,ke.createElement(_s.CheckIcon,null))))),ke.createElement(Gc,{page:f,onClose:r})))),ke.createElement(Ee,null),ke.createElement(Jt.Item,{onSelect:a,asChild:!0},ke.createElement($e,null,ke.createElement("span",null,ke.createElement(Er.FormattedMessage,{id:"create.page"})),ke.createElement(bt,null,ke.createElement(_s.PlusIcon,null)))))}var zde=H("div",{position:"relative",display:"grid",gridTemplateColumns:"1fr auto",gridAutoFlow:"column",margin:0,'& > *[data-shy="true"]':{opacity:0},'&:hover > *[data-shy="true"]':{opacity:1},variants:{isDropAbove:{true:{"&::after":{content:"",display:"block",position:"absolute",top:0,width:"100%",height:"1px",backgroundColor:"$selected",zIndex:999,pointerEvents:"none"}}},isDropBelow:{true:{"&::after":{content:"",display:"block",position:"absolute",width:"100%",height:"1px",top:"100%",backgroundColor:"$selected",zIndex:999,pointerEvents:"none"}}}}}),Ode=H($e,{minWidth:128});var co=V(require("@radix-ui/react-dropdown-menu")),po=require("@radix-ui/react-icons"),pe=V(require("react")),un=require("react-intl");var Fde=r=>r.appState.currentStyle,jde=r=>r.document.pageStates[r.appState.currentPageId].selectedIds,Gde=Object.keys(Ko),$c={["draw"]:pe.createElement(rd,null),["solid"]:pe.createElement(sd,null),["dashed"]:pe.createElement(nd,null),["dotted"]:pe.createElement(od,null)},Vde={["small"]:pe.createElement(ad,null),["medium"]:pe.createElement(ld,null),["large"]:pe.createElement(dd,null)},$de={["start"]:pe.createElement(po.TextAlignLeftIcon,null),["middle"]:pe.createElement(po.TextAlignCenterIcon,null),["end"]:pe.createElement(po.TextAlignRightIcon,null),["justify"]:pe.createElement(po.TextAlignJustifyIcon,null)},Nde=r=>r.settings.isDarkMode?"dark":"light",Wde=r=>r.settings.keepStyleMenuOpen,Ude=r=>{let{activeTool:e,currentPageId:t}=r.appState;switch(e){case"select":{let n=r.document.pages[t],o=!1,s=!1;for(let a of r.document.pageStates[t].selectedIds)"text"in n.shapes[a]&&(o=!0),"label"in n.shapes[a]&&(s=!0);return o?"text":s?"label":""}case"text":return"text";case"rectangle":return"label";case"ellipse":return"label";case"triangle":return"label";case"arrow":return"label";case"line":return"label"}return!1},Nc=pe.memo(function(){let e=ge(),t=(0,un.useIntl)(),n=e.useStore(Nde),o=e.useStore(Wde),s=e.useStore(Ude),a=e.useStore(Fde),d=e.useStore(jde),[i,c]=pe.useState(a),u=pe.useRef(a);pe.useEffect(()=>{let{appState:{currentStyle:b},page:y,selectedIds:R}=e,K={};if(R.length<=0)K=b;else{let L=new Set([]);e.selectedIds.map(v=>y.shapes[v]).forEach(v=>{Gde.forEach(I=>{if(!L.has(I))if(K[I]===void 0)K[I]=v.style[I];else{if(K[I]===v.style[I])return;K[I]=v.style[I],L.add(I)}})})}JSON.stringify(K)!==JSON.stringify(u.current)&&(u.current=K,c(K))},[a,d]);let p=pe.useCallback(b=>{e.setSetting("keepStyleMenuOpen",b)},[]),m=pe.useCallback(b=>{e.style({isFilled:b})},[]),h=pe.useCallback(b=>{e.style({dash:b})},[]),g=pe.useCallback(b=>{e.style({size:b})},[]),f=pe.useCallback(b=>{e.style({font:b})},[]),T=pe.useCallback(b=>{e.style({textAlign:b})},[]),x=pe.useCallback(b=>{e.setMenuOpen(b)},[e]);return pe.createElement(co.Root,{dir:"ltr",onOpenChange:x,open:o?!0:void 0},pe.createElement(co.Trigger,{asChild:!0,id:"TD-Styles"},pe.createElement(Ie,{"aria-label":t.formatMessage({id:"styles"}),variant:"text"},pe.createElement(un.FormattedMessage,{id:"styles"}),pe.createElement(_de,{style:{color:Uo[n][i.color]}},i.isFilled&&pe.createElement(xi,{size:16,stroke:"none",fill:vs[n][i.color]}),$c[i.dash]))),pe.createElement(At,{id:"TD-StylesMenu",side:"bottom",align:"end",sideOffset:4,alignOffset:4},pe.createElement(Br,{variant:"tall",id:"TD-Styles-Color-Container"},pe.createElement("span",null,pe.createElement(un.FormattedMessage,{id:"style.menu.color"})),pe.createElement(Kde,null,Object.keys(Uo.light).map(b=>pe.createElement(co.Item,{key:b,onSelect:Oe,asChild:!0,id:`TD-Styles-Color-Swatch-${b}`},pe.createElement(Ie,{variant:"icon",isActive:i.color===b,onClick:()=>e.style({color:b}),"aria-label":t.formatMessage({id:b})},pe.createElement(xi,{size:18,strokeWidth:2.5,fill:i.isFilled?vs[n][b]:"transparent",stroke:Uo.light[b]})))))),pe.createElement(Rt,{variant:"styleMenu",checked:!!i.isFilled,onCheckedChange:m,id:"TD-Styles-Fill"},pe.createElement(un.FormattedMessage,{id:"style.menu.fill"})),pe.createElement(Br,{id:"TD-Styles-Dash-Container"},pe.createElement(un.FormattedMessage,{id:"style.menu.dash"}),pe.createElement(Ys,{dir:"ltr",value:i.dash,onValueChange:h},Object.values(Sn).map(b=>pe.createElement(Tr,{key:b,isActive:b===i.dash,value:b,onSelect:Oe,bp:rt,id:`TD-Styles-Dash-${b}`,"aria-label":t.formatMessage({id:b})},$c[b])))),pe.createElement(Br,{id:"TD-Styles-Size-Container"},pe.createElement(un.FormattedMessage,{id:"style.menu.size"}),pe.createElement(Ys,{dir:"ltr",value:i.size,onValueChange:g},Object.values(Sr).map(b=>pe.createElement(Tr,{key:b,isActive:b===i.size,value:b,onSelect:Oe,bp:rt,id:`TD-Styles-Dash-${b}`,"aria-label":t.formatMessage({id:b})},Vde[b])))),(s==="text"||s==="label")&&pe.createElement(pe.Fragment,null,pe.createElement(Ee,null),pe.createElement(Br,{id:"TD-Styles-Font-Container"},pe.createElement(un.FormattedMessage,{id:"style.menu.font"}),pe.createElement(Ys,{dir:"ltr",value:i.font,onValueChange:f},Object.values(Ao).map(b=>pe.createElement(Tr,{key:b,isActive:b===i.font,value:b,onSelect:Oe,bp:rt,id:`TD-Styles-Font-${b}`},pe.createElement(Yde,{fontStyle:b},"Aa"))))),s==="text"&&pe.createElement(Br,{id:"TD-Styles-Align-Container"},pe.createElement(un.FormattedMessage,{id:"style.menu.align"}),pe.createElement(Ys,{dir:"ltr",value:i.textAlign,onValueChange:T},Object.values(Gt).map(b=>pe.createElement(Tr,{key:b,isActive:b===i.textAlign,value:b,onSelect:Oe,bp:rt,id:`TD-Styles-Align-${b}`},$de[b]))))),pe.createElement(Ee,null),pe.createElement(Rt,{variant:"styleMenu",checked:o,onCheckedChange:p,id:"TD-Styles-Keep-Open"},pe.createElement(un.FormattedMessage,{id:"style.menu.keep.open"}))))}),Kde=H("div",{display:"grid",gridTemplateColumns:"repeat(4, auto)",gap:0}),Br=H("div",{position:"relative",width:"100%",background:"none",border:"none",cursor:"pointer",minHeight:"32px",outline:"none",color:"$text",fontFamily:"$ui",fontWeight:400,fontSize:"$1",padding:"$2 0 $2 $3",borderRadius:4,userSelect:"none",WebkitUserSelect:"none",margin:0,display:"flex",gap:"$3",flexDirection:"row",alignItems:"center",justifyContent:"space-between",variants:{variant:{tall:{alignItems:"flex-start",padding:"0 0 0 $3","& > span":{paddingTop:"$4"}}}}}),Ys=H(co.DropdownMenuRadioGroup,{display:"flex",flexDirection:"row",gap:"$1"}),_de=H("div",{display:"grid","& > *":{gridColumn:1,gridRow:1}}),Yde=H("div",{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"$3",variants:{fontStyle:{["script"]:{fontFamily:"Caveat Brush"},["sans"]:{fontFamily:"Recursive"},["serif"]:{fontFamily:"Georgia"},["mono"]:{fontFamily:"Recursive Mono"}}}});var Zs=V(require("@radix-ui/react-dropdown-menu")),Et=V(require("react")),nr=require("react-intl");var Zde=r=>r.document.pageStates[r.appState.currentPageId].camera.zoom,Wc=function(){let e=ge(),t=e.useStore(Zde);return Et.createElement(Zs.Root,{dir:"ltr"},Et.createElement(Zs.Trigger,{dir:"ltr",asChild:!0,id:"TD-Zoom"},Et.createElement(Xde,{onDoubleClick:e.resetZoom,variant:"text"},Math.round(t*100),"%")),Et.createElement(At,{align:"end"},Et.createElement(ve,{onSelect:Oe,onClick:e.zoomIn,kbd:"#+",id:"TD-Zoom-Zoom_In"},Et.createElement(nr.FormattedMessage,{id:"zoom.in"})),Et.createElement(ve,{onSelect:Oe,onClick:e.zoomOut,kbd:"#\u2212",id:"TD-Zoom-Zoom_Out"},Et.createElement(nr.FormattedMessage,{id:"zoom.out"})),Et.createElement(ve,{onSelect:Oe,onClick:e.resetZoom,kbd:"\u21E70",id:"TD-Zoom-Zoom_To_100%"},Et.createElement(nr.FormattedMessage,{id:"zoom.to"})," 100%"),Et.createElement(ve,{onSelect:Oe,onClick:e.zoomToFit,kbd:"\u21E71",id:"TD-Zoom-To_Fit"},Et.createElement(nr.FormattedMessage,{id:"zoom.to.fit"})),Et.createElement(ve,{onSelect:Oe,onClick:e.zoomToSelection,kbd:"\u21E72",id:"TD-Zoom-To_Selection"},Et.createElement(nr.FormattedMessage,{id:"zoom.to.selection"}))))},Xde=H(Ie,{minWidth:56});function qde({readOnly:r,showPages:e,showMenu:t,showStyles:n,showZoom:o,showMultiplayerMenu:s}){let a=ge(),d=(0,Uc.useIntl)();return ut.createElement(Jde,null,(t||e)&&ut.createElement(So,{side:"left",id:"TD-MenuPanel"},t&&ut.createElement(Ad,{readOnly:r}),s&&ut.createElement(Fc,null),e&&ut.createElement(Vc,null)),ut.createElement(Qde,null),(n||o)&&ut.createElement(So,{side:"right"},a.readOnly?ut.createElement(ece,null,"Read Only"):ut.createElement(ut.Fragment,null,ut.createElement(on,{kbd:"#Z",label:d.formatMessage({id:"undo"}),onClick:a.undo,id:"TD-TopPanel-Undo","aria-label":d.formatMessage({id:"undo"})},ut.createElement(Di,null)),ut.createElement(on,{kbd:"#\u21E7Z",label:d.formatMessage({id:"redo"}),onClick:a.redo,id:"TD-TopPanel-Redo","aria-label":d.formatMessage({id:"redo"})},ut.createElement(Di,{flipHorizontal:!0}))),o&&ut.createElement(Wc,null),n&&!r&&ut.createElement(Nc,null)))}var Jde=H("div",{width:"100%",position:"absolute",top:0,left:0,right:0,display:"flex",flexDirection:"row",pointerEvents:"none","& > *":{pointerEvents:"all"}}),Qde=H("div",{flexGrow:2,pointerEvents:"none"}),ece=H("div",{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"$ui",fontSize:"$1",paddingLeft:"$4",paddingRight:"$1",userSelect:"none",WebkitUserSelect:"none"}),Kc=ut.memo(qde);var _c=V(require("react"));function Yc(r){_c.default.useEffect(()=>{let e=!1,t=!1,n=r.current;if(!n)return;let o=i=>{i.key===" "&&!t&&(t=!0,e?n.setAttribute("style","cursor: grabbing !important"):n.setAttribute("style","cursor: grab !important"))},s=i=>{i.key===" "&&(t=!1,n.setAttribute("style","cursor: initial"))},a=i=>{e=!0,i.button===1&&n.setAttribute("style","cursor: grabbing !important"),i.button===0&&t&&n.setAttribute("style","cursor: grabbing !important")},d=()=>{e=!1,t?n.setAttribute("style","cursor: grab !important"):n.setAttribute("style","cursor: initial")};return n.addEventListener("keydown",o),n.addEventListener("keyup",s),n.addEventListener("pointerdown",a),n.addEventListener("pointerup",d),()=>{n.removeEventListener("keydown",o),n.removeEventListener("keyup",s),n.removeEventListener("pointerdown",a),n.removeEventListener("pointerup",d)}},[r.current])}var Dt=require("@tldraw/core"),xe=require("@tldraw/vec");var Rr=require("idb-keyval"),Zc="tldraw_clipboard";function Xc(){return ue(this,null,function*(){return(0,Rr.get)(Zc)})}function qc(r){return ue(this,null,function*(){return(0,Rr.set)(Zc,r)})}var Jc=require("@tldraw/core"),ko=V(require("idb-keyval")),Qc=V(require("zustand")),ep=V(require("zustand/vanilla"));var ha=class{constructor(e,t,n,o){l(this,"_idbId");l(this,"initialState");l(this,"store");l(this,"pointer",-1);l(this,"_state");l(this,"_status","loading");l(this,"stack",[]);l(this,"_snapshot");l(this,"useStore");l(this,"ready");l(this,"isPaused",!1);l(this,"persist",(e,t)=>{if(this._status==="ready"&&(this.onPersist&&this.onPersist(this._state,e,t),this._idbId))return ko.set(this._idbId,this._state).catch(n=>console.error(n))});l(this,"applyPatch",(e,t)=>{let n=this._state,o=Jc.Utils.deepMerge(this._state,e),s=this.cleanup(o,n,e,t);return this.onStateWillChange&&this.onStateWillChange(s,t),this._state=s,this.store.setState(this._state,!0),this.onStateDidChange&&this.onStateDidChange(this._state,t),this});l(this,"migrate",e=>e);l(this,"cleanup",(e,t,n,o)=>e);l(this,"onStateWillChange");l(this,"onStateDidChange");l(this,"patchState",(e,t)=>(this.applyPatch(e,t),this.onPatch&&this.onPatch(this._state,e,t),this));l(this,"replaceState",(e,t)=>{let n=this.cleanup(e,this._state,e,t);return this.onStateWillChange&&this.onStateWillChange(n,"replace"),this._state=n,this.store.setState(this._state,!0),this.onStateDidChange&&this.onStateDidChange(this._state,"replace"),this});l(this,"setState",(e,t=e.id)=>(this.pointer<this.stack.length-1&&(this.stack=this.stack.slice(0,this.pointer+1)),this.stack.push(w(S({},e),{id:t})),this.pointer=this.stack.length-1,this.applyPatch(e.after,t),this.onCommand&&this.onCommand(this._state,e,t),this.persist(e.after,t),this));l(this,"onReady");l(this,"onPatch");l(this,"onCommand");l(this,"onPersist");l(this,"onReplace");l(this,"onReset");l(this,"onResetHistory");l(this,"onUndo");l(this,"onRedo");l(this,"reset",()=>(this.onStateWillChange&&this.onStateWillChange(this.initialState,"reset"),this._state=this.initialState,this.store.setState(this._state,!0),this.resetHistory(),this.persist({},"reset"),this.onStateDidChange&&this.onStateDidChange(this._state,"reset"),this.onReset&&this.onReset(this._state),this));l(this,"replaceHistory",(e,t=e.length-1)=>(this.stack=e,this.pointer=t,this.onReplace&&this.onReplace(this._state),this));l(this,"resetHistory",()=>(this.stack=[],this.pointer=-1,this.onResetHistory&&this.onResetHistory(this._state),this));l(this,"undo",()=>{if(!this.isPaused){if(!this.canUndo)return this;let e=this.stack[this.pointer];this.pointer--,this.applyPatch(e.before,"undo"),this.persist(e.before,"undo")}return this.onUndo&&this.onUndo(this._state),this});l(this,"redo",()=>{if(!this.isPaused){if(!this.canRedo)return this;this.pointer++;let e=this.stack[this.pointer];this.applyPatch(e.after,"redo"),this.persist(e.after,"undo")}return this.onRedo&&this.onRedo(this._state),this});l(this,"setSnapshot",()=>(this._snapshot=S({},this._state),this));l(this,"forceUpdate",()=>{this.store.setState(this._state,!0)});this._idbId=t,this._state=wt(e),this._snapshot=wt(e),this.initialState=wt(e),this.store=(0,ep.default)(()=>this._state),this.useStore=(0,Qc.default)(this.store),this.ready=new Promise(s=>{let a="none";this._idbId?(a="restored",ko.get(this._idbId).then(d=>ue(this,null,function*(){if(d){let i=d;if(n){let u=yield ko.get(t+"_version");u&&u<n&&(i=o?o(d,e,u):e,a="migrated")}yield ko.set(t+"_version",n||-1);let c=this._state.appState.isEmptyCanvas;i=this.migrate(i),this._state=wt(i),this._snapshot=wt(i),this._state.appState.isEmptyCanvas=c,this.store.setState(this._state,!0)}else yield ko.set(t+"_version",n||-1);this._status="ready",s(a)})).catch(d=>console.error(d))):(this._status="ready",s(a))}).then(s=>(this.onReady&&this.onReady(s),s))}pause(){this.isPaused=!0}resume(){this.isPaused=!1}get canUndo(){return this.pointer>-1}get canRedo(){return this.pointer<this.stack.length-1}get state(){return this._state}get status(){return this._status}get snapshot(){return this._snapshot}};var tp=require("@tldraw/core"),ma=require("@tldraw/vec");function np(r,e,t){let{currentPageId:n}=r,o=e.map(m=>r.getShape(m)),s=o.map(m=>({id:m.id,point:[...m.point],bounds:k.getBounds(m)})),a=tp.Utils.getCommonBounds(s.map(({bounds:m})=>m)),d=a.minX+a.width/2,i=a.minY+a.height/2,c=Object.fromEntries(s.map(({id:m,point:h,bounds:g})=>[m,{prev:h,next:{["top"]:[h[0],a.minY],["centerVertical"]:[h[0],i-g.height/2],["bottom"]:[h[0],a.maxY-g.height],["left"]:[a.minX,h[1]],["centerHorizontal"]:[d-g.width/2,h[1]],["right"]:[a.maxX-g.width,h[1]]}[t]}])),{before:u,after:p}=k.mutateShapes(r.state,e,m=>c[m.id]?{point:c[m.id].next}:m,n,!1);return o.forEach(m=>{if(m.type==="group"){let h=ma.Vec.sub(p[m.id].point,u[m.id].point);m.children.forEach(g=>{let f=r.getShape(g);u[f.id]={point:f.point},p[f.id]={point:ma.Vec.add(f.point,h)}}),delete u[m.id],delete p[m.id]}}),{id:"align",before:{document:{pages:{[n]:{shapes:u}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:p}},pageStates:{[n]:{selectedIds:e}}}}}}function op(r,e){return{id:"change_page",before:{appState:{currentPageId:r.currentPageId}},after:{appState:{currentPageId:e}}}}var ip=require("@tldraw/core");function rp(r,e){var o;let t=r,n=new Set(e);for(;n.has(t);)t=((o=/^.*(\d+)$/.exec(t))==null?void 0:o[1])?t.replace(/(\d+)(?=\D?)$/,s=>(+s+1).toString()):`${t} 1`;return t}function sp(r,e,t){let n={shapes:{},bindings:{}},o={shapes:{},bindings:{}},s=[],a=new Set,d=new Set;e.filter(c=>!k.getShape(r,c,t).isLocked).forEach(c=>{a.add(c);let u=k.getShape(r,c,t);n.shapes[c]=u,o.shapes[c]=void 0,u.children!==void 0&&u.children.forEach(p=>{a.add(p);let m=k.getShape(r,p,t);n.shapes[p]=m,o.shapes[p]=void 0}),u.parentId!==t&&s.push(k.getShape(r,u.parentId,t)),u.assetId&&d.add(u.assetId)}),s.forEach(c=>{var u;e.includes(c.id)||(a.add(c.id),n.shapes[c.id]={children:c.children},o.shapes[c.id]={children:c.children.filter(p=>!e.includes(p))},((u=o.shapes[c.id])==null?void 0:u.children.length)===0&&(o.shapes[c.id]=void 0,n.shapes[c.id]=k.getShape(r,c.id,t)))});let i=k.getPage(r,t);return Object.values(i.bindings).filter(c=>a.has(c.fromId)||a.has(c.toId)).forEach(c=>{for(let u of[c.toId,c.fromId])if(o.shapes[u]===void 0){n.bindings[c.id]=c,o.bindings[c.id]=void 0;let p=i.shapes[u];p&&p.handles&&Object.values(p.handles).filter(m=>m.bindingId===c.id).forEach(m=>{var h,g,f,T,x,b;n.shapes[u]=w(S({},n.shapes[u]),{handles:w(S({},(h=n.shapes[u])==null?void 0:h.handles),{[m.id]:w(S({},(f=(g=n.shapes[u])==null?void 0:g.handles)==null?void 0:f[m.id]),{bindingId:c.id})})}),a.has(u)||(o.shapes[u]=w(S({},o.shapes[u]),{handles:w(S({},(T=o.shapes[u])==null?void 0:T.handles),{[m.id]:w(S({},(b=(x=o.shapes[u])==null?void 0:x.handles)==null?void 0:b[m.id]),{bindingId:void 0})})}))})}}),Object.values(r.document.pages).flatMap(c=>Object.values(c.shapes)).forEach(c=>{"assetId"in c&&c.assetId&&!a.has(c.id)&&d.delete(c.assetId)}),{before:n,after:o,assetsToRemove:Array.from(d)}}function ap(r,e,t=ip.Utils.uniqueId(),n="Page"){let{currentPageId:o}=r,s=Object.values(r.state.document.pages).sort((u,p)=>{var m,h;return((m=u.childIndex)!=null?m:0)-((h=p.childIndex)!=null?h:0)}),a=s[s.length-1],d=(a==null?void 0:a.childIndex)?(a==null?void 0:a.childIndex)+1:1,i={id:t,name:rp(n,s.map(u=>{var p;return(p=u.name)!=null?p:""})),childIndex:d,shapes:{},bindings:{}},c={id:t,selectedIds:[],camera:{point:e,zoom:1},editingId:void 0,bindingId:void 0,hoveredId:void 0,pointedId:void 0};return{id:"create_page",before:{appState:{currentPageId:o},document:{pages:{[t]:void 0},pageStates:{[t]:void 0}}},after:{appState:{currentPageId:i.id},document:{pages:{[t]:i},pageStates:{[t]:c}}}}}function ga(r,e,t=[]){let{currentPageId:n}=r,o={},s={};e.forEach(i=>{o[i.id]=void 0,s[i.id]=i});let a={},d={};return t.forEach(i=>{a[i.id]=void 0,d[i.id]=i}),{id:"create",before:{document:{pages:{[n]:{shapes:o,bindings:a}},pageStates:{[n]:{selectedIds:[...r.selectedIds]}}}},after:{document:{pages:{[n]:{shapes:s,bindings:d}},pageStates:{[n]:{selectedIds:e.map(i=>i.id)}}}}}}function lp(r,e){let{currentPageId:t,document:{pages:n,pageStates:o}}=r,s=Object.values(n).sort((i,c)=>(i.childIndex||0)-(c.childIndex||0)),a=s.findIndex(i=>i.id===e),d;return e===t?a===s.length-1?d=s[s.length-2].id:d=s[a+1].id:d=t,{id:"delete_page",before:{appState:{currentPageId:e},document:{pages:{[e]:S({},n[e])},pageStates:{[e]:S({},o[e])}}},after:{appState:{currentPageId:d},document:{pages:{[e]:void 0},pageStates:{[e]:void 0}}}}}var tce=(r,e)=>{let t=S({},r);return e.forEach(n=>t[n]=void 0),t};function fa(r,e,t=r.currentPageId){let{pageState:n,selectedIds:o,document:{assets:s}}=r,{before:a,after:d,assetsToRemove:i}=sp(r.state,e,t),c=tce(s,i);return{id:"delete",before:{document:{assets:s,pages:{[t]:a},pageStates:{[t]:{selectedIds:[...r.selectedIds]}}}},after:{document:{assets:c,pages:{[t]:d},pageStates:{[t]:{selectedIds:o.filter(u=>!e.includes(u)),hoveredId:n.hoveredId&&e.includes(n.hoveredId)?void 0:n.hoveredId}}}}}}var dp=require("@tldraw/core"),Sa=V(require("@tldraw/vec"));function cp(r,e,t){let{currentPageId:n}=r,o=e.map(i=>r.getShape(i)),s=Object.fromEntries(nce(o,t).map(i=>[i.id,i])),{before:a,after:d}=k.mutateShapes(r.state,e.filter(i=>s[i]!==void 0),i=>{var c;return{point:(c=s[i.id])==null?void 0:c.next}},n);return o.forEach(i=>{if(i.type==="group"){let c=Sa.default.sub(d[i.id].point,a[i.id].point);i.children.forEach(u=>{let p=r.getShape(u);a[p.id]={point:p.point},d[p.id]={point:Sa.default.add(p.point,c)}}),delete a[i.id],delete d[i.id]}}),{id:"distribute",before:{document:{pages:{[n]:{shapes:a}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:d}},pageStates:{[n]:{selectedIds:e}}}}}}function nce(r,e){let t=r.map(a=>{let d=k.getShapeUtil(a);return{id:a.id,point:[...a.point],bounds:d.getBounds(a),center:d.getCenter(a)}}),n=t.length,o=dp.Utils.getCommonBounds(t.map(({bounds:a})=>a)),s=[];switch(e){case"horizontal":{let a=t.reduce((d,i)=>d+i.bounds.width,0);if(a>o.width){let d=t.sort((m,h)=>m.bounds.minX-h.bounds.minX)[0],i=t.sort((m,h)=>h.bounds.maxX-m.bounds.maxX)[0],c=t.filter(m=>m!==d&&m!==i).sort((m,h)=>m.center[0]-h.center[0]),u=(i.center[0]-d.center[0])/(n-1),p=d.center[0]+u;c.forEach(({id:m,point:h,bounds:g},f)=>{s.push({id:m,prev:h,next:[p+u*f-g.width/2,g.minY]})})}else{let d=t.sort((u,p)=>u.center[0]-p.center[0]),i=o.minX,c=(o.width-a)/(n-1);d.forEach(({id:u,point:p,bounds:m})=>{s.push({id:u,prev:p,next:[i,m.minY]}),i+=m.width+c})}break}case"vertical":{let a=t.reduce((d,i)=>d+i.bounds.height,0);if(a>o.height){let d=t.sort((m,h)=>m.bounds.minY-h.bounds.minY)[0],i=t.sort((m,h)=>h.bounds.maxY-m.bounds.maxY)[0],c=t.filter(m=>m!==d&&m!==i).sort((m,h)=>m.center[1]-h.center[1]),u=(i.center[1]-d.center[1])/(n-1),p=d.center[1]+u;c.forEach(({id:m,point:h,bounds:g},f)=>{s.push({id:m,prev:h,next:[g.minX,p+u*f-g.height/2]})})}else{let d=t.sort((u,p)=>u.center[1]-p.center[1]),i=o.minY,c=(o.height-a)/(n-1);d.forEach(({id:u,point:p,bounds:m})=>{s.push({id:u,prev:p,next:[m.minX,i]}),i+=m.height+c})}break}}return s}var or=require("@tldraw/core");function pp(r,e){let{currentPageId:t,pageState:{camera:n}}=r,o=r.document.pages[e],s=or.Utils.uniqueId(),a=Object.fromEntries([[o.id,s],...Object.keys(o.shapes).map(u=>[u,or.Utils.uniqueId()]),...Object.keys(o.bindings).map(u=>[u,or.Utils.uniqueId()])]),d=Object.fromEntries(Object.entries(o.shapes).map(([u,p])=>[a[u],w(S({},or.Utils.deepClone(p)),{id:a[u],parentId:a[p.parentId]})])),i=Object.fromEntries(Object.entries(o.bindings).map(([u,p])=>[a[u],w(S({},or.Utils.deepClone(p)),{id:a[p.id],fromId:a[p.fromId],toId:a[p.toId]})]));Object.values(o.bindings).forEach(u=>{let p=a[u.fromId],m=d[p].handles;m&&Object.values(m).forEach(f=>{f.bindingId===u.id&&(f.bindingId=a[u.id])});let h=a[u.toId],g=d[h].handles;g&&Object.values(g).forEach(f=>{f.bindingId===u.id&&(f.bindingId=a[u.id])})});let c=w(S({},o),{id:a[o.id],name:o.name+" Copy",shapes:d,bindings:i});return{id:"duplicate_page",before:{appState:{currentPageId:t},document:{pages:{[s]:void 0},pageStates:{[s]:void 0}}},after:{appState:{currentPageId:s},document:{pages:{[s]:c},pageStates:{[s]:w(S({},o),{id:s,selectedIds:[],camera:S({},n),editingId:void 0,bindingId:void 0,hoveredId:void 0,pointedId:void 0})}}}}}var Kn=require("@tldraw/core"),Xs=require("@tldraw/vec");function up(r,e,t){let{selectedIds:n,currentPageId:o,page:s,shapes:a}=r,d={shapes:{},bindings:{}},i={shapes:{},bindings:{}},c={},u=e.map(h=>r.getShape(h)).filter(h=>!e.includes(h.parentId));u.forEach(h=>{let g=Kn.Utils.uniqueId();if(d.shapes[g]=void 0,i.shapes[g]=w(S({},Kn.Utils.deepClone(h)),{id:g,childIndex:k.getChildIndexAbove(r.state,h.id,o)}),h.children&&(i.shapes[g].children=[]),h.parentId!==o){let f=r.getShape(h.parentId);d.shapes[f.id]=w(S({},d.shapes[f.id]),{children:f.children}),i.shapes[f.id]=w(S({},i.shapes[f.id]),{children:[...(i.shapes[f.id]||f).children,g]})}c[h.id]=g}),u.forEach(h=>{h.children&&h.children.forEach(g=>{var b,y;let f=r.getShape(g),T=Kn.Utils.uniqueId(),x=c[h.id];d.shapes[T]=void 0,i.shapes[T]=w(S({},Kn.Utils.deepClone(f)),{id:T,parentId:x,childIndex:k.getChildIndexAbove(r.state,f.id,o)}),c[g]=T,(y=(b=i.shapes[c[h.id]])==null?void 0:b.children)==null||y.push(T)})});let p=new Set(Object.keys(c));Object.values(s.bindings).filter(h=>p.has(h.fromId)||p.has(h.toId)).forEach(h=>{if(p.has(h.fromId))if(p.has(h.toId)){let g=Kn.Utils.uniqueId(),f=w(S({},Kn.Utils.deepClone(h)),{id:g,fromId:c[h.fromId],toId:c[h.toId]});d.bindings[g]=void 0,i.bindings[g]=f;let T=i.shapes[f.fromId];Object.values(T.handles).forEach(x=>{x.bindingId===h.id&&(x.bindingId=g)})}else{let g=i.shapes[c[h.fromId]];Object.values(g.handles).forEach(f=>{f.bindingId===h.id&&(f.bindingId=void 0)})}});let m=Object.values(i.shapes);if(t){let h=Kn.Utils.getCommonBounds(m.map(f=>k.getBounds(f))),g=Kn.Utils.getBoundsCenter(h);m.forEach(f=>{!f.point||(f.point=Xs.Vec.sub(t,Xs.Vec.sub(g,f.point)))})}else{let h=[16,16];m.forEach(g=>{!g.point||(g.point=Xs.Vec.add(g.point,h))})}return m.forEach(h=>{h.isLocked&&(h.isLocked=!1)}),{id:"duplicate",before:{document:{pages:{[o]:d},pageStates:{[o]:{selectedIds:n}}}},after:{document:{pages:{[o]:i},pageStates:{[o]:{selectedIds:Array.from(p.values()).map(h=>c[h])}}}}}}var hn=require("@tldraw/core");function ba(r,e,t){let{selectedIds:n,currentPageId:o,page:{shapes:s}}=r,a=e.map(p=>k.getBounds(s[p])),d=e.length===1&&s[e[0]].type==="group",i=hn.Utils.getCommonBounds(a),{before:c,after:u}=k.mutateShapes(r.state,e,p=>{let m=k.getBounds(p),h=p.parentId!==o;switch(t){case"horizontal":{if(h&&!d){let f=k.getBounds(s[p.parentId]),x=hn.Utils.getRelativeTransformedBoundingBox(i,i,f,!0,!1).minX-f.minX;return k.getShapeUtil(p).transform(p,w(S({},m),{minX:m.minX+x,maxX:m.maxX+x}),{type:hn.TLBoundsCorner.TopLeft,scaleX:1,scaleY:1,initialShape:p,transformOrigin:[.5,.5]})}let g=hn.Utils.getRelativeTransformedBoundingBox(i,i,m,!0,!1);return k.getShapeUtil(p).transform(p,g,{type:hn.TLBoundsCorner.TopLeft,scaleX:-1,scaleY:1,initialShape:p,transformOrigin:[.5,.5]})}case"vertical":{if(h&&!d){let f=k.getBounds(s[p.parentId]),x=hn.Utils.getRelativeTransformedBoundingBox(i,i,f,!1,!0).minY-f.minY;return k.getShapeUtil(p).transform(p,w(S({},m),{minY:m.minY+x,maxY:m.maxY+x}),{type:hn.TLBoundsCorner.TopLeft,scaleX:1,scaleY:1,initialShape:p,transformOrigin:[.5,.5]})}let g=hn.Utils.getRelativeTransformedBoundingBox(i,i,m,!1,!0);return k.getShapeUtil(p).transform(p,g,{type:hn.TLBoundsCorner.TopLeft,scaleX:1,scaleY:-1,initialShape:p,transformOrigin:[.5,.5]})}}},o,!0);return{id:"flip",before:{document:{pages:{[o]:{shapes:c}},pageStates:{[o]:{selectedIds:n}}}},after:{document:{pages:{[o]:{shapes:u}},pageStates:{[o]:{selectedIds:e}}}}}}var hp=require("@tldraw/core");function mp(r,e,t,n){var R,K;if(e.length<2)return;let o={},s={},a={},d={},i=[...e],c=[],u=[],p=[];for(let L of e){let v=r.getShape(L);if(!v.isLocked)if(v.children===void 0)c.push(v);else{let I=v.children.filter(J=>!r.getShape(J).isLocked);p.push(v),i.push(...I),c.push(...I.map(J=>r.getShape(J)).filter(Boolean))}}if(c.every(L=>L.parentId===c[0].parentId)&&c[0].parentId!==n&&((R=r.getShape(c[0].parentId).children)==null?void 0:R.length)===i.length)return;let m=k.flattenPage(r.state,n),h=Object.fromEntries(c.map(L=>[L.id,m.indexOf(L)])),g=c.sort((L,v)=>h[L.id]-h[v.id]),f=n,T=(g.filter(L=>L.parentId===n)[0]||g[0]).childIndex,x=hp.Utils.getCommonBounds(c.map(L=>k.getBounds(L)));for(o[t]=void 0,s[t]=k.getShapeUtil("group").create({id:t,childIndex:T,parentId:f,point:[x.minX,x.minY],size:[x.width,x.height],children:g.map(L=>L.id)}),g.forEach((L,v)=>{if(L.parentId!==n){let I=r.getShape(L.parentId);p.push(I)}o[L.id]=w(S({},o[L.id]),{parentId:L.parentId,childIndex:L.childIndex}),s[L.id]=w(S({},s[L.id]),{parentId:t,childIndex:v+1})});p.length>0;){let L=p.pop();if(!L)break;let v=(((K=o[L.id])==null?void 0:K.children)||L.children).filter(I=>I&&!(i.includes(I)||u.includes(I)));v.length===0?(o[L.id]=L,s[L.id]=void 0,L.parentId!==n&&(u.push(L.id),p.push(r.getShape(L.parentId)))):(o[L.id]=w(S({},o[L.id]),{children:L.children}),s[L.id]=w(S({},s[L.id]),{children:v}))}let{bindings:b}=r,y=new Set(u);return b.forEach(L=>{for(let v of[L.toId,L.fromId])if(y.has(v)){a[L.id]=L,d[L.id]=void 0;let I=r.getShape(v);I.handles&&Object.values(I.handles).filter(J=>J.bindingId===L.id).forEach(J=>{var ce,de;o[v]=w(S({},o[v]),{handles:w(S({},(ce=o[v])==null?void 0:ce.handles),{[J.id]:{bindingId:L.id}})}),u.includes(v)||(s[v]=w(S({},s[v]),{handles:w(S({},(de=s[v])==null?void 0:de.handles),{[J.id]:{bindingId:void 0}})}))})}}),{id:"group",before:{document:{pages:{[n]:{shapes:o,bindings:a}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:s,bindings:a}},pageStates:{[n]:{selectedIds:[t]}}}}}}var gp=require("@tldraw/core"),Ta=require("@tldraw/vec");function fp(r,e,t,n,o){let{page:s}=r,a={before:{shapes:{},bindings:{}},after:{shapes:{},bindings:{}}},d={before:{shapes:{},bindings:{}},after:{shapes:{},bindings:{}}},i=new Set,c=new Set;e.map(b=>r.getShape(b,n)).filter(b=>!b.isLocked).forEach(b=>{i.add(b.id),c.add(b),b.children!==void 0&&b.children.forEach(y=>{i.add(y),c.add(r.getShape(y,n))})});let u=k.getTopChildIndex(r.state,o),p=Array.from(c.values());p.forEach((b,y)=>{if(a.before.shapes[b.id]=b,a.after.shapes[b.id]=void 0,d.before.shapes[b.id]=void 0,d.after.shapes[b.id]=b,!i.has(b.parentId)&&(d.after.shapes[b.id]=w(S({},b),{parentId:o,childIndex:u+y}),b.parentId!==n)){let R=r.getShape(b.parentId,n);a.before.shapes[R.id]={children:R.children},a.after.shapes[R.id]={children:R.children.filter(K=>K!==b.id)}}}),Object.values(s.bindings).filter(b=>i.has(b.fromId)||i.has(b.toId)).forEach(b=>{a.before.bindings[b.id]=b,a.after.bindings[b.id]=void 0;let y=r.getShape(b.fromId,n);if(i.has(b.fromId)&&i.has(b.toId))d.before.bindings[b.id]=void 0,d.after.bindings[b.id]=b;else if(i.has(b.fromId)){let K=r.getShape(b.fromId,n),v=Object.values(y.handles).find(J=>J.bindingId===b.id).id,I=d.after.shapes[K.id];I.handles=w(S({},I.handles),{[v]:w(S({},I.handles[v]),{bindingId:void 0})})}else{let K=r.getShape(b.fromId,n),L=Object.values(y.handles).find(v=>v.bindingId===b.id);a.before.shapes[K.id]={handles:{[L.id]:{bindingId:b.id}}},a.after.shapes[K.id]={handles:{[L.id]:{bindingId:void 0}}}}});let m=r.state.document.pageStates[o],h=gp.Utils.getCommonBounds(p.map(b=>k.getBounds(b))),g=k.getCameraZoom(t.width<t.height?(t.width-128)/h.width:(t.height-128)/h.height),f=(t.width-h.width*g)/2/g,T=(t.height-h.height*g)/2/g,x=Ta.Vec.toFixed(Ta.Vec.add([-h.minX,-h.minY],[f,T]));return{id:"move_to_page",before:{appState:{currentPageId:n},document:{pages:{[n]:a.before,[o]:d.before},pageStates:{[n]:{selectedIds:e},[o]:{selectedIds:m.selectedIds,camera:m.camera}}}},after:{appState:{currentPageId:o},document:{pages:{[n]:a.after,[o]:d.after},pageStates:{[n]:{selectedIds:[]},[o]:{selectedIds:e,camera:{zoom:g,point:x}}}}}}}function Sp(r,e,t){let{pages:n}=r.document,o=n[e],s=Object.values(n).sort((i,c)=>{var u,p;return((u=i.childIndex)!=null?u:0)-((p=c.childIndex)!=null?p:0)}),a=s.indexOf(o),d=[...s];return d.splice(a,1),d.splice(t>a?t-1:t,0,o),{id:"move_page",before:{document:{pages:Object.fromEntries(s.map(i=>[i.id,{childIndex:i.childIndex}]))}},after:{document:{pages:Object.fromEntries(d.map((i,c)=>[i.id,{childIndex:c}]))}}}}function Ar(r,e,t){let{currentPageId:n,page:o}=r,s=new Set(e.map(u=>r.getShape(u).parentId)),a={before:{},after:{}},d,i,c;return Array.from(s.values()).forEach(u=>{let p=[];if(u===o.id)p=Object.values(o.shapes).sort((g,f)=>g.childIndex-f.childIndex);else{let g=r.getShape(u);if(!g.children)throw Error("No children in parent!");p=g.children.map(f=>r.getShape(f)).sort((f,T)=>f.childIndex-T.childIndex)}let m=p.map(g=>g.id),h=e.filter(g=>m.includes(g)).map(g=>m.indexOf(g)).sort((g,f)=>g-f);if(h.length!==m.length)switch(t){case"toBack":{for(let g=0;g<m.length;g++)if(!h.includes(g)){d=g;break}i=p[d].childIndex,c=i/(h.length+1),a=k.mutateShapes(r.state,h.map(g=>p[g].id).reverse(),(g,f)=>({childIndex:i-(f+1)*c}),n);break}case"toFront":{for(let g=m.length-1;g>=0;g--)if(!h.includes(g)){d=g;break}i=p[d].childIndex,c=1,a=k.mutateShapes(r.state,h.map(g=>p[g].id),(g,f)=>({childIndex:i+(f+1)}),n);break}case"backward":{let g={};for(let f=m.length-1;f>=0;f--)if(h.includes(f)){for(let T=f;T>=0;T--)if(!h.includes(T)){let x=p[T].childIndex,b,y;T===0?(b=x/2,y=x/2/(f-T+1)):(b=p[T-1].childIndex,y=(x-b)/(f-T+1),b+=y);for(let R=0;R<f-T;R++)g[p[T+R+1].id]=b+y*R;break}}Object.values(g).length>0&&(a=k.mutateShapes(r.state,h.map(f=>p[f].id),f=>({childIndex:g[f.id]}),n));break}case"forward":{let g={};for(let f=0;f<m.length;f++)if(h.includes(f)){for(let T=f;T<m.length;T++)if(!h.includes(T)){i=p[T].childIndex;let x=T===m.length-1?1:(p[T+1].childIndex-i)/(T-f+1);for(let b=0;b<T-f;b++)g[p[f+b].id]=i+x*(b+1);break}}Object.values(g).length>0&&(a=k.mutateShapes(r.state,h.map(f=>p[f].id),f=>({childIndex:g[f.id]}),n));break}}}),{id:"move",before:{document:{pages:{[n]:{shapes:a.before}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:a.after}},pageStates:{[n]:{selectedIds:e}}}}}}function bp(r,e,t){let{page:n}=r;return{id:"rename_page",before:{document:{pages:{[e]:{name:n.name}}}},after:{document:{pages:{[e]:{name:t}}}}}}function ya(r,e,t){let{currentPageId:n}=r,{before:o,after:s}=k.mutateShapes(r.state,e,a=>{var d,i;return(i=(d=r.getShapeUtil(a)).onDoubleClickBoundsHandle)==null?void 0:i.call(d,a)},t);return{id:"reset_bounds",before:{document:{pages:{[n]:{shapes:o}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:s}},pageStates:{[n]:{selectedIds:e}}}}}}var xa=require("@tldraw/core");var oce=Math.PI*2;function Tp(r,e,t=-oce/4){let{currentPageId:n}=r,o={},s={},a=e.flatMap(i=>{let c=r.getShape(i);return c.children?c.children.map(u=>r.getShape(u)):c}).filter(i=>!i.isLocked),d=xa.Utils.getBoundsCenter(xa.Utils.getCommonBounds(a.map(i=>k.getBounds(i))));return a.forEach(i=>{let c=k.getRotatedShapeMutation(i,k.getCenter(i),d,t);!c||(o[i.id]=k.getBeforeShape(i,c),s[i.id]=c)}),{id:"rotate",before:{document:{pages:{[n]:{shapes:o}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:s}},pageStates:{[n]:{selectedIds:e}}}}}}var Lr=require("@tldraw/core");function yp(r,e,t){let{currentPageId:n,selectedIds:o}=r,s=e.map(p=>r.getShape(p)),a=s.map(p=>k.getBounds(p)),d=Lr.Utils.getCommonBounds(a),i=e.flatMap(p=>{let m=r.getShape(p);return m.children?m.children:m.id}).filter(p=>!r.getShape(p).isLocked),{before:c,after:u}=k.mutateShapes(r.state,i,p=>{let m=k.getBounds(p);switch(t){case"horizontal":{let h=w(S({},m),{minX:d.minX,maxX:d.maxX,width:d.width});return k.getShapeUtil(p).transformSingle(p,h,{type:Lr.TLBoundsCorner.TopLeft,scaleX:h.width/m.width,scaleY:1,initialShape:p,transformOrigin:[.5,.5]})}case"vertical":{let h=w(S({},m),{minY:d.minY,maxY:d.maxY,height:d.height});return k.getShapeUtil(p).transformSingle(p,h,{type:Lr.TLBoundsCorner.TopLeft,scaleX:1,scaleY:h.height/m.height,initialShape:p,transformOrigin:[.5,.5]})}}},n);return s.forEach(p=>{p.type==="group"&&(delete c[p.id],delete u[p.id])}),{id:"stretch",before:{document:{pages:{[n]:{shapes:c}},pageStates:{[n]:{selectedIds:o}}}},after:{document:{pages:{[n]:{shapes:u}},pageStates:{[n]:{selectedIds:e}}}}}}var qs=require("@tldraw/vec");function xp(r,e,t){let{currentPageId:n,selectedIds:o}=r,s=e.flatMap(i=>k.getDocumentBranch(r.state,i,n)).filter(i=>!r.getShape(i).isLocked),a={},d={};return s.map(i=>r.getShape(i)).filter(i=>!i.isLocked).forEach(i=>{a[i.id]={style:S({},Object.fromEntries(Object.keys(t).map(c=>[c,i.style[c]])))},d[i.id]={style:t},i.type==="text"&&(a[i.id].point=i.point,d[i.id].point=qs.Vec.toFixed(qs.Vec.add(i.point,qs.Vec.sub(r.getShapeUtil(i).getCenter(i),r.getShapeUtil(i).getCenter(w(S({},i),{style:S(S({},i.style),t)}))))))}),{id:"style",before:{document:{pages:{[n]:{shapes:a}},pageStates:{[n]:{selectedIds:o}}},appState:{currentStyle:S({},r.appState.currentStyle)}},after:{document:{pages:{[n]:{shapes:d}},pageStates:{[n]:{selectedIds:e}}},appState:{currentStyle:t}}}}function wp(r,e,t){let{currentPageId:n,selectedIds:o}=r,s=Object.fromEntries(e.map(d=>{var i;return[d,{decorations:{[t]:(i=r.getShape(d).decorations)==null?void 0:i[t]}}]})),a=Object.fromEntries(e.filter(d=>!r.getShape(d).isLocked).map(d=>{var i;return[d,{decorations:{[t]:((i=r.getShape(d).decorations)==null?void 0:i[t])?void 0:"arrow"}}]}));return{id:"toggle_decorations",before:{document:{pages:{[n]:{shapes:s}},pageStates:{[n]:{selectedIds:o}}}},after:{document:{pages:{[n]:{shapes:a}},pageStates:{[n]:{selectedIds:e}}}}}}function Js(r,e,t){let{currentPageId:n}=r,o=e.map(i=>r.getShape(i)).filter(i=>t==="isLocked"?!0:!i.isLocked),s=o.every(i=>i[t]),a={},d={};return o.forEach(i=>{a[i.id]={[t]:i[t]},d[i.id]={[t]:!s}}),{id:"toggle",before:{document:{pages:{[n]:{shapes:a}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:d}},pageStates:{[n]:{selectedIds:e}}}}}}var wa=require("@tldraw/vec");function kp(r,e,t){let{currentPageId:n,selectedIds:o}=r;r.rotationInfo.selectedIds=[...o];let s={shapes:{},bindings:{}},a={shapes:{},bindings:{}},d=e.flatMap(u=>{let p=r.getShape(u);return p.children?p.children:p.id}).filter(u=>!r.getShape(u).isLocked),i=k.mutateShapes(r.state,d,u=>({point:wa.Vec.toFixed(wa.Vec.add(u.point,t))}),n);return s.shapes=i.before,a.shapes=i.after,k.getBindings(r.state,n).filter(u=>e.includes(u.fromId)&&!e.includes(u.toId)).forEach(u=>{s.bindings[u.id]=u,a.bindings[u.id]=void 0;for(let p of[u.toId,u.fromId]){let m=r.getShape(p);!m.handles||Object.values(m.handles).filter(h=>h.bindingId===u.id).forEach(h=>{var g,f;s.shapes[p]=w(S({},s.shapes[p]),{handles:w(S({},(g=s.shapes[p])==null?void 0:g.handles),{[h.id]:{bindingId:u.id}})}),a.shapes[p]=w(S({},a.shapes[p]),{handles:w(S({},(f=a.shapes[p])==null?void 0:f.handles),{[h.id]:{bindingId:void 0}})})})}}),{id:"translate",before:{document:{pages:{[n]:s},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:a},pageStates:{[n]:{selectedIds:e}}}}}}function vp(r,e,t,n){let{bindings:o}=r,s={},a={},d={},i={},c=e,u=e.filter(p=>!t.find(m=>m.id===p));return t.filter(p=>!p.isLocked).forEach(p=>{let m=[],h=[];s[p.id]=p,a[p.id]=void 0,p.children.forEach(b=>{u.push(b);let y=r.getShape(b,n);m.push(y)});let g=p.childIndex,T=(k.getChildIndexAbove(r.state,p.id,n)-g)/m.length;m.sort((b,y)=>b.childIndex-y.childIndex).forEach((b,y)=>{s[b.id]={parentId:b.parentId,childIndex:b.childIndex},a[b.id]={parentId:n,childIndex:g+T*y}}),o.filter(b=>b.toId===p.id||b.fromId===p.id).forEach(b=>{for(let y of[b.toId,b.fromId])if(a[y]===void 0){d[b.id]=b,i[b.id]=void 0;let R=r.getShape(y,n);R.handles&&Object.values(R.handles).filter(K=>K.bindingId===b.id).forEach(K=>{var L,v;s[y]=w(S({},s[y]),{handles:w(S({},(L=s[y])==null?void 0:L.handles),{[K.id]:{bindingId:b.id}})}),h.includes(y)||(a[y]=w(S({},a[y]),{handles:w(S({},(v=a[y])==null?void 0:v.handles),{[K.id]:{bindingId:void 0}})}))})}})}),{id:"ungroup",before:{document:{pages:{[n]:{shapes:s,bindings:d}},pageStates:{[n]:{selectedIds:c}}}},after:{document:{pages:{[n]:{shapes:a,bindings:d}},pageStates:{[n]:{selectedIds:u}}}}}}function ka(r,e,t){let n=e.map(s=>s.id),o=k.mutateShapes(r.state,n.filter(s=>!r.getShape(s,t).isLocked),(s,a)=>e[a],t);return{id:"update",before:{document:{pages:{[t]:{shapes:o.before}}}},after:{document:{pages:{[t]:{shapes:o.after}}}}}}function Ip(r,e,t){let{currentPageId:n,selectedIds:o}=r,s=e.map(c=>r.getShape(c)).filter(c=>t.isLocked?!0:!c.isLocked),a={},d={},i=Object.keys(t);return s.forEach(c=>{a[c.id]=Object.fromEntries(i.map(u=>[u,c[u]])),d[c.id]=t}),{id:"set_props",before:{document:{pages:{[n]:{shapes:a}},pageStates:{[n]:{selectedIds:o}}}},after:{document:{pages:{[n]:{shapes:d}},pageStates:{[n]:{selectedIds:o}}}}}}var Ut=require("@tldraw/core"),vo=require("@tldraw/vec");function Cp(r,e,t={}){let{currentPageId:n}=r,{point:o,select:s,overwrite:a}=t,d=r.document.pages[n],i={shapes:{},bindings:{}},c={},u={shapes:{},bindings:{}};if(a){for(let m of e.shapes)i.shapes[m.id]=d.shapes[m.id],u.shapes[m.id]=m;if(e.bindings)for(let m of e.bindings)i.bindings[m.id]=d.bindings[m.id],u.bindings[m.id]=m;if(e.assets)for(let m of e.assets)c[m.id]=m}else{let m={},h=k.getTopChildIndex(r.state,n),g=e.shapes.sort((x,b)=>x.childIndex-b.childIndex).map(x=>{let b=Ut.Utils.uniqueId();return m[x.id]=b,w(S({},Ut.Utils.deepClone(x)),{id:b})}),f=new Set;for(;g.length>0;){let x=g.shift();if(!x)break;if(f.add(x.id),x.parentId==="currentPageId")x.parentId=n,x.childIndex=h++;else{x.parentId=m[x.parentId];let b=u.shapes[x.parentId];if(!b){f.has(x.id)&&(x.parentId="currentPageId"),g.push(x);continue}b.children.push(x.id)}x.children&&(x.children=[]),i.shapes[x.id]=void 0,u.shapes[x.id]=x}Object.values(u.shapes).forEach(x=>{x.children&&x.children.length===0&&(delete i.shapes[x.id],delete u.shapes[x.id])}),e.bindings&&e.bindings.forEach(x=>{let b=Ut.Utils.uniqueId();m[x.id]=b;let y=m[x.toId],R=m[x.fromId];if(!y||!R){if(R){let I=u.shapes[R].handles;I&&Object.values(I).forEach(J=>{J.bindingId===x.id&&(J.bindingId=void 0)})}if(y){let I=u.shapes[y].handles;I&&Object.values(I).forEach(J=>{J.bindingId===x.id&&(J.bindingId=void 0)})}return}let K=u.shapes[R].handles;K&&Object.values(K).forEach(I=>{I.bindingId===x.id&&(I.bindingId=b)}),u.shapes[y].handles&&Object.values(u.shapes[y].handles).forEach(I=>{I.bindingId===x.id&&(I.bindingId=b)});let v=w(S({},Ut.Utils.deepClone(x)),{id:b,toId:y,fromId:R});i.bindings[v.id]=void 0,u.bindings[v.id]=v});let T=Object.values(u.shapes);if(T.length>0)if(o){let x=Ut.Utils.getCommonBounds(T.map(y=>k.getBounds(y))),b=Ut.Utils.getBoundsCenter(x);T.forEach(y=>{!y.point||(y.point=vo.Vec.sub(o,vo.Vec.sub(b,y.point)))})}else{let x=Ut.Utils.getCommonBounds(T.map(k.getBounds));if(!(Ut.Utils.boundsContain(r.viewport,x)||Ut.Utils.boundsCollide(r.viewport,x))){let b=vo.Vec.toFixed(r.getPagePoint(r.centerPoint)),y=Ut.Utils.centerBounds(x,b),R=vo.Vec.sub(Ut.Utils.getBoundsCenter(y),Ut.Utils.getBoundsCenter(x));T.forEach(K=>{K.point=vo.Vec.toFixed(vo.Vec.add(K.point,R))})}}if(e.assets)for(let x of e.assets)c[x.id]=x}let p=document.createElement("textarea");return Object.values(u.shapes).forEach(m=>{"text"in m&&(p.innerHTML=m.text,m.text=p.value),"label"in m&&(p.innerHTML=m.label,m.label=p.value)}),p.remove(),{id:"insert",before:{document:{pages:{[n]:i},pageStates:{[n]:{selectedIds:[...r.selectedIds]}}}},after:{document:{pages:{[n]:u},assets:c,pageStates:{[n]:{selectedIds:s?Object.keys(u.shapes):[...r.selectedIds]}}}}}}var rr={};Ja(rr,{fileToBase64:()=>Pa,fileToText:()=>Ma,getImageSizeFromSrc:()=>Ea,getVideoSizeFromSrc:()=>Ba,loadFileHandle:()=>va,migrate:()=>An,openAssetsFromFileSystem:()=>Da,openFromFileSystem:()=>Ca,saveFileHandle:()=>Ia,saveToFileSystem:()=>ei});function An(r,e){let{document:t,settings:n}=r,{version:o=0}=t;"assets"in t||(t.assets={});let s=new Set;return Object.values(t.pages).forEach(a=>Object.values(a.shapes).forEach(d=>{let{parentId:i,children:c,assetId:u}=d;u&&s.add(u),i!==a.id&&!a.shapes[i]&&(console.warn("Encountered a shape with a missing parent!"),d.parentId=a.id),d.type==="group"&&c&&c.forEach(p=>{a.shapes[p]||(console.warn("Encountered a parent with a missing child!",d.id,p),c==null||c.splice(c.indexOf(p),1))})})),Object.keys(t.assets).forEach(a=>{s.has(a)||delete t.assets[a]}),o!==e&&(o<14&&Object.values(t.pages).forEach(a=>{Object.values(a.shapes).filter(d=>d.type==="text").forEach(d=>d.style.font==="script")}),o<=13&&Object.values(t.pages).forEach(a=>{Object.values(a.bindings).forEach(d=>{Object.assign(d,d.meta)}),Object.values(a.shapes).forEach(d=>{Object.entries(d.style).forEach(([i,c])=>{typeof c=="string"&&(d.style[i]=c.toLowerCase())}),d.type==="arrow"&&d.decorations&&Object.entries(d.decorations).forEach(([i,c])=>{c==="Arrow"&&(d.decorations=w(S({},d.decorations),{[i]:"arrow"}))})})}),o<=13.1&&(t.name="New Document"),o<15&&(t.assets={}),Object.values(t.pages).forEach(a=>{Object.values(a.shapes).forEach(d=>{o<15.2&&(d.type==="image"||d.type==="video")&&(d.style.isFilled=!0),o<15.3&&(d.type==="rectangle"||d.type==="triangle"||d.type==="ellipse"||d.type==="arrow")&&(d.label=d.text||"",d.labelPoint=[.5,.5])})}),o<15.4&&(n.dockPosition="bottom"),o<15.5&&(n.exportBackground="transparent")),Object.values(t.pageStates).forEach(a=>{a.selectedIds=a.selectedIds.filter(d=>t.pages[a.id].shapes[d]!==void 0),a.bindingId=void 0,a.editingId=void 0,a.hoveredId=void 0,a.pointedId=void 0}),t.version=e,r}var Io=require("browser-fs-access"),Qs=require("idb-keyval");var Dp={mode:"readwrite"},sce=r=>ue(void 0,null,function*(){return(yield r.queryPermission(Dp))==="granted"||(yield r.requestPermission(Dp))==="granted"});function va(){return ue(this,null,function*(){if(typeof Window=="undefined"||!("_location"in Window))return;let r=yield(0,Qs.get)(`Tldraw_file_handle_${window.location.origin}`);return r||null})}function Ia(r){return ue(this,null,function*(){return(0,Qs.set)(`Tldraw_file_handle_${window.location.origin}`,r)})}function ei(r,e,t){return ue(this,null,function*(){let n={name:r.name||"New Document",fileHandle:e!=null?e:null,document:r,assets:{}},o=JSON.stringify(n),s=new Blob([o],{type:"application/vnd.Tldraw+json"});if(e&&!(yield sce(e)))return null;let a=!Io.supported&&(t==null?void 0:t.length)?t:`${n.name}`,d=yield(0,Io.fileSave)(s,{fileName:`${a}${ys}`,description:"Tldraw File",extensions:[`${ys}`]},e);return yield Ia(d),d})}function Ca(){return ue(this,null,function*(){var o;let r=yield(0,Io.fileOpen)({description:"Tldraw File",extensions:[`${ys}`],multiple:!1});if(!r)return null;let e=yield new Promise(s=>{let a=new FileReader;a.onloadend=()=>{a.readyState===FileReader.DONE&&s(a.result)},a.readAsText(r,"utf8")}),t=JSON.parse(e),n=(o=r.handle)!=null?o:null;return yield Ia(n),{fileHandle:n,document:t.document}})}function Da(){return ue(this,null,function*(){return(0,Io.fileOpen)({description:"Image or Video",extensions:[...xs,...ws],multiple:!0})})}function Pa(r){return new Promise((e,t)=>{if(r){let n=new FileReader;n.readAsDataURL(r),n.onload=()=>e(n.result),n.onerror=o=>t(o),n.onabort=o=>t(o)}})}function Ma(r){return new Promise((e,t)=>{if(r){let n=new FileReader;n.readAsText(r),n.onload=()=>e(n.result),n.onerror=o=>t(o),n.onabort=o=>t(o)}})}function Ea(r){return new Promise((e,t)=>{let n=new Image;n.onload=()=>e([n.width,n.height]),n.onerror=()=>t(new Error("Could not get image size")),n.src=r})}function Ba(r){return new Promise((e,t)=>{let n=document.createElement("video");n.onloadedmetadata=()=>e([n.videoWidth,n.videoHeight]),n.onerror=()=>t(new Error("Could not get video size")),n.src=r})}Mo(rr,require("browser-fs-access"));var Ln=require("@tldraw/core"),Ve=require("@tldraw/vec");var Je=class{constructor(e){this.app=e}};var Ra=class extends Je{constructor(e,t,n,o=!1){super(e);l(this,"type","arrow");l(this,"performanceMode");l(this,"status","translatingHandle");l(this,"newStartBindingId",Ln.Utils.uniqueId());l(this,"draggedBindingId",Ln.Utils.uniqueId());l(this,"didBind",!1);l(this,"initialShape");l(this,"handleId");l(this,"bindableShapeIds");l(this,"initialBinding");l(this,"startBindingShapeId");l(this,"isCreate");l(this,"start",()=>{});l(this,"update",()=>{var K,L,v;let{initialShape:e}=this,{currentPoint:t,shiftKey:n,altKey:o,metaKey:s,currentGrid:a,settings:{showGrid:d}}=this.app,i=this.app.getShape(e.id);if(i.isLocked)return;let{handles:c}=e,u=this.handleId;if(!c[u].canBind)return;let p=Ve.Vec.sub(t,Ve.Vec.add(c[u].point,e.point));if(n){let I=o?Ve.Vec.med(c.start.point,c.end.point):c[u==="start"?"end":"start"].point,J=c[u].point,ce=Ve.Vec.add(J,p),de=Ve.Vec.angle(I,ce),He=Ve.Vec.rotWith(ce,I,Ln.Utils.snapAngleToSegments(de,24)-de);p=Ve.Vec.add(p,Ve.Vec.sub(He,ce))}let m=Ve.Vec.add(c[u].point,p),h={[u]:w(S({},c[u]),{point:d?Ve.Vec.snap(m,a):Ve.Vec.toFixed(m),bindingId:void 0})},g=Rn["arrow"],f=(K=g.onHandleChange)==null?void 0:K.call(g,e,h);if(!f)return;let T={shape:Ln.Utils.deepMerge(i,f),bindings:{}},x,b=T.shape.handles[this.handleId],y=T.shape.handles[this.handleId==="start"?"end":"start"];if(this.startBindingShapeId){let I,J=this.app.page.shapes[this.startBindingShapeId],ce=k.getShapeUtil(J),de=ce.getCenter(J),He=T.shape.handles.start,Pe=T.shape.handles.end,Me=Ve.Vec.add(He.point,T.shape.point);Ve.Vec.isEqual(Me,de)&&Me[1]++;let Ue=de,Ke=ce.hitTestPoint(J,t),Kt=Ve.Vec.uni(Ve.Vec.sub(Me,Ue)),gn=this.app.getBinding(this.newStartBindingId)!==void 0;!s&&!ce.hitTestPoint(J,Ve.Vec.add(T.shape.point,Pe.point))&&(I=this.findBindingPoint(i,J,"start",this.newStartBindingId,de,Ue,Kt,Ke)),I&&!gn?(this.didBind=!0,T.bindings[this.newStartBindingId]=I,T.shape=Ln.Utils.deepMerge(T.shape,{handles:{start:{bindingId:I.id}}})):!I&&gn&&(this.didBind=!1,T.bindings[this.newStartBindingId]=void 0,T.shape=Ln.Utils.deepMerge(e,{handles:{start:{bindingId:void 0}}}))}if(!s){let I=Ve.Vec.add(y.point,T.shape.point),J=Ve.Vec.add(b.point,T.shape.point),ce=Ve.Vec.uni(Ve.Vec.sub(J,I)),de=Ve.Vec.add(T.shape.point,T.shape.handles.start.point),He=Ve.Vec.add(T.shape.point,T.shape.handles.end.point),Pe=this.bindableShapeIds.map(Me=>this.app.page.shapes[Me]).sort((Me,Ue)=>Ue.childIndex-Me.childIndex).filter(Me=>{if(Me.isLocked)return!1;let Ue=k.getShapeUtil(Me);return![de,He].every(Ke=>Ue.hitTestPoint(Me,Ke))});for(let Me of Pe)if(x=this.findBindingPoint(i,Me,this.handleId,this.draggedBindingId,J,I,ce,o),x)break}if(x)this.didBind=!0,T.bindings[this.draggedBindingId]=x,T.shape=Ln.Utils.deepMerge(T.shape,{handles:{[this.handleId]:{bindingId:this.draggedBindingId}}});else{this.didBind=this.didBind||!1;let I=i.handles[this.handleId].bindingId;I!==void 0&&(T.bindings[I]=void 0,T.shape=Ln.Utils.deepMerge(T.shape,{handles:{[this.handleId]:{bindingId:void 0}}}))}let R=(v=(L=k.getShapeUtil(T.shape)).onHandleChange)==null?void 0:v.call(L,T.shape,T.shape.handles);return{document:{pages:{[this.app.currentPageId]:{shapes:{[i.id]:S(S({},T.shape),R!=null?R:{})},bindings:T.bindings}},pageStates:{[this.app.currentPageId]:{bindingId:T.shape.handles[u].bindingId}}}}});l(this,"cancel",()=>{let{initialShape:e,initialBinding:t,newStartBindingId:n,draggedBindingId:o}=this,s=k.onSessionComplete(this.app.page.shapes[e.id]),a=this.isCreate||Ve.Vec.dist(s.handles.start.point,s.handles.end.point)<4,d={};return d[o]=void 0,t&&(d[t.id]=a?void 0:t),n&&(d[n]=void 0),{document:{pages:{[this.app.currentPageId]:{shapes:{[e.id]:a?void 0:e},bindings:d}},pageStates:{[this.app.currentPageId]:{selectedIds:a?[]:[e.id],bindingId:void 0,hoveredId:void 0,editingId:void 0}}}}});l(this,"complete",()=>{let{initialShape:e,initialBinding:t,newStartBindingId:n,startBindingShapeId:o,handleId:s}=this,a=k.onSessionComplete(this.app.page.shapes[e.id]),d=a.handles[s].bindingId,i=Ve.Vec.dist(a.handles.start.point,a.handles.end.point);if(!(d||t)&&i<4)return this.cancel();let c={},u={};return t&&(c[t.id]=this.isCreate?void 0:t,u[t.id]=void 0),d&&(c[d]=void 0,u[d]=this.app.page.bindings[d]),o&&(c[n]=void 0,u[n]=this.app.page.bindings[n]),{id:"arrow",before:{document:{pages:{[this.app.currentPageId]:{shapes:{[e.id]:this.isCreate?void 0:e},bindings:c}},pageStates:{[this.app.currentPageId]:{selectedIds:this.isCreate?[]:[e.id],bindingId:void 0,hoveredId:void 0,editingId:void 0}}}},after:{document:{pages:{[this.app.currentPageId]:{shapes:{[e.id]:a},bindings:u}},pageStates:{[this.app.currentPageId]:{selectedIds:[e.id],bindingId:void 0,hoveredId:void 0,editingId:void 0}}}}}});l(this,"findBindingPoint",(e,t,n,o,s,a,d,i)=>{let u=k.getShapeUtil(t.type).getBindingPoint(t,e,s,a,d,i);if(!!u)return{id:o,type:"arrow",fromId:e.id,toId:t.id,handleId:n,point:Ve.Vec.toFixed(u.point),distance:u.distance}});var c,u,p;this.isCreate=o;let{currentPageId:s}=e.state.appState,a=e.state.document.pages[s];this.handleId=n,this.initialShape=wt(a.shapes[t]),this.bindableShapeIds=k.getBindableShapeIds(e.state).filter(m=>!(m===this.initialShape.id||m===this.initialShape.parentId));let d=(c=this.initialShape.handles[n==="start"?"end":"start"])==null?void 0:c.bindingId;if(d){let m=(u=a.bindings[d])==null?void 0:u.toId;m&&(this.bindableShapeIds=this.bindableShapeIds.filter(h=>h!==m))}let{originPoint:i}=this.app;if(this.isCreate)this.startBindingShapeId=(p=this.bindableShapeIds.map(m=>a.shapes[m]).filter(m=>!m.isLocked&&Ln.Utils.pointInBounds(i,k.getShapeUtil(m).getBounds(m))).sort((m,h)=>h.childIndex-m.childIndex)[0])==null?void 0:p.id,this.startBindingShapeId&&this.bindableShapeIds.splice(this.bindableShapeIds.indexOf(this.startBindingShapeId),1);else{let m=this.initialShape.handles[this.handleId].bindingId;m?this.initialBinding=a.bindings[m]:this.initialShape.handles[this.handleId].bindingId=void 0}}};var Aa=require("@tldraw/core");var La=class extends Je{constructor(e){super(e);l(this,"type","brush");l(this,"performanceMode");l(this,"status","brushing");l(this,"initialSelectedIds");l(this,"shapesToTest");l(this,"start",()=>{});l(this,"update",()=>{let{initialSelectedIds:e,shapesToTest:t,app:{metaKey:n,settings:o,originPoint:s,currentPoint:a}}=this,d=Aa.Utils.getBoundsFromPoints([s,a]),i=o.isCadSelectMode?!n&&s[0]<a[0]:n,c=new Set,u=new Set(e);t.forEach(({id:g,selectId:f})=>{let T=this.app.getShape(g);if(!c.has(f)){let x=this.app.getShapeUtil(T);(i?Aa.Utils.boundsContain(d,x.getBounds(T)):x.hitTestBounds(T,d))?(c.add(f),u.has(f)||u.add(f)):u.has(f)&&u.delete(f)}});let p=this.app.selectedIds,m=u.size!==p.length||p.some(g=>!u.has(g)),h=m?Array.from(u.values()):p;return m?{appState:{selectByContain:i},document:{pageStates:{[this.app.currentPageId]:{brush:d,selectedIds:h}}}}:{appState:{selectByContain:i},document:{pageStates:{[this.app.currentPageId]:{brush:d}}}}});l(this,"cancel",()=>({appState:{selectByContain:!1},document:{pageStates:{[this.app.currentPageId]:{brush:null,selectedIds:Array.from(this.initialSelectedIds.values())}}}}));l(this,"complete",()=>({appState:{selectByContain:!1},document:{pageStates:{[this.app.currentPageId]:{brush:null,selectedIds:[...this.app.selectedIds]}}}}));let{currentPageId:t}=e;this.initialSelectedIds=new Set(this.app.selectedIds),this.shapesToTest=this.app.shapes.filter(n=>!(n.isLocked||n.isHidden||n.parentId!==t||this.initialSelectedIds.has(n.id)||this.initialSelectedIds.has(n.parentId))).map(n=>({id:n.id,bounds:this.app.getShapeUtil(n).getBounds(n),selectId:n.id})),this.update()}};var nt=require("@tldraw/vec");var Ha=class extends Je{constructor(e,t){super(e);l(this,"type","draw");l(this,"performanceMode");l(this,"status","creating");l(this,"topLeft");l(this,"points");l(this,"initialShape");l(this,"lastAdjustedPoint");l(this,"shiftedPoints",[]);l(this,"shapeId");l(this,"isLocked");l(this,"isExtending");l(this,"lockedDirection");l(this,"start",()=>{var s;let e=this.app.originPoint,t=[0,0,(s=e[2])!=null?s:.5];this.points.push(t);let n=[Math.min(this.topLeft[0],e[0]),Math.min(this.topLeft[1],e[1])],o=nt.Vec.sub(n,e);return this.topLeft=n,this.shiftedPoints=this.points.map(a=>nt.Vec.toFixed(nt.Vec.sub(a,o)).concat(a[2])),{document:{pages:{[this.app.currentPageId]:{shapes:{[this.shapeId]:{point:this.topLeft,points:this.shiftedPoints}}}},pageStates:{[this.app.currentPageId]:{selectedIds:[this.shapeId]}}}}});l(this,"update",()=>{let{shapeId:e}=this,{currentPoint:t,originPoint:n,shiftKey:o,zoom:s}=this.app;if(!this.lockedDirection&&this.points.length>1){let d=nt.Vec.sub(t,n);nt.Vec.len(d)>3/s&&(this.lockedDirection=Math.abs(d[0])>Math.abs(d[1])?"horizontal":"vertical")}if(o){if(!this.isLocked&&this.points.length>2){if(!this.lockedDirection){let i=nt.Vec.sub(t,n);nt.Vec.len(i)>3/s&&(this.lockedDirection=Math.abs(i[0])>Math.abs(i[1])?"horizontal":"vertical")}this.isLocked=!0;let d=[...this.lastAdjustedPoint];this.lockedDirection==="vertical"?d[0]=0:d[1]=0,this.points.push(d.concat(t[2]))}}else this.isLocked&&(this.isLocked=!1);this.isLocked&&(this.lockedDirection==="vertical"?t[0]=n[0]:t[1]=n[1]);let a=this.addPoint(t);if(!!a)return{document:{pages:{[this.app.currentPageId]:{shapes:{[e]:a}}},pageStates:{[this.app.currentPageId]:{selectedIds:[e]}}}}});l(this,"cancel",()=>{let{shapeId:e}=this,t=this.app.currentPageId;return{document:{pages:{[t]:{shapes:{[e]:this.isExtending?this.initialShape:void 0}}},pageStates:{[t]:{selectedIds:[]}}}}});l(this,"complete",()=>{let{shapeId:e}=this,t=this.app.currentPageId,n=this.app.getShape(e);return{id:"create_draw",before:{document:{pages:{[t]:{shapes:{[e]:this.isExtending?this.initialShape:void 0}}},pageStates:{[t]:{selectedIds:[]}}}},after:{document:{pages:{[t]:{shapes:{[e]:w(S({},n),{point:nt.Vec.toFixed(n.point),points:n.points.map(o=>nt.Vec.toFixed(o)),isComplete:!0})}}},pageStates:{[this.app.currentPageId]:{selectedIds:[]}}}}}});l(this,"addPoint",e=>{let{originPoint:t}=this.app,n=nt.Vec.toFixed(nt.Vec.sub(e,t)).concat(e[2]);if(nt.Vec.isEqual(this.lastAdjustedPoint,n))return;this.points.push(n),this.lastAdjustedPoint=n;let o=[...this.topLeft],s=[Math.min(this.topLeft[0],e[0]),Math.min(this.topLeft[1],e[1])],a=nt.Vec.sub(s,t),d;return o[0]!==s[0]||o[1]!==s[1]?(this.topLeft=s,d=this.points.map(i=>nt.Vec.toFixed(nt.Vec.sub(i,a)).concat(i[2]))):d=[...this.shiftedPoints,nt.Vec.sub(n,a).concat(n[2])],this.shiftedPoints=d,{point:this.topLeft,points:d}});var i;let{originPoint:n}=this.app;this.shapeId=t,this.initialShape=this.app.getShape(t),this.topLeft=[...this.initialShape.point];let o=[0,0,(i=n[2])!=null?i:.5],s=nt.Vec.sub(n,this.topLeft),a=this.initialShape.points.map(c=>nt.Vec.sub(c,s).concat(c[2]));this.isExtending=a.length>0;let d=[];if(this.isExtending){let c=a[a.length-1];if(c){d.push(c,c);let u=Math.floor(nt.Vec.dist(c,o)/16);if(u>1)for(let p=0;p<u;p++){let m=p/(u-1);d.push(nt.Vec.lrp(c,o,m).concat(c[2]))}else d.push(o,o)}}else d.push(o);this.points=[...a,...d],this.shiftedPoints=this.points.map(c=>nt.Vec.add(c,s).concat(c[2])),this.lastAdjustedPoint=this.points[this.points.length-1]}};var za=class extends Je{constructor(e,t,n){super(e);l(this,"type","edit");l(this,"performanceMode");l(this,"initialShape");l(this,"initialSelectedIds");l(this,"currentPageId");l(this,"isCreating");l(this,"start",()=>{});l(this,"update",()=>{});l(this,"cancel",()=>({document:{pages:{[this.currentPageId]:{shapes:{[this.initialShape.id]:this.isCreating?void 0:this.initialShape}}},pageStates:{[this.currentPageId]:{selectedIds:this.isCreating?[]:this.initialSelectedIds,editingId:void 0}}}}));l(this,"complete",()=>{let e=this.app.getShape(this.initialShape.id);return{id:"edit",before:{document:{pages:{[this.currentPageId]:{shapes:{[this.initialShape.id]:this.isCreating?void 0:this.initialShape}}},pageStates:{[this.currentPageId]:{selectedIds:this.isCreating?[]:this.initialSelectedIds,editingId:void 0}}}},after:{document:{pages:{[this.currentPageId]:{shapes:{[this.initialShape.id]:e}}},pageStates:{[this.currentPageId]:{selectedIds:[e.id],editingId:void 0}}}}}});this.initialShape=e.getShape(t,e.currentPageId),this.currentPageId=e.currentPageId,this.isCreating=n,this.initialSelectedIds=[...e.selectedIds]}};var Co=require("@tldraw/vec");var Oa=class extends Je{constructor(e){super(e);l(this,"type","draw");l(this,"performanceMode");l(this,"status","creating");l(this,"isLocked");l(this,"lockedDirection");l(this,"erasedShapes",new Set);l(this,"erasedBindings",new Set);l(this,"initialSelectedShapes");l(this,"erasableShapes");l(this,"prevPoint");l(this,"prevEraseShapesSize",0);l(this,"interval");l(this,"timestamp1",0);l(this,"timestamp2",0);l(this,"prevErasePoint",[]);l(this,"loop",()=>{let e=Date.now(),t=e-this.timestamp1,n=e-this.timestamp2,{eraseLine:o}=this.app.appState,s=[...o],a=!1;t>16&&this.prevErasePoint!==this.prevPoint&&(a=!0,s=[...o,this.prevPoint],this.prevErasePoint=this.prevPoint),n>32&&s.length>1&&(a=!0,s.splice(0,Math.ceil(s.length*.1)),this.timestamp2=e),a&&this.app.patchState({appState:{eraseLine:s}},"eraseline"),this.interval=requestAnimationFrame(this.loop)});l(this,"start",()=>{});l(this,"update",()=>{let{page:e,shiftKey:t,originPoint:n,currentPoint:o,zoom:s}=this.app;if(t){let c=Co.Vec.sub(o,n);if(!this.isLocked&&Co.Vec.len(c)>3/s){if(!this.lockedDirection){let u=Co.Vec.sub(o,n);this.lockedDirection=Math.abs(u[0])>Math.abs(u[1])?"horizontal":"vertical"}this.isLocked=!0}}else this.isLocked&&(this.isLocked=!1);this.isLocked&&(this.lockedDirection==="vertical"?o[0]=n[0]:o[1]=n[1]);let a=Co.Vec.toFixed(Co.Vec.add(n,Co.Vec.sub(o,n))),d=new Set([]);this.erasableShapes.forEach(c=>{if(!this.erasedShapes.has(c)&&this.app.getShapeUtil(c).hitTestLineSegment(c,this.prevPoint,a)&&(this.erasedShapes.add(c),d.add(c.id),c.children!==void 0))for(let u of c.children)this.erasedShapes.add(this.app.getShape(u)),d.add(u)}),Object.values(e.bindings).forEach(c=>{for(let u of[c.toId,c.fromId])d.has(u)&&this.erasedBindings.add(c)}),this.erasedShapes.forEach(c=>{this.app.getShape(c.id)||(this.erasedShapes.delete(c),this.erasableShapes.delete(c),d.delete(c.id))});let i=Array.from(this.erasedShapes.values());if(this.prevPoint=a,i.length!==this.prevEraseShapesSize)return this.prevEraseShapesSize=i.length,{document:{pages:{[e.id]:{shapes:Object.fromEntries(i.map(c=>[c.id,{isGhost:!0}]))}}}}});l(this,"cancel",()=>{let{page:e}=this.app;cancelAnimationFrame(this.interval),this.erasedShapes.forEach(n=>{this.app.getShape(n.id)||(this.erasedShapes.delete(n),this.erasableShapes.delete(n))});let t=Array.from(this.erasedShapes.values());return{document:{pages:{[e.id]:{shapes:Object.fromEntries(t.map(n=>[n.id,{isGhost:!1}]))}},pageStates:{[e.id]:{selectedIds:this.initialSelectedShapes.map(n=>n.id)}}},appState:{eraseLine:[]}}});l(this,"complete",()=>{let{page:e}=this.app;cancelAnimationFrame(this.interval),this.erasedShapes.forEach(i=>{this.app.getShape(i.id)||(this.erasedShapes.delete(i),this.erasableShapes.delete(i))}),this.erasedBindings.forEach(i=>{this.app.getBinding(i.id)||this.erasedBindings.delete(i)});let t=Array.from(this.erasedShapes.values()),n=Array.from(this.erasedBindings.values()),o=t.map(i=>i.id),s=n.map(i=>i.id),a={shapes:Object.fromEntries(t.map(i=>[i.id,i])),bindings:Object.fromEntries(n.map(i=>[i.id,i]))},d={shapes:Object.fromEntries(t.map(i=>[i.id,void 0])),bindings:Object.fromEntries(n.map(i=>[i.id,void 0]))};return this.app.shapes.forEach(i=>{i.handles&&!d.shapes[i.id]&&Object.values(i.handles).forEach(c=>{var u,p;c.bindingId&&s.includes(c.bindingId)&&(a.shapes[i.id]=w(S({},a.shapes[i.id]),{handles:w(S({},(u=a.shapes[i.id])==null?void 0:u.handles),{[c.id]:c})}),o.includes(i.id)||(d.shapes[i.id]=w(S({},d.shapes[i.id]),{handles:w(S({},(p=d.shapes[i.id])==null?void 0:p.handles),{[c.id]:w(S({},c),{bindingId:void 0})})})))})}),{id:"erase",before:{document:{pages:{[e.id]:a},pageStates:{[e.id]:{selectedIds:this.initialSelectedShapes.filter(i=>!!this.app.getShape(i.id)).map(i=>i.id)}}},appState:{eraseLine:[]}},after:{document:{pages:{[e.id]:d},pageStates:{[e.id]:{selectedIds:this.initialSelectedShapes.filter(i=>!!this.app.getShape(i.id)).filter(i=>!o.includes(i.id)).map(i=>i.id)}}},appState:{eraseLine:[]}}}});this.prevPoint=[...e.originPoint],this.initialSelectedShapes=this.app.selectedIds.map(t=>this.app.getShape(t)),this.erasableShapes=new Set(this.app.shapes.filter(t=>!t.isLocked)),this.interval=this.loop()}};var Fa=require("@tldraw/core"),ja=require("@tldraw/vec");var Ga=class extends Je{constructor(e,t){super(e);l(this,"type","grid");l(this,"performanceMode");l(this,"status","translating");l(this,"shape");l(this,"bounds");l(this,"initialSelectedIds");l(this,"initialSiblings");l(this,"grid",{});l(this,"columns",1);l(this,"rows",1);l(this,"isCopying",!1);l(this,"start",()=>{});l(this,"update",()=>{let{currentPageId:e,altKey:t,shiftKey:n,currentPoint:o}=this.app,s={},a={},d=Fa.Utils.getBoundsCenter(this.bounds),i=ja.Vec.sub(o,d);n&&(Math.abs(i[0])<Math.abs(i[1])?i[0]=0:i[1]=0);let c=this.bounds.width+32,u=this.bounds.height+32,p=Math.ceil(i[0]/c),m=Math.ceil(i[1]/u),h=Math.min(p,0),g=Math.min(m,0),f=Math.max(p,1),T=Math.max(m,1),x=new Set,b=t;b!==this.isCopying&&(Object.values(this.grid).filter(y=>y!==this.shape.id).forEach(y=>s[y]=void 0),this.grid={"0_0":this.shape.id},this.isCopying=b);for(let y=h;y<f;y++)for(let R=g;R<T;R++){let K=`${y}_${R}`;if(x.add(K),this.grid[K]||y===0&&R===0)continue;let L=this.getClone(ja.Vec.add(this.shape.point,[y*c,R*u]),b);s[L.id]=L,this.grid[K]=L.id}if(Object.entries(this.grid).forEach(([y,R])=>{x.has(y)||(s[R]=void 0,delete this.grid[y])}),Object.values(s).length!==0)return this.initialSiblings&&(s[this.shape.parentId]={children:[...this.initialSiblings,...Object.values(this.grid)]}),{document:{pages:{[e]:{shapes:s}},pageStates:{[e]:a}}}});l(this,"cancel",()=>{let{currentPageId:e}=this.app,t={};return Object.values(this.grid).forEach(n=>{t[n]=void 0}),t[this.shape.id]=w(S({},t[this.shape.id]),{point:this.shape.point}),this.initialSiblings&&(t[this.shape.parentId]={children:[...this.initialSiblings,this.shape.id]}),{document:{pages:{[e]:{shapes:t}},pageStates:{[e]:{selectedIds:[this.shape.id]}}}}});l(this,"complete",()=>{let{currentPageId:e}=this.app,t={},n={},o=[];if(Object.values(this.grid).forEach(s=>{t[s]=void 0,n[s]=this.app.getShape(s),o.push(s)}),t[this.shape.id]=this.shape,this.initialSiblings&&(t[this.shape.parentId]={children:[...this.initialSiblings,this.shape.id]},n[this.shape.parentId]={children:[...this.initialSiblings,...Object.values(this.grid)]}),o.length!==1)return{id:"grid",before:{document:{pages:{[e]:{shapes:t}},pageStates:{[e]:{selectedIds:[],hoveredId:void 0}}}},after:{document:{pages:{[e]:{shapes:n}},pageStates:{[e]:{selectedIds:o,hoveredId:void 0}}}}}});l(this,"getClone",(e,t)=>{let n=w(S({},this.shape),{id:Fa.Utils.uniqueId(),point:e});return t||n.type==="sticky"&&(n.text=""),n});var n;this.shape=this.app.getShape(t),this.grid["0_0"]=this.shape.id,this.bounds=this.app.getShapeBounds(t),this.initialSelectedIds=[...this.app.selectedIds],this.shape.parentId!==this.app.currentPageId&&(this.initialSiblings=(n=this.app.getShape(this.shape.parentId).children)==null?void 0:n.filter(o=>o!==this.shape.id))}};var ti=require("@tldraw/vec");var Va=class extends Je{constructor(e,t,n,o="move_handle"){super(e);l(this,"type","handle");l(this,"performanceMode");l(this,"status","translatingHandle");l(this,"commandId");l(this,"topLeft");l(this,"shiftKey",!1);l(this,"initialShape");l(this,"handleId");l(this,"start",()=>{});l(this,"update",()=>{var u,p;let{initialShape:e,app:{currentPageId:t,currentPoint:n}}=this,o=this.app.getShape(e.id);if(o.isLocked)return;let s=o.handles,a=this.handleId,d=ti.Vec.sub(n,s[a].point),i={[a]:w(S({},s[a]),{point:ti.Vec.sub(ti.Vec.add(s[a].point,d),o.point)})},c=(p=(u=k.getShapeUtil(o)).onHandleChange)==null?void 0:p.call(u,o,i);if(!!c)return{document:{pages:{[t]:{shapes:{[o.id]:c}}}}}});l(this,"cancel",()=>{let{initialShape:e,app:{currentPageId:t}}=this;return{document:{pages:{[t]:{shapes:{[e.id]:e}}}}}});l(this,"complete",()=>{let{initialShape:e,app:{currentPageId:t}}=this;return{id:this.commandId,before:{document:{pages:{[t]:{shapes:{[e.id]:e}}}}},after:{document:{pages:{[t]:{shapes:{[e.id]:k.onSessionComplete(this.app.getShape(this.initialShape.id))}}}}}}});let{originPoint:s}=e;this.topLeft=[...s],this.handleId=n,this.initialShape=this.app.getShape(t),this.commandId=o}};var Hr=require("@tldraw/core"),$a=require("@tldraw/vec");var Na=class extends Je{constructor(e){super(e);l(this,"type","rotate");l(this,"status","transforming");l(this,"performanceMode");l(this,"delta",[0,0]);l(this,"commonBoundsCenter");l(this,"initialAngle");l(this,"initialShapes");l(this,"changes",{});l(this,"start",()=>{});l(this,"update",()=>{let{commonBoundsCenter:e,initialShapes:t,app:{currentPageId:n,currentPoint:o,shiftKey:s}}=this,a={},d=$a.Vec.angle(e,o)-this.initialAngle;return s&&(d=Hr.Utils.snapAngleToSegments(d,24)),t.forEach(({center:i,shape:c})=>{let{rotation:u=0}=c,p=0;s&&(p=Hr.Utils.snapAngleToSegments(u,24)-u);let m=k.getRotatedShapeMutation(c,i,e,s?d+p:d);m&&(a[c.id]=m)}),this.changes=a,{document:{pages:{[n]:{shapes:a}}}}});l(this,"cancel",()=>{let{initialShapes:e,app:{currentPageId:t}}=this,n={};return e.forEach(({shape:o})=>n[o.id]=o),{document:{pages:{[t]:{shapes:n}}}}});l(this,"complete",()=>{let{initialShapes:e,app:{currentPageId:t}}=this,n={},o=this.changes;return e.forEach(({shape:{id:s,point:a,rotation:d,handles:i}})=>{n[s]={point:a,rotation:d,handles:i}}),{id:"rotate",before:{document:{pages:{[t]:{shapes:n}}}},after:{document:{pages:{[t]:{shapes:o}}}}}});let{app:{currentPageId:t,pageState:n,originPoint:o}}=this,s=k.getSelectedBranchSnapshot(e.state,t).filter(a=>!a.isLocked);if(s.length===0)throw Error("No selected shapes!");if(e.rotationInfo.selectedIds===n.selectedIds){if(e.rotationInfo.center===void 0)throw Error("We should have a center for rotation!");this.commonBoundsCenter=e.rotationInfo.center}else this.commonBoundsCenter=Hr.Utils.getBoundsCenter(Hr.Utils.getCommonBounds(s.map(k.getBounds))),e.rotationInfo.selectedIds=n.selectedIds,e.rotationInfo.center=this.commonBoundsCenter;this.initialShapes=s.filter(a=>a.children===void 0).map(a=>({shape:a,center:this.app.getShapeUtil(a).getCenter(a)})),this.initialAngle=$a.Vec.angle(this.commonBoundsCenter,o)}};var St=require("@tldraw/core"),Do=require("@tldraw/vec");var Wa=class extends Je{constructor(e,t=St.TLBoundsCorner.BottomRight,n=!1){super(e);this.transformType=t;this.isCreate=n;l(this,"type","transform");l(this,"performanceMode");l(this,"status","transforming");l(this,"scaleX",1);l(this,"scaleY",1);l(this,"initialShapes");l(this,"initialShapeIds");l(this,"initialSelectedIds");l(this,"shapeBounds");l(this,"hasUnlockedShapes");l(this,"isAllAspectRatioLocked");l(this,"initialCommonBounds");l(this,"snapInfo",{state:"empty"});l(this,"prevPoint",[0,0]);l(this,"speed",1);l(this,"start",()=>{this.snapInfo={state:"ready",bounds:this.app.shapes.filter(e=>!this.initialShapeIds.includes(e.id)).map(e=>St.Utils.getBoundsWithCenter(k.getRotatedBounds(e)))}});l(this,"update",()=>{let{transformType:e,shapeBounds:t,initialCommonBounds:n,isAllAspectRatioLocked:o,app:{currentPageId:s,pageState:{camera:a},viewport:d,currentPoint:i,previousPoint:c,originPoint:u,shiftKey:p,altKey:m,metaKey:h,currentGrid:g,settings:{isSnapping:f,showGrid:T}}}=this,x={},b=m?Do.Vec.mul(Do.Vec.sub(i,u),2):Do.Vec.sub(i,u),y=St.Utils.getTransformedBoundingBox(n,e,b,0,p||o);m&&(y=S(S({},y),St.Utils.centerBounds(y,St.Utils.getBoundsCenter(n)))),T&&(y=S(S({},y),St.Utils.snapBoundsToGrid(y,g)));let K=Do.Vec.dist(i,c)-this.speed;this.speed=this.speed+K*(K>1?.5:.15);let L=[];if((f&&!h||!f&&h)&&this.speed*a.zoom<10&&this.snapInfo.state==="ready"){let v=St.Utils.getSnapPoints(St.Utils.getBoundsWithCenter(y),this.snapInfo.bounds.filter(I=>St.Utils.boundsContain(d,I)||St.Utils.boundsCollide(d,I)),5/a.zoom);v&&(L=v.snapLines,y=St.Utils.getTransformedBoundingBox(n,e,Do.Vec.sub(b,v.offset),0,p||o))}return this.scaleX=y.scaleX,this.scaleY=y.scaleY,t.forEach(({initialShape:v,initialShapeBounds:I,transformOrigin:J})=>{let ce=St.Utils.getRelativeTransformedBoundingBox(y,n,I,this.scaleX<0,this.scaleY<0);T&&(ce=St.Utils.snapBoundsToGrid(ce,g));let de=k.transform(this.app.getShape(v.id),ce,{type:this.transformType,initialShape:v,scaleX:this.scaleX,scaleY:this.scaleY,transformOrigin:J});x[v.id]=de}),{appState:{snapLines:L},document:{pages:{[s]:{shapes:x}}}}});l(this,"cancel",()=>{let{shapeBounds:e,app:{currentPageId:t}}=this,n={};return this.isCreate?e.forEach(o=>n[o.initialShape.id]=void 0):e.forEach(o=>n[o.initialShape.id]=o.initialShape),{appState:{snapLines:[]},document:{pages:{[t]:{shapes:n}},pageStates:{[t]:{selectedIds:this.isCreate?[]:e.map(o=>o.initialShape.id)}}}}});l(this,"complete",()=>{let{isCreate:e,shapeBounds:t,hasUnlockedShapes:n,app:{currentPageId:o}}=this;if(!n)return;if(this.isCreate&&Do.Vec.dist(this.app.originPoint,this.app.currentPoint)<2)return this.cancel();let s={},a={},d,i;return e?(d=[],i=[],t.forEach(({initialShape:c})=>{s[c.id]=void 0,a[c.id]=this.app.getShape(c.id)})):(d=this.initialSelectedIds,i=this.initialSelectedIds,t.forEach(({initialShape:c})=>{s[c.id]=c,a[c.id]=this.app.getShape(c.id)})),{id:"transform",before:{appState:{snapLines:[]},document:{pages:{[o]:{shapes:s}},pageStates:{[o]:{selectedIds:d,hoveredId:void 0,editingId:void 0}}}},after:{appState:{snapLines:[]},document:{pages:{[o]:{shapes:a}},pageStates:{[o]:{selectedIds:i,hoveredId:void 0,editingId:void 0}}}}}});this.initialSelectedIds=[...this.app.selectedIds],this.app.rotationInfo.selectedIds=[...this.initialSelectedIds],this.initialShapes=k.getSelectedBranchSnapshot(this.app.state,this.app.currentPageId).filter(d=>!d.isLocked),this.initialShapeIds=this.initialShapes.map(d=>d.id),this.hasUnlockedShapes=this.initialShapes.length>0,this.isAllAspectRatioLocked=this.initialShapes.every(d=>d.isAspectRatioLocked||k.getShapeUtil(d).isAspectRatioLocked);let o=Object.fromEntries(this.initialShapes.map(d=>[d.id,k.getBounds(d)])),s=Object.values(o);this.initialCommonBounds=St.Utils.getCommonBounds(s);let a=St.Utils.getBoundsFromPoints(s.map(St.Utils.getBoundsCenter));this.shapeBounds=this.initialShapes.map(d=>{let i=o[d.id],c=St.Utils.getBoundsCenter(i),u=(c[0]-a.minX)/a.width,p=(c[1]-a.minY)/a.height;return{initialShape:d,initialShapeBounds:i,transformOrigin:[u,p]}})}};var mn=require("@tldraw/core"),uo=require("@tldraw/vec");var Ua=class extends Je{constructor(e,t,n,o=!1){super(e);l(this,"type","transformSingle");l(this,"status","transforming");l(this,"performanceMode");l(this,"transformType");l(this,"scaleX",1);l(this,"scaleY",1);l(this,"isCreate");l(this,"initialShape");l(this,"initialShapeBounds");l(this,"initialCommonBounds");l(this,"snapInfo",{state:"empty"});l(this,"prevPoint",[0,0]);l(this,"speed",1);l(this,"start",()=>{this.snapInfo={state:"ready",bounds:this.app.shapes.filter(e=>e.id!==this.initialShape.id).map(e=>mn.Utils.getBoundsWithCenter(k.getRotatedBounds(e)))}});l(this,"update",()=>{let{transformType:e,initialShape:t,initialShapeBounds:n,app:{settings:{isSnapping:o,showGrid:s},currentPageId:a,pageState:{camera:d},viewport:i,currentPoint:c,previousPoint:u,originPoint:p,currentGrid:m,shiftKey:h,altKey:g,metaKey:f}}=this;if(t.isLocked)return;let T={},x=g?uo.Vec.mul(uo.Vec.sub(c,p),2):uo.Vec.sub(c,p),b=this.app.getShape(t.id),y=k.getShapeUtil(b),R=mn.Utils.getTransformedBoundingBox(n,e,x,b.rotation,h||b.isAspectRatioLocked||y.isAspectRatioLocked);g&&(R=S(S({},R),mn.Utils.centerBounds(R,mn.Utils.getBoundsCenter(n)))),s&&(R=S(S({},R),mn.Utils.snapBoundsToGrid(R,m)));let L=uo.Vec.dist(c,u)-this.speed;this.speed=this.speed+L*(L>1?.5:.15);let v=[];if((o&&!f||!o&&f)&&!t.rotation&&this.speed*d.zoom<10&&this.snapInfo.state==="ready"){let J=mn.Utils.getSnapPoints(mn.Utils.getBoundsWithCenter(R),this.snapInfo.bounds.filter(ce=>mn.Utils.boundsContain(i,ce)||mn.Utils.boundsCollide(i,ce)),5/d.zoom);J&&(v=J.snapLines,R=mn.Utils.getTransformedBoundingBox(n,e,uo.Vec.sub(x,J.offset),b.rotation,h||b.isAspectRatioLocked||y.isAspectRatioLocked))}let I=k.getShapeUtil(b).transformSingle(b,R,{initialShape:t,type:this.transformType,scaleX:R.scaleX,scaleY:R.scaleY,transformOrigin:[.5,.5]});return I&&(T[b.id]=I),s&&I&&I.point&&(I.point=uo.Vec.snap(I.point,m)),{appState:{snapLines:v},document:{pages:{[a]:{shapes:T}}}}});l(this,"cancel",()=>{let{initialShape:e,app:{currentPageId:t}}=this,n={};return this.isCreate?n[e.id]=void 0:n[e.id]=e,{appState:{snapLines:[]},document:{pages:{[t]:{shapes:n}},pageStates:{[t]:{selectedIds:this.isCreate?[]:[e.id]}}}}});l(this,"complete",()=>{let{initialShape:e,app:{currentPageId:t}}=this;if(e.isLocked)return;if(this.isCreate&&uo.Vec.dist(this.app.originPoint,this.app.currentPoint)<2)return this.cancel();let n={},o={};return n[e.id]=this.isCreate?void 0:e,o[e.id]=k.onSessionComplete(this.app.getShape(e.id)),{id:"transform_single",before:{appState:{snapLines:[]},document:{pages:{[t]:{shapes:n}},pageStates:{[t]:{selectedIds:this.isCreate?[]:[e.id],editingId:void 0,hoveredId:void 0}}}},after:{appState:{snapLines:[]},document:{pages:{[t]:{shapes:o}},pageStates:{[t]:{selectedIds:[e.id],editingId:void 0,hoveredId:void 0}}}}}});this.isCreate=o,this.transformType=n;let s=this.app.getShape(t);this.initialShape=s,this.initialShapeBounds=k.getBounds(s),this.initialCommonBounds=k.getRotatedBounds(s),this.app.rotationInfo.selectedIds=[s.id]}};var Ft=require("@tldraw/core"),We=require("@tldraw/vec");var Ka=class extends Je{constructor(e,t=!1,n=!1){super(e);l(this,"performanceMode");l(this,"type","translate");l(this,"status","translating");l(this,"delta",[0,0]);l(this,"prev",[0,0]);l(this,"prevPoint",[0,0]);l(this,"speed",1);l(this,"cloneInfo",{state:"empty"});l(this,"snapInfo",{state:"empty"});l(this,"snapLines",[]);l(this,"isCloning",!1);l(this,"isCreate");l(this,"link");l(this,"initialIds");l(this,"hasUnlockedShapes");l(this,"initialSelectedIds");l(this,"initialCommonBounds");l(this,"initialShapes");l(this,"initialParentChildren");l(this,"bindingsToDelete");l(this,"start",()=>{let{bindingsToDelete:e,initialIds:t,app:{currentPageId:n,page:o}}=this,s=[],a=[];if(Object.values(o.shapes).forEach(c=>{let u=Ft.Utils.getBoundsWithCenter(k.getRotatedBounds(c));s.push(u),t.has(c.id)||a.push(u)}),this.snapInfo={state:"ready",bounds:s,others:a},e.length===0)return;let d={},i={};return e.forEach(c=>{d[c.id]=void 0;let u=this.app.getShape(c.fromId);i[c.fromId]={handles:w(S({},u.handles),{[c.handleId]:w(S({},u.handles[c.handleId]),{bindingId:void 0})})}}),{document:{pages:{[n]:{bindings:d,shapes:i}}}}});l(this,"update",()=>{let{initialParentChildren:e,initialShapes:t,initialCommonBounds:n,bindingsToDelete:o,app:{pageState:{camera:s},settings:{isSnapping:a,showGrid:d},currentPageId:i,viewport:c,selectedIds:u,currentPoint:p,previousPoint:m,originPoint:h,altKey:g,shiftKey:f,metaKey:T,currentGrid:x}}=this,b={},y={},R={},K=We.Vec.sub(p,h),L=!1;this.isCreate||(g&&!this.isCloning?(this.isCloning=!0,L=!0):!g&&this.isCloning&&(this.isCloning=!1,L=!0)),f&&(Math.abs(K[0])<Math.abs(K[1])?K[0]=0:K[1]=0);let I=We.Vec.dist(p,m)-this.speed;if(this.speed=this.speed+I*(I>1?.5:.15),this.snapLines=[],(a&&!T||!a&&T)&&this.speed*s.zoom<10&&this.snapInfo.state==="ready"){let J=Ft.Utils.getSnapPoints(Ft.Utils.getBoundsWithCenter(d?Ft.Utils.snapBoundsToGrid(Ft.Utils.translateBounds(n,K),x):Ft.Utils.translateBounds(n,K)),(this.isCloning?this.snapInfo.bounds:this.snapInfo.others).filter(ce=>Ft.Utils.boundsContain(c,ce)||Ft.Utils.boundsCollide(c,ce)),5/s.zoom);J&&(this.snapLines=J.snapLines,K=We.Vec.sub(K,J.offset))}if(this.prev=K,this.isCloning)if(L){if(this.cloneInfo.state==="empty"&&this.createCloneInfo(),this.cloneInfo.state==="empty")throw Error;let{clones:J,clonedBindings:ce}=this.cloneInfo;this.isCloning=!0,o.forEach(de=>b[de.id]=de),t.forEach(de=>y[de.id]={point:de.point}),J.forEach(de=>{var He;if(y[de.id]=S({},de),de.parentId!==i&&!u.includes(de.parentId)){let Pe=((He=y[de.parentId])==null?void 0:He.children)||e[de.parentId];Pe.includes(de.id)||(y[de.parentId]=w(S({},y[de.parentId]),{children:[...Pe,de.id]}))}});for(let de of ce)b[de.id]=de;R.selectedIds=J.map(de=>de.id),J.forEach(de=>{y[de.id]=w(S({},de),{point:d?We.Vec.snap(We.Vec.toFixed(We.Vec.add(de.point,K)),x):We.Vec.toFixed(We.Vec.add(de.point,K))})})}else{if(this.cloneInfo.state==="empty")throw Error;let{clones:J}=this.cloneInfo;J.forEach(ce=>{y[ce.id]={point:d?We.Vec.snap(We.Vec.toFixed(We.Vec.add(ce.point,K)),x):We.Vec.toFixed(We.Vec.add(ce.point,K))}})}else if(L){if(this.cloneInfo.state==="empty")throw Error;let{clones:J,clonedBindings:ce}=this.cloneInfo;this.isCloning=!1,o.forEach(de=>b[de.id]=void 0),J.forEach(de=>{de.parentId!==i&&(y[de.parentId]=w(S({},y[de.parentId]),{children:e[de.parentId]}))}),J.forEach(de=>y[de.id]=void 0),t.forEach(de=>{y[de.id]={point:d?We.Vec.snap(We.Vec.toFixed(We.Vec.add(de.point,K)),x):We.Vec.toFixed(We.Vec.add(de.point,K))}});for(let de of ce)b[de.id]=void 0;R.selectedIds=t.map(de=>de.id)}else t.forEach(J=>{y[J.id]={point:d?We.Vec.snap(We.Vec.toFixed(We.Vec.add(J.point,K)),x):We.Vec.toFixed(We.Vec.add(J.point,K))}});return{appState:{snapLines:this.snapLines},document:{pages:{[i]:{shapes:y,bindings:b}},pageStates:{[i]:R}}}});l(this,"cancel",()=>{let{initialShapes:e,initialSelectedIds:t,bindingsToDelete:n,app:{currentPageId:o}}=this,s={},a={},d={editingId:void 0,hoveredId:void 0};if(this.isCreate?(e.forEach(({id:i})=>a[i]=void 0),d.selectedIds=[]):(e.forEach(({id:i,point:c,handles:u})=>a[i]=u?w(S({},a[i]),{point:c,handles:u}):w(S({},a[i]),{point:c})),d.selectedIds=t,n.forEach(i=>{s[i.id]=i})),this.cloneInfo.state==="ready"){let{clones:i,clonedBindings:c}=this.cloneInfo;i.forEach(u=>a[u.id]=void 0),c.forEach(u=>s[u.id]=void 0)}return{appState:{snapLines:[]},document:{pages:{[o]:{shapes:a,bindings:s}},pageStates:{[o]:d}}}});l(this,"complete",()=>{let{initialShapes:e,initialParentChildren:t,bindingsToDelete:n,app:{currentPageId:o}}=this,s={},a={},d={},i={};if(this.isCloning){if(this.cloneInfo.state==="empty"&&this.createCloneInfo(),this.cloneInfo.state!=="ready")throw Error;let{clones:c,clonedBindings:u}=this.cloneInfo;c.forEach(p=>{a[p.id]=void 0,i[p.id]=this.app.getShape(p.id),p.parentId!==o&&(a[p.parentId]=w(S({},a[p.parentId]),{children:t[p.parentId]}),i[p.parentId]=w(S({},i[p.parentId]),{children:this.app.getShape(p.parentId).children}))}),u.forEach(p=>{s[p.id]=void 0,d[p.id]=this.app.getBinding(p.id)})}else e.forEach(c=>{a[c.id]=this.isCreate?void 0:w(S({},a[c.id]),{point:c.point}),i[c.id]=S(S({},i[c.id]),this.isCreate?this.app.getShape(c.id):{point:this.app.getShape(c.id).point})});return n.forEach(c=>{var u,p,m,h,g;s[c.id]=c,a[c.fromId]=w(S({},a[c.fromId]),{id:c.fromId,handles:w(S({},(u=a[c.fromId])==null?void 0:u.handles),{[c.handleId]:w(S({},(m=(p=a[c.fromId])==null?void 0:p.handles)==null?void 0:m[c.handleId]),{bindingId:c.id})})}),i[c.fromId]=w(S({},i[c.fromId]),{id:c.fromId,handles:w(S({},i[c.fromId].handles),{[c.handleId]:w(S({},(g=(h=i[c.fromId])==null?void 0:h.handles)==null?void 0:g[c.handleId]),{bindingId:void 0})})})}),n.forEach(c=>d[c.id]=void 0),{id:"translate",before:{appState:{snapLines:[]},document:{pages:{[o]:{shapes:a,bindings:s}},pageStates:{[o]:{selectedIds:this.isCreate?[]:[...this.initialSelectedIds]}}}},after:{appState:{snapLines:[]},document:{pages:{[o]:{shapes:i,bindings:d}},pageStates:{[o]:{selectedIds:[...this.app.selectedIds]}}}}}});l(this,"createCloneInfo",()=>{let{initialShapes:e,initialParentChildren:t,app:{selectedIds:n,currentPageId:o,page:s}}=this,a={},d={},i=[],c=[];e.forEach(p=>{let m=Ft.Utils.uniqueId();t[m]=t[p.id],a[p.id]=m;let h=w(S({},Ft.Utils.deepClone(p)),{id:m,parentId:p.parentId,childIndex:k.getChildIndexAbove(this.app.state,p.id,o)});if(h.type==="video"){let g=document.getElementById(p.id+"_video");g&&(h.currentTime=(g.currentTime+16)%g.duration)}c.push(h)}),c.forEach(p=>{p.children!==void 0&&(p.children=p.children.map(m=>a[m]))}),c.forEach(p=>{n.includes(p.parentId)&&(p.parentId=a[p.parentId])});let u=new Set(Object.keys(a));Object.values(s.bindings).filter(p=>u.has(p.fromId)||u.has(p.toId)).forEach(p=>{if(u.has(p.fromId)&&u.has(p.toId)){let m=Ft.Utils.uniqueId(),h=w(S({},Ft.Utils.deepClone(p)),{id:m,fromId:a[p.fromId]||p.fromId,toId:a[p.toId]||p.toId});d[p.id]=m,i.push(h)}}),c.forEach(p=>{if(p.handles&&p.handles)for(let m in p.handles){let h=p.handles[m];h.bindingId=h.bindingId?d[h.bindingId]:void 0}}),c.forEach(p=>{if(s.shapes[p.id])throw Error("uh oh, we didn't clone correctly")}),this.cloneInfo={state:"ready",clones:c,cloneMap:a,clonedBindings:i}});this.isCreate=t,this.link=n;let{currentPageId:o,selectedIds:s,page:a}=this.app;this.initialSelectedIds=[...s];let d=(n?k.getLinkedShapeIds(this.app.state,o,n,!1):s).map(c=>this.app.getShape(c)).filter(c=>!c.isLocked),i=new Set(d.map(c=>c.id));this.hasUnlockedShapes=d.length>0,this.initialShapes=Array.from(new Set(d.filter(c=>!i.has(c.parentId)).flatMap(c=>c.children?[c,...c.children.map(u=>this.app.getShape(u))]:[c])).values()),this.initialIds=new Set(this.initialShapes.map(c=>c.id)),this.bindingsToDelete=[],Object.values(a.bindings).filter(c=>this.initialIds.has(c.fromId)||this.initialIds.has(c.toId)).forEach(c=>{this.initialIds.has(c.fromId)&&(this.initialIds.has(c.toId)||this.bindingsToDelete.push(c))}),this.initialParentChildren={},this.initialShapes.map(c=>c.parentId).filter(c=>c!==a.id).forEach(c=>{this.initialParentChildren[c]=this.app.getShape(c).children}),this.initialCommonBounds=Ft.Utils.getCommonBounds(this.initialShapes.map(k.getRotatedBounds)),this.app.rotationInfo.selectedIds=[...this.app.selectedIds]}};var ice={["arrow"]:Ra,["brush"]:La,["draw"]:Ha,["erase"]:Oa,["handle"]:Va,["rotate"]:Na,["transform"]:Wa,["transformSingle"]:Ua,["translate"]:Ka,["grid"]:Ga,["edit"]:za},Pp=r=>ice[r];var Ep=require("@tldraw/core"),Bp=V(require("@tldraw/vec"));var Mp=require("@tldraw/core");var at=class extends os{constructor(e){super();this.app=e;l(this,"type","select");l(this,"previous");l(this,"status","idle");l(this,"setStatus",e=>{this.status=e,this.app.setStatus(this.status)});l(this,"onEnter",()=>{this.setStatus("idle")});l(this,"onExit",()=>{this.setStatus("idle")});l(this,"onCancel",()=>{this.status==="idle"?this.app.selectTool("select"):this.setStatus("idle"),this.app.cancelSession()});l(this,"getNextChildIndex",()=>{let{shapes:e,appState:{currentPageId:t}}=this.app;return e.length===0?1:e.filter(n=>n.parentId===t).sort((n,o)=>o.childIndex-n.childIndex)[0].childIndex+1});l(this,"onPinchStart",()=>{this.app.cancelSession(),this.setStatus("pinching")});l(this,"onPinchEnd",()=>{Mp.Utils.isMobileSafari()&&this.app.undoSelect(),this.setStatus("idle")});l(this,"onPinch",(e,t)=>{var n;this.status==="pinching"&&(isNaN(e.delta[0])||isNaN(e.delta[1])||(this.app.pinchZoom(e.point,e.delta,e.delta[2]),(n=this.onPointerMove)==null||n.call(this,e,t)))});l(this,"onKeyDown",e=>{if(e==="Escape"){this.onCancel();return}if(e==="Meta"||e==="Control"||e==="Alt"){this.app.updateSession();return}});l(this,"onKeyUp",e=>{if(e==="Meta"||e==="Control"||e==="Alt"){this.app.updateSession();return}});l(this,"onPointerMove",()=>{this.status==="creating"&&this.app.updateSession()});l(this,"onPointerUp",()=>{if(this.status==="creating"){this.app.completeSession();let{isToolLocked:e}=this.app.appState;e||this.app.selectTool("select")}this.setStatus("idle")})}};var Fr=class extends at{constructor(){super(...arguments);l(this,"type","arrow");l(this,"onPointerDown",()=>{if(this.status!=="idle")return;let{currentPoint:e,currentGrid:t,settings:{showGrid:n},appState:{currentPageId:o,currentStyle:s}}=this.app,a=this.getNextChildIndex(),d=Ep.Utils.uniqueId(),i=Qo.create({id:d,parentId:o,childIndex:a,point:n?Bp.default.snap(e,t):e,style:S({},s)});this.app.patchCreate([i]),this.app.startSession("arrow",i.id,"end",!0),this.setStatus("creating")})}};var Rp=require("@tldraw/core");var jr=class extends at{constructor(){super(...arguments);l(this,"type","draw");l(this,"lastShapeId");l(this,"onEnter",()=>{this.lastShapeId=void 0});l(this,"onCancel",()=>{switch(this.status){case"idle":{this.app.selectTool("select");break}default:{this.setStatus("idle");break}}this.app.cancelSession()});l(this,"onPointerDown",e=>{if(this.status!=="idle"||this.app.readOnly)return;let{currentPoint:t,appState:{currentPageId:n,currentStyle:o}}=this.app,s=this.lastShapeId&&this.app.getShape(this.lastShapeId);if(e.shiftKey&&s)this.app.startSession("draw",s.id),this.setStatus("extending");else{let a=this.getNextChildIndex(),d=Rp.Utils.uniqueId(),i=Ws.create({id:d,parentId:n,childIndex:a,point:t,style:S({},o)});this.lastShapeId=d,this.app.patchCreate([i]),this.app.startSession("draw",d),this.setStatus("creating")}});l(this,"onPointerMove",()=>{if(!this.app.readOnly)switch(this.status){case"extending":case"creating":this.app.updateSession()}});l(this,"onPointerUp",()=>{this.app.completeSession(),this.setStatus("idle")})}};var ni=require("@tldraw/core"),Ap=V(require("@tldraw/vec"));var Gr=class extends at{constructor(){super(...arguments);l(this,"type","ellipse");l(this,"onPointerDown",()=>{if(this.app.readOnly||this.status!=="idle")return;let{currentPoint:e,currentGrid:t,settings:{showGrid:n},appState:{currentPageId:o,currentStyle:s}}=this.app,a=this.getNextChildIndex(),d=ni.Utils.uniqueId(),i=Ns.create({id:d,parentId:o,childIndex:a,point:n?Ap.default.snap(e,t):e,style:S({},s)});this.app.patchCreate([i]),this.app.startSession("transformSingle",i.id,ni.TLBoundsCorner.BottomRight,!0),this.setStatus("creating")})}};var Lp=V(require("@tldraw/vec"));var Vr=class extends at{constructor(){super(...arguments);l(this,"type","erase");l(this,"status","idle");l(this,"onPointerDown",()=>{this.app.readOnly||this.status==="idle"&&this.setStatus("pointing")});l(this,"onPointerMove",e=>{if(!this.app.readOnly)switch(this.status){case"pointing":{Lp.default.dist(e.origin,e.point)>3&&(this.app.startSession("erase"),this.app.updateSession(),this.setStatus("erasing"));break}case"erasing":this.app.updateSession()}});l(this,"onPointerUp",()=>{if(!this.app.readOnly){switch(this.status){case"pointing":{let e=this.app.shapes.filter(t=>!t.isLocked).filter(t=>this.app.getShapeUtil(t).hitTestPoint(t,this.app.currentPoint)).flatMap(t=>t.children?[t.id,...t.children]:t.id);this.app.delete(e);break}case"erasing":this.app.completeSession()}this.setStatus("idle")}});l(this,"onCancel",()=>{this.status==="idle"?this.previous?this.app.selectTool(this.previous):this.app.selectTool("select"):this.setStatus("idle"),this.app.cancelSession()})}};var Hp=require("@tldraw/core"),zp=V(require("@tldraw/vec"));var $r=class extends at{constructor(){super(...arguments);l(this,"type","line");l(this,"onPointerDown",()=>{if(this.app.readOnly||this.status!=="idle")return;let{currentPoint:e,currentGrid:t,settings:{showGrid:n},appState:{currentPageId:o,currentStyle:s}}=this.app,a=this.getNextChildIndex(),d=Hp.Utils.uniqueId(),i=Qo.create({id:d,parentId:o,childIndex:a,point:n?zp.default.snap(e,t):e,decorations:{start:void 0,end:void 0},style:S({},s)});this.app.patchCreate([i]),this.app.startSession("arrow",i.id,"end",!0),this.setStatus("creating")})}};var oi=require("@tldraw/core"),Op=V(require("@tldraw/vec"));var Nr=class extends at{constructor(){super(...arguments);l(this,"type","rectangle");l(this,"onPointerDown",()=>{if(this.app.readOnly||this.status!=="idle")return;let{currentPoint:e,currentGrid:t,settings:{showGrid:n},appState:{currentPageId:o,currentStyle:s}}=this.app,a=this.getNextChildIndex(),d=oi.Utils.uniqueId(),i=Vs.create({id:d,parentId:o,childIndex:a,point:n?Op.default.snap(e,t):e,style:S({},s)});this.app.patchCreate([i]),this.app.startSession("transformSingle",i.id,oi.TLBoundsCorner.BottomRight,!0),this.setStatus("creating")})}};var ir=require("@tldraw/core"),Hn=V(require("@tldraw/vec"));var Wr=class extends at{constructor(){super(...arguments);l(this,"type","select");l(this,"pointedId");l(this,"selectedGroupId");l(this,"pointedHandleId");l(this,"pointedBoundsHandle");l(this,"pointedLinkHandleId");l(this,"onEnter",()=>{this.setStatus("idle")});l(this,"onExit",()=>{this.setStatus("idle")});l(this,"clonePaint",e=>{if(this.app.selectedIds.length===0)return;let t=this.app.selectedIds.map(c=>this.app.getShape(c)),n=ir.Utils.expandBounds(ir.Utils.getCommonBounds(t.map(k.getBounds)),16),o=ir.Utils.getBoundsCenter(n),s=[n.width,n.height],a=[o[0]+s[0]*Math.floor((e[0]+s[0]/2-o[0])/s[0]),o[1]+s[1]*Math.floor((e[1]+s[1]/2-o[1])/s[1])],d=ir.Utils.centerBounds(n,a);this.app.shapes.some(c=>k.getShapeUtil(c).hitTestBounds(c,d))||this.app.duplicate(this.app.selectedIds,a)});l(this,"getShapeClone",(e,t)=>{let n=this.app.getShape(e),o=k.getShapeUtil(n);if(o.canClone){let s=o.getBounds(n),a=o.getCenter(n),d={top:[s.minX,s.minY-(s.height+32)],right:[s.maxX+32,s.minY],bottom:[s.minX,s.maxY+32],left:[s.minX-(s.width+32),s.minY],topLeft:[s.minX-(s.width+32),s.minY-(s.height+32)],topRight:[s.maxX+32,s.minY-(s.height+32)],bottomLeft:[s.minX-(s.width+32),s.maxY+32],bottomRight:[s.maxX+32,s.maxY+32]}[t];if(n.rotation!==0){let u=Hn.default.add(d,[s.width/2,s.height/2]),p=Hn.default.rotWith(u,a,n.rotation||0);d=Hn.default.sub(p,[s.width/2,s.height/2])}let i=ir.Utils.uniqueId(),c=w(S({},n),{id:i,point:d});return c.type==="sticky"&&(c.text=""),c}});l(this,"onCancel",()=>{this.app.session?this.app.cancelSession():this.selectNone(),this.setStatus("idle")});l(this,"onKeyDown",(e,t,n)=>{switch(e){case"Escape":{this.onCancel();break}case"Tab":{if(this.app.readOnly)return;if(!this.app.pageState.editingId&&this.status==="idle"&&this.app.selectedIds.length===1){let[o]=this.app.selectedIds,s=this.getShapeClone(o,"right");s&&(this.app.createShapes(s),this.setStatus("idle"),s.type==="sticky"&&(this.app.select(s.id),this.app.setEditingId(s.id)))}break}case"Meta":case"Control":case"Alt":{this.app.updateSession();break}case"Enter":{if(this.app.readOnly)return;let{pageState:o}=this.app;o.selectedIds.length===1&&!o.editingId&&(this.app.setEditingId(o.selectedIds[0]),n.preventDefault())}}});l(this,"onKeyUp",(e,t)=>{if(this.status==="clonePainting"&&!(t.altKey&&t.shiftKey)){this.setStatus("idle");return}if(e==="Meta"||e==="Control"||e==="Alt"){this.app.updateSession();return}});l(this,"onPointerMove",()=>{let{originPoint:e,currentPoint:t}=this.app;if(this.app.readOnly&&this.app.isPointing){this.app.session?this.app.updateSession():Hn.default.dist(e,t)>3&&(this.app.startSession("brush"),this.setStatus("brushing"));return}switch(this.status){case"pointingBoundsHandle":{if(!this.pointedBoundsHandle)throw Error("No pointed bounds handle");if(Hn.default.dist(e,t)>3){if(this.pointedBoundsHandle==="rotate")this.setStatus("rotating"),this.app.startSession("rotate");else if(this.pointedBoundsHandle==="center"||this.pointedBoundsHandle==="left"||this.pointedBoundsHandle==="right")this.setStatus("translating"),this.app.startSession("translate",!1,this.pointedBoundsHandle);else{this.setStatus("transforming");let n=this.app.selectedIds.flatMap(o=>k.getDocumentBranch(this.app.state,o,this.app.currentPageId));n.length===1?this.app.startSession("transformSingle",n[0],this.pointedBoundsHandle):this.app.startSession("transform",this.pointedBoundsHandle)}this.app.updateSession()}break}case"pointingCanvas":{Hn.default.dist(e,t)>3&&(this.app.startSession("brush"),this.setStatus("brushing"));break}case"pointingClone":{Hn.default.dist(e,t)>3&&(this.setStatus("translatingClone"),this.app.startSession("translate"),this.app.updateSession());break}case"pointingBounds":{Hn.default.dist(e,t)>3&&(this.setStatus("translating"),this.app.startSession("translate"),this.app.updateSession());break}case"pointingHandle":{if(!this.pointedHandleId)throw Error("No pointed handle");if(Hn.default.dist(e,t)>3){this.setStatus("translatingHandle");let n=this.app.getShape(this.app.selectedIds[0]);n&&(this.pointedHandleId==="bend"?(this.app.startSession("handle",n.id,this.pointedHandleId),this.app.updateSession()):(this.app.startSession("arrow",n.id,this.pointedHandleId,!1),this.app.updateSession()))}break}case"clonePainting":{this.clonePaint(t);break}default:if(this.app.session){this.app.updateSession();break}}});l(this,"onPointerDown",(e,t)=>{if(e.target==="canvas"&&this.status==="idle"){let{currentPoint:n}=this.app;if(e.spaceKey&&t.buttons===1)return;if(this.status==="idle"&&e.altKey&&e.shiftKey){this.setStatus("clonePainting"),this.clonePaint(n);return}if(!e.shiftKey){if(this.app.onShapeBlur(),e.altKey&&this.app.selectedIds.length>0){this.app.duplicate(this.app.selectedIds,n);return}this.selectNone()}this.setStatus("pointingCanvas")}});l(this,"onPointerUp",e=>{var t;if(this.status==="translatingClone"||this.status==="pointingClone"){this.pointedId&&(this.app.completeSession(),this.app.setEditingId(this.pointedId)),this.setStatus("idle"),this.pointedId=void 0;return}if(this.status==="pointingBounds"){if(e.target==="bounds")this.selectNone();else if(this.app.isSelected(e.target))e.shiftKey?this.pointedId!==e.target&&this.deselect(e.target):this.pointedId!==e.target&&this.app.selectedIds.length>1&&this.select(e.target);else if(this.pointedId===e.target){if(this.app.getShape(e.target).isLocked)return;e.shiftKey?this.pushSelect(e.target):this.select(e.target)}}this.setStatus("idle"),this.pointedBoundsHandle=void 0,this.pointedHandleId=void 0,this.pointedId=void 0,((t=this.app.session)==null?void 0:t.type)!=="edit"&&this.app.completeSession()});l(this,"onDoubleClickCanvas",()=>{!this.app.readOnly});l(this,"onPointShape",(e,t)=>{if(e.spaceKey&&t.buttons===1||this.app.getShape(e.target).isLocked)return;let{editingId:n,hoveredId:o}=this.app.pageState;if(n&&e.target!==n&&this.app.onShapeBlur(),(this.status==="idle"||this.status==="pointingBounds")&&e.metaKey&&e.shiftKey&&o){this.pointedId=o,this.app.isSelected(o)?this.deselect(o):(this.pushSelect(o),this.setStatus("pointingBounds"));return}if(this.status==="pointingBounds"){let{parentId:s}=this.app.getShape(e.target);this.pointedId=s===this.app.currentPageId?e.target:s;return}if(this.status==="idle"){if(this.setStatus("pointingBounds"),e.metaKey){e.shiftKey||this.selectNone(),this.app.startSession("brush"),this.setStatus("brushing");return}let s,{parentId:a}=this.app.getShape(e.target);a===this.app.currentPageId?(s=e.target,this.selectedGroupId=void 0):a===this.selectedGroupId?s=e.target:(s=a,this.selectedGroupId=void 0),this.app.isSelected(s)||(this.pointedId=s,e.shiftKey?this.pushSelect(s):this.select(s))}});l(this,"onDoubleClickShape",e=>{if(this.app.readOnly)return;let t=this.app.getShape(e.target);if(t.isLocked){this.app.select(e.target);return}k.getShapeUtil(t.type).canEdit&&(t.parentId===this.app.currentPageId||t.parentId===this.selectedGroupId)&&this.app.setEditingId(e.target),t.parentId!==this.app.currentPageId&&(this.selectedGroupId=t.parentId),this.app.select(e.target)});l(this,"onRightPointShape",e=>{this.app.isSelected(e.target)||this.app.select(e.target)});l(this,"onHoverShape",e=>{this.app.setHoveredId(e.target)});l(this,"onUnhoverShape",e=>{let{currentPageId:t}=this.app;requestAnimationFrame(()=>{t===this.app.currentPageId&&this.app.pageState.hoveredId===e.target&&this.app.setHoveredId(void 0)})});l(this,"onPointBounds",e=>{if(e.metaKey){e.shiftKey||this.selectNone(),this.app.startSession("brush"),this.setStatus("brushing");return}this.setStatus("pointingBounds")});l(this,"onRightPointBounds",(e,t)=>{t.stopPropagation()});l(this,"onReleaseBounds",()=>{(this.status==="translating"||this.status==="brushing")&&this.app.completeSession(),this.setStatus("idle")});l(this,"onPointBoundsHandle",e=>{this.pointedBoundsHandle=e.target,this.setStatus("pointingBoundsHandle")});l(this,"onDoubleClickBoundsHandle",e=>{switch(e.target){case"center":case"left":case"right":{this.app.select(...k.getLinkedShapeIds(this.app.state,this.app.currentPageId,e.target,e.shiftKey));break}default:if(this.app.selectedIds.length===1){this.app.resetBounds(this.app.selectedIds);let t=this.app.getShape(this.app.selectedIds[0]);"label"in t&&this.app.setEditingId(t.id)}}});l(this,"onReleaseBoundsHandle",()=>{this.setStatus("idle")});l(this,"onPointHandle",e=>{this.pointedHandleId=e.target,this.setStatus("pointingHandle")});l(this,"onDoubleClickHandle",e=>{if(e.target==="bend"){let{selectedIds:t}=this.app;if(t.length!==1)return;let n=this.app.getShape(t[0]);k.getShapeUtil(n.type).canEdit&&(n.parentId===this.app.currentPageId||n.parentId===this.selectedGroupId)&&this.app.setEditingId(n.id);return}this.app.toggleDecoration(e.target)});l(this,"onReleaseHandle",()=>{this.setStatus("idle")});l(this,"onShapeClone",e=>{let t=this.app.selectedIds[0],n=this.getShapeClone(t,e.target);e.target==="left"||e.target==="right"||e.target==="top"||e.target==="bottom"?n&&(this.app.createShapes(n),this.pointedId=n.id,this.setStatus("pointingClone")):(this.setStatus("gridCloning"),this.app.startSession("grid",t))})}deselect(e){this.app.select(...this.app.selectedIds.filter(t=>t!==e))}select(e){this.app.select(e)}pushSelect(e){let t=this.app.getShape(e);this.app.select(...this.app.selectedIds.filter(n=>n!==t.parentId),e)}selectNone(){this.app.selectNone()}};var Fp=require("@tldraw/core"),_a=V(require("@tldraw/vec"));var Ur=class extends at{constructor(){super(...arguments);l(this,"type","sticky");l(this,"shapeId");l(this,"onPointerDown",()=>{if(!this.app.readOnly){if(this.status==="creating"){this.setStatus("idle"),this.app.appState.isToolLocked||this.app.selectTool("select");return}if(this.status==="idle"){let{currentPoint:e,currentGrid:t,settings:{showGrid:n},appState:{currentPageId:o,currentStyle:s}}=this.app,a=this.getNextChildIndex(),d=Fp.Utils.uniqueId();this.shapeId=d;let i=Pr.create({id:d,parentId:o,childIndex:a,point:n?_a.default.snap(e,t):e,style:S({},s)}),c=Pr.getBounds(i);i.point=_a.default.sub(i.point,[c.width/2,c.height/2]),this.app.patchCreate([i]),this.app.startSession("translate"),this.setStatus("creating")}}});l(this,"onPointerUp",()=>{this.app.readOnly||this.status==="creating"&&(this.setStatus("idle"),this.app.completeSession(),this.app.selectTool("select"),this.app.setEditingId(this.shapeId))})}};var jp=V(require("@tldraw/vec"));var Kr=class extends at{constructor(){super(...arguments);l(this,"type","text");l(this,"stopEditingShape",()=>{this.setStatus("idle"),this.app.appState.isToolLocked||this.app.selectTool("select")});l(this,"onKeyUp",()=>{});l(this,"onKeyDown",()=>{});l(this,"onPointerDown",()=>{if(this.status==="creating"){this.stopEditingShape();return}if(this.status==="idle"){let{currentPoint:e,currentGrid:t,settings:{showGrid:n}}=this.app;this.app.createTextShapeAtPoint(n?jp.default.snap(e,t):e,void 0,!0),this.setStatus("creating");return}});l(this,"onPointerUp",()=>{});l(this,"onPointShape",e=>{if(this.app.readOnly)return;let t=this.app.getShape(e.target);t.type==="text"&&(this.setStatus("idle"),this.app.setEditingId(t.id))});l(this,"onShapeBlur",()=>{this.app.readOnly||this.stopEditingShape()})}};var ri=require("@tldraw/core"),Gp=V(require("@tldraw/vec"));var _r=class extends at{constructor(){super(...arguments);l(this,"type","triangle");l(this,"onPointerDown",()=>{if(this.app.readOnly||this.status!=="idle")return;let{currentPoint:e,currentGrid:t,settings:{showGrid:n},appState:{currentPageId:o,currentStyle:s}}=this.app,a=this.getNextChildIndex(),d=ri.Utils.uniqueId(),i=$s.create({id:d,parentId:o,childIndex:a,point:n?Gp.default.snap(e,t):e,style:S({},s)});this.app.patchCreate([i]),this.app.startSession("transformSingle",i.id,ri.TLBoundsCorner.BottomRight,!0),this.setStatus("creating")})}};var Ya=Dt.Utils.uniqueId(),ht=class extends ha{constructor(e,t={}){super(ht.defaultState,e,ht.version,(n,o,s)=>An(w(S({},o),{document:w(S(S({},o.document),n.document),{version:s})}),ht.version));l(this,"callbacks",{});l(this,"tools",{select:new Wr(this),erase:new Vr(this),["text"]:new Kr(this),["draw"]:new jr(this),["ellipse"]:new Gr(this),["rectangle"]:new Nr(this),["triangle"]:new _r(this),["line"]:new $r(this),["arrow"]:new Fr(this),["sticky"]:new Ur(this)});l(this,"currentTool",this.tools.select);l(this,"session");l(this,"readOnly",!1);l(this,"isDirty",!1);l(this,"isCreating",!1);l(this,"originPoint",[0,0]);l(this,"currentPoint",[0,0]);l(this,"previousPoint",[0,0]);l(this,"shiftKey",!1);l(this,"altKey",!1);l(this,"metaKey",!1);l(this,"ctrlKey",!1);l(this,"spaceKey",!1);l(this,"isPointing",!1);l(this,"isForcePanning",!1);l(this,"isErasingWithPen",!1);l(this,"isPastePrevented",!1);l(this,"editingStartTime",-1);l(this,"fileSystemHandle",null);l(this,"viewport",Dt.Utils.getBoundsFromPoints([[0,0],[100,100]]));l(this,"rendererBounds",Dt.Utils.getBoundsFromPoints([[0,0],[100,100]]));l(this,"selectHistory",{stack:[[]],pointer:0});l(this,"clipboard");l(this,"rotationInfo",{selectedIds:[],center:[0,0]});l(this,"migrate",e=>An(e,ht.version));l(this,"onReady",()=>{var e,t;this.loadDocument(this.document),va().then(n=>{this.fileSystemHandle=n});try{this.patchState(w(S({},An(this.state,ht.version)),{appState:{status:"idle"}}))}catch(n){console.error("The data appears to be corrupted. Resetting!",n),localStorage.setItem(this.document.id+"_corrupted",JSON.stringify(this.document)),this.patchState(w(S({},ht.defaultState),{appState:w(S({},ht.defaultState.appState),{status:"idle"})}))}(t=(e=this.callbacks).onMount)==null||t.call(e,this)});l(this,"cleanup",(e,t)=>{var a;let n=S({},e);n.document!==t.document&&Object.entries(n.document.pages).forEach(([d,i])=>{if(i===void 0){delete n.document.pages[d],delete n.document.pageStates[d];return}let c=t.document.pages[d],u={};if(!c||i.shapes!==c.shapes||i.bindings!==c.bindings){i.shapes=S({},i.shapes),i.bindings=S({},i.bindings);let m=new Set;Object.entries(i.shapes).forEach(([f,T])=>{var b;let x;T?x=T.parentId:(x=(b=c==null?void 0:c.shapes[f])==null?void 0:b.parentId,delete i.shapes[f]),i.id===n.appState.currentPageId&&(c==null?void 0:c.shapes[f])!==T&&(u[f]=T),x&&x!==d&&i.shapes[x]!==void 0&&m.add(i.shapes[x])}),Object.keys(i.bindings).forEach(f=>{i.bindings[f]||delete i.bindings[f]}),n.document.pages[d]=i;let h=k.getRelatedBindings(n,Object.keys(u),d),g=new Set;h.forEach(f=>{if(!i.bindings[f.id])return;let T=i.shapes[f.toId],x=i.shapes[f.fromId];if(!(T&&x)){delete n.document.pages[d].bindings[f.id];return}if(g.has(x))return;let b=k.updateArrowBindings(i,x);if(g.add(x),b){let y=S(S({},x),b);i.shapes[x.id]=y}}),m.forEach(f=>{if(!f)throw Error("no group!");let T=f.children.filter(b=>i.shapes[b]!==void 0),x=Dt.Utils.getCommonBounds(T.map(b=>i.shapes[b]).filter(Boolean).map(b=>k.getRotatedBounds(b)));i.shapes[f.id]=w(S({},f),{point:[x.minX,x.minY],size:[x.width,x.height],children:T})})}let p=S({},n.document.pageStates[d]);p.brush||delete p.brush,p.hoveredId&&!i.shapes[p.hoveredId]&&delete p.hoveredId,p.bindingId&&!i.bindings[p.bindingId]&&(k.warn(`Could not find the binding of ${d}`),delete p.bindingId),p.editingId&&!i.shapes[p.editingId]&&(k.warn("Could not find the editing shape!"),delete p.editingId),n.document.pageStates[d]=p}),Object.keys((a=n.document.assets)!=null?a:{}).forEach(d=>{var i,c;((i=n.document.assets)==null?void 0:i[d])||(c=n.document.assets)==null||delete c[d]});let o=n.appState.currentPageId,s=n.document.pageStates[o];if(n.room&&n.room!==t.room){let d=w(S({},n.room),{users:S({},n.room.users)});t.room&&Object.values(t.room.users).filter(Boolean).forEach(i=>{d.users[i.id]===void 0&&delete d.users[i.id]}),n.room=d}return n.room&&(n.room.users[n.room.userId]=w(S({},n.room.users[n.room.userId]),{point:this.currentPoint,selectedIds:s.selectedIds})),this.readOnly&&(n.document.pages=t.document.pages),n});l(this,"broadcastPatch",(e,t)=>{var c,u,p,m,h,g,f,T,x;let n={},o={},s={},a=(p=(u=(c=e==null?void 0:e.document)==null?void 0:c.pages)==null?void 0:u[this.currentPageId])==null?void 0:p.shapes,d=(g=(h=(m=e==null?void 0:e.document)==null?void 0:m.pages)==null?void 0:h[this.currentPageId])==null?void 0:g.bindings,i=(f=e==null?void 0:e.document)==null?void 0:f.assets;a&&Object.keys(a).forEach(b=>{n[b]=this.getShape(b,this.currentPageId)}),d&&Object.keys(d).forEach(b=>{o[b]=this.getBinding(b,this.currentPageId)}),i&&Object.keys(i).forEach(b=>{s[b]=this.document.assets[b]}),(x=(T=this.callbacks).onChangePage)==null||x.call(T,this,n,o,s,t)});l(this,"onPatch",(e,t,n)=>{var o,s,a,d,i,c;(this.callbacks.onChangePage&&((s=(o=t==null?void 0:t.document)==null?void 0:o.pages)==null?void 0:s[this.currentPageId])||((a=t==null?void 0:t.document)==null?void 0:a.assets))&&(((d=t==null?void 0:t.document)==null?void 0:d.assets)||this.session&&this.session.type!=="brush"&&this.session.type!=="erase"&&this.session.type!=="draw")&&this.broadcastPatch(t,!1),(c=(i=this.callbacks).onPatch)==null||c.call(i,this,t,n)});l(this,"onCommand",(e,t,n)=>{var o,s;this.clearSelectHistory(),this.isDirty=!0,(s=(o=this.callbacks).onCommand)==null||s.call(o,this,t,n)});l(this,"onReplace",()=>{this.clearSelectHistory(),this.isDirty=!1});l(this,"onUndo",()=>{var e,t;this.rotationInfo.selectedIds=[...this.selectedIds],(t=(e=this.callbacks).onUndo)==null||t.call(e,this)});l(this,"onRedo",()=>{var e,t;this.rotationInfo.selectedIds=[...this.selectedIds],(t=(e=this.callbacks).onRedo)==null||t.call(e,this)});l(this,"onPersist",(e,t)=>{var n,o;(o=(n=this.callbacks).onPersist)==null||o.call(n,this),this.broadcastPatch(t,!0)});l(this,"prevSelectedIds",this.selectedIds);l(this,"onStateDidChange",(e,t)=>{var n,o,s,a;(o=(n=this.callbacks).onChange)==null||o.call(n,this,t),this.room&&this.selectedIds!==this.prevSelectedIds&&((a=(s=this.callbacks).onChangePresence)==null||a.call(s,this,w(S({},this.room.users[this.room.userId]),{selectedIds:this.selectedIds,session:!!this.session})),this.prevSelectedIds=this.selectedIds)});l(this,"preventPaste",()=>{if(this.isPastePrevented)return;let e=n=>n.stopImmediatePropagation(),t=()=>{setTimeout(()=>{document.removeEventListener("paste",e,{capture:!0}),this.isPastePrevented=!1},50)};document.addEventListener("paste",e,{capture:!0}),window.addEventListener("pointerup",t,{once:!0}),this.isPastePrevented=!0});l(this,"justSent",!1);l(this,"getReservedContent",(e,t=this.currentPageId)=>{let{bindings:n}=this.document.pages[t],o={},s={},a=Object.values(n),d=new Map(a.map(h=>[h.toId,h])),i=new Map(a.map(h=>[h.fromId,h])),c=[d,i],u=[];this.session&&e.forEach(h=>u.push(h)),this.pageState.editingId&&u.push(this.pageState.editingId);let p=new Set(u),m=new Set;for(;u.length>0;){let h=u.pop();if(!h)break;if(m.has(h))continue;m.add(h);let g=this.getShape(h);o[h]=g,g.parentId!==t&&u.push(g.parentId),g.children&&u.push(...g.children),c.map(f=>f.get(g.id)).filter(Boolean).forEach(f=>{s[f.id]=f,u.push(f.toId,f.fromId)})}return{reservedShapes:o,reservedBindings:s,strongReservedShapeIds:p}});l(this,"replacePageContent",(e,t,n,o=this.currentPageId)=>{if(this.justSent)return this.justSent=!1,this;let s=this.document.pages[this.currentPageId];return Object.values(e).forEach(a=>{a.parentId!==o&&!(s.shapes[a.parentId]||e[a.parentId])&&(console.warn("Added a shape without a parent on the page"),a.parentId=o)}),this.useStore.setState(a=>{let{hoveredId:d,editingId:i,bindingId:c,selectedIds:u}=a.document.pageStates[o],p=[...u],m=i&&a.document.pages[this.currentPageId].shapes[i];m&&p.push(m.id);let{reservedShapes:h,reservedBindings:g,strongReservedShapeIds:f}=this.getReservedContent(p,this.currentPageId);Object.values(h).filter(v=>!("text"in v)).forEach(v=>{let I=e[v.id];if(!!I){if(!(v.type==="arrow"||f.has(v.id))){e[v.id]=I;return}"decorations"in I&&"decorations"in v&&(e[v.id]=w(S({},v),{decorations:I.decorations})),v.style=I.style}});let T=S(S({},e),h);m&&(T[m.id]=m);let x=S(S({},t),g),b=S({},n),y=w(S({},a),{document:w(S({},a.document),{pages:{[o]:w(S({},a.document.pages[o]),{shapes:T,bindings:x})},assets:b,pageStates:w(S({},a.document.pageStates),{[o]:w(S({},a.document.pageStates[o]),{selectedIds:u.filter(v=>T[v]!==void 0),hoveredId:d?T[d]===void 0?void 0:d:void 0,editingId:i,bindingId:c?x[c]===void 0?void 0:c:void 0})})})}),R=y.document.pages[o],K=k.getRelatedBindings(y,Object.keys(T),o),L=new Set;return K.forEach(v=>{if(!R.bindings[v.id])return;let I=R.shapes[v.fromId];if(L.has(I))return;let J=k.updateArrowBindings(R,I);if(L.add(I),J){let ce=S(S({},I),J);R.shapes[I.id]=ce}}),Object.values(T).forEach(v=>{if(v.type!=="group")return;let I=v.children.filter(ce=>R.shapes[ce]!==void 0),J=Dt.Utils.getCommonBounds(I.map(ce=>R.shapes[ce]).filter(Boolean).map(ce=>k.getRotatedBounds(ce)));R.shapes[v.id]=w(S({},v),{point:[J.minX,J.minY],size:[J.width,J.height],children:I})}),this.state.document=y.document,y},!0),this});l(this,"updateBounds",e=>{this.rendererBounds=e;let{point:t,zoom:n}=this.camera;this.updateViewport(t,n),!this.readOnly&&this.session&&this.session.update()});l(this,"updateViewport",(e,t)=>{let{width:n,height:o}=this.rendererBounds,[s,a]=xe.Vec.sub(xe.Vec.div([0,0],t),e),[d,i]=xe.Vec.sub(xe.Vec.div([n,o],t),e);this.viewport={minX:s,minY:a,maxX:d,maxY:i,width:d-s,height:i-a}});l(this,"setEditingId",(e,t=!1)=>{if(!this.readOnly){if(e)this.startSession("edit",e,t);else{if(!this.pageState.editingId)return;this.completeSession()}this.editingStartTime=performance.now(),this.patchState({document:{pageStates:{[this.currentPageId]:{editingId:e}}}},"set_editing_id")}});l(this,"setHoveredId",e=>{this.patchState({document:{pageStates:{[this.currentPageId]:{hoveredId:e}}}},"set_hovered_id")});l(this,"setSetting",(e,t)=>{if(this.session)return this;let n={settings:{[e]:typeof t=="function"?t(this.settings[e]):t}};return this.patchState(n,`settings:${e}`),this.persist(n),this});l(this,"toggleFocusMode",()=>{if(this.session)return this;let e={settings:{isFocusMode:!this.settings.isFocusMode}};return this.patchState(e,"settings:toggled_focus_mode"),this.persist(e),this});l(this,"togglePenMode",()=>{if(this.session)return this;let e={settings:{isPenMode:!this.settings.isPenMode}};return this.patchState(e,"settings:toggled_pen_mode"),this.persist(e),this});l(this,"toggleDarkMode",()=>{if(this.session)return this;let e={settings:{isDarkMode:!this.settings.isDarkMode}};return this.patchState(e,"settings:toggled_dark_mode"),this.persist(e),this});l(this,"toggleZoomSnap",()=>{if(this.session)return this;let e={settings:{isZoomSnap:!this.settings.isZoomSnap}};return this.patchState(e,"settings:toggled_zoom_snap"),this.persist(e),this});l(this,"toggleDebugMode",()=>{if(this.session)return this;let e={settings:{isDebugMode:!this.settings.isDebugMode}};return this.patchState(e,"settings:toggled_debug"),this.persist(e),this});l(this,"setMenuOpen",e=>{let t={appState:{isMenuOpen:e}};return this.patchState(t,"ui:toggled_menu_opened"),this.persist(t),this});l(this,"setIsLoading",e=>{let t={appState:{isLoading:e}};return this.patchState(t,"ui:toggled_is_loading"),this.persist(t),this});l(this,"setDisableAssets",e=>(this.patchState({appState:{disableAssets:e}},"ui:toggled_disable_images"),this));l(this,"toggleGrid",()=>{if(this.session)return this;let e={settings:{showGrid:!this.settings.showGrid}};return this.patchState(e,"settings:toggled_grid"),this.persist(e),this});l(this,"selectTool",e=>{if(this.readOnly||this.session)return this;this.isPointing=!1;let t=this.tools[e];return t===this.currentTool?(this.patchState({appState:{isToolLocked:!1}}),this):(this.currentTool.onExit(),t.previous=this.currentTool.type,this.currentTool=t,this.currentTool.onEnter(),this.patchState({appState:{activeTool:e,isToolLocked:!1}},`selected_tool:${e}`))});l(this,"toggleToolLock",()=>this.session?this:this.patchState({appState:{isToolLocked:!this.appState.isToolLocked}},"toggled_tool_lock"));l(this,"resetDocument",()=>{if(this.session)return this;this.session=void 0,this.currentTool=this.tools.select;let e=ht.defaultDocument;return e.pages.page.name="Page 1",this.resetHistory().clearSelectHistory().loadDocument(ht.defaultDocument).persist({}),this});l(this,"updateUsers",(e,t=!1)=>{this.patchState({room:{users:Object.fromEntries(e.map(n=>[n.id,n]))}},t?"room:self:update":"room:user:update")});l(this,"removeUser",e=>{this.patchState({room:{users:{[e]:void 0}}})});l(this,"mergeDocument",e=>{if(this.document.id!==e.id)return this.replaceState(w(S({},An(w(S({},this.state),{document:e}),ht.version)),{appState:w(S({},this.appState),{currentPageId:Object.keys(e.pages)[0]})})),this;let t=S({},this.document.pageStates),n=w(S({},this.appState),{currentPageId:e.pages[this.currentPageId]?this.currentPageId:Object.keys(e.pages)[0],pages:Object.values(e.pages).map((s,a)=>({id:s.id,name:s.name,childIndex:s.childIndex||a}))});this.resetHistory(),Object.keys(this.document.pages).forEach(s=>{e.pages[s]||(s===this.appState.currentPageId&&(this.cancelSession(),this.selectNone()),t[s]=void 0)}),this.session&&this.selectedIds.filter(s=>!e.pages[this.currentPageId].shapes[s]).forEach(s=>e.pages[this.currentPageId].shapes[s]=this.page.shapes[s]),Object.entries(t).forEach(([s,a])=>{a.selectedIds=a.selectedIds.filter(d=>!!e.pages[s].shapes[d])});let{editingId:o}=this.pageState;return o&&(e.pages[this.currentPageId].shapes[o]=this.page.shapes[o],t[this.currentPageId].selectedIds=[o]),this.replaceState(w(S({},An(w(S({},this.state),{document:w(S({},e),{pageStates:t})}),ht.version)),{appState:n}),"merge")});l(this,"updateDocument",(e,t="updated_document")=>{let n=this.state,o=w(S({},n),{document:w(S({},n.document),{assets:e.assets})});e.pages[this.currentPageId]||(o.appState=w(S({},n.appState),{currentPageId:Object.keys(e.pages)[0]}));let s=1;for(let a of Object.values(e.pages))a!==n.document.pages[a.id]&&(o.document.pages[a.id]=a,a.name||(o.document.pages[a.id].name=`Page ${s+1}`,s++));for(let a of Object.values(e.pageStates))if(a!==n.document.pageStates[a.id]){o.document.pageStates[a.id]=a;let d=e.pages[a.id],i=["bindingId","editingId","hoveredId","pointedId"];for(let c of i)d.shapes[c]||(a[c]=void 0);a.selectedIds=a.selectedIds.filter(c=>!!e.pages[d.id].shapes[c])}return this.replaceState(An(o,o.document.version||0),`${t}:${e.id}`)});l(this,"loadRoom",e=>(this.patchState({room:{id:e,userId:Ya,users:{[Ya]:{id:Ya,color:Fi[Math.floor(Math.random()*Fi.length)],point:[100,100],selectedIds:[],activeShapes:[]}}}}),this));l(this,"loadDocument",e=>{this.setIsLoading(!0),this.selectNone(),this.resetHistory(),this.clearSelectHistory(),this.session=void 0;let t=w(S({},ht.defaultState),{settings:S({},this.state.settings),document:e,appState:w(S(S({},ht.defaultState.appState),this.state.appState),{currentPageId:Object.keys(e.pages)[0],disableAssets:this.disableAssets})});this.replaceState(An(t,ht.version),"loaded_document");let{point:n,zoom:o}=this.camera;return this.updateViewport(n,o),this.setIsLoading(!1),this});l(this,"loadPageFromURL",(e,t)=>{let n=e.id,o=w(S({},this.state.document),{pageStates:w(S({},this.state.document.pageStates),{[n]:t}),pages:w(S({},this.document.pages),{[n]:e})});this.loadDocument(o),this.persist({})});l(this,"newProject",()=>{!this.isLocal||(this.fileSystemHandle=null,this.resetDocument())});l(this,"saveProject",()=>ue(this,null,function*(){if(this.readOnly)return;let e=yield ei(An(this.state,ht.version).document,this.fileSystemHandle);return this.fileSystemHandle=e,this.persist({}),this.isDirty=!1,this}));l(this,"saveProjectAs",e=>ue(this,null,function*(){try{let t=yield ei(this.document,null,e);this.fileSystemHandle=t,this.persist({}),this.isDirty=!1}catch(t){console.error(t.message)}return this}));l(this,"openProject",()=>ue(this,null,function*(){if(!!this.isLocal)try{let e=yield Ca();if(!e)throw Error();let{fileHandle:t,document:n}=e;this.loadDocument(n),this.fileSystemHandle=t,this.zoomToFit(),this.persist({})}catch(e){console.error(e)}finally{this.persist({})}}));l(this,"openAsset",()=>ue(this,null,function*(){if(!this.disableAssets)try{let e=yield Da();if(Array.isArray(e))this.addMediaFromFiles(e,this.centerPoint);else{if(!e)return;this.addMediaFromFiles([e])}}catch(e){console.error(e)}finally{this.persist({})}}));l(this,"signOut",()=>{});l(this,"getAppState",()=>this.appState);l(this,"getPage",(e=this.currentPageId)=>k.getPage(this.state,e||this.currentPageId));l(this,"getShapes",(e=this.currentPageId)=>k.getShapes(this.state,e||this.currentPageId));l(this,"getBindings",(e=this.currentPageId)=>k.getBindings(this.state,e||this.currentPageId));l(this,"getShape",(e,t=this.currentPageId)=>k.getShape(this.state,e,t));l(this,"getShapeBounds",(e,t=this.currentPageId)=>k.getBounds(this.getShape(e,t)));l(this,"getBinding",(e,t=this.currentPageId)=>k.getBinding(this.state,e,t));l(this,"getPageState",(e=this.currentPageId)=>k.getPageState(this.state,e||this.currentPageId));l(this,"getPagePoint",(e,t=this.currentPageId)=>{let{camera:n}=this.getPageState(t);return xe.Vec.sub(xe.Vec.div(e,n.zoom),n.point)});l(this,"createPage",(e,t)=>{if(this.readOnly)return this;let{width:n,height:o}=this.rendererBounds;return this.setState(ap(this,[-n/2,-o/2],e,t))});l(this,"changePage",e=>this.setState(op(this,e)));l(this,"movePage",(e,t)=>this.readOnly?this:this.setState(Sp(this,e,t)));l(this,"renamePage",(e,t)=>this.readOnly?this:this.setState(bp(this,e,t)));l(this,"duplicatePage",e=>this.readOnly?this:this.setState(pp(this,e)));l(this,"deletePage",e=>this.readOnly?this:Object.values(this.document.pages).length<=1?this:this.setState(lp(this,e||this.currentPageId)));l(this,"cut",(e=this.selectedIds,t)=>(t==null||t.preventDefault(),this.copy(e,t),this.readOnly||this.delete(e),this));l(this,"copy",(e=this.selectedIds,t)=>{var s;t==null||t.preventDefault(),this.clipboard=this.getContent(e);let o=`<tldraw>${JSON.stringify(S({type:"tldr/clipboard",shapes:[],assets:[],bindings:[]},this.clipboard))}</tldraw>`;return qc(o),t&&((s=t.clipboardData)==null||s.setData("text/html",o)),navigator.clipboard&&window.ClipboardItem&&navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([o],{type:"text/html"})})]),this});l(this,"paste",(e,t)=>ue(this,null,function*(){var c,u;if(this.readOnly)return;let n=[],o=[],s,a=p=>ue(this,null,function*(){let m=document.createElement("div");m.innerHTML=p;let h=m.firstChild;h.style.setProperty("background-color","transparent");let g=yield k.getImageForSvg(h,"svg",{scale:1,quality:1});if(g){let f=new File([g],"image.svg");n.push(f)}else d(p)}),d=p=>{let m=this.getPagePoint(e!=null?e:this.centerPoint,this.currentPageId),h=p.includes(`
+`)}static assertShapeHasProperty(e,t){if(e[t]===void 0)throw new Error}static warn(e){zc&&console.warn(e)}static error(e){zc&&console.error(e)}static getSvgString(e,t=1){let n=e.cloneNode(!0);return e.setAttribute("width",+e.getAttribute("width")*t+""),e.setAttribute("height",+e.getAttribute("height")*t+""),new XMLSerializer().serializeToString(n).replaceAll("&#10;      ","").replaceAll(/((\s|")[0-9]*\.[0-9]{2})([0-9]*)(\b|"|\))/g,"$1")}static getSvgAsDataUrl(e,t=1){let n=me.getSvgString(e,t);return`data:image/svg+xml;base64,${window.btoa(unescape(n))}`}static getImageForSvg(o){return ue(this,arguments,function*(e,t="png",n={}){let{scale:s=2,quality:a=1}=n,d=me.getSvgString(e,s);if(!d)return;let i=yield new Promise(u=>{let p=new Image;p.crossOrigin="anonymous";let h=`data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent(d)))}`;p.onload=()=>{let g=document.createElement("canvas"),f=g.getContext("2d"),T=p.width,x=p.height;g.width=T,g.height=x,f.drawImage(p,0,0,T,x),URL.revokeObjectURL(h),u(g)},p.onerror=()=>{console.warn("Could not convert that SVG to an image.")},p.src=h});return yield new Promise(u=>i.toBlob(p=>u(p),"image/"+t,a))})}},k=me;l(k,"copyStringToClipboard",e=>{try{navigator.clipboard&&navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([e],{type:"text/plain"})})])}catch(t){let n=document.createElement("textarea");n.setAttribute("position","fixed"),n.setAttribute("top","0"),n.setAttribute("readonly","true"),n.setAttribute("contenteditable","true"),n.style.position="fixed",n.value=e,document.body.appendChild(n),n.focus(),n.select();try{let o=document.createRange();o.selectNodeContents(n);let s=window.getSelection();s&&(s.removeAllRanges(),s.addRange(o),n.setSelectionRange(0,n.value.length)),document.execCommand("copy")}catch(o){}finally{document.body.removeChild(n)}}}),l(k,"flattenShape",(e,t)=>{var n;return[t,...((n=t.children)!=null?n:[]).map(o=>me.getShape(e,o,e.appState.currentPageId)).sort((o,s)=>o.childIndex-s.childIndex).flatMap(o=>me.flattenShape(e,o))]}),l(k,"flattenPage",(e,t)=>Object.values(e.document.pages[t].shapes).sort((n,o)=>n.childIndex-o.childIndex).reduce((n,o)=>[...n,...me.flattenShape(e,o)],[])),l(k,"getTopChildIndex",(e,t)=>{let n=me.getShapes(e,t);return n.length===0?1:n.filter(o=>o.parentId===t).sort((o,s)=>s.childIndex-o.childIndex)[0].childIndex+1}),l(k,"fixNewLines",/\r?\n|\r/g);var Dde=r=>r.room,Fc=function(){let e=ge(),t=e.useStore(Dde),[n,o]=Le.useState(!1),s=Le.useRef(0),a=Le.useCallback(()=>{o(!0),k.copyStringToClipboard(window.location.href),clearTimeout(s.current),s.current=setTimeout(()=>o(!1),1200)},[]),d=Le.useCallback(()=>{o(!0);let u=window.location.href.split("/");u[u.length-2]="v",u[u.length-1]=Us.Utils.lns(u[u.length-1]),k.copyStringToClipboard(u.join("/")),clearTimeout(s.current),s.current=setTimeout(()=>o(!1),1200)},[]),i=Le.useCallback(()=>ue(this,null,function*(){e.isDirty?e.fileSystemHandle?window.confirm("Do you want to save changes to your current project?")&&(yield e.saveProject()):window.confirm("Do you want to save your current project?")&&(yield e.saveProject()):e.fileSystemHandle||window.confirm("Do you want to save your current project?")&&(yield e.saveProject())}),[]),c=Le.useCallback(()=>ue(this,null,function*(){var p;let u=Us.Utils.deepClone(e.document);e.setIsLoading(!0);try{if(e.callbacks.onAssetUpload)for(let h in u.assets){let g=u.assets[h];if(g.src.includes("base64")){let f=Pde(g.src,((p=g.fileName)!=null?p:g.type==="video")?"image.png":"image.mp4"),T=yield e.callbacks.onAssetUpload(e,f,h);T?g.src=T:g.src=""}}let m=yield fetch("/api/create",{method:"POST",mode:"no-cors",headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json"},body:JSON.stringify({roomId:Us.Utils.uniqueId(),pageId:e.currentPageId,document:u})}).then(h=>h.json());(m==null?void 0:m.url)?window.location.href=m.url:k.warn(m==null?void 0:m.message)}catch(m){k.warn(m.message)}e.setIsLoading(!1)}),[]);return Le.createElement(Oc.Root,{dir:"ltr"},Le.createElement(fs,{id:"TD-MultiplayerMenuIcon",isActive:!!t},Le.createElement(Ld,null)),Le.createElement(At,{variant:"menu",id:"TD-MultiplayerMenu",side:"bottom",align:"start",sideOffset:4},Le.createElement(ve,{id:"TD-Multiplayer-CopyInviteLink",onClick:a,disabled:!t},Le.createElement(Mr.FormattedMessage,{id:"copy.invite.link"}),Le.createElement(bt,null,n?Le.createElement(er.CheckIcon,null):Le.createElement(er.ClipboardIcon,null))),Le.createElement(ve,{id:"TD-Multiplayer-CopyReadOnlyLink",onClick:d,disabled:!t},Le.createElement(Mr.FormattedMessage,{id:"copy.readonly.link"}),Le.createElement(bt,null,n?Le.createElement(er.CheckIcon,null):Le.createElement(er.ClipboardIcon,null))),Le.createElement(Ee,null),Le.createElement(ve,{id:"TD-Multiplayer-CreateMultiplayerProject",onClick:i},Le.createElement("a",{href:`${window.location.origin}/r`},Le.createElement(Mr.FormattedMessage,{id:"create.multiplayer.project"}))),Le.createElement(ve,{id:"TD-Multiplayer-CopyToMultiplayerProject",onClick:c},Le.createElement(Mr.FormattedMessage,{id:"copy.multiplayer.project"}))))};function Pde(r,e){var d,i;let t=r.split(","),n=(i=(d=t[0])==null?void 0:d.match(/:(.*?);/))==null?void 0:i[1],o=window.atob(t[1]),s=o.length,a=new Uint8Array(s);for(;s--;)a[s]=o.charCodeAt(s);return new File([a],e,{type:n})}var Jt=V(require("@radix-ui/react-dropdown-menu")),_s=require("@radix-ui/react-icons"),ke=V(require("react")),Er=require("react-intl");var Ot=V(require("@radix-ui/react-alert-dialog")),Ks=require("@radix-ui/react-icons"),Ce=V(require("react")),tr=require("react-intl");var Mde=r=>Object.keys(r.document.pages).length>1;function Gc({page:r,onOpen:e,onClose:t}){let n=ge(),o=(0,tr.useIntl)(),[s,a]=Ce.useState(!1),[d,i]=Ce.useState(r.name||"Page"),c=n.useStore(Mde),u=Ce.useRef(null),p=Ce.useCallback(()=>{a(!1)},[]),m=Ce.useCallback(()=>{n.duplicatePage(r.id)},[n]),h=Ce.useCallback(()=>{window.confirm("Are you sure you want to delete this page?")&&n.deletePage(r.id)},[n]),g=Ce.useCallback(L=>{if(a(L),L){e==null||e();return}},[n]);function f(L){L.stopPropagation()}let T=Ce.useRef(r.name||"Page"),x=Ce.useRef(T.current),b=Ce.useCallback(L=>{let v=L.target.value.trimStart();x.current=v,i(v)},[]),y=Ce.useCallback(L=>{switch(L.key){case"Enter":{x.current===T.current||(T.current=x.current,n.renamePage(r.id,x.current.trim())),a(!1);break}case"Escape":{if(x.current===T.current){a(!1);return}x.current=T.current,i(T.current),requestAnimationFrame(()=>{let v=u.current;v&&(v.focus(),v.setSelectionRange(0,v.value.length))});break}}},[]),R=Ce.useRef(!1);Ce.useEffect(()=>(s?(R.current=!0,T.current=r.name||"Page",x.current=T.current,requestAnimationFrame(()=>{let L=u.current;L&&(L.focus(),L.setSelectionRange(0,L.value.length))})):R.current&&(t==null||t()),()=>{x.current!==T.current&&(T.current=x.current,n.renamePage(r.id,x.current))}),[s]);let K=Vt();return Ce.createElement(Ot.Root,{open:s,onOpenChange:g},Ce.createElement(Ot.Trigger,{asChild:!0,"data-shy":"true"},Ce.createElement(Ho,{bp:rt},Ce.createElement(bt,null,Ce.createElement(Ks.MixerVerticalIcon,null)))),Ce.createElement(Ot.Portal,{container:K.current},Ce.createElement(Bde,{onPointerDown:p}),Ce.createElement(Ede,{dir:"ltr",onKeyDown:f,onKeyUp:f},Ce.createElement(hs,{ref:u,placeholder:o.formatMessage({id:"page.name"}),value:d,onChange:b,onKeyDown:y,icon:Ce.createElement(Ks.Pencil1Icon,null)}),Ce.createElement(Ee,null),Ce.createElement(jc,{onSelect:m},Ce.createElement(tr.FormattedMessage,{id:"duplicate"})),Ce.createElement(jc,{disabled:!c,onSelect:h},Ce.createElement(tr.FormattedMessage,{id:"delete"})),Ce.createElement(Ee,null),Ce.createElement(Ot.Cancel,{asChild:!0},Ce.createElement($e,null,Ce.createElement(tr.FormattedMessage,{id:"cancel"}))))))}var Ede=H(Ot.Content,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",minWidth:240,maxWidth:"fit-content",maxHeight:"85vh",marginTop:"-5vh",pointerEvents:"all",backgroundColor:"$panel",padding:"$1",borderRadius:"$2",font:"$ui",zIndex:999999,"&:focus":{outline:"none"}}),Bde=H(Ot.Overlay,{backgroundColor:"rgba(0, 0, 0, .15)",position:"absolute",pointerEvents:"all",inset:0,zIndex:999998});function jc(t){var n=t,{onSelect:r}=n,e=ot(n,["onSelect"]);return Ce.createElement(Ot.Action,{asChild:!0,onClick:r,onSelect:r},Ce.createElement($e,S({},e)))}var Rde=r=>Object.values(r.document.pages).sort((e,t)=>(e.childIndex||0)-(t.childIndex||0)),Ade=r=>r.document.pages[r.appState.currentPageId].name,Lde=r=>r.document.pages[r.appState.currentPageId].id;function Vc(){let r=ge(),e=(0,Er.useIntl)(),t=ke.useRef(!1),[n,o]=ke.useState(!1);ke.useEffect(()=>{t.current!==n&&(t.current=n)},[n]);let s=ke.useCallback(()=>{o(!1)},[o]),a=ke.useCallback(i=>{t.current!==i&&o(i)},[o]),d=r.useStore(Ade);return ke.createElement(Jt.Root,{dir:"ltr",open:n,onOpenChange:a},ke.createElement(Jt.Trigger,{dir:"ltr",asChild:!0,id:"TD-Page"},ke.createElement(Ie,{variant:"text"},d||e.formatMessage({id:"page"}))),ke.createElement(At,{variant:"menu",align:"start",sideOffset:4},n&&ke.createElement(Hde,{onClose:s})))}function Hde({onClose:r}){let e=ge(),t=(0,Er.useIntl)(),n=e.useStore(Rde),o=e.useStore(Lde),s=t.formatMessage({id:"page"}),a=ke.useCallback(()=>{let f=s+" "+(Object.keys(e.document.pages).length+1);e.createPage(void 0,f)},[e]),d=ke.useCallback(f=>{r(),e.changePage(f)},[e]),[i,c]=ke.useState(null),[u,p]=ke.useState(null),m=ke.useCallback(f=>{c(f.currentTarget.id),p(n.findIndex(T=>T.id===f.currentTarget.id)),f.dataTransfer.effectAllowed="move"},[]),h=ke.useCallback(f=>{f.preventDefault();let T=n.findIndex(y=>y.id===f.currentTarget.id),x=f.currentTarget.getBoundingClientRect();T=(f.clientY-x.top)/x.height<.5?T:T+1,p(T)},[i,n]),g=ke.useCallback(()=>{i!==null&&u!==null&&e.movePage(i,u),c(null),p(null)},[i,u]);return ke.createElement(ke.Fragment,null,ke.createElement(Jt.RadioGroup,{dir:"ltr",value:o,onValueChange:d},n.map((f,T)=>ke.createElement(zde,{key:f.id,isDropAbove:T===u&&T===0,isDropBelow:u!==null&&T===u-1},ke.createElement(Jt.RadioItem,{title:f.name||s,value:f.id,key:f.id,id:f.id,asChild:!0,onDragOver:h,onDragStart:m,onDrop:g,draggable:!0},ke.createElement(Ode,null,ke.createElement("span",{id:f.id},f.name||s),ke.createElement(Jt.ItemIndicator,null,ke.createElement(bt,null,ke.createElement(_s.CheckIcon,null))))),ke.createElement(Gc,{page:f,onClose:r})))),ke.createElement(Ee,null),ke.createElement(Jt.Item,{onSelect:a,asChild:!0},ke.createElement($e,null,ke.createElement("span",null,ke.createElement(Er.FormattedMessage,{id:"create.page"})),ke.createElement(bt,null,ke.createElement(_s.PlusIcon,null)))))}var zde=H("div",{position:"relative",display:"grid",gridTemplateColumns:"1fr auto",gridAutoFlow:"column",margin:0,'& > *[data-shy="true"]':{opacity:0},'&:hover > *[data-shy="true"]':{opacity:1},variants:{isDropAbove:{true:{"&::after":{content:"",display:"block",position:"absolute",top:0,width:"100%",height:"1px",backgroundColor:"$selected",zIndex:999,pointerEvents:"none"}}},isDropBelow:{true:{"&::after":{content:"",display:"block",position:"absolute",width:"100%",height:"1px",top:"100%",backgroundColor:"$selected",zIndex:999,pointerEvents:"none"}}}}}),Ode=H($e,{minWidth:128});var co=V(require("@radix-ui/react-dropdown-menu")),po=require("@radix-ui/react-icons"),pe=V(require("react")),un=require("react-intl");var Fde=r=>r.appState.currentStyle,jde=r=>r.document.pageStates[r.appState.currentPageId].selectedIds,Gde=Object.keys(Ko),$c={["draw"]:pe.createElement(rd,null),["solid"]:pe.createElement(sd,null),["dashed"]:pe.createElement(nd,null),["dotted"]:pe.createElement(od,null)},Vde={["small"]:pe.createElement(ad,null),["medium"]:pe.createElement(ld,null),["large"]:pe.createElement(dd,null)},$de={["start"]:pe.createElement(po.TextAlignLeftIcon,null),["middle"]:pe.createElement(po.TextAlignCenterIcon,null),["end"]:pe.createElement(po.TextAlignRightIcon,null),["justify"]:pe.createElement(po.TextAlignJustifyIcon,null)},Nde=r=>r.settings.isDarkMode?"dark":"light",Wde=r=>r.settings.keepStyleMenuOpen,Ude=r=>{let{activeTool:e,currentPageId:t}=r.appState;switch(e){case"select":{let n=r.document.pages[t],o=!1,s=!1;for(let a of r.document.pageStates[t].selectedIds)"text"in n.shapes[a]&&(o=!0),"label"in n.shapes[a]&&(s=!0);return o?"text":s?"label":""}case"text":return"text";case"rectangle":return"label";case"ellipse":return"label";case"triangle":return"label";case"arrow":return"label";case"line":return"label"}return!1},Nc=pe.memo(function(){let e=ge(),t=(0,un.useIntl)(),n=e.useStore(Nde),o=e.useStore(Wde),s=e.useStore(Ude),a=e.useStore(Fde),d=e.useStore(jde),[i,c]=pe.useState(a),u=pe.useRef(a);pe.useEffect(()=>{let{appState:{currentStyle:b},page:y,selectedIds:R}=e,K={};if(R.length<=0)K=b;else{let L=new Set([]);e.selectedIds.map(v=>y.shapes[v]).forEach(v=>{Gde.forEach(I=>{if(!L.has(I))if(K[I]===void 0)K[I]=v.style[I];else{if(K[I]===v.style[I])return;K[I]=v.style[I],L.add(I)}})})}JSON.stringify(K)!==JSON.stringify(u.current)&&(u.current=K,c(K))},[a,d]);let p=pe.useCallback(b=>{e.setSetting("keepStyleMenuOpen",b)},[]),m=pe.useCallback(b=>{e.style({isFilled:b})},[]),h=pe.useCallback(b=>{e.style({dash:b})},[]),g=pe.useCallback(b=>{e.style({size:b})},[]),f=pe.useCallback(b=>{e.style({font:b})},[]),T=pe.useCallback(b=>{e.style({textAlign:b})},[]),x=pe.useCallback(b=>{e.setMenuOpen(b)},[e]);return pe.createElement(co.Root,{dir:"ltr",onOpenChange:x,open:o?!0:void 0},pe.createElement(co.Trigger,{asChild:!0,id:"TD-Styles"},pe.createElement(Ie,{"aria-label":t.formatMessage({id:"styles"}),variant:"text"},pe.createElement(un.FormattedMessage,{id:"styles"}),pe.createElement(_de,{style:{color:Uo[n][i.color]}},i.isFilled&&pe.createElement(xi,{size:16,stroke:"none",fill:vs[n][i.color]}),$c[i.dash]))),pe.createElement(At,{id:"TD-StylesMenu",side:"bottom",align:"end",sideOffset:4,alignOffset:4},pe.createElement(Br,{variant:"tall",id:"TD-Styles-Color-Container"},pe.createElement("span",null,pe.createElement(un.FormattedMessage,{id:"style.menu.color"})),pe.createElement(Kde,null,Object.keys(Uo.light).map(b=>pe.createElement(co.Item,{key:b,onSelect:Oe,asChild:!0,id:`TD-Styles-Color-Swatch-${b}`},pe.createElement(Ie,{variant:"icon",isActive:i.color===b,onClick:()=>e.style({color:b}),"aria-label":t.formatMessage({id:b})},pe.createElement(xi,{size:18,strokeWidth:2.5,fill:i.isFilled?vs[n][b]:"transparent",stroke:Uo.light[b]})))))),pe.createElement(Rt,{variant:"styleMenu",checked:!!i.isFilled,onCheckedChange:m,id:"TD-Styles-Fill"},pe.createElement(un.FormattedMessage,{id:"style.menu.fill"})),pe.createElement(Br,{id:"TD-Styles-Dash-Container"},pe.createElement(un.FormattedMessage,{id:"style.menu.dash"}),pe.createElement(Ys,{dir:"ltr",value:i.dash,onValueChange:h},Object.values(Sn).map(b=>pe.createElement(Tr,{key:b,isActive:b===i.dash,value:b,onSelect:Oe,bp:rt,id:`TD-Styles-Dash-${b}`,"aria-label":t.formatMessage({id:b})},$c[b])))),pe.createElement(Br,{id:"TD-Styles-Size-Container"},pe.createElement(un.FormattedMessage,{id:"style.menu.size"}),pe.createElement(Ys,{dir:"ltr",value:i.size,onValueChange:g},Object.values(Sr).map(b=>pe.createElement(Tr,{key:b,isActive:b===i.size,value:b,onSelect:Oe,bp:rt,id:`TD-Styles-Dash-${b}`,"aria-label":t.formatMessage({id:b})},Vde[b])))),(s==="text"||s==="label")&&pe.createElement(pe.Fragment,null,pe.createElement(Ee,null),pe.createElement(Br,{id:"TD-Styles-Font-Container"},pe.createElement(un.FormattedMessage,{id:"style.menu.font"}),pe.createElement(Ys,{dir:"ltr",value:i.font,onValueChange:f},Object.values(Ao).map(b=>pe.createElement(Tr,{key:b,isActive:b===i.font,value:b,onSelect:Oe,bp:rt,id:`TD-Styles-Font-${b}`},pe.createElement(Yde,{fontStyle:b},"Aa"))))),s==="text"&&pe.createElement(Br,{id:"TD-Styles-Align-Container"},pe.createElement(un.FormattedMessage,{id:"style.menu.align"}),pe.createElement(Ys,{dir:"ltr",value:i.textAlign,onValueChange:T},Object.values(Gt).map(b=>pe.createElement(Tr,{key:b,isActive:b===i.textAlign,value:b,onSelect:Oe,bp:rt,id:`TD-Styles-Align-${b}`},$de[b]))))),pe.createElement(Ee,null),pe.createElement(Rt,{variant:"styleMenu",checked:o,onCheckedChange:p,id:"TD-Styles-Keep-Open"},pe.createElement(un.FormattedMessage,{id:"style.menu.keep.open"}))))}),Kde=H("div",{display:"grid",gridTemplateColumns:"repeat(4, auto)",gap:0}),Br=H("div",{position:"relative",width:"100%",background:"none",border:"none",cursor:"pointer",minHeight:"32px",outline:"none",color:"$text",fontFamily:"$ui",fontWeight:400,fontSize:"$1",padding:"$2 0 $2 $3",borderRadius:4,userSelect:"none",WebkitUserSelect:"none",margin:0,display:"flex",gap:"$3",flexDirection:"row",alignItems:"center",justifyContent:"space-between",variants:{variant:{tall:{alignItems:"flex-start",padding:"0 0 0 $3","& > span":{paddingTop:"$4"}}}}}),Ys=H(co.DropdownMenuRadioGroup,{display:"flex",flexDirection:"row",gap:"$1"}),_de=H("div",{display:"grid","& > *":{gridColumn:1,gridRow:1}}),Yde=H("div",{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"$3",variants:{fontStyle:{["script"]:{fontFamily:"Caveat Brush"},["sans"]:{fontFamily:"Recursive"},["serif"]:{fontFamily:"Georgia"},["mono"]:{fontFamily:"Recursive Mono"}}}});var Zs=V(require("@radix-ui/react-dropdown-menu")),Et=V(require("react")),nr=require("react-intl");var Zde=r=>r.document.pageStates[r.appState.currentPageId].camera.zoom,Wc=function(){let e=ge(),t=e.useStore(Zde);return Et.createElement(Zs.Root,{dir:"ltr"},Et.createElement(Zs.Trigger,{dir:"ltr",asChild:!0,id:"TD-Zoom"},Et.createElement(Xde,{onDoubleClick:e.resetZoom,variant:"text"},Math.round(t*100),"%")),Et.createElement(At,{align:"end"},Et.createElement(ve,{onSelect:Oe,onClick:e.zoomIn,kbd:"#+",id:"TD-Zoom-Zoom_In"},Et.createElement(nr.FormattedMessage,{id:"zoom.in"})),Et.createElement(ve,{onSelect:Oe,onClick:e.zoomOut,kbd:"#\u2212",id:"TD-Zoom-Zoom_Out"},Et.createElement(nr.FormattedMessage,{id:"zoom.out"})),Et.createElement(ve,{onSelect:Oe,onClick:e.resetZoom,kbd:"\u21E70",id:"TD-Zoom-Zoom_To_100%"},Et.createElement(nr.FormattedMessage,{id:"zoom.to"})," 100%"),Et.createElement(ve,{onSelect:Oe,onClick:e.zoomToFit,kbd:"\u21E71",id:"TD-Zoom-To_Fit"},Et.createElement(nr.FormattedMessage,{id:"zoom.to.fit"})),Et.createElement(ve,{onSelect:Oe,onClick:e.zoomToSelection,kbd:"\u21E72",id:"TD-Zoom-To_Selection"},Et.createElement(nr.FormattedMessage,{id:"zoom.to.selection"}))))},Xde=H(Ie,{minWidth:56});function qde({readOnly:r,showPages:e,showMenu:t,showStyles:n,showZoom:o,showMultiplayerMenu:s}){let a=ge(),d=(0,Uc.useIntl)();return ut.createElement(Jde,null,(t||e)&&ut.createElement(So,{side:"left",id:"TD-MenuPanel"},t&&ut.createElement(Ad,{readOnly:r}),s&&ut.createElement(Fc,null),e&&ut.createElement(Vc,null)),ut.createElement(Qde,null),(n||o)&&ut.createElement(So,{side:"right"},a.readOnly?ut.createElement(ece,null,"Read Only"):ut.createElement(ut.Fragment,null,ut.createElement(on,{kbd:"#Z",label:d.formatMessage({id:"undo"}),onClick:a.undo,id:"TD-TopPanel-Undo","aria-label":d.formatMessage({id:"undo"})},ut.createElement(Di,null)),ut.createElement(on,{kbd:"#\u21E7Z",label:d.formatMessage({id:"redo"}),onClick:a.redo,id:"TD-TopPanel-Redo","aria-label":d.formatMessage({id:"redo"})},ut.createElement(Di,{flipHorizontal:!0}))),o&&ut.createElement(Wc,null),n&&!r&&ut.createElement(Nc,null)))}var Jde=H("div",{width:"100%",position:"absolute",top:0,left:0,right:0,display:"flex",flexDirection:"row",pointerEvents:"none","& > *":{pointerEvents:"all"}}),Qde=H("div",{flexGrow:2,pointerEvents:"none"}),ece=H("div",{color:"$text",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"$ui",fontSize:"$1",paddingLeft:"$4",paddingRight:"$1",userSelect:"none",WebkitUserSelect:"none"}),Kc=ut.memo(qde);var _c=V(require("react"));function Yc(r){_c.default.useEffect(()=>{let e=!1,t=!1,n=r.current;if(!n)return;let o=i=>{i.key===" "&&!t&&(t=!0,e?n.setAttribute("style","cursor: grabbing !important"):n.setAttribute("style","cursor: grab !important"))},s=i=>{i.key===" "&&(t=!1,n.setAttribute("style","cursor: initial"))},a=i=>{e=!0,i.button===1&&n.setAttribute("style","cursor: grabbing !important"),i.button===0&&t&&n.setAttribute("style","cursor: grabbing !important")},d=()=>{e=!1,t?n.setAttribute("style","cursor: grab !important"):n.setAttribute("style","cursor: initial")};return n.addEventListener("keydown",o),n.addEventListener("keyup",s),n.addEventListener("pointerdown",a),n.addEventListener("pointerup",d),()=>{n.removeEventListener("keydown",o),n.removeEventListener("keyup",s),n.removeEventListener("pointerdown",a),n.removeEventListener("pointerup",d)}},[r.current])}var Dt=require("@tldraw/core"),xe=require("@tldraw/vec");var Rr=require("idb-keyval"),Zc="tldraw_clipboard";function Xc(){return ue(this,null,function*(){return(0,Rr.get)(Zc)})}function qc(r){return ue(this,null,function*(){return(0,Rr.set)(Zc,r)})}var Jc=require("@tldraw/core"),ko=V(require("idb-keyval")),Qc=V(require("zustand")),ep=V(require("zustand/vanilla"));var ha=class{constructor(e,t,n,o){l(this,"_idbId");l(this,"initialState");l(this,"store");l(this,"pointer",-1);l(this,"_state");l(this,"_status","loading");l(this,"stack",[]);l(this,"_snapshot");l(this,"useStore");l(this,"ready");l(this,"isPaused",!1);l(this,"persist",(e,t)=>{if(this._status==="ready"&&(this.onPersist&&this.onPersist(this._state,e,t),this._idbId))return ko.set(this._idbId,this._state).catch(n=>console.error(n))});l(this,"applyPatch",(e,t)=>{let n=this._state,o=Jc.Utils.deepMerge(this._state,e),s=this.cleanup(o,n,e,t);return this.onStateWillChange&&this.onStateWillChange(s,t),this._state=s,this.store.setState(this._state,!0),this.onStateDidChange&&this.onStateDidChange(this._state,t),this});l(this,"migrate",e=>e);l(this,"cleanup",(e,t,n,o)=>e);l(this,"onStateWillChange");l(this,"onStateDidChange");l(this,"patchState",(e,t)=>(this.applyPatch(e,t),this.onPatch&&this.onPatch(this._state,e,t),this));l(this,"replaceState",(e,t)=>{let n=this.cleanup(e,this._state,e,t);return this.onStateWillChange&&this.onStateWillChange(n,"replace"),this._state=n,this.store.setState(this._state,!0),this.onStateDidChange&&this.onStateDidChange(this._state,"replace"),this});l(this,"setState",(e,t=e.id)=>(this.pointer<this.stack.length-1&&(this.stack=this.stack.slice(0,this.pointer+1)),this.stack.push(w(S({},e),{id:t})),this.pointer=this.stack.length-1,this.applyPatch(e.after,t),this.onCommand&&this.onCommand(this._state,e,t),this.persist(e.after,t),this));l(this,"onReady");l(this,"onPatch");l(this,"onCommand");l(this,"onPersist");l(this,"onReplace");l(this,"onReset");l(this,"onResetHistory");l(this,"onUndo");l(this,"onRedo");l(this,"reset",()=>(this.onStateWillChange&&this.onStateWillChange(this.initialState,"reset"),this._state=this.initialState,this.store.setState(this._state,!0),this.resetHistory(),this.persist({},"reset"),this.onStateDidChange&&this.onStateDidChange(this._state,"reset"),this.onReset&&this.onReset(this._state),this));l(this,"replaceHistory",(e,t=e.length-1)=>(this.stack=e,this.pointer=t,this.onReplace&&this.onReplace(this._state),this));l(this,"resetHistory",()=>(this.stack=[],this.pointer=-1,this.onResetHistory&&this.onResetHistory(this._state),this));l(this,"undo",()=>{if(!this.isPaused){if(!this.canUndo)return this;let e=this.stack[this.pointer];this.pointer--,this.applyPatch(e.before,"undo"),this.persist(e.before,"undo")}return this.onUndo&&this.onUndo(this._state),this});l(this,"redo",()=>{if(!this.isPaused){if(!this.canRedo)return this;this.pointer++;let e=this.stack[this.pointer];this.applyPatch(e.after,"redo"),this.persist(e.after,"undo")}return this.onRedo&&this.onRedo(this._state),this});l(this,"setSnapshot",()=>(this._snapshot=S({},this._state),this));l(this,"forceUpdate",()=>{this.store.setState(this._state,!0)});this._idbId=t,this._state=wt(e),this._snapshot=wt(e),this.initialState=wt(e),this.store=(0,ep.default)(()=>this._state),this.useStore=(0,Qc.default)(this.store),this.ready=new Promise(s=>{let a="none";this._idbId?(a="restored",ko.get(this._idbId).then(d=>ue(this,null,function*(){if(d){let i=d;if(n){let u=yield ko.get(t+"_version");u&&u<n&&(i=o?o(d,e,u):e,a="migrated")}yield ko.set(t+"_version",n||-1);let c=this._state.appState.isEmptyCanvas;i=this.migrate(i),this._state=wt(i),this._snapshot=wt(i),this._state.appState.isEmptyCanvas=c,this.store.setState(this._state,!0)}else yield ko.set(t+"_version",n||-1);this._status="ready",s(a)})).catch(d=>console.error(d))):(this._status="ready",s(a))}).then(s=>(this.onReady&&this.onReady(s),s))}pause(){this.isPaused=!0}resume(){this.isPaused=!1}get canUndo(){return this.pointer>-1}get canRedo(){return this.pointer<this.stack.length-1}get state(){return this._state}get status(){return this._status}get snapshot(){return this._snapshot}};var tp=require("@tldraw/core"),ma=require("@tldraw/vec");function np(r,e,t){let{currentPageId:n}=r,o=e.map(m=>r.getShape(m)),s=o.map(m=>({id:m.id,point:[...m.point],bounds:k.getBounds(m)})),a=tp.Utils.getCommonBounds(s.map(({bounds:m})=>m)),d=a.minX+a.width/2,i=a.minY+a.height/2,c=Object.fromEntries(s.map(({id:m,point:h,bounds:g})=>[m,{prev:h,next:{["top"]:[h[0],a.minY],["centerVertical"]:[h[0],i-g.height/2],["bottom"]:[h[0],a.maxY-g.height],["left"]:[a.minX,h[1]],["centerHorizontal"]:[d-g.width/2,h[1]],["right"]:[a.maxX-g.width,h[1]]}[t]}])),{before:u,after:p}=k.mutateShapes(r.state,e,m=>c[m.id]?{point:c[m.id].next}:m,n,!1);return o.forEach(m=>{if(m.type==="group"){let h=ma.Vec.sub(p[m.id].point,u[m.id].point);m.children.forEach(g=>{let f=r.getShape(g);u[f.id]={point:f.point},p[f.id]={point:ma.Vec.add(f.point,h)}}),delete u[m.id],delete p[m.id]}}),{id:"align",before:{document:{pages:{[n]:{shapes:u}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:p}},pageStates:{[n]:{selectedIds:e}}}}}}function op(r,e){return{id:"change_page",before:{appState:{currentPageId:r.currentPageId}},after:{appState:{currentPageId:e}}}}var ip=require("@tldraw/core");function rp(r,e){var o;let t=r,n=new Set(e);for(;n.has(t);)t=((o=/^.*(\d+)$/.exec(t))==null?void 0:o[1])?t.replace(/(\d+)(?=\D?)$/,s=>(+s+1).toString()):`${t} 1`;return t}function sp(r,e,t){let n={shapes:{},bindings:{}},o={shapes:{},bindings:{}},s=[],a=new Set,d=new Set;e.filter(c=>!k.getShape(r,c,t).isLocked).forEach(c=>{a.add(c);let u=k.getShape(r,c,t);n.shapes[c]=u,o.shapes[c]=void 0,u.children!==void 0&&u.children.forEach(p=>{a.add(p);let m=k.getShape(r,p,t);n.shapes[p]=m,o.shapes[p]=void 0}),u.parentId!==t&&s.push(k.getShape(r,u.parentId,t)),u.assetId&&d.add(u.assetId)}),s.forEach(c=>{var u;e.includes(c.id)||(a.add(c.id),n.shapes[c.id]={children:c.children},o.shapes[c.id]={children:c.children.filter(p=>!e.includes(p))},((u=o.shapes[c.id])==null?void 0:u.children.length)===0&&(o.shapes[c.id]=void 0,n.shapes[c.id]=k.getShape(r,c.id,t)))});let i=k.getPage(r,t);return Object.values(i.bindings).filter(c=>a.has(c.fromId)||a.has(c.toId)).forEach(c=>{for(let u of[c.toId,c.fromId])if(o.shapes[u]===void 0){n.bindings[c.id]=c,o.bindings[c.id]=void 0;let p=i.shapes[u];p&&p.handles&&Object.values(p.handles).filter(m=>m.bindingId===c.id).forEach(m=>{var h,g,f,T,x,b;n.shapes[u]=w(S({},n.shapes[u]),{handles:w(S({},(h=n.shapes[u])==null?void 0:h.handles),{[m.id]:w(S({},(f=(g=n.shapes[u])==null?void 0:g.handles)==null?void 0:f[m.id]),{bindingId:c.id})})}),a.has(u)||(o.shapes[u]=w(S({},o.shapes[u]),{handles:w(S({},(T=o.shapes[u])==null?void 0:T.handles),{[m.id]:w(S({},(b=(x=o.shapes[u])==null?void 0:x.handles)==null?void 0:b[m.id]),{bindingId:void 0})})}))})}}),Object.values(r.document.pages).flatMap(c=>Object.values(c.shapes)).forEach(c=>{"assetId"in c&&c.assetId&&!a.has(c.id)&&d.delete(c.assetId)}),{before:n,after:o,assetsToRemove:Array.from(d)}}function ap(r,e,t=ip.Utils.uniqueId(),n="Page"){let{currentPageId:o}=r,s=Object.values(r.state.document.pages).sort((u,p)=>{var m,h;return((m=u.childIndex)!=null?m:0)-((h=p.childIndex)!=null?h:0)}),a=s[s.length-1],d=(a==null?void 0:a.childIndex)?(a==null?void 0:a.childIndex)+1:1,i={id:t,name:rp(n,s.map(u=>{var p;return(p=u.name)!=null?p:""})),childIndex:d,shapes:{},bindings:{}},c={id:t,selectedIds:[],camera:{point:e,zoom:1},editingId:void 0,bindingId:void 0,hoveredId:void 0,pointedId:void 0};return{id:"create_page",before:{appState:{currentPageId:o},document:{pages:{[t]:void 0},pageStates:{[t]:void 0}}},after:{appState:{currentPageId:i.id},document:{pages:{[t]:i},pageStates:{[t]:c}}}}}function ga(r,e,t=[]){let{currentPageId:n}=r,o={},s={};e.forEach(i=>{o[i.id]=void 0,s[i.id]=i});let a={},d={};return t.forEach(i=>{a[i.id]=void 0,d[i.id]=i}),{id:"create",before:{document:{pages:{[n]:{shapes:o,bindings:a}},pageStates:{[n]:{selectedIds:[...r.selectedIds]}}}},after:{document:{pages:{[n]:{shapes:s,bindings:d}},pageStates:{[n]:{selectedIds:e.map(i=>i.id)}}}}}}function lp(r,e){let{currentPageId:t,document:{pages:n,pageStates:o}}=r,s=Object.values(n).sort((i,c)=>(i.childIndex||0)-(c.childIndex||0)),a=s.findIndex(i=>i.id===e),d;return e===t?a===s.length-1?d=s[s.length-2].id:d=s[a+1].id:d=t,{id:"delete_page",before:{appState:{currentPageId:e},document:{pages:{[e]:S({},n[e])},pageStates:{[e]:S({},o[e])}}},after:{appState:{currentPageId:d},document:{pages:{[e]:void 0},pageStates:{[e]:void 0}}}}}var tce=(r,e)=>{let t=S({},r);return e.forEach(n=>t[n]=void 0),t};function fa(r,e,t=r.currentPageId){let{pageState:n,selectedIds:o,document:{assets:s}}=r,{before:a,after:d,assetsToRemove:i}=sp(r.state,e,t),c=tce(s,i);return{id:"delete",before:{document:{assets:s,pages:{[t]:a},pageStates:{[t]:{selectedIds:[...r.selectedIds]}}}},after:{document:{assets:c,pages:{[t]:d},pageStates:{[t]:{selectedIds:o.filter(u=>!e.includes(u)),hoveredId:n.hoveredId&&e.includes(n.hoveredId)?void 0:n.hoveredId}}}}}}var dp=require("@tldraw/core"),Sa=V(require("@tldraw/vec"));function cp(r,e,t){let{currentPageId:n}=r,o=e.map(i=>r.getShape(i)),s=Object.fromEntries(nce(o,t).map(i=>[i.id,i])),{before:a,after:d}=k.mutateShapes(r.state,e.filter(i=>s[i]!==void 0),i=>{var c;return{point:(c=s[i.id])==null?void 0:c.next}},n);return o.forEach(i=>{if(i.type==="group"){let c=Sa.default.sub(d[i.id].point,a[i.id].point);i.children.forEach(u=>{let p=r.getShape(u);a[p.id]={point:p.point},d[p.id]={point:Sa.default.add(p.point,c)}}),delete a[i.id],delete d[i.id]}}),{id:"distribute",before:{document:{pages:{[n]:{shapes:a}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:d}},pageStates:{[n]:{selectedIds:e}}}}}}function nce(r,e){let t=r.map(a=>{let d=k.getShapeUtil(a);return{id:a.id,point:[...a.point],bounds:d.getBounds(a),center:d.getCenter(a)}}),n=t.length,o=dp.Utils.getCommonBounds(t.map(({bounds:a})=>a)),s=[];switch(e){case"horizontal":{let a=t.reduce((d,i)=>d+i.bounds.width,0);if(a>o.width){let d=t.sort((m,h)=>m.bounds.minX-h.bounds.minX)[0],i=t.sort((m,h)=>h.bounds.maxX-m.bounds.maxX)[0],c=t.filter(m=>m!==d&&m!==i).sort((m,h)=>m.center[0]-h.center[0]),u=(i.center[0]-d.center[0])/(n-1),p=d.center[0]+u;c.forEach(({id:m,point:h,bounds:g},f)=>{s.push({id:m,prev:h,next:[p+u*f-g.width/2,g.minY]})})}else{let d=t.sort((u,p)=>u.center[0]-p.center[0]),i=o.minX,c=(o.width-a)/(n-1);d.forEach(({id:u,point:p,bounds:m})=>{s.push({id:u,prev:p,next:[i,m.minY]}),i+=m.width+c})}break}case"vertical":{let a=t.reduce((d,i)=>d+i.bounds.height,0);if(a>o.height){let d=t.sort((m,h)=>m.bounds.minY-h.bounds.minY)[0],i=t.sort((m,h)=>h.bounds.maxY-m.bounds.maxY)[0],c=t.filter(m=>m!==d&&m!==i).sort((m,h)=>m.center[1]-h.center[1]),u=(i.center[1]-d.center[1])/(n-1),p=d.center[1]+u;c.forEach(({id:m,point:h,bounds:g},f)=>{s.push({id:m,prev:h,next:[g.minX,p+u*f-g.height/2]})})}else{let d=t.sort((u,p)=>u.center[1]-p.center[1]),i=o.minY,c=(o.height-a)/(n-1);d.forEach(({id:u,point:p,bounds:m})=>{s.push({id:u,prev:p,next:[m.minX,i]}),i+=m.height+c})}break}}return s}var or=require("@tldraw/core");function pp(r,e){let{currentPageId:t,pageState:{camera:n}}=r,o=r.document.pages[e],s=or.Utils.uniqueId(),a=Object.fromEntries([[o.id,s],...Object.keys(o.shapes).map(u=>[u,or.Utils.uniqueId()]),...Object.keys(o.bindings).map(u=>[u,or.Utils.uniqueId()])]),d=Object.fromEntries(Object.entries(o.shapes).map(([u,p])=>[a[u],w(S({},or.Utils.deepClone(p)),{id:a[u],parentId:a[p.parentId]})])),i=Object.fromEntries(Object.entries(o.bindings).map(([u,p])=>[a[u],w(S({},or.Utils.deepClone(p)),{id:a[p.id],fromId:a[p.fromId],toId:a[p.toId]})]));Object.values(o.bindings).forEach(u=>{let p=a[u.fromId],m=d[p].handles;m&&Object.values(m).forEach(f=>{f.bindingId===u.id&&(f.bindingId=a[u.id])});let h=a[u.toId],g=d[h].handles;g&&Object.values(g).forEach(f=>{f.bindingId===u.id&&(f.bindingId=a[u.id])})});let c=w(S({},o),{id:a[o.id],name:o.name+" Copy",shapes:d,bindings:i});return{id:"duplicate_page",before:{appState:{currentPageId:t},document:{pages:{[s]:void 0},pageStates:{[s]:void 0}}},after:{appState:{currentPageId:s},document:{pages:{[s]:c},pageStates:{[s]:w(S({},o),{id:s,selectedIds:[],camera:S({},n),editingId:void 0,bindingId:void 0,hoveredId:void 0,pointedId:void 0})}}}}}var Kn=require("@tldraw/core"),Xs=require("@tldraw/vec");function up(r,e,t){let{selectedIds:n,currentPageId:o,page:s,shapes:a}=r,d={shapes:{},bindings:{}},i={shapes:{},bindings:{}},c={},u=e.map(h=>r.getShape(h)).filter(h=>!e.includes(h.parentId));u.forEach(h=>{let g=Kn.Utils.uniqueId();if(d.shapes[g]=void 0,i.shapes[g]=w(S({},Kn.Utils.deepClone(h)),{id:g,childIndex:k.getChildIndexAbove(r.state,h.id,o)}),h.children&&(i.shapes[g].children=[]),h.parentId!==o){let f=r.getShape(h.parentId);d.shapes[f.id]=w(S({},d.shapes[f.id]),{children:f.children}),i.shapes[f.id]=w(S({},i.shapes[f.id]),{children:[...(i.shapes[f.id]||f).children,g]})}c[h.id]=g}),u.forEach(h=>{h.children&&h.children.forEach(g=>{var b,y;let f=r.getShape(g),T=Kn.Utils.uniqueId(),x=c[h.id];d.shapes[T]=void 0,i.shapes[T]=w(S({},Kn.Utils.deepClone(f)),{id:T,parentId:x,childIndex:k.getChildIndexAbove(r.state,f.id,o)}),c[g]=T,(y=(b=i.shapes[c[h.id]])==null?void 0:b.children)==null||y.push(T)})});let p=new Set(Object.keys(c));Object.values(s.bindings).filter(h=>p.has(h.fromId)||p.has(h.toId)).forEach(h=>{if(p.has(h.fromId))if(p.has(h.toId)){let g=Kn.Utils.uniqueId(),f=w(S({},Kn.Utils.deepClone(h)),{id:g,fromId:c[h.fromId],toId:c[h.toId]});d.bindings[g]=void 0,i.bindings[g]=f;let T=i.shapes[f.fromId];Object.values(T.handles).forEach(x=>{x.bindingId===h.id&&(x.bindingId=g)})}else{let g=i.shapes[c[h.fromId]];Object.values(g.handles).forEach(f=>{f.bindingId===h.id&&(f.bindingId=void 0)})}});let m=Object.values(i.shapes);if(t){let h=Kn.Utils.getCommonBounds(m.map(f=>k.getBounds(f))),g=Kn.Utils.getBoundsCenter(h);m.forEach(f=>{!f.point||(f.point=Xs.Vec.sub(t,Xs.Vec.sub(g,f.point)))})}else{let h=[16,16];m.forEach(g=>{!g.point||(g.point=Xs.Vec.add(g.point,h))})}return m.forEach(h=>{h.isLocked&&(h.isLocked=!1)}),{id:"duplicate",before:{document:{pages:{[o]:d},pageStates:{[o]:{selectedIds:n}}}},after:{document:{pages:{[o]:i},pageStates:{[o]:{selectedIds:Array.from(p.values()).map(h=>c[h])}}}}}}var hn=require("@tldraw/core");function ba(r,e,t){let{selectedIds:n,currentPageId:o,page:{shapes:s}}=r,a=e.map(p=>k.getBounds(s[p])),d=e.length===1&&s[e[0]].type==="group",i=hn.Utils.getCommonBounds(a),{before:c,after:u}=k.mutateShapes(r.state,e,p=>{let m=k.getBounds(p),h=p.parentId!==o;switch(t){case"horizontal":{if(h&&!d){let f=k.getBounds(s[p.parentId]),x=hn.Utils.getRelativeTransformedBoundingBox(i,i,f,!0,!1).minX-f.minX;return k.getShapeUtil(p).transform(p,w(S({},m),{minX:m.minX+x,maxX:m.maxX+x}),{type:hn.TLBoundsCorner.TopLeft,scaleX:1,scaleY:1,initialShape:p,transformOrigin:[.5,.5]})}let g=hn.Utils.getRelativeTransformedBoundingBox(i,i,m,!0,!1);return k.getShapeUtil(p).transform(p,g,{type:hn.TLBoundsCorner.TopLeft,scaleX:-1,scaleY:1,initialShape:p,transformOrigin:[.5,.5]})}case"vertical":{if(h&&!d){let f=k.getBounds(s[p.parentId]),x=hn.Utils.getRelativeTransformedBoundingBox(i,i,f,!1,!0).minY-f.minY;return k.getShapeUtil(p).transform(p,w(S({},m),{minY:m.minY+x,maxY:m.maxY+x}),{type:hn.TLBoundsCorner.TopLeft,scaleX:1,scaleY:1,initialShape:p,transformOrigin:[.5,.5]})}let g=hn.Utils.getRelativeTransformedBoundingBox(i,i,m,!1,!0);return k.getShapeUtil(p).transform(p,g,{type:hn.TLBoundsCorner.TopLeft,scaleX:1,scaleY:-1,initialShape:p,transformOrigin:[.5,.5]})}}},o,!0);return{id:"flip",before:{document:{pages:{[o]:{shapes:c}},pageStates:{[o]:{selectedIds:n}}}},after:{document:{pages:{[o]:{shapes:u}},pageStates:{[o]:{selectedIds:e}}}}}}var hp=require("@tldraw/core");function mp(r,e,t,n){var R,K;if(e.length<2)return;let o={},s={},a={},d={},i=[...e],c=[],u=[],p=[];for(let L of e){let v=r.getShape(L);if(!v.isLocked)if(v.children===void 0)c.push(v);else{let I=v.children.filter(J=>!r.getShape(J).isLocked);p.push(v),i.push(...I),c.push(...I.map(J=>r.getShape(J)).filter(Boolean))}}if(c.every(L=>L.parentId===c[0].parentId)&&c[0].parentId!==n&&((R=r.getShape(c[0].parentId).children)==null?void 0:R.length)===i.length)return;let m=k.flattenPage(r.state,n),h=Object.fromEntries(c.map(L=>[L.id,m.indexOf(L)])),g=c.sort((L,v)=>h[L.id]-h[v.id]),f=n,T=(g.filter(L=>L.parentId===n)[0]||g[0]).childIndex,x=hp.Utils.getCommonBounds(c.map(L=>k.getBounds(L)));for(o[t]=void 0,s[t]=k.getShapeUtil("group").create({id:t,childIndex:T,parentId:f,point:[x.minX,x.minY],size:[x.width,x.height],children:g.map(L=>L.id)}),g.forEach((L,v)=>{if(L.parentId!==n){let I=r.getShape(L.parentId);p.push(I)}o[L.id]=w(S({},o[L.id]),{parentId:L.parentId,childIndex:L.childIndex}),s[L.id]=w(S({},s[L.id]),{parentId:t,childIndex:v+1})});p.length>0;){let L=p.pop();if(!L)break;let v=(((K=o[L.id])==null?void 0:K.children)||L.children).filter(I=>I&&!(i.includes(I)||u.includes(I)));v.length===0?(o[L.id]=L,s[L.id]=void 0,L.parentId!==n&&(u.push(L.id),p.push(r.getShape(L.parentId)))):(o[L.id]=w(S({},o[L.id]),{children:L.children}),s[L.id]=w(S({},s[L.id]),{children:v}))}let{bindings:b}=r,y=new Set(u);return b.forEach(L=>{for(let v of[L.toId,L.fromId])if(y.has(v)){a[L.id]=L,d[L.id]=void 0;let I=r.getShape(v);I.handles&&Object.values(I.handles).filter(J=>J.bindingId===L.id).forEach(J=>{var ce,de;o[v]=w(S({},o[v]),{handles:w(S({},(ce=o[v])==null?void 0:ce.handles),{[J.id]:{bindingId:L.id}})}),u.includes(v)||(s[v]=w(S({},s[v]),{handles:w(S({},(de=s[v])==null?void 0:de.handles),{[J.id]:{bindingId:void 0}})}))})}}),{id:"group",before:{document:{pages:{[n]:{shapes:o,bindings:a}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:s,bindings:a}},pageStates:{[n]:{selectedIds:[t]}}}}}}var gp=require("@tldraw/core"),Ta=require("@tldraw/vec");function fp(r,e,t,n,o){let{page:s}=r,a={before:{shapes:{},bindings:{}},after:{shapes:{},bindings:{}}},d={before:{shapes:{},bindings:{}},after:{shapes:{},bindings:{}}},i=new Set,c=new Set;e.map(b=>r.getShape(b,n)).filter(b=>!b.isLocked).forEach(b=>{i.add(b.id),c.add(b),b.children!==void 0&&b.children.forEach(y=>{i.add(y),c.add(r.getShape(y,n))})});let u=k.getTopChildIndex(r.state,o),p=Array.from(c.values());p.forEach((b,y)=>{if(a.before.shapes[b.id]=b,a.after.shapes[b.id]=void 0,d.before.shapes[b.id]=void 0,d.after.shapes[b.id]=b,!i.has(b.parentId)&&(d.after.shapes[b.id]=w(S({},b),{parentId:o,childIndex:u+y}),b.parentId!==n)){let R=r.getShape(b.parentId,n);a.before.shapes[R.id]={children:R.children},a.after.shapes[R.id]={children:R.children.filter(K=>K!==b.id)}}}),Object.values(s.bindings).filter(b=>i.has(b.fromId)||i.has(b.toId)).forEach(b=>{a.before.bindings[b.id]=b,a.after.bindings[b.id]=void 0;let y=r.getShape(b.fromId,n);if(i.has(b.fromId)&&i.has(b.toId))d.before.bindings[b.id]=void 0,d.after.bindings[b.id]=b;else if(i.has(b.fromId)){let K=r.getShape(b.fromId,n),v=Object.values(y.handles).find(J=>J.bindingId===b.id).id,I=d.after.shapes[K.id];I.handles=w(S({},I.handles),{[v]:w(S({},I.handles[v]),{bindingId:void 0})})}else{let K=r.getShape(b.fromId,n),L=Object.values(y.handles).find(v=>v.bindingId===b.id);a.before.shapes[K.id]={handles:{[L.id]:{bindingId:b.id}}},a.after.shapes[K.id]={handles:{[L.id]:{bindingId:void 0}}}}});let m=r.state.document.pageStates[o],h=gp.Utils.getCommonBounds(p.map(b=>k.getBounds(b))),g=k.getCameraZoom(t.width<t.height?(t.width-128)/h.width:(t.height-128)/h.height),f=(t.width-h.width*g)/2/g,T=(t.height-h.height*g)/2/g,x=Ta.Vec.toFixed(Ta.Vec.add([-h.minX,-h.minY],[f,T]));return{id:"move_to_page",before:{appState:{currentPageId:n},document:{pages:{[n]:a.before,[o]:d.before},pageStates:{[n]:{selectedIds:e},[o]:{selectedIds:m.selectedIds,camera:m.camera}}}},after:{appState:{currentPageId:o},document:{pages:{[n]:a.after,[o]:d.after},pageStates:{[n]:{selectedIds:[]},[o]:{selectedIds:e,camera:{zoom:g,point:x}}}}}}}function Sp(r,e,t){let{pages:n}=r.document,o=n[e],s=Object.values(n).sort((i,c)=>{var u,p;return((u=i.childIndex)!=null?u:0)-((p=c.childIndex)!=null?p:0)}),a=s.indexOf(o),d=[...s];return d.splice(a,1),d.splice(t>a?t-1:t,0,o),{id:"move_page",before:{document:{pages:Object.fromEntries(s.map(i=>[i.id,{childIndex:i.childIndex}]))}},after:{document:{pages:Object.fromEntries(d.map((i,c)=>[i.id,{childIndex:c}]))}}}}function Ar(r,e,t){let{currentPageId:n,page:o}=r,s=new Set(e.map(u=>r.getShape(u).parentId)),a={before:{},after:{}},d,i,c;return Array.from(s.values()).forEach(u=>{let p=[];if(u===o.id)p=Object.values(o.shapes).sort((g,f)=>g.childIndex-f.childIndex);else{let g=r.getShape(u);if(!g.children)throw Error("No children in parent!");p=g.children.map(f=>r.getShape(f)).sort((f,T)=>f.childIndex-T.childIndex)}let m=p.map(g=>g.id),h=e.filter(g=>m.includes(g)).map(g=>m.indexOf(g)).sort((g,f)=>g-f);if(h.length!==m.length)switch(t){case"toBack":{for(let g=0;g<m.length;g++)if(!h.includes(g)){d=g;break}i=p[d].childIndex,c=i/(h.length+1),a=k.mutateShapes(r.state,h.map(g=>p[g].id).reverse(),(g,f)=>({childIndex:i-(f+1)*c}),n);break}case"toFront":{for(let g=m.length-1;g>=0;g--)if(!h.includes(g)){d=g;break}i=p[d].childIndex,c=1,a=k.mutateShapes(r.state,h.map(g=>p[g].id),(g,f)=>({childIndex:i+(f+1)}),n);break}case"backward":{let g={};for(let f=m.length-1;f>=0;f--)if(h.includes(f)){for(let T=f;T>=0;T--)if(!h.includes(T)){let x=p[T].childIndex,b,y;T===0?(b=x/2,y=x/2/(f-T+1)):(b=p[T-1].childIndex,y=(x-b)/(f-T+1),b+=y);for(let R=0;R<f-T;R++)g[p[T+R+1].id]=b+y*R;break}}Object.values(g).length>0&&(a=k.mutateShapes(r.state,h.map(f=>p[f].id),f=>({childIndex:g[f.id]}),n));break}case"forward":{let g={};for(let f=0;f<m.length;f++)if(h.includes(f)){for(let T=f;T<m.length;T++)if(!h.includes(T)){i=p[T].childIndex;let x=T===m.length-1?1:(p[T+1].childIndex-i)/(T-f+1);for(let b=0;b<T-f;b++)g[p[f+b].id]=i+x*(b+1);break}}Object.values(g).length>0&&(a=k.mutateShapes(r.state,h.map(f=>p[f].id),f=>({childIndex:g[f.id]}),n));break}}}),{id:"move",before:{document:{pages:{[n]:{shapes:a.before}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:a.after}},pageStates:{[n]:{selectedIds:e}}}}}}function bp(r,e,t){let{page:n}=r;return{id:"rename_page",before:{document:{pages:{[e]:{name:n.name}}}},after:{document:{pages:{[e]:{name:t}}}}}}function ya(r,e,t){let{currentPageId:n}=r,{before:o,after:s}=k.mutateShapes(r.state,e,a=>{var d,i;return(i=(d=r.getShapeUtil(a)).onDoubleClickBoundsHandle)==null?void 0:i.call(d,a)},t);return{id:"reset_bounds",before:{document:{pages:{[n]:{shapes:o}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:s}},pageStates:{[n]:{selectedIds:e}}}}}}var xa=require("@tldraw/core");var oce=Math.PI*2;function Tp(r,e,t=-oce/4){let{currentPageId:n}=r,o={},s={},a=e.flatMap(i=>{let c=r.getShape(i);return c.children?c.children.map(u=>r.getShape(u)):c}).filter(i=>!i.isLocked),d=xa.Utils.getBoundsCenter(xa.Utils.getCommonBounds(a.map(i=>k.getBounds(i))));return a.forEach(i=>{let c=k.getRotatedShapeMutation(i,k.getCenter(i),d,t);!c||(o[i.id]=k.getBeforeShape(i,c),s[i.id]=c)}),{id:"rotate",before:{document:{pages:{[n]:{shapes:o}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:s}},pageStates:{[n]:{selectedIds:e}}}}}}var Lr=require("@tldraw/core");function yp(r,e,t){let{currentPageId:n,selectedIds:o}=r,s=e.map(p=>r.getShape(p)),a=s.map(p=>k.getBounds(p)),d=Lr.Utils.getCommonBounds(a),i=e.flatMap(p=>{let m=r.getShape(p);return m.children?m.children:m.id}).filter(p=>!r.getShape(p).isLocked),{before:c,after:u}=k.mutateShapes(r.state,i,p=>{let m=k.getBounds(p);switch(t){case"horizontal":{let h=w(S({},m),{minX:d.minX,maxX:d.maxX,width:d.width});return k.getShapeUtil(p).transformSingle(p,h,{type:Lr.TLBoundsCorner.TopLeft,scaleX:h.width/m.width,scaleY:1,initialShape:p,transformOrigin:[.5,.5]})}case"vertical":{let h=w(S({},m),{minY:d.minY,maxY:d.maxY,height:d.height});return k.getShapeUtil(p).transformSingle(p,h,{type:Lr.TLBoundsCorner.TopLeft,scaleX:1,scaleY:h.height/m.height,initialShape:p,transformOrigin:[.5,.5]})}}},n);return s.forEach(p=>{p.type==="group"&&(delete c[p.id],delete u[p.id])}),{id:"stretch",before:{document:{pages:{[n]:{shapes:c}},pageStates:{[n]:{selectedIds:o}}}},after:{document:{pages:{[n]:{shapes:u}},pageStates:{[n]:{selectedIds:e}}}}}}var qs=require("@tldraw/vec");function xp(r,e,t){let{currentPageId:n,selectedIds:o}=r,s=e.flatMap(i=>k.getDocumentBranch(r.state,i,n)).filter(i=>!r.getShape(i).isLocked),a={},d={};return s.map(i=>r.getShape(i)).filter(i=>!i.isLocked).forEach(i=>{a[i.id]={style:S({},Object.fromEntries(Object.keys(t).map(c=>[c,i.style[c]])))},d[i.id]={style:t},i.type==="text"&&(a[i.id].point=i.point,d[i.id].point=qs.Vec.toFixed(qs.Vec.add(i.point,qs.Vec.sub(r.getShapeUtil(i).getCenter(i),r.getShapeUtil(i).getCenter(w(S({},i),{style:S(S({},i.style),t)}))))))}),{id:"style",before:{document:{pages:{[n]:{shapes:a}},pageStates:{[n]:{selectedIds:o}}},appState:{currentStyle:S({},r.appState.currentStyle)}},after:{document:{pages:{[n]:{shapes:d}},pageStates:{[n]:{selectedIds:e}}},appState:{currentStyle:t}}}}function wp(r,e,t){let{currentPageId:n,selectedIds:o}=r,s=Object.fromEntries(e.map(d=>{var i;return[d,{decorations:{[t]:(i=r.getShape(d).decorations)==null?void 0:i[t]}}]})),a=Object.fromEntries(e.filter(d=>!r.getShape(d).isLocked).map(d=>{var i;return[d,{decorations:{[t]:((i=r.getShape(d).decorations)==null?void 0:i[t])?void 0:"arrow"}}]}));return{id:"toggle_decorations",before:{document:{pages:{[n]:{shapes:s}},pageStates:{[n]:{selectedIds:o}}}},after:{document:{pages:{[n]:{shapes:a}},pageStates:{[n]:{selectedIds:e}}}}}}function Js(r,e,t){let{currentPageId:n}=r,o=e.map(i=>r.getShape(i)).filter(i=>t==="isLocked"?!0:!i.isLocked),s=o.every(i=>i[t]),a={},d={};return o.forEach(i=>{a[i.id]={[t]:i[t]},d[i.id]={[t]:!s}}),{id:"toggle",before:{document:{pages:{[n]:{shapes:a}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:d}},pageStates:{[n]:{selectedIds:e}}}}}}var wa=require("@tldraw/vec");function kp(r,e,t){let{currentPageId:n,selectedIds:o}=r;r.rotationInfo.selectedIds=[...o];let s={shapes:{},bindings:{}},a={shapes:{},bindings:{}},d=e.flatMap(u=>{let p=r.getShape(u);return p.children?p.children:p.id}).filter(u=>!r.getShape(u).isLocked),i=k.mutateShapes(r.state,d,u=>({point:wa.Vec.toFixed(wa.Vec.add(u.point,t))}),n);return s.shapes=i.before,a.shapes=i.after,k.getBindings(r.state,n).filter(u=>e.includes(u.fromId)&&!e.includes(u.toId)).forEach(u=>{s.bindings[u.id]=u,a.bindings[u.id]=void 0;for(let p of[u.toId,u.fromId]){let m=r.getShape(p);!m.handles||Object.values(m.handles).filter(h=>h.bindingId===u.id).forEach(h=>{var g,f;s.shapes[p]=w(S({},s.shapes[p]),{handles:w(S({},(g=s.shapes[p])==null?void 0:g.handles),{[h.id]:{bindingId:u.id}})}),a.shapes[p]=w(S({},a.shapes[p]),{handles:w(S({},(f=a.shapes[p])==null?void 0:f.handles),{[h.id]:{bindingId:void 0}})})})}}),{id:"translate",before:{document:{pages:{[n]:s},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:a},pageStates:{[n]:{selectedIds:e}}}}}}function vp(r,e,t,n){let{bindings:o}=r,s={},a={},d={},i={},c=e,u=e.filter(p=>!t.find(m=>m.id===p));return t.filter(p=>!p.isLocked).forEach(p=>{let m=[],h=[];s[p.id]=p,a[p.id]=void 0,p.children.forEach(b=>{u.push(b);let y=r.getShape(b,n);m.push(y)});let g=p.childIndex,T=(k.getChildIndexAbove(r.state,p.id,n)-g)/m.length;m.sort((b,y)=>b.childIndex-y.childIndex).forEach((b,y)=>{s[b.id]={parentId:b.parentId,childIndex:b.childIndex},a[b.id]={parentId:n,childIndex:g+T*y}}),o.filter(b=>b.toId===p.id||b.fromId===p.id).forEach(b=>{for(let y of[b.toId,b.fromId])if(a[y]===void 0){d[b.id]=b,i[b.id]=void 0;let R=r.getShape(y,n);R.handles&&Object.values(R.handles).filter(K=>K.bindingId===b.id).forEach(K=>{var L,v;s[y]=w(S({},s[y]),{handles:w(S({},(L=s[y])==null?void 0:L.handles),{[K.id]:{bindingId:b.id}})}),h.includes(y)||(a[y]=w(S({},a[y]),{handles:w(S({},(v=a[y])==null?void 0:v.handles),{[K.id]:{bindingId:void 0}})}))})}})}),{id:"ungroup",before:{document:{pages:{[n]:{shapes:s,bindings:d}},pageStates:{[n]:{selectedIds:c}}}},after:{document:{pages:{[n]:{shapes:a,bindings:d}},pageStates:{[n]:{selectedIds:u}}}}}}function ka(r,e,t){let n=e.map(s=>s.id),o=k.mutateShapes(r.state,n.filter(s=>!r.getShape(s,t).isLocked),(s,a)=>e[a],t);return{id:"update",before:{document:{pages:{[t]:{shapes:o.before}}}},after:{document:{pages:{[t]:{shapes:o.after}}}}}}function Ip(r,e,t){let{currentPageId:n,selectedIds:o}=r,s=e.map(c=>r.getShape(c)).filter(c=>t.isLocked?!0:!c.isLocked),a={},d={},i=Object.keys(t);return s.forEach(c=>{a[c.id]=Object.fromEntries(i.map(u=>[u,c[u]])),d[c.id]=t}),{id:"set_props",before:{document:{pages:{[n]:{shapes:a}},pageStates:{[n]:{selectedIds:o}}}},after:{document:{pages:{[n]:{shapes:d}},pageStates:{[n]:{selectedIds:o}}}}}}var Ut=require("@tldraw/core"),vo=require("@tldraw/vec");function Cp(r,e,t={}){let{currentPageId:n}=r,{point:o,select:s,overwrite:a}=t,d=r.document.pages[n],i={shapes:{},bindings:{}},c={},u={shapes:{},bindings:{}};if(a){for(let m of e.shapes)i.shapes[m.id]=d.shapes[m.id],u.shapes[m.id]=m;if(e.bindings)for(let m of e.bindings)i.bindings[m.id]=d.bindings[m.id],u.bindings[m.id]=m;if(e.assets)for(let m of e.assets)c[m.id]=m}else{let m={},h=k.getTopChildIndex(r.state,n),g=e.shapes.sort((x,b)=>x.childIndex-b.childIndex).map(x=>{let b=Ut.Utils.uniqueId();return m[x.id]=b,w(S({},Ut.Utils.deepClone(x)),{id:b})}),f=new Set;for(;g.length>0;){let x=g.shift();if(!x)break;if(f.add(x.id),x.parentId==="currentPageId")x.parentId=n,x.childIndex=h++;else{x.parentId=m[x.parentId];let b=u.shapes[x.parentId];if(!b){f.has(x.id)&&(x.parentId="currentPageId"),g.push(x);continue}b.children.push(x.id)}x.children&&(x.children=[]),i.shapes[x.id]=void 0,u.shapes[x.id]=x}Object.values(u.shapes).forEach(x=>{x.children&&x.children.length===0&&(delete i.shapes[x.id],delete u.shapes[x.id])}),e.bindings&&e.bindings.forEach(x=>{let b=Ut.Utils.uniqueId();m[x.id]=b;let y=m[x.toId],R=m[x.fromId];if(!y||!R){if(R){let I=u.shapes[R].handles;I&&Object.values(I).forEach(J=>{J.bindingId===x.id&&(J.bindingId=void 0)})}if(y){let I=u.shapes[y].handles;I&&Object.values(I).forEach(J=>{J.bindingId===x.id&&(J.bindingId=void 0)})}return}let K=u.shapes[R].handles;K&&Object.values(K).forEach(I=>{I.bindingId===x.id&&(I.bindingId=b)}),u.shapes[y].handles&&Object.values(u.shapes[y].handles).forEach(I=>{I.bindingId===x.id&&(I.bindingId=b)});let v=w(S({},Ut.Utils.deepClone(x)),{id:b,toId:y,fromId:R});i.bindings[v.id]=void 0,u.bindings[v.id]=v});let T=Object.values(u.shapes);if(T.length>0)if(o){let x=Ut.Utils.getCommonBounds(T.map(y=>k.getBounds(y))),b=Ut.Utils.getBoundsCenter(x);T.forEach(y=>{!y.point||(y.point=vo.Vec.sub(o,vo.Vec.sub(b,y.point)))})}else{let x=Ut.Utils.getCommonBounds(T.map(k.getBounds));if(!(Ut.Utils.boundsContain(r.viewport,x)||Ut.Utils.boundsCollide(r.viewport,x))){let b=vo.Vec.toFixed(r.getPagePoint(r.centerPoint)),y=Ut.Utils.centerBounds(x,b),R=vo.Vec.sub(Ut.Utils.getBoundsCenter(y),Ut.Utils.getBoundsCenter(x));T.forEach(K=>{K.point=vo.Vec.toFixed(vo.Vec.add(K.point,R))})}}if(e.assets)for(let x of e.assets)c[x.id]=x}let p=document.createElement("textarea");return Object.values(u.shapes).forEach(m=>{"text"in m&&(p.innerHTML=m.text,m.text=p.value),"label"in m&&(p.innerHTML=m.label,m.label=p.value)}),p.remove(),{id:"insert",before:{document:{pages:{[n]:i},pageStates:{[n]:{selectedIds:[...r.selectedIds]}}}},after:{document:{pages:{[n]:u},assets:c,pageStates:{[n]:{selectedIds:s?Object.keys(u.shapes):[...r.selectedIds]}}}}}}var rr={};Ja(rr,{fileToBase64:()=>Pa,fileToText:()=>Ma,getImageSizeFromSrc:()=>Ea,getVideoSizeFromSrc:()=>Ba,loadFileHandle:()=>va,migrate:()=>An,openAssetsFromFileSystem:()=>Da,openFromFileSystem:()=>Ca,saveFileHandle:()=>Ia,saveToFileSystem:()=>ei});function An(r,e){let{document:t,settings:n}=r,{version:o=0}=t;"assets"in t||(t.assets={});let s=new Set;return Object.values(t.pages).forEach(a=>Object.values(a.shapes).forEach(d=>{let{parentId:i,children:c,assetId:u}=d;u&&s.add(u),i!==a.id&&!a.shapes[i]&&(console.warn("Encountered a shape with a missing parent!"),d.parentId=a.id),d.type==="group"&&c&&c.forEach(p=>{a.shapes[p]||(console.warn("Encountered a parent with a missing child!",d.id,p),c==null||c.splice(c.indexOf(p),1))})})),Object.keys(t.assets).forEach(a=>{s.has(a)||delete t.assets[a]}),o!==e&&(o<14&&Object.values(t.pages).forEach(a=>{Object.values(a.shapes).filter(d=>d.type==="text").forEach(d=>d.style.font==="script")}),o<=13&&Object.values(t.pages).forEach(a=>{Object.values(a.bindings).forEach(d=>{Object.assign(d,d.meta)}),Object.values(a.shapes).forEach(d=>{Object.entries(d.style).forEach(([i,c])=>{typeof c=="string"&&(d.style[i]=c.toLowerCase())}),d.type==="arrow"&&d.decorations&&Object.entries(d.decorations).forEach(([i,c])=>{c==="Arrow"&&(d.decorations=w(S({},d.decorations),{[i]:"arrow"}))})})}),o<=13.1&&(t.name="New Document"),o<15&&(t.assets={}),Object.values(t.pages).forEach(a=>{Object.values(a.shapes).forEach(d=>{o<15.2&&(d.type==="image"||d.type==="video")&&(d.style.isFilled=!0),o<15.3&&(d.type==="rectangle"||d.type==="triangle"||d.type==="ellipse"||d.type==="arrow")&&(d.label=d.text||"",d.labelPoint=[.5,.5])})}),o<15.4&&(n.dockPosition="bottom"),o<15.5&&(n.exportBackground="transparent")),Object.values(t.pageStates).forEach(a=>{a.selectedIds=a.selectedIds.filter(d=>t.pages[a.id].shapes[d]!==void 0),a.bindingId=void 0,a.editingId=void 0,a.hoveredId=void 0,a.pointedId=void 0}),t.version=e,r}var Io=require("browser-fs-access"),Qs=require("idb-keyval");var Dp={mode:"readwrite"},sce=r=>ue(void 0,null,function*(){return(yield r.queryPermission(Dp))==="granted"||(yield r.requestPermission(Dp))==="granted"});function va(){return ue(this,null,function*(){if(typeof Window=="undefined"||!("_location"in Window))return;let r=yield(0,Qs.get)(`Tldraw_file_handle_${window.location.origin}`);return r||null})}function Ia(r){return ue(this,null,function*(){return(0,Qs.set)(`Tldraw_file_handle_${window.location.origin}`,r)})}function ei(r,e,t){return ue(this,null,function*(){let n={name:r.name||"New Document",fileHandle:e!=null?e:null,document:r,assets:{}},o=JSON.stringify(n),s=new Blob([o],{type:"application/vnd.Tldraw+json"});if(e&&!(yield sce(e)))return null;let a=!Io.supported&&(t==null?void 0:t.length)?t:`${n.name}`,d=yield(0,Io.fileSave)(s,{fileName:`${a}${ys}`,description:"Tldraw File",extensions:[`${ys}`]},e);return yield Ia(d),d})}function Ca(){return ue(this,null,function*(){var o;let r=yield(0,Io.fileOpen)({description:"Tldraw File",extensions:[`${ys}`],multiple:!1});if(!r)return null;let e=yield new Promise(s=>{let a=new FileReader;a.onloadend=()=>{a.readyState===FileReader.DONE&&s(a.result)},a.readAsText(r,"utf8")}),t=JSON.parse(e),n=(o=r.handle)!=null?o:null;return yield Ia(n),{fileHandle:n,document:t.document}})}function Da(){return ue(this,null,function*(){return(0,Io.fileOpen)({description:"Image or Video",extensions:[...xs,...ws],multiple:!0})})}function Pa(r){return new Promise((e,t)=>{if(r){let n=new FileReader;n.readAsDataURL(r),n.onload=()=>e(n.result),n.onerror=o=>t(o),n.onabort=o=>t(o)}})}function Ma(r){return new Promise((e,t)=>{if(r){let n=new FileReader;n.readAsText(r),n.onload=()=>e(n.result),n.onerror=o=>t(o),n.onabort=o=>t(o)}})}function Ea(r){return new Promise((e,t)=>{let n=new Image;n.onload=()=>e([n.width,n.height]),n.onerror=()=>t(new Error("Could not get image size")),n.src=r})}function Ba(r){return new Promise((e,t)=>{let n=document.createElement("video");n.onloadedmetadata=()=>e([n.videoWidth,n.videoHeight]),n.onerror=()=>t(new Error("Could not get video size")),n.src=r})}Mo(rr,require("browser-fs-access"));var Ln=require("@tldraw/core"),Ve=require("@tldraw/vec");var Je=class{constructor(e){this.app=e}};var Ra=class extends Je{constructor(e,t,n,o=!1){super(e);l(this,"type","arrow");l(this,"performanceMode");l(this,"status","translatingHandle");l(this,"newStartBindingId",Ln.Utils.uniqueId());l(this,"draggedBindingId",Ln.Utils.uniqueId());l(this,"didBind",!1);l(this,"initialShape");l(this,"handleId");l(this,"bindableShapeIds");l(this,"initialBinding");l(this,"startBindingShapeId");l(this,"isCreate");l(this,"start",()=>{});l(this,"update",()=>{var K,L,v;let{initialShape:e}=this,{currentPoint:t,shiftKey:n,altKey:o,metaKey:s,currentGrid:a,settings:{showGrid:d}}=this.app,i=this.app.getShape(e.id);if(i.isLocked)return;let{handles:c}=e,u=this.handleId;if(!c[u].canBind)return;let p=Ve.Vec.sub(t,Ve.Vec.add(c[u].point,e.point));if(n){let I=o?Ve.Vec.med(c.start.point,c.end.point):c[u==="start"?"end":"start"].point,J=c[u].point,ce=Ve.Vec.add(J,p),de=Ve.Vec.angle(I,ce),He=Ve.Vec.rotWith(ce,I,Ln.Utils.snapAngleToSegments(de,24)-de);p=Ve.Vec.add(p,Ve.Vec.sub(He,ce))}let m=Ve.Vec.add(c[u].point,p),h={[u]:w(S({},c[u]),{point:d?Ve.Vec.snap(m,a):Ve.Vec.toFixed(m),bindingId:void 0})},g=Rn["arrow"],f=(K=g.onHandleChange)==null?void 0:K.call(g,e,h);if(!f)return;let T={shape:Ln.Utils.deepMerge(i,f),bindings:{}},x,b=T.shape.handles[this.handleId],y=T.shape.handles[this.handleId==="start"?"end":"start"];if(this.startBindingShapeId){let I,J=this.app.page.shapes[this.startBindingShapeId],ce=k.getShapeUtil(J),de=ce.getCenter(J),He=T.shape.handles.start,Pe=T.shape.handles.end,Me=Ve.Vec.add(He.point,T.shape.point);Ve.Vec.isEqual(Me,de)&&Me[1]++;let Ue=de,Ke=ce.hitTestPoint(J,t),Kt=Ve.Vec.uni(Ve.Vec.sub(Me,Ue)),gn=this.app.getBinding(this.newStartBindingId)!==void 0;!s&&!ce.hitTestPoint(J,Ve.Vec.add(T.shape.point,Pe.point))&&(I=this.findBindingPoint(i,J,"start",this.newStartBindingId,de,Ue,Kt,Ke)),I&&!gn?(this.didBind=!0,T.bindings[this.newStartBindingId]=I,T.shape=Ln.Utils.deepMerge(T.shape,{handles:{start:{bindingId:I.id}}})):!I&&gn&&(this.didBind=!1,T.bindings[this.newStartBindingId]=void 0,T.shape=Ln.Utils.deepMerge(e,{handles:{start:{bindingId:void 0}}}))}if(!s){let I=Ve.Vec.add(y.point,T.shape.point),J=Ve.Vec.add(b.point,T.shape.point),ce=Ve.Vec.uni(Ve.Vec.sub(J,I)),de=Ve.Vec.add(T.shape.point,T.shape.handles.start.point),He=Ve.Vec.add(T.shape.point,T.shape.handles.end.point),Pe=this.bindableShapeIds.map(Me=>this.app.page.shapes[Me]).sort((Me,Ue)=>Ue.childIndex-Me.childIndex).filter(Me=>{if(Me.isLocked)return!1;let Ue=k.getShapeUtil(Me);return![de,He].every(Ke=>Ue.hitTestPoint(Me,Ke))});for(let Me of Pe)if(x=this.findBindingPoint(i,Me,this.handleId,this.draggedBindingId,J,I,ce,o),x)break}if(x)this.didBind=!0,T.bindings[this.draggedBindingId]=x,T.shape=Ln.Utils.deepMerge(T.shape,{handles:{[this.handleId]:{bindingId:this.draggedBindingId}}});else{this.didBind=this.didBind||!1;let I=i.handles[this.handleId].bindingId;I!==void 0&&(T.bindings[I]=void 0,T.shape=Ln.Utils.deepMerge(T.shape,{handles:{[this.handleId]:{bindingId:void 0}}}))}let R=(v=(L=k.getShapeUtil(T.shape)).onHandleChange)==null?void 0:v.call(L,T.shape,T.shape.handles);return{document:{pages:{[this.app.currentPageId]:{shapes:{[i.id]:S(S({},T.shape),R!=null?R:{})},bindings:T.bindings}},pageStates:{[this.app.currentPageId]:{bindingId:T.shape.handles[u].bindingId}}}}});l(this,"cancel",()=>{let{initialShape:e,initialBinding:t,newStartBindingId:n,draggedBindingId:o}=this,s=k.onSessionComplete(this.app.page.shapes[e.id]),a=this.isCreate||Ve.Vec.dist(s.handles.start.point,s.handles.end.point)<4,d={};return d[o]=void 0,t&&(d[t.id]=a?void 0:t),n&&(d[n]=void 0),{document:{pages:{[this.app.currentPageId]:{shapes:{[e.id]:a?void 0:e},bindings:d}},pageStates:{[this.app.currentPageId]:{selectedIds:a?[]:[e.id],bindingId:void 0,hoveredId:void 0,editingId:void 0}}}}});l(this,"complete",()=>{let{initialShape:e,initialBinding:t,newStartBindingId:n,startBindingShapeId:o,handleId:s}=this,a=k.onSessionComplete(this.app.page.shapes[e.id]),d=a.handles[s].bindingId,i=Ve.Vec.dist(a.handles.start.point,a.handles.end.point);if(!(d||t)&&i<4)return this.cancel();let c={},u={};return t&&(c[t.id]=this.isCreate?void 0:t,u[t.id]=void 0),d&&(c[d]=void 0,u[d]=this.app.page.bindings[d]),o&&(c[n]=void 0,u[n]=this.app.page.bindings[n]),{id:"arrow",before:{document:{pages:{[this.app.currentPageId]:{shapes:{[e.id]:this.isCreate?void 0:e},bindings:c}},pageStates:{[this.app.currentPageId]:{selectedIds:this.isCreate?[]:[e.id],bindingId:void 0,hoveredId:void 0,editingId:void 0}}}},after:{document:{pages:{[this.app.currentPageId]:{shapes:{[e.id]:a},bindings:u}},pageStates:{[this.app.currentPageId]:{selectedIds:[e.id],bindingId:void 0,hoveredId:void 0,editingId:void 0}}}}}});l(this,"findBindingPoint",(e,t,n,o,s,a,d,i)=>{let u=k.getShapeUtil(t.type).getBindingPoint(t,e,s,a,d,i);if(!!u)return{id:o,type:"arrow",fromId:e.id,toId:t.id,handleId:n,point:Ve.Vec.toFixed(u.point),distance:u.distance}});var c,u,p;this.isCreate=o;let{currentPageId:s}=e.state.appState,a=e.state.document.pages[s];this.handleId=n,this.initialShape=wt(a.shapes[t]),this.bindableShapeIds=k.getBindableShapeIds(e.state).filter(m=>!(m===this.initialShape.id||m===this.initialShape.parentId));let d=(c=this.initialShape.handles[n==="start"?"end":"start"])==null?void 0:c.bindingId;if(d){let m=(u=a.bindings[d])==null?void 0:u.toId;m&&(this.bindableShapeIds=this.bindableShapeIds.filter(h=>h!==m))}let{originPoint:i}=this.app;if(this.isCreate)this.startBindingShapeId=(p=this.bindableShapeIds.map(m=>a.shapes[m]).filter(m=>!m.isLocked&&Ln.Utils.pointInBounds(i,k.getShapeUtil(m).getBounds(m))).sort((m,h)=>h.childIndex-m.childIndex)[0])==null?void 0:p.id,this.startBindingShapeId&&this.bindableShapeIds.splice(this.bindableShapeIds.indexOf(this.startBindingShapeId),1);else{let m=this.initialShape.handles[this.handleId].bindingId;m?this.initialBinding=a.bindings[m]:this.initialShape.handles[this.handleId].bindingId=void 0}}};var Aa=require("@tldraw/core");var La=class extends Je{constructor(e){super(e);l(this,"type","brush");l(this,"performanceMode");l(this,"status","brushing");l(this,"initialSelectedIds");l(this,"shapesToTest");l(this,"start",()=>{});l(this,"update",()=>{let{initialSelectedIds:e,shapesToTest:t,app:{metaKey:n,settings:o,originPoint:s,currentPoint:a}}=this,d=Aa.Utils.getBoundsFromPoints([s,a]),i=o.isCadSelectMode?!n&&s[0]<a[0]:n,c=new Set,u=new Set(e);t.forEach(({id:g,selectId:f})=>{let T=this.app.getShape(g);if(!c.has(f)){let x=this.app.getShapeUtil(T);(i?Aa.Utils.boundsContain(d,x.getBounds(T)):x.hitTestBounds(T,d))?(c.add(f),u.has(f)||u.add(f)):u.has(f)&&u.delete(f)}});let p=this.app.selectedIds,m=u.size!==p.length||p.some(g=>!u.has(g)),h=m?Array.from(u.values()):p;return m?{appState:{selectByContain:i},document:{pageStates:{[this.app.currentPageId]:{brush:d,selectedIds:h}}}}:{appState:{selectByContain:i},document:{pageStates:{[this.app.currentPageId]:{brush:d}}}}});l(this,"cancel",()=>({appState:{selectByContain:!1},document:{pageStates:{[this.app.currentPageId]:{brush:null,selectedIds:Array.from(this.initialSelectedIds.values())}}}}));l(this,"complete",()=>({appState:{selectByContain:!1},document:{pageStates:{[this.app.currentPageId]:{brush:null,selectedIds:[...this.app.selectedIds]}}}}));let{currentPageId:t}=e;this.initialSelectedIds=new Set(this.app.selectedIds),this.shapesToTest=this.app.shapes.filter(n=>!(n.isLocked||n.isHidden||n.parentId!==t||this.initialSelectedIds.has(n.id)||this.initialSelectedIds.has(n.parentId))).map(n=>({id:n.id,bounds:this.app.getShapeUtil(n).getBounds(n),selectId:n.id})),this.update()}};var nt=require("@tldraw/vec");var Ha=class extends Je{constructor(e,t){super(e);l(this,"type","draw");l(this,"performanceMode");l(this,"status","creating");l(this,"topLeft");l(this,"points");l(this,"initialShape");l(this,"lastAdjustedPoint");l(this,"shiftedPoints",[]);l(this,"shapeId");l(this,"isLocked");l(this,"isExtending");l(this,"lockedDirection");l(this,"start",()=>{var s;let e=this.app.originPoint,t=[0,0,(s=e[2])!=null?s:.5];this.points.push(t);let n=[Math.min(this.topLeft[0],e[0]),Math.min(this.topLeft[1],e[1])],o=nt.Vec.sub(n,e);return this.topLeft=n,this.shiftedPoints=this.points.map(a=>nt.Vec.toFixed(nt.Vec.sub(a,o)).concat(a[2])),{document:{pages:{[this.app.currentPageId]:{shapes:{[this.shapeId]:{point:this.topLeft,points:this.shiftedPoints}}}},pageStates:{[this.app.currentPageId]:{selectedIds:[this.shapeId]}}}}});l(this,"update",()=>{let{shapeId:e}=this,{currentPoint:t,originPoint:n,shiftKey:o,zoom:s}=this.app;if(!this.lockedDirection&&this.points.length>1){let d=nt.Vec.sub(t,n);nt.Vec.len(d)>3/s&&(this.lockedDirection=Math.abs(d[0])>Math.abs(d[1])?"horizontal":"vertical")}if(o){if(!this.isLocked&&this.points.length>2){if(!this.lockedDirection){let i=nt.Vec.sub(t,n);nt.Vec.len(i)>3/s&&(this.lockedDirection=Math.abs(i[0])>Math.abs(i[1])?"horizontal":"vertical")}this.isLocked=!0;let d=[...this.lastAdjustedPoint];this.lockedDirection==="vertical"?d[0]=0:d[1]=0,this.points.push(d.concat(t[2]))}}else this.isLocked&&(this.isLocked=!1);this.isLocked&&(this.lockedDirection==="vertical"?t[0]=n[0]:t[1]=n[1]);let a=this.addPoint(t);if(!!a)return{document:{pages:{[this.app.currentPageId]:{shapes:{[e]:a}}},pageStates:{[this.app.currentPageId]:{selectedIds:[e]}}}}});l(this,"cancel",()=>{let{shapeId:e}=this,t=this.app.currentPageId;return{document:{pages:{[t]:{shapes:{[e]:this.isExtending?this.initialShape:void 0}}},pageStates:{[t]:{selectedIds:[]}}}}});l(this,"complete",()=>{let{shapeId:e}=this,t=this.app.currentPageId,n=this.app.getShape(e);return{id:"create_draw",before:{document:{pages:{[t]:{shapes:{[e]:this.isExtending?this.initialShape:void 0}}},pageStates:{[t]:{selectedIds:[]}}}},after:{document:{pages:{[t]:{shapes:{[e]:w(S({},n),{point:nt.Vec.toFixed(n.point),points:n.points.map(o=>nt.Vec.toFixed(o)),isComplete:!0})}}},pageStates:{[this.app.currentPageId]:{selectedIds:[]}}}}}});l(this,"addPoint",e=>{let{originPoint:t}=this.app,n=nt.Vec.toFixed(nt.Vec.sub(e,t)).concat(e[2]);if(nt.Vec.isEqual(this.lastAdjustedPoint,n))return;this.points.push(n),this.lastAdjustedPoint=n;let o=[...this.topLeft],s=[Math.min(this.topLeft[0],e[0]),Math.min(this.topLeft[1],e[1])],a=nt.Vec.sub(s,t),d;return o[0]!==s[0]||o[1]!==s[1]?(this.topLeft=s,d=this.points.map(i=>nt.Vec.toFixed(nt.Vec.sub(i,a)).concat(i[2]))):d=[...this.shiftedPoints,nt.Vec.sub(n,a).concat(n[2])],this.shiftedPoints=d,{point:this.topLeft,points:d}});var i;let{originPoint:n}=this.app;this.shapeId=t,this.initialShape=this.app.getShape(t),this.topLeft=[...this.initialShape.point];let o=[0,0,(i=n[2])!=null?i:.5],s=nt.Vec.sub(n,this.topLeft),a=this.initialShape.points.map(c=>nt.Vec.sub(c,s).concat(c[2]));this.isExtending=a.length>0;let d=[];if(this.isExtending){let c=a[a.length-1];if(c){d.push(c,c);let u=Math.floor(nt.Vec.dist(c,o)/16);if(u>1)for(let p=0;p<u;p++){let m=p/(u-1);d.push(nt.Vec.lrp(c,o,m).concat(c[2]))}else d.push(o,o)}}else d.push(o);this.points=[...a,...d],this.shiftedPoints=this.points.map(c=>nt.Vec.add(c,s).concat(c[2])),this.lastAdjustedPoint=this.points[this.points.length-1]}};var za=class extends Je{constructor(e,t,n){super(e);l(this,"type","edit");l(this,"performanceMode");l(this,"initialShape");l(this,"initialSelectedIds");l(this,"currentPageId");l(this,"isCreating");l(this,"start",()=>{});l(this,"update",()=>{});l(this,"cancel",()=>({document:{pages:{[this.currentPageId]:{shapes:{[this.initialShape.id]:this.isCreating?void 0:this.initialShape}}},pageStates:{[this.currentPageId]:{selectedIds:this.isCreating?[]:this.initialSelectedIds,editingId:void 0}}}}));l(this,"complete",()=>{let e=this.app.getShape(this.initialShape.id);return{id:"edit",before:{document:{pages:{[this.currentPageId]:{shapes:{[this.initialShape.id]:this.isCreating?void 0:this.initialShape}}},pageStates:{[this.currentPageId]:{selectedIds:this.isCreating?[]:this.initialSelectedIds,editingId:void 0}}}},after:{document:{pages:{[this.currentPageId]:{shapes:{[this.initialShape.id]:e}}},pageStates:{[this.currentPageId]:{selectedIds:[e.id],editingId:void 0}}}}}});this.initialShape=e.getShape(t,e.currentPageId),this.currentPageId=e.currentPageId,this.isCreating=n,this.initialSelectedIds=[...e.selectedIds]}};var Co=require("@tldraw/vec");var Oa=class extends Je{constructor(e){super(e);l(this,"type","draw");l(this,"performanceMode");l(this,"status","creating");l(this,"isLocked");l(this,"lockedDirection");l(this,"erasedShapes",new Set);l(this,"erasedBindings",new Set);l(this,"initialSelectedShapes");l(this,"erasableShapes");l(this,"prevPoint");l(this,"prevEraseShapesSize",0);l(this,"interval");l(this,"timestamp1",0);l(this,"timestamp2",0);l(this,"prevErasePoint",[]);l(this,"loop",()=>{let e=Date.now(),t=e-this.timestamp1,n=e-this.timestamp2,{eraseLine:o}=this.app.appState,s=[...o],a=!1;t>16&&this.prevErasePoint!==this.prevPoint&&(a=!0,s=[...o,this.prevPoint],this.prevErasePoint=this.prevPoint),n>32&&s.length>1&&(a=!0,s.splice(0,Math.ceil(s.length*.1)),this.timestamp2=e),a&&this.app.patchState({appState:{eraseLine:s}},"eraseline"),this.interval=requestAnimationFrame(this.loop)});l(this,"start",()=>{});l(this,"update",()=>{let{page:e,shiftKey:t,originPoint:n,currentPoint:o,zoom:s}=this.app;if(t){let c=Co.Vec.sub(o,n);if(!this.isLocked&&Co.Vec.len(c)>3/s){if(!this.lockedDirection){let u=Co.Vec.sub(o,n);this.lockedDirection=Math.abs(u[0])>Math.abs(u[1])?"horizontal":"vertical"}this.isLocked=!0}}else this.isLocked&&(this.isLocked=!1);this.isLocked&&(this.lockedDirection==="vertical"?o[0]=n[0]:o[1]=n[1]);let a=Co.Vec.toFixed(Co.Vec.add(n,Co.Vec.sub(o,n))),d=new Set([]);this.erasableShapes.forEach(c=>{if(!this.erasedShapes.has(c)&&this.app.getShapeUtil(c).hitTestLineSegment(c,this.prevPoint,a)&&(this.erasedShapes.add(c),d.add(c.id),c.children!==void 0))for(let u of c.children)this.erasedShapes.add(this.app.getShape(u)),d.add(u)}),Object.values(e.bindings).forEach(c=>{for(let u of[c.toId,c.fromId])d.has(u)&&this.erasedBindings.add(c)}),this.erasedShapes.forEach(c=>{this.app.getShape(c.id)||(this.erasedShapes.delete(c),this.erasableShapes.delete(c),d.delete(c.id))});let i=Array.from(this.erasedShapes.values());if(this.prevPoint=a,i.length!==this.prevEraseShapesSize)return this.prevEraseShapesSize=i.length,{document:{pages:{[e.id]:{shapes:Object.fromEntries(i.map(c=>[c.id,{isGhost:!0}]))}}}}});l(this,"cancel",()=>{let{page:e}=this.app;cancelAnimationFrame(this.interval),this.erasedShapes.forEach(n=>{this.app.getShape(n.id)||(this.erasedShapes.delete(n),this.erasableShapes.delete(n))});let t=Array.from(this.erasedShapes.values());return{document:{pages:{[e.id]:{shapes:Object.fromEntries(t.map(n=>[n.id,{isGhost:!1}]))}},pageStates:{[e.id]:{selectedIds:this.initialSelectedShapes.map(n=>n.id)}}},appState:{eraseLine:[]}}});l(this,"complete",()=>{let{page:e}=this.app;cancelAnimationFrame(this.interval),this.erasedShapes.forEach(i=>{this.app.getShape(i.id)||(this.erasedShapes.delete(i),this.erasableShapes.delete(i))}),this.erasedBindings.forEach(i=>{this.app.getBinding(i.id)||this.erasedBindings.delete(i)});let t=Array.from(this.erasedShapes.values()),n=Array.from(this.erasedBindings.values()),o=t.map(i=>i.id),s=n.map(i=>i.id),a={shapes:Object.fromEntries(t.map(i=>[i.id,i])),bindings:Object.fromEntries(n.map(i=>[i.id,i]))},d={shapes:Object.fromEntries(t.map(i=>[i.id,void 0])),bindings:Object.fromEntries(n.map(i=>[i.id,void 0]))};return this.app.shapes.forEach(i=>{i.handles&&!d.shapes[i.id]&&Object.values(i.handles).forEach(c=>{var u,p;c.bindingId&&s.includes(c.bindingId)&&(a.shapes[i.id]=w(S({},a.shapes[i.id]),{handles:w(S({},(u=a.shapes[i.id])==null?void 0:u.handles),{[c.id]:c})}),o.includes(i.id)||(d.shapes[i.id]=w(S({},d.shapes[i.id]),{handles:w(S({},(p=d.shapes[i.id])==null?void 0:p.handles),{[c.id]:w(S({},c),{bindingId:void 0})})})))})}),{id:"erase",before:{document:{pages:{[e.id]:a},pageStates:{[e.id]:{selectedIds:this.initialSelectedShapes.filter(i=>!!this.app.getShape(i.id)).map(i=>i.id)}}},appState:{eraseLine:[]}},after:{document:{pages:{[e.id]:d},pageStates:{[e.id]:{selectedIds:this.initialSelectedShapes.filter(i=>!!this.app.getShape(i.id)).filter(i=>!o.includes(i.id)).map(i=>i.id)}}},appState:{eraseLine:[]}}}});this.prevPoint=[...e.originPoint],this.initialSelectedShapes=this.app.selectedIds.map(t=>this.app.getShape(t)),this.erasableShapes=new Set(this.app.shapes.filter(t=>!t.isLocked)),this.interval=this.loop()}};var Fa=require("@tldraw/core"),ja=require("@tldraw/vec");var Ga=class extends Je{constructor(e,t){super(e);l(this,"type","grid");l(this,"performanceMode");l(this,"status","translating");l(this,"shape");l(this,"bounds");l(this,"initialSelectedIds");l(this,"initialSiblings");l(this,"grid",{});l(this,"columns",1);l(this,"rows",1);l(this,"isCopying",!1);l(this,"start",()=>{});l(this,"update",()=>{let{currentPageId:e,altKey:t,shiftKey:n,currentPoint:o}=this.app,s={},a={},d=Fa.Utils.getBoundsCenter(this.bounds),i=ja.Vec.sub(o,d);n&&(Math.abs(i[0])<Math.abs(i[1])?i[0]=0:i[1]=0);let c=this.bounds.width+32,u=this.bounds.height+32,p=Math.ceil(i[0]/c),m=Math.ceil(i[1]/u),h=Math.min(p,0),g=Math.min(m,0),f=Math.max(p,1),T=Math.max(m,1),x=new Set,b=t;b!==this.isCopying&&(Object.values(this.grid).filter(y=>y!==this.shape.id).forEach(y=>s[y]=void 0),this.grid={"0_0":this.shape.id},this.isCopying=b);for(let y=h;y<f;y++)for(let R=g;R<T;R++){let K=`${y}_${R}`;if(x.add(K),this.grid[K]||y===0&&R===0)continue;let L=this.getClone(ja.Vec.add(this.shape.point,[y*c,R*u]),b);s[L.id]=L,this.grid[K]=L.id}if(Object.entries(this.grid).forEach(([y,R])=>{x.has(y)||(s[R]=void 0,delete this.grid[y])}),Object.values(s).length!==0)return this.initialSiblings&&(s[this.shape.parentId]={children:[...this.initialSiblings,...Object.values(this.grid)]}),{document:{pages:{[e]:{shapes:s}},pageStates:{[e]:a}}}});l(this,"cancel",()=>{let{currentPageId:e}=this.app,t={};return Object.values(this.grid).forEach(n=>{t[n]=void 0}),t[this.shape.id]=w(S({},t[this.shape.id]),{point:this.shape.point}),this.initialSiblings&&(t[this.shape.parentId]={children:[...this.initialSiblings,this.shape.id]}),{document:{pages:{[e]:{shapes:t}},pageStates:{[e]:{selectedIds:[this.shape.id]}}}}});l(this,"complete",()=>{let{currentPageId:e}=this.app,t={},n={},o=[];if(Object.values(this.grid).forEach(s=>{t[s]=void 0,n[s]=this.app.getShape(s),o.push(s)}),t[this.shape.id]=this.shape,this.initialSiblings&&(t[this.shape.parentId]={children:[...this.initialSiblings,this.shape.id]},n[this.shape.parentId]={children:[...this.initialSiblings,...Object.values(this.grid)]}),o.length!==1)return{id:"grid",before:{document:{pages:{[e]:{shapes:t}},pageStates:{[e]:{selectedIds:[],hoveredId:void 0}}}},after:{document:{pages:{[e]:{shapes:n}},pageStates:{[e]:{selectedIds:o,hoveredId:void 0}}}}}});l(this,"getClone",(e,t)=>{let n=w(S({},this.shape),{id:Fa.Utils.uniqueId(),point:e});return t||n.type==="sticky"&&(n.text=""),n});var n;this.shape=this.app.getShape(t),this.grid["0_0"]=this.shape.id,this.bounds=this.app.getShapeBounds(t),this.initialSelectedIds=[...this.app.selectedIds],this.shape.parentId!==this.app.currentPageId&&(this.initialSiblings=(n=this.app.getShape(this.shape.parentId).children)==null?void 0:n.filter(o=>o!==this.shape.id))}};var ti=require("@tldraw/vec");var Va=class extends Je{constructor(e,t,n,o="move_handle"){super(e);l(this,"type","handle");l(this,"performanceMode");l(this,"status","translatingHandle");l(this,"commandId");l(this,"topLeft");l(this,"shiftKey",!1);l(this,"initialShape");l(this,"handleId");l(this,"start",()=>{});l(this,"update",()=>{var u,p;let{initialShape:e,app:{currentPageId:t,currentPoint:n}}=this,o=this.app.getShape(e.id);if(o.isLocked)return;let s=o.handles,a=this.handleId,d=ti.Vec.sub(n,s[a].point),i={[a]:w(S({},s[a]),{point:ti.Vec.sub(ti.Vec.add(s[a].point,d),o.point)})},c=(p=(u=k.getShapeUtil(o)).onHandleChange)==null?void 0:p.call(u,o,i);if(!!c)return{document:{pages:{[t]:{shapes:{[o.id]:c}}}}}});l(this,"cancel",()=>{let{initialShape:e,app:{currentPageId:t}}=this;return{document:{pages:{[t]:{shapes:{[e.id]:e}}}}}});l(this,"complete",()=>{let{initialShape:e,app:{currentPageId:t}}=this;return{id:this.commandId,before:{document:{pages:{[t]:{shapes:{[e.id]:e}}}}},after:{document:{pages:{[t]:{shapes:{[e.id]:k.onSessionComplete(this.app.getShape(this.initialShape.id))}}}}}}});let{originPoint:s}=e;this.topLeft=[...s],this.handleId=n,this.initialShape=this.app.getShape(t),this.commandId=o}};var Hr=require("@tldraw/core"),$a=require("@tldraw/vec");var Na=class extends Je{constructor(e){super(e);l(this,"type","rotate");l(this,"status","transforming");l(this,"performanceMode");l(this,"delta",[0,0]);l(this,"commonBoundsCenter");l(this,"initialAngle");l(this,"initialShapes");l(this,"changes",{});l(this,"start",()=>{});l(this,"update",()=>{let{commonBoundsCenter:e,initialShapes:t,app:{currentPageId:n,currentPoint:o,shiftKey:s}}=this,a={},d=$a.Vec.angle(e,o)-this.initialAngle;return s&&(d=Hr.Utils.snapAngleToSegments(d,24)),t.forEach(({center:i,shape:c})=>{let{rotation:u=0}=c,p=0;s&&(p=Hr.Utils.snapAngleToSegments(u,24)-u);let m=k.getRotatedShapeMutation(c,i,e,s?d+p:d);m&&(a[c.id]=m)}),this.changes=a,{document:{pages:{[n]:{shapes:a}}}}});l(this,"cancel",()=>{let{initialShapes:e,app:{currentPageId:t}}=this,n={};return e.forEach(({shape:o})=>n[o.id]=o),{document:{pages:{[t]:{shapes:n}}}}});l(this,"complete",()=>{let{initialShapes:e,app:{currentPageId:t}}=this,n={},o=this.changes;return e.forEach(({shape:{id:s,point:a,rotation:d,handles:i}})=>{n[s]={point:a,rotation:d,handles:i}}),{id:"rotate",before:{document:{pages:{[t]:{shapes:n}}}},after:{document:{pages:{[t]:{shapes:o}}}}}});let{app:{currentPageId:t,pageState:n,originPoint:o}}=this,s=k.getSelectedBranchSnapshot(e.state,t).filter(a=>!a.isLocked);if(s.length===0)throw Error("No selected shapes!");if(e.rotationInfo.selectedIds===n.selectedIds){if(e.rotationInfo.center===void 0)throw Error("We should have a center for rotation!");this.commonBoundsCenter=e.rotationInfo.center}else this.commonBoundsCenter=Hr.Utils.getBoundsCenter(Hr.Utils.getCommonBounds(s.map(k.getBounds))),e.rotationInfo.selectedIds=n.selectedIds,e.rotationInfo.center=this.commonBoundsCenter;this.initialShapes=s.filter(a=>a.children===void 0).map(a=>({shape:a,center:this.app.getShapeUtil(a).getCenter(a)})),this.initialAngle=$a.Vec.angle(this.commonBoundsCenter,o)}};var St=require("@tldraw/core"),Do=require("@tldraw/vec");var Wa=class extends Je{constructor(e,t=St.TLBoundsCorner.BottomRight,n=!1){super(e);this.transformType=t;this.isCreate=n;l(this,"type","transform");l(this,"performanceMode");l(this,"status","transforming");l(this,"scaleX",1);l(this,"scaleY",1);l(this,"initialShapes");l(this,"initialShapeIds");l(this,"initialSelectedIds");l(this,"shapeBounds");l(this,"hasUnlockedShapes");l(this,"isAllAspectRatioLocked");l(this,"initialCommonBounds");l(this,"snapInfo",{state:"empty"});l(this,"prevPoint",[0,0]);l(this,"speed",1);l(this,"start",()=>{this.snapInfo={state:"ready",bounds:this.app.shapes.filter(e=>!this.initialShapeIds.includes(e.id)).map(e=>St.Utils.getBoundsWithCenter(k.getRotatedBounds(e)))}});l(this,"update",()=>{let{transformType:e,shapeBounds:t,initialCommonBounds:n,isAllAspectRatioLocked:o,app:{currentPageId:s,pageState:{camera:a},viewport:d,currentPoint:i,previousPoint:c,originPoint:u,shiftKey:p,altKey:m,metaKey:h,currentGrid:g,settings:{isSnapping:f,showGrid:T}}}=this,x={},b=m?Do.Vec.mul(Do.Vec.sub(i,u),2):Do.Vec.sub(i,u),y=St.Utils.getTransformedBoundingBox(n,e,b,0,p||o);m&&(y=S(S({},y),St.Utils.centerBounds(y,St.Utils.getBoundsCenter(n)))),T&&(y=S(S({},y),St.Utils.snapBoundsToGrid(y,g)));let K=Do.Vec.dist(i,c)-this.speed;this.speed=this.speed+K*(K>1?.5:.15);let L=[];if((f&&!h||!f&&h)&&this.speed*a.zoom<10&&this.snapInfo.state==="ready"){let v=St.Utils.getSnapPoints(St.Utils.getBoundsWithCenter(y),this.snapInfo.bounds.filter(I=>St.Utils.boundsContain(d,I)||St.Utils.boundsCollide(d,I)),5/a.zoom);v&&(L=v.snapLines,y=St.Utils.getTransformedBoundingBox(n,e,Do.Vec.sub(b,v.offset),0,p||o))}return this.scaleX=y.scaleX,this.scaleY=y.scaleY,t.forEach(({initialShape:v,initialShapeBounds:I,transformOrigin:J})=>{let ce=St.Utils.getRelativeTransformedBoundingBox(y,n,I,this.scaleX<0,this.scaleY<0);T&&(ce=St.Utils.snapBoundsToGrid(ce,g));let de=k.transform(this.app.getShape(v.id),ce,{type:this.transformType,initialShape:v,scaleX:this.scaleX,scaleY:this.scaleY,transformOrigin:J});x[v.id]=de}),{appState:{snapLines:L},document:{pages:{[s]:{shapes:x}}}}});l(this,"cancel",()=>{let{shapeBounds:e,app:{currentPageId:t}}=this,n={};return this.isCreate?e.forEach(o=>n[o.initialShape.id]=void 0):e.forEach(o=>n[o.initialShape.id]=o.initialShape),{appState:{snapLines:[]},document:{pages:{[t]:{shapes:n}},pageStates:{[t]:{selectedIds:this.isCreate?[]:e.map(o=>o.initialShape.id)}}}}});l(this,"complete",()=>{let{isCreate:e,shapeBounds:t,hasUnlockedShapes:n,app:{currentPageId:o}}=this;if(!n)return;if(this.isCreate&&Do.Vec.dist(this.app.originPoint,this.app.currentPoint)<2)return this.cancel();let s={},a={},d,i;return e?(d=[],i=[],t.forEach(({initialShape:c})=>{s[c.id]=void 0,a[c.id]=this.app.getShape(c.id)})):(d=this.initialSelectedIds,i=this.initialSelectedIds,t.forEach(({initialShape:c})=>{s[c.id]=c,a[c.id]=this.app.getShape(c.id)})),{id:"transform",before:{appState:{snapLines:[]},document:{pages:{[o]:{shapes:s}},pageStates:{[o]:{selectedIds:d,hoveredId:void 0,editingId:void 0}}}},after:{appState:{snapLines:[]},document:{pages:{[o]:{shapes:a}},pageStates:{[o]:{selectedIds:i,hoveredId:void 0,editingId:void 0}}}}}});this.initialSelectedIds=[...this.app.selectedIds],this.app.rotationInfo.selectedIds=[...this.initialSelectedIds],this.initialShapes=k.getSelectedBranchSnapshot(this.app.state,this.app.currentPageId).filter(d=>!d.isLocked),this.initialShapeIds=this.initialShapes.map(d=>d.id),this.hasUnlockedShapes=this.initialShapes.length>0,this.isAllAspectRatioLocked=this.initialShapes.every(d=>d.isAspectRatioLocked||k.getShapeUtil(d).isAspectRatioLocked);let o=Object.fromEntries(this.initialShapes.map(d=>[d.id,k.getBounds(d)])),s=Object.values(o);this.initialCommonBounds=St.Utils.getCommonBounds(s);let a=St.Utils.getBoundsFromPoints(s.map(St.Utils.getBoundsCenter));this.shapeBounds=this.initialShapes.map(d=>{let i=o[d.id],c=St.Utils.getBoundsCenter(i),u=(c[0]-a.minX)/a.width,p=(c[1]-a.minY)/a.height;return{initialShape:d,initialShapeBounds:i,transformOrigin:[u,p]}})}};var mn=require("@tldraw/core"),uo=require("@tldraw/vec");var Ua=class extends Je{constructor(e,t,n,o=!1){super(e);l(this,"type","transformSingle");l(this,"status","transforming");l(this,"performanceMode");l(this,"transformType");l(this,"scaleX",1);l(this,"scaleY",1);l(this,"isCreate");l(this,"initialShape");l(this,"initialShapeBounds");l(this,"initialCommonBounds");l(this,"snapInfo",{state:"empty"});l(this,"prevPoint",[0,0]);l(this,"speed",1);l(this,"start",()=>{this.snapInfo={state:"ready",bounds:this.app.shapes.filter(e=>e.id!==this.initialShape.id).map(e=>mn.Utils.getBoundsWithCenter(k.getRotatedBounds(e)))}});l(this,"update",()=>{let{transformType:e,initialShape:t,initialShapeBounds:n,app:{settings:{isSnapping:o,showGrid:s},currentPageId:a,pageState:{camera:d},viewport:i,currentPoint:c,previousPoint:u,originPoint:p,currentGrid:m,shiftKey:h,altKey:g,metaKey:f}}=this;if(t.isLocked)return;let T={},x=g?uo.Vec.mul(uo.Vec.sub(c,p),2):uo.Vec.sub(c,p),b=this.app.getShape(t.id),y=k.getShapeUtil(b),R=mn.Utils.getTransformedBoundingBox(n,e,x,b.rotation,h||b.isAspectRatioLocked||y.isAspectRatioLocked);g&&(R=S(S({},R),mn.Utils.centerBounds(R,mn.Utils.getBoundsCenter(n)))),s&&(R=S(S({},R),mn.Utils.snapBoundsToGrid(R,m)));let L=uo.Vec.dist(c,u)-this.speed;this.speed=this.speed+L*(L>1?.5:.15);let v=[];if((o&&!f||!o&&f)&&!t.rotation&&this.speed*d.zoom<10&&this.snapInfo.state==="ready"){let J=mn.Utils.getSnapPoints(mn.Utils.getBoundsWithCenter(R),this.snapInfo.bounds.filter(ce=>mn.Utils.boundsContain(i,ce)||mn.Utils.boundsCollide(i,ce)),5/d.zoom);J&&(v=J.snapLines,R=mn.Utils.getTransformedBoundingBox(n,e,uo.Vec.sub(x,J.offset),b.rotation,h||b.isAspectRatioLocked||y.isAspectRatioLocked))}let I=k.getShapeUtil(b).transformSingle(b,R,{initialShape:t,type:this.transformType,scaleX:R.scaleX,scaleY:R.scaleY,transformOrigin:[.5,.5]});return I&&(T[b.id]=I),s&&I&&I.point&&(I.point=uo.Vec.snap(I.point,m)),{appState:{snapLines:v},document:{pages:{[a]:{shapes:T}}}}});l(this,"cancel",()=>{let{initialShape:e,app:{currentPageId:t}}=this,n={};return this.isCreate?n[e.id]=void 0:n[e.id]=e,{appState:{snapLines:[]},document:{pages:{[t]:{shapes:n}},pageStates:{[t]:{selectedIds:this.isCreate?[]:[e.id]}}}}});l(this,"complete",()=>{let{initialShape:e,app:{currentPageId:t}}=this;if(e.isLocked)return;if(this.isCreate&&uo.Vec.dist(this.app.originPoint,this.app.currentPoint)<2)return this.cancel();let n={},o={};return n[e.id]=this.isCreate?void 0:e,o[e.id]=k.onSessionComplete(this.app.getShape(e.id)),{id:"transform_single",before:{appState:{snapLines:[]},document:{pages:{[t]:{shapes:n}},pageStates:{[t]:{selectedIds:this.isCreate?[]:[e.id],editingId:void 0,hoveredId:void 0}}}},after:{appState:{snapLines:[]},document:{pages:{[t]:{shapes:o}},pageStates:{[t]:{selectedIds:[e.id],editingId:void 0,hoveredId:void 0}}}}}});this.isCreate=o,this.transformType=n;let s=this.app.getShape(t);this.initialShape=s,this.initialShapeBounds=k.getBounds(s),this.initialCommonBounds=k.getRotatedBounds(s),this.app.rotationInfo.selectedIds=[s.id]}};var Ft=require("@tldraw/core"),We=require("@tldraw/vec");var Ka=class extends Je{constructor(e,t=!1,n=!1){super(e);l(this,"performanceMode");l(this,"type","translate");l(this,"status","translating");l(this,"delta",[0,0]);l(this,"prev",[0,0]);l(this,"prevPoint",[0,0]);l(this,"speed",1);l(this,"cloneInfo",{state:"empty"});l(this,"snapInfo",{state:"empty"});l(this,"snapLines",[]);l(this,"isCloning",!1);l(this,"isCreate");l(this,"link");l(this,"initialIds");l(this,"hasUnlockedShapes");l(this,"initialSelectedIds");l(this,"initialCommonBounds");l(this,"initialShapes");l(this,"initialParentChildren");l(this,"bindingsToDelete");l(this,"start",()=>{let{bindingsToDelete:e,initialIds:t,app:{currentPageId:n,page:o}}=this,s=[],a=[];if(Object.values(o.shapes).forEach(c=>{let u=Ft.Utils.getBoundsWithCenter(k.getRotatedBounds(c));s.push(u),t.has(c.id)||a.push(u)}),this.snapInfo={state:"ready",bounds:s,others:a},e.length===0)return;let d={},i={};return e.forEach(c=>{d[c.id]=void 0;let u=this.app.getShape(c.fromId);i[c.fromId]={handles:w(S({},u.handles),{[c.handleId]:w(S({},u.handles[c.handleId]),{bindingId:void 0})})}}),{document:{pages:{[n]:{bindings:d,shapes:i}}}}});l(this,"update",()=>{let{initialParentChildren:e,initialShapes:t,initialCommonBounds:n,bindingsToDelete:o,app:{pageState:{camera:s},settings:{isSnapping:a,showGrid:d},currentPageId:i,viewport:c,selectedIds:u,currentPoint:p,previousPoint:m,originPoint:h,altKey:g,shiftKey:f,metaKey:T,currentGrid:x}}=this,b={},y={},R={},K=We.Vec.sub(p,h),L=!1;this.isCreate||(g&&!this.isCloning?(this.isCloning=!0,L=!0):!g&&this.isCloning&&(this.isCloning=!1,L=!0)),f&&(Math.abs(K[0])<Math.abs(K[1])?K[0]=0:K[1]=0);let I=We.Vec.dist(p,m)-this.speed;if(this.speed=this.speed+I*(I>1?.5:.15),this.snapLines=[],(a&&!T||!a&&T)&&this.speed*s.zoom<10&&this.snapInfo.state==="ready"){let J=Ft.Utils.getSnapPoints(Ft.Utils.getBoundsWithCenter(d?Ft.Utils.snapBoundsToGrid(Ft.Utils.translateBounds(n,K),x):Ft.Utils.translateBounds(n,K)),(this.isCloning?this.snapInfo.bounds:this.snapInfo.others).filter(ce=>Ft.Utils.boundsContain(c,ce)||Ft.Utils.boundsCollide(c,ce)),5/s.zoom);J&&(this.snapLines=J.snapLines,K=We.Vec.sub(K,J.offset))}if(this.prev=K,this.isCloning)if(L){if(this.cloneInfo.state==="empty"&&this.createCloneInfo(),this.cloneInfo.state==="empty")throw Error;let{clones:J,clonedBindings:ce}=this.cloneInfo;this.isCloning=!0,o.forEach(de=>b[de.id]=de),t.forEach(de=>y[de.id]={point:de.point}),J.forEach(de=>{var He;if(y[de.id]=S({},de),de.parentId!==i&&!u.includes(de.parentId)){let Pe=((He=y[de.parentId])==null?void 0:He.children)||e[de.parentId];Pe.includes(de.id)||(y[de.parentId]=w(S({},y[de.parentId]),{children:[...Pe,de.id]}))}});for(let de of ce)b[de.id]=de;R.selectedIds=J.map(de=>de.id),J.forEach(de=>{y[de.id]=w(S({},de),{point:d?We.Vec.snap(We.Vec.toFixed(We.Vec.add(de.point,K)),x):We.Vec.toFixed(We.Vec.add(de.point,K))})})}else{if(this.cloneInfo.state==="empty")throw Error;let{clones:J}=this.cloneInfo;J.forEach(ce=>{y[ce.id]={point:d?We.Vec.snap(We.Vec.toFixed(We.Vec.add(ce.point,K)),x):We.Vec.toFixed(We.Vec.add(ce.point,K))}})}else if(L){if(this.cloneInfo.state==="empty")throw Error;let{clones:J,clonedBindings:ce}=this.cloneInfo;this.isCloning=!1,o.forEach(de=>b[de.id]=void 0),J.forEach(de=>{de.parentId!==i&&(y[de.parentId]=w(S({},y[de.parentId]),{children:e[de.parentId]}))}),J.forEach(de=>y[de.id]=void 0),t.forEach(de=>{y[de.id]={point:d?We.Vec.snap(We.Vec.toFixed(We.Vec.add(de.point,K)),x):We.Vec.toFixed(We.Vec.add(de.point,K))}});for(let de of ce)b[de.id]=void 0;R.selectedIds=t.map(de=>de.id)}else t.forEach(J=>{y[J.id]={point:d?We.Vec.snap(We.Vec.toFixed(We.Vec.add(J.point,K)),x):We.Vec.toFixed(We.Vec.add(J.point,K))}});return{appState:{snapLines:this.snapLines},document:{pages:{[i]:{shapes:y,bindings:b}},pageStates:{[i]:R}}}});l(this,"cancel",()=>{let{initialShapes:e,initialSelectedIds:t,bindingsToDelete:n,app:{currentPageId:o}}=this,s={},a={},d={editingId:void 0,hoveredId:void 0};if(this.isCreate?(e.forEach(({id:i})=>a[i]=void 0),d.selectedIds=[]):(e.forEach(({id:i,point:c,handles:u})=>a[i]=u?w(S({},a[i]),{point:c,handles:u}):w(S({},a[i]),{point:c})),d.selectedIds=t,n.forEach(i=>{s[i.id]=i})),this.cloneInfo.state==="ready"){let{clones:i,clonedBindings:c}=this.cloneInfo;i.forEach(u=>a[u.id]=void 0),c.forEach(u=>s[u.id]=void 0)}return{appState:{snapLines:[]},document:{pages:{[o]:{shapes:a,bindings:s}},pageStates:{[o]:d}}}});l(this,"complete",()=>{let{initialShapes:e,initialParentChildren:t,bindingsToDelete:n,app:{currentPageId:o}}=this,s={},a={},d={},i={};if(this.isCloning){if(this.cloneInfo.state==="empty"&&this.createCloneInfo(),this.cloneInfo.state!=="ready")throw Error;let{clones:c,clonedBindings:u}=this.cloneInfo;c.forEach(p=>{a[p.id]=void 0,i[p.id]=this.app.getShape(p.id),p.parentId!==o&&(a[p.parentId]=w(S({},a[p.parentId]),{children:t[p.parentId]}),i[p.parentId]=w(S({},i[p.parentId]),{children:this.app.getShape(p.parentId).children}))}),u.forEach(p=>{s[p.id]=void 0,d[p.id]=this.app.getBinding(p.id)})}else e.forEach(c=>{a[c.id]=this.isCreate?void 0:w(S({},a[c.id]),{point:c.point}),i[c.id]=S(S({},i[c.id]),this.isCreate?this.app.getShape(c.id):{point:this.app.getShape(c.id).point})});return n.forEach(c=>{var u,p,m,h,g;s[c.id]=c,a[c.fromId]=w(S({},a[c.fromId]),{id:c.fromId,handles:w(S({},(u=a[c.fromId])==null?void 0:u.handles),{[c.handleId]:w(S({},(m=(p=a[c.fromId])==null?void 0:p.handles)==null?void 0:m[c.handleId]),{bindingId:c.id})})}),i[c.fromId]=w(S({},i[c.fromId]),{id:c.fromId,handles:w(S({},i[c.fromId].handles),{[c.handleId]:w(S({},(g=(h=i[c.fromId])==null?void 0:h.handles)==null?void 0:g[c.handleId]),{bindingId:void 0})})})}),n.forEach(c=>d[c.id]=void 0),{id:"translate",before:{appState:{snapLines:[]},document:{pages:{[o]:{shapes:a,bindings:s}},pageStates:{[o]:{selectedIds:this.isCreate?[]:[...this.initialSelectedIds]}}}},after:{appState:{snapLines:[]},document:{pages:{[o]:{shapes:i,bindings:d}},pageStates:{[o]:{selectedIds:[...this.app.selectedIds]}}}}}});l(this,"createCloneInfo",()=>{let{initialShapes:e,initialParentChildren:t,app:{selectedIds:n,currentPageId:o,page:s}}=this,a={},d={},i=[],c=[];e.forEach(p=>{let m=Ft.Utils.uniqueId();t[m]=t[p.id],a[p.id]=m;let h=w(S({},Ft.Utils.deepClone(p)),{id:m,parentId:p.parentId,childIndex:k.getChildIndexAbove(this.app.state,p.id,o)});if(h.type==="video"){let g=document.getElementById(p.id+"_video");g&&(h.currentTime=(g.currentTime+16)%g.duration)}c.push(h)}),c.forEach(p=>{p.children!==void 0&&(p.children=p.children.map(m=>a[m]))}),c.forEach(p=>{n.includes(p.parentId)&&(p.parentId=a[p.parentId])});let u=new Set(Object.keys(a));Object.values(s.bindings).filter(p=>u.has(p.fromId)||u.has(p.toId)).forEach(p=>{if(u.has(p.fromId)&&u.has(p.toId)){let m=Ft.Utils.uniqueId(),h=w(S({},Ft.Utils.deepClone(p)),{id:m,fromId:a[p.fromId]||p.fromId,toId:a[p.toId]||p.toId});d[p.id]=m,i.push(h)}}),c.forEach(p=>{if(p.handles&&p.handles)for(let m in p.handles){let h=p.handles[m];h.bindingId=h.bindingId?d[h.bindingId]:void 0}}),c.forEach(p=>{if(s.shapes[p.id])throw Error("uh oh, we didn't clone correctly")}),this.cloneInfo={state:"ready",clones:c,cloneMap:a,clonedBindings:i}});this.isCreate=t,this.link=n;let{currentPageId:o,selectedIds:s,page:a}=this.app;this.initialSelectedIds=[...s];let d=(n?k.getLinkedShapeIds(this.app.state,o,n,!1):s).map(c=>this.app.getShape(c)).filter(c=>!c.isLocked),i=new Set(d.map(c=>c.id));this.hasUnlockedShapes=d.length>0,this.initialShapes=Array.from(new Set(d.filter(c=>!i.has(c.parentId)).flatMap(c=>c.children?[c,...c.children.map(u=>this.app.getShape(u))]:[c])).values()),this.initialIds=new Set(this.initialShapes.map(c=>c.id)),this.bindingsToDelete=[],Object.values(a.bindings).filter(c=>this.initialIds.has(c.fromId)||this.initialIds.has(c.toId)).forEach(c=>{this.initialIds.has(c.fromId)&&(this.initialIds.has(c.toId)||this.bindingsToDelete.push(c))}),this.initialParentChildren={},this.initialShapes.map(c=>c.parentId).filter(c=>c!==a.id).forEach(c=>{this.initialParentChildren[c]=this.app.getShape(c).children}),this.initialCommonBounds=Ft.Utils.getCommonBounds(this.initialShapes.map(k.getRotatedBounds)),this.app.rotationInfo.selectedIds=[...this.app.selectedIds]}};var ice={["arrow"]:Ra,["brush"]:La,["draw"]:Ha,["erase"]:Oa,["handle"]:Va,["rotate"]:Na,["transform"]:Wa,["transformSingle"]:Ua,["translate"]:Ka,["grid"]:Ga,["edit"]:za},Pp=r=>ice[r];var Ep=require("@tldraw/core"),Bp=V(require("@tldraw/vec"));var Mp=require("@tldraw/core");var at=class extends os{constructor(e){super();this.app=e;l(this,"type","select");l(this,"previous");l(this,"status","idle");l(this,"setStatus",e=>{this.status=e,this.app.setStatus(this.status)});l(this,"onEnter",()=>{this.setStatus("idle")});l(this,"onExit",()=>{this.setStatus("idle")});l(this,"onCancel",()=>{this.status==="idle"?this.app.selectTool("select"):this.setStatus("idle"),this.app.cancelSession()});l(this,"getNextChildIndex",()=>{let{shapes:e,appState:{currentPageId:t}}=this.app;return e.length===0?1:e.filter(n=>n.parentId===t).sort((n,o)=>o.childIndex-n.childIndex)[0].childIndex+1});l(this,"onPinchStart",()=>{this.app.cancelSession(),this.setStatus("pinching")});l(this,"onPinchEnd",()=>{Mp.Utils.isMobileSafari()&&this.app.undoSelect(),this.setStatus("idle")});l(this,"onPinch",(e,t)=>{var n;this.status==="pinching"&&(isNaN(e.delta[0])||isNaN(e.delta[1])||(this.app.pinchZoom(e.point,e.delta,e.delta[2]),(n=this.onPointerMove)==null||n.call(this,e,t)))});l(this,"onKeyDown",e=>{if(e==="Escape"){this.onCancel();return}if(e==="Meta"||e==="Control"||e==="Alt"){this.app.updateSession();return}});l(this,"onKeyUp",e=>{if(e==="Meta"||e==="Control"||e==="Alt"){this.app.updateSession();return}});l(this,"onPointerMove",()=>{this.status==="creating"&&this.app.updateSession()});l(this,"onPointerUp",()=>{if(this.status==="creating"){this.app.completeSession();let{isToolLocked:e}=this.app.appState;e||this.app.selectTool("select")}this.setStatus("idle")})}};var Fr=class extends at{constructor(){super(...arguments);l(this,"type","arrow");l(this,"onPointerDown",()=>{if(this.status!=="idle")return;let{currentPoint:e,currentGrid:t,settings:{showGrid:n},appState:{currentPageId:o,currentStyle:s}}=this.app,a=this.getNextChildIndex(),d=Ep.Utils.uniqueId(),i=Qo.create({id:d,parentId:o,childIndex:a,point:n?Bp.default.snap(e,t):e,style:S({},s)});this.app.patchCreate([i]),this.app.startSession("arrow",i.id,"end",!0),this.setStatus("creating")})}};var Rp=require("@tldraw/core");var jr=class extends at{constructor(){super(...arguments);l(this,"type","draw");l(this,"lastShapeId");l(this,"onEnter",()=>{this.lastShapeId=void 0});l(this,"onCancel",()=>{switch(this.status){case"idle":{this.app.selectTool("select");break}default:{this.setStatus("idle");break}}this.app.cancelSession()});l(this,"onPointerDown",e=>{if(this.status!=="idle"||this.app.readOnly)return;let{currentPoint:t,appState:{currentPageId:n,currentStyle:o}}=this.app,s=this.lastShapeId&&this.app.getShape(this.lastShapeId);if(e.shiftKey&&s)this.app.startSession("draw",s.id),this.setStatus("extending");else{let a=this.getNextChildIndex(),d=Rp.Utils.uniqueId(),i=Ws.create({id:d,parentId:n,childIndex:a,point:t,style:S({},o)});this.lastShapeId=d,this.app.patchCreate([i]),this.app.startSession("draw",d),this.setStatus("creating")}});l(this,"onPointerMove",()=>{if(!this.app.readOnly)switch(this.status){case"extending":case"creating":this.app.updateSession()}});l(this,"onPointerUp",()=>{this.app.completeSession(),this.setStatus("idle")})}};var ni=require("@tldraw/core"),Ap=V(require("@tldraw/vec"));var Gr=class extends at{constructor(){super(...arguments);l(this,"type","ellipse");l(this,"onPointerDown",()=>{if(this.app.readOnly||this.status!=="idle")return;let{currentPoint:e,currentGrid:t,settings:{showGrid:n},appState:{currentPageId:o,currentStyle:s}}=this.app,a=this.getNextChildIndex(),d=ni.Utils.uniqueId(),i=Ns.create({id:d,parentId:o,childIndex:a,point:n?Ap.default.snap(e,t):e,style:S({},s)});this.app.patchCreate([i]),this.app.startSession("transformSingle",i.id,ni.TLBoundsCorner.BottomRight,!0),this.setStatus("creating")})}};var Lp=V(require("@tldraw/vec"));var Vr=class extends at{constructor(){super(...arguments);l(this,"type","erase");l(this,"status","idle");l(this,"onPointerDown",()=>{this.app.readOnly||this.status==="idle"&&this.setStatus("pointing")});l(this,"onPointerMove",e=>{if(!this.app.readOnly)switch(this.status){case"pointing":{Lp.default.dist(e.origin,e.point)>3&&(this.app.startSession("erase"),this.app.updateSession(),this.setStatus("erasing"));break}case"erasing":this.app.updateSession()}});l(this,"onPointerUp",()=>{if(!this.app.readOnly){switch(this.status){case"pointing":{let e=this.app.shapes.filter(t=>!t.isLocked).filter(t=>this.app.getShapeUtil(t).hitTestPoint(t,this.app.currentPoint)).flatMap(t=>t.children?[t.id,...t.children]:t.id);this.app.delete(e);break}case"erasing":this.app.completeSession()}this.setStatus("idle")}});l(this,"onCancel",()=>{this.status==="idle"?this.previous?this.app.selectTool(this.previous):this.app.selectTool("select"):this.setStatus("idle"),this.app.cancelSession()})}};var Hp=require("@tldraw/core"),zp=V(require("@tldraw/vec"));var $r=class extends at{constructor(){super(...arguments);l(this,"type","line");l(this,"onPointerDown",()=>{if(this.app.readOnly||this.status!=="idle")return;let{currentPoint:e,currentGrid:t,settings:{showGrid:n},appState:{currentPageId:o,currentStyle:s}}=this.app,a=this.getNextChildIndex(),d=Hp.Utils.uniqueId(),i=Qo.create({id:d,parentId:o,childIndex:a,point:n?zp.default.snap(e,t):e,decorations:{start:void 0,end:void 0},style:S({},s)});this.app.patchCreate([i]),this.app.startSession("arrow",i.id,"end",!0),this.setStatus("creating")})}};var oi=require("@tldraw/core"),Op=V(require("@tldraw/vec"));var Nr=class extends at{constructor(){super(...arguments);l(this,"type","rectangle");l(this,"onPointerDown",()=>{if(this.app.readOnly||this.status!=="idle")return;let{currentPoint:e,currentGrid:t,settings:{showGrid:n},appState:{currentPageId:o,currentStyle:s}}=this.app,a=this.getNextChildIndex(),d=oi.Utils.uniqueId(),i=Vs.create({id:d,parentId:o,childIndex:a,point:n?Op.default.snap(e,t):e,style:S({},s)});this.app.patchCreate([i]),this.app.startSession("transformSingle",i.id,oi.TLBoundsCorner.BottomRight,!0),this.setStatus("creating")})}};var ir=require("@tldraw/core"),Hn=V(require("@tldraw/vec"));var Wr=class extends at{constructor(){super(...arguments);l(this,"type","select");l(this,"pointedId");l(this,"selectedGroupId");l(this,"pointedHandleId");l(this,"pointedBoundsHandle");l(this,"pointedLinkHandleId");l(this,"onEnter",()=>{this.setStatus("idle")});l(this,"onExit",()=>{this.setStatus("idle")});l(this,"clonePaint",e=>{if(this.app.selectedIds.length===0)return;let t=this.app.selectedIds.map(c=>this.app.getShape(c)),n=ir.Utils.expandBounds(ir.Utils.getCommonBounds(t.map(k.getBounds)),16),o=ir.Utils.getBoundsCenter(n),s=[n.width,n.height],a=[o[0]+s[0]*Math.floor((e[0]+s[0]/2-o[0])/s[0]),o[1]+s[1]*Math.floor((e[1]+s[1]/2-o[1])/s[1])],d=ir.Utils.centerBounds(n,a);this.app.shapes.some(c=>k.getShapeUtil(c).hitTestBounds(c,d))||this.app.duplicate(this.app.selectedIds,a)});l(this,"getShapeClone",(e,t)=>{let n=this.app.getShape(e),o=k.getShapeUtil(n);if(o.canClone){let s=o.getBounds(n),a=o.getCenter(n),d={top:[s.minX,s.minY-(s.height+32)],right:[s.maxX+32,s.minY],bottom:[s.minX,s.maxY+32],left:[s.minX-(s.width+32),s.minY],topLeft:[s.minX-(s.width+32),s.minY-(s.height+32)],topRight:[s.maxX+32,s.minY-(s.height+32)],bottomLeft:[s.minX-(s.width+32),s.maxY+32],bottomRight:[s.maxX+32,s.maxY+32]}[t];if(n.rotation!==0){let u=Hn.default.add(d,[s.width/2,s.height/2]),p=Hn.default.rotWith(u,a,n.rotation||0);d=Hn.default.sub(p,[s.width/2,s.height/2])}let i=ir.Utils.uniqueId(),c=w(S({},n),{id:i,point:d});return c.type==="sticky"&&(c.text=""),c}});l(this,"onCancel",()=>{this.app.session?this.app.cancelSession():this.selectNone(),this.setStatus("idle")});l(this,"onKeyDown",(e,t,n)=>{switch(e){case"Escape":{this.onCancel();break}case"Tab":{if(this.app.readOnly)return;if(!this.app.pageState.editingId&&this.status==="idle"&&this.app.selectedIds.length===1){let[o]=this.app.selectedIds,s=this.getShapeClone(o,"right");s&&(this.app.createShapes(s),this.setStatus("idle"),s.type==="sticky"&&(this.app.select(s.id),this.app.setEditingId(s.id)))}break}case"Meta":case"Control":case"Alt":{this.app.updateSession();break}case"Enter":{if(this.app.readOnly)return;let{pageState:o}=this.app;o.selectedIds.length===1&&!o.editingId&&(this.app.setEditingId(o.selectedIds[0]),n.preventDefault())}}});l(this,"onKeyUp",(e,t)=>{if(this.status==="clonePainting"&&!(t.altKey&&t.shiftKey)){this.setStatus("idle");return}if(e==="Meta"||e==="Control"||e==="Alt"){this.app.updateSession();return}});l(this,"onPointerMove",()=>{let{originPoint:e,currentPoint:t}=this.app;if(this.app.readOnly&&this.app.isPointing){this.app.session?this.app.updateSession():Hn.default.dist(e,t)>3&&(this.app.startSession("brush"),this.setStatus("brushing"));return}switch(this.status){case"pointingBoundsHandle":{if(!this.pointedBoundsHandle)throw Error("No pointed bounds handle");if(Hn.default.dist(e,t)>3){if(this.pointedBoundsHandle==="rotate")this.setStatus("rotating"),this.app.startSession("rotate");else if(this.pointedBoundsHandle==="center"||this.pointedBoundsHandle==="left"||this.pointedBoundsHandle==="right")this.setStatus("translating"),this.app.startSession("translate",!1,this.pointedBoundsHandle);else{this.setStatus("transforming");let n=this.app.selectedIds.flatMap(o=>k.getDocumentBranch(this.app.state,o,this.app.currentPageId));n.length===1?this.app.startSession("transformSingle",n[0],this.pointedBoundsHandle):this.app.startSession("transform",this.pointedBoundsHandle)}this.app.updateSession()}break}case"pointingCanvas":{Hn.default.dist(e,t)>3&&(this.app.startSession("brush"),this.setStatus("brushing"));break}case"pointingClone":{Hn.default.dist(e,t)>3&&(this.setStatus("translatingClone"),this.app.startSession("translate"),this.app.updateSession());break}case"pointingBounds":{Hn.default.dist(e,t)>3&&(this.setStatus("translating"),this.app.startSession("translate"),this.app.updateSession());break}case"pointingHandle":{if(!this.pointedHandleId)throw Error("No pointed handle");if(Hn.default.dist(e,t)>3){this.setStatus("translatingHandle");let n=this.app.getShape(this.app.selectedIds[0]);n&&(this.pointedHandleId==="bend"?(this.app.startSession("handle",n.id,this.pointedHandleId),this.app.updateSession()):(this.app.startSession("arrow",n.id,this.pointedHandleId,!1),this.app.updateSession()))}break}case"clonePainting":{this.clonePaint(t);break}default:if(this.app.session){this.app.updateSession();break}}});l(this,"onPointerDown",(e,t)=>{if(e.target==="canvas"&&this.status==="idle"){let{currentPoint:n}=this.app;if(e.spaceKey&&t.buttons===1)return;if(this.status==="idle"&&e.altKey&&e.shiftKey){this.setStatus("clonePainting"),this.clonePaint(n);return}if(!e.shiftKey){if(this.app.onShapeBlur(),e.altKey&&this.app.selectedIds.length>0){this.app.duplicate(this.app.selectedIds,n);return}this.selectNone()}this.setStatus("pointingCanvas")}});l(this,"onPointerUp",e=>{var t;if(this.status==="translatingClone"||this.status==="pointingClone"){this.pointedId&&(this.app.completeSession(),this.app.setEditingId(this.pointedId)),this.setStatus("idle"),this.pointedId=void 0;return}if(this.status==="pointingBounds"){if(e.target==="bounds")this.selectNone();else if(this.app.isSelected(e.target))e.shiftKey?this.pointedId!==e.target&&this.deselect(e.target):this.pointedId!==e.target&&this.app.selectedIds.length>1&&this.select(e.target);else if(this.pointedId===e.target){if(this.app.getShape(e.target).isLocked)return;e.shiftKey?this.pushSelect(e.target):this.select(e.target)}}this.setStatus("idle"),this.pointedBoundsHandle=void 0,this.pointedHandleId=void 0,this.pointedId=void 0,((t=this.app.session)==null?void 0:t.type)!=="edit"&&this.app.completeSession()});l(this,"onDoubleClickCanvas",()=>{!this.app.readOnly});l(this,"onPointShape",(e,t)=>{if(e.spaceKey&&t.buttons===1||this.app.getShape(e.target).isLocked)return;let{editingId:n,hoveredId:o}=this.app.pageState;if(n&&e.target!==n&&this.app.onShapeBlur(),(this.status==="idle"||this.status==="pointingBounds")&&e.metaKey&&e.shiftKey&&o){this.pointedId=o,this.app.isSelected(o)?this.deselect(o):(this.pushSelect(o),this.setStatus("pointingBounds"));return}if(this.status==="pointingBounds"){let{parentId:s}=this.app.getShape(e.target);this.pointedId=s===this.app.currentPageId?e.target:s;return}if(this.status==="idle"){if(this.setStatus("pointingBounds"),e.metaKey){e.shiftKey||this.selectNone(),this.app.startSession("brush"),this.setStatus("brushing");return}let s,{parentId:a}=this.app.getShape(e.target);a===this.app.currentPageId?(s=e.target,this.selectedGroupId=void 0):a===this.selectedGroupId?s=e.target:(s=a,this.selectedGroupId=void 0),this.app.isSelected(s)||(this.pointedId=s,e.shiftKey?this.pushSelect(s):this.select(s))}});l(this,"onDoubleClickShape",e=>{if(this.app.readOnly)return;let t=this.app.getShape(e.target);if(t.isLocked){this.app.select(e.target);return}k.getShapeUtil(t.type).canEdit&&(t.parentId===this.app.currentPageId||t.parentId===this.selectedGroupId)&&this.app.setEditingId(e.target),t.parentId!==this.app.currentPageId&&(this.selectedGroupId=t.parentId),this.app.select(e.target)});l(this,"onRightPointShape",e=>{this.app.isSelected(e.target)||this.app.select(e.target)});l(this,"onHoverShape",e=>{this.app.setHoveredId(e.target)});l(this,"onUnhoverShape",e=>{let{currentPageId:t}=this.app;requestAnimationFrame(()=>{t===this.app.currentPageId&&this.app.pageState.hoveredId===e.target&&this.app.setHoveredId(void 0)})});l(this,"onPointBounds",e=>{if(e.metaKey){e.shiftKey||this.selectNone(),this.app.startSession("brush"),this.setStatus("brushing");return}this.setStatus("pointingBounds")});l(this,"onRightPointBounds",(e,t)=>{t.stopPropagation()});l(this,"onReleaseBounds",()=>{(this.status==="translating"||this.status==="brushing")&&this.app.completeSession(),this.setStatus("idle")});l(this,"onPointBoundsHandle",e=>{this.pointedBoundsHandle=e.target,this.setStatus("pointingBoundsHandle")});l(this,"onDoubleClickBoundsHandle",e=>{switch(e.target){case"center":case"left":case"right":{this.app.select(...k.getLinkedShapeIds(this.app.state,this.app.currentPageId,e.target,e.shiftKey));break}default:if(this.app.selectedIds.length===1){this.app.resetBounds(this.app.selectedIds);let t=this.app.getShape(this.app.selectedIds[0]);"label"in t&&this.app.setEditingId(t.id)}}});l(this,"onReleaseBoundsHandle",()=>{this.setStatus("idle")});l(this,"onPointHandle",e=>{this.pointedHandleId=e.target,this.setStatus("pointingHandle")});l(this,"onDoubleClickHandle",e=>{if(e.target==="bend"){let{selectedIds:t}=this.app;if(t.length!==1)return;let n=this.app.getShape(t[0]);k.getShapeUtil(n.type).canEdit&&(n.parentId===this.app.currentPageId||n.parentId===this.selectedGroupId)&&this.app.setEditingId(n.id);return}this.app.toggleDecoration(e.target)});l(this,"onReleaseHandle",()=>{this.setStatus("idle")});l(this,"onShapeClone",e=>{let t=this.app.selectedIds[0],n=this.getShapeClone(t,e.target);e.target==="left"||e.target==="right"||e.target==="top"||e.target==="bottom"?n&&(this.app.createShapes(n),this.pointedId=n.id,this.setStatus("pointingClone")):(this.setStatus("gridCloning"),this.app.startSession("grid",t))})}deselect(e){this.app.select(...this.app.selectedIds.filter(t=>t!==e))}select(e){this.app.select(e)}pushSelect(e){let t=this.app.getShape(e);this.app.select(...this.app.selectedIds.filter(n=>n!==t.parentId),e)}selectNone(){this.app.selectNone()}};var Fp=require("@tldraw/core"),_a=V(require("@tldraw/vec"));var Ur=class extends at{constructor(){super(...arguments);l(this,"type","sticky");l(this,"shapeId");l(this,"onPointerDown",()=>{if(!this.app.readOnly){if(this.status==="creating"){this.setStatus("idle"),this.app.appState.isToolLocked||this.app.selectTool("select");return}if(this.status==="idle"){let{currentPoint:e,currentGrid:t,settings:{showGrid:n},appState:{currentPageId:o,currentStyle:s}}=this.app,a=this.getNextChildIndex(),d=Fp.Utils.uniqueId();this.shapeId=d;let i=Pr.create({id:d,parentId:o,childIndex:a,point:n?_a.default.snap(e,t):e,style:S({},s)}),c=Pr.getBounds(i);i.point=_a.default.sub(i.point,[c.width/2,c.height/2]),this.app.patchCreate([i]),this.app.startSession("translate"),this.setStatus("creating")}}});l(this,"onPointerUp",()=>{this.app.readOnly||this.status==="creating"&&(this.setStatus("idle"),this.app.completeSession(),this.app.selectTool("select"),this.app.setEditingId(this.shapeId))})}};var jp=V(require("@tldraw/vec"));var Kr=class extends at{constructor(){super(...arguments);l(this,"type","text");l(this,"stopEditingShape",()=>{this.setStatus("idle"),this.app.appState.isToolLocked||this.app.selectTool("select")});l(this,"onKeyUp",()=>{});l(this,"onKeyDown",()=>{});l(this,"onPointerDown",()=>{if(this.status==="creating"){this.stopEditingShape();return}if(this.status==="idle"){let{currentPoint:e,currentGrid:t,settings:{showGrid:n}}=this.app;this.app.createTextShapeAtPoint(n?jp.default.snap(e,t):e,void 0,!0),this.setStatus("creating");return}});l(this,"onPointerUp",()=>{});l(this,"onPointShape",e=>{if(this.app.readOnly)return;let t=this.app.getShape(e.target);t.type==="text"&&(this.setStatus("idle"),this.app.setEditingId(t.id))});l(this,"onShapeBlur",()=>{this.app.readOnly||this.stopEditingShape()})}};var ri=require("@tldraw/core"),Gp=V(require("@tldraw/vec"));var _r=class extends at{constructor(){super(...arguments);l(this,"type","triangle");l(this,"onPointerDown",()=>{if(this.app.readOnly||this.status!=="idle")return;let{currentPoint:e,currentGrid:t,settings:{showGrid:n},appState:{currentPageId:o,currentStyle:s}}=this.app,a=this.getNextChildIndex(),d=ri.Utils.uniqueId(),i=$s.create({id:d,parentId:o,childIndex:a,point:n?Gp.default.snap(e,t):e,style:S({},s)});this.app.patchCreate([i]),this.app.startSession("transformSingle",i.id,ri.TLBoundsCorner.BottomRight,!0),this.setStatus("creating")})}};var Ya=Dt.Utils.uniqueId(),ht=class extends ha{constructor(e,t={}){super(ht.defaultState,e,ht.version,(n,o,s)=>An(w(S({},o),{document:w(S(S({},o.document),n.document),{version:s})}),ht.version));l(this,"callbacks",{});l(this,"tools",{select:new Wr(this),erase:new Vr(this),["text"]:new Kr(this),["draw"]:new jr(this),["ellipse"]:new Gr(this),["rectangle"]:new Nr(this),["triangle"]:new _r(this),["line"]:new $r(this),["arrow"]:new Fr(this),["sticky"]:new Ur(this)});l(this,"currentTool",this.tools.select);l(this,"session");l(this,"readOnly",!1);l(this,"isDirty",!1);l(this,"isCreating",!1);l(this,"originPoint",[0,0]);l(this,"currentPoint",[0,0]);l(this,"previousPoint",[0,0]);l(this,"shiftKey",!1);l(this,"altKey",!1);l(this,"metaKey",!1);l(this,"ctrlKey",!1);l(this,"spaceKey",!1);l(this,"isPointing",!1);l(this,"isForcePanning",!1);l(this,"isErasingWithPen",!1);l(this,"isPastePrevented",!1);l(this,"editingStartTime",-1);l(this,"fileSystemHandle",null);l(this,"viewport",Dt.Utils.getBoundsFromPoints([[0,0],[100,100]]));l(this,"rendererBounds",Dt.Utils.getBoundsFromPoints([[0,0],[100,100]]));l(this,"selectHistory",{stack:[[]],pointer:0});l(this,"clipboard");l(this,"rotationInfo",{selectedIds:[],center:[0,0]});l(this,"migrate",e=>An(e,ht.version));l(this,"onReady",()=>{var e,t;this.loadDocument(this.document),va().then(n=>{this.fileSystemHandle=n});try{this.patchState(w(S({},An(this.state,ht.version)),{appState:{status:"idle"}}))}catch(n){console.error("The data appears to be corrupted. Resetting!",n),localStorage.setItem(this.document.id+"_corrupted",JSON.stringify(this.document)),this.patchState(w(S({},ht.defaultState),{appState:w(S({},ht.defaultState.appState),{status:"idle"})}))}(t=(e=this.callbacks).onMount)==null||t.call(e,this)});l(this,"cleanup",(e,t)=>{var a;let n=S({},e);n.document!==t.document&&Object.entries(n.document.pages).forEach(([d,i])=>{if(i===void 0){delete n.document.pages[d],delete n.document.pageStates[d];return}let c=t.document.pages[d],u={};if(!c||i.shapes!==c.shapes||i.bindings!==c.bindings){i.shapes=S({},i.shapes),i.bindings=S({},i.bindings);let m=new Set;Object.entries(i.shapes).forEach(([f,T])=>{var b;let x;T?x=T.parentId:(x=(b=c==null?void 0:c.shapes[f])==null?void 0:b.parentId,delete i.shapes[f]),i.id===n.appState.currentPageId&&(c==null?void 0:c.shapes[f])!==T&&(u[f]=T),x&&x!==d&&i.shapes[x]!==void 0&&m.add(i.shapes[x])}),Object.keys(i.bindings).forEach(f=>{i.bindings[f]||delete i.bindings[f]}),n.document.pages[d]=i;let h=k.getRelatedBindings(n,Object.keys(u),d),g=new Set;h.forEach(f=>{if(!i.bindings[f.id])return;let T=i.shapes[f.toId],x=i.shapes[f.fromId];if(!(T&&x)){delete n.document.pages[d].bindings[f.id];return}if(g.has(x))return;let b=k.updateArrowBindings(i,x);if(g.add(x),b){let y=S(S({},x),b);i.shapes[x.id]=y}}),m.forEach(f=>{if(!f)throw Error("no group!");let T=f.children.filter(b=>i.shapes[b]!==void 0),x=Dt.Utils.getCommonBounds(T.map(b=>i.shapes[b]).filter(Boolean).map(b=>k.getRotatedBounds(b)));i.shapes[f.id]=w(S({},f),{point:[x.minX,x.minY],size:[x.width,x.height],children:T})})}let p=S({},n.document.pageStates[d]);p.brush||delete p.brush,p.hoveredId&&!i.shapes[p.hoveredId]&&delete p.hoveredId,p.bindingId&&!i.bindings[p.bindingId]&&(k.warn(`Could not find the binding of ${d}`),delete p.bindingId),p.editingId&&!i.shapes[p.editingId]&&(k.warn("Could not find the editing shape!"),delete p.editingId),n.document.pageStates[d]=p}),Object.keys((a=n.document.assets)!=null?a:{}).forEach(d=>{var i,c;((i=n.document.assets)==null?void 0:i[d])||(c=n.document.assets)==null||delete c[d]});let o=n.appState.currentPageId,s=n.document.pageStates[o];if(n.room&&n.room!==t.room){let d=w(S({},n.room),{users:S({},n.room.users)});t.room&&Object.values(t.room.users).filter(Boolean).forEach(i=>{d.users[i.id]===void 0&&delete d.users[i.id]}),n.room=d}return n.room&&(n.room.users[n.room.userId]=w(S({},n.room.users[n.room.userId]),{point:this.currentPoint,selectedIds:s.selectedIds})),this.readOnly&&(n.document.pages=t.document.pages),n});l(this,"broadcastPatch",(e,t)=>{var c,u,p,m,h,g,f,T,x;let n={},o={},s={},a=(p=(u=(c=e==null?void 0:e.document)==null?void 0:c.pages)==null?void 0:u[this.currentPageId])==null?void 0:p.shapes,d=(g=(h=(m=e==null?void 0:e.document)==null?void 0:m.pages)==null?void 0:h[this.currentPageId])==null?void 0:g.bindings,i=(f=e==null?void 0:e.document)==null?void 0:f.assets;a&&Object.keys(a).forEach(b=>{n[b]=this.getShape(b,this.currentPageId)}),d&&Object.keys(d).forEach(b=>{o[b]=this.getBinding(b,this.currentPageId)}),i&&Object.keys(i).forEach(b=>{s[b]=this.document.assets[b]}),(x=(T=this.callbacks).onChangePage)==null||x.call(T,this,n,o,s,t)});l(this,"onPatch",(e,t,n)=>{var o,s,a,d,i,c;(this.callbacks.onChangePage&&((s=(o=t==null?void 0:t.document)==null?void 0:o.pages)==null?void 0:s[this.currentPageId])||((a=t==null?void 0:t.document)==null?void 0:a.assets))&&(((d=t==null?void 0:t.document)==null?void 0:d.assets)||this.session&&this.session.type!=="brush"&&this.session.type!=="erase"&&this.session.type!=="draw")&&this.broadcastPatch(t,!1),(c=(i=this.callbacks).onPatch)==null||c.call(i,this,t,n)});l(this,"onCommand",(e,t,n)=>{var o,s;this.clearSelectHistory(),this.isDirty=!0,(s=(o=this.callbacks).onCommand)==null||s.call(o,this,t,n)});l(this,"onReplace",()=>{this.clearSelectHistory(),this.isDirty=!1});l(this,"onUndo",()=>{var e,t;this.rotationInfo.selectedIds=[...this.selectedIds],(t=(e=this.callbacks).onUndo)==null||t.call(e,this)});l(this,"onRedo",()=>{var e,t;this.rotationInfo.selectedIds=[...this.selectedIds],(t=(e=this.callbacks).onRedo)==null||t.call(e,this)});l(this,"onPersist",(e,t)=>{var n,o;(o=(n=this.callbacks).onPersist)==null||o.call(n,this),this.broadcastPatch(t,!0)});l(this,"prevSelectedIds",this.selectedIds);l(this,"onStateDidChange",(e,t)=>{var n,o,s,a;(o=(n=this.callbacks).onChange)==null||o.call(n,this,t),this.room&&this.selectedIds!==this.prevSelectedIds&&((a=(s=this.callbacks).onChangePresence)==null||a.call(s,this,w(S({},this.room.users[this.room.userId]),{selectedIds:this.selectedIds,session:!!this.session})),this.prevSelectedIds=this.selectedIds)});l(this,"preventPaste",()=>{if(this.isPastePrevented)return;let e=n=>n.stopImmediatePropagation(),t=()=>{setTimeout(()=>{document.removeEventListener("paste",e,{capture:!0}),this.isPastePrevented=!1},50)};document.addEventListener("paste",e,{capture:!0}),window.addEventListener("pointerup",t,{once:!0}),this.isPastePrevented=!0});l(this,"justSent",!1);l(this,"getReservedContent",(e,t=this.currentPageId)=>{let{bindings:n}=this.document.pages[t],o={},s={},a=Object.values(n),d=new Map(a.map(h=>[h.toId,h])),i=new Map(a.map(h=>[h.fromId,h])),c=[d,i],u=[];this.session&&e.forEach(h=>u.push(h)),this.pageState.editingId&&u.push(this.pageState.editingId);let p=new Set(u),m=new Set;for(;u.length>0;){let h=u.pop();if(!h)break;if(m.has(h))continue;m.add(h);let g=this.getShape(h);o[h]=g,g.parentId!==t&&u.push(g.parentId),g.children&&u.push(...g.children),c.map(f=>f.get(g.id)).filter(Boolean).forEach(f=>{s[f.id]=f,u.push(f.toId,f.fromId)})}return{reservedShapes:o,reservedBindings:s,strongReservedShapeIds:p}});l(this,"replacePageContent",(e,t,n,o=this.currentPageId)=>{if(this.justSent)return this.justSent=!1,this;let s=this.document.pages[this.currentPageId];return Object.values(e).forEach(a=>{a.parentId!==o&&!(s.shapes[a.parentId]||e[a.parentId])&&(console.warn("Added a shape without a parent on the page"),a.parentId=o)}),this.useStore.setState(a=>{let{hoveredId:d,editingId:i,bindingId:c,selectedIds:u}=a.document.pageStates[o],p=[...u],m=i&&a.document.pages[this.currentPageId].shapes[i];m&&p.push(m.id);let{reservedShapes:h,reservedBindings:g,strongReservedShapeIds:f}=this.getReservedContent(p,this.currentPageId);Object.values(h).filter(v=>!("text"in v)).forEach(v=>{let I=e[v.id];if(!!I){if(!(v.type==="arrow"||f.has(v.id))){e[v.id]=I;return}"decorations"in I&&"decorations"in v&&(e[v.id]=w(S({},v),{decorations:I.decorations})),v.style=I.style}});let T=S(S({},e),h);m&&(T[m.id]=m);let x=S(S({},t),g),b=S({},n),y=w(S({},a),{document:w(S({},a.document),{pages:{[o]:w(S({},a.document.pages[o]),{shapes:T,bindings:x})},assets:b,pageStates:w(S({},a.document.pageStates),{[o]:w(S({},a.document.pageStates[o]),{selectedIds:u.filter(v=>T[v]!==void 0),hoveredId:d?T[d]===void 0?void 0:d:void 0,editingId:i,bindingId:c?x[c]===void 0?void 0:c:void 0})})})}),R=y.document.pages[o],K=k.getRelatedBindings(y,Object.keys(T),o),L=new Set;return K.forEach(v=>{if(!R.bindings[v.id])return;let I=R.shapes[v.fromId];if(L.has(I))return;let J=k.updateArrowBindings(R,I);if(L.add(I),J){let ce=S(S({},I),J);R.shapes[I.id]=ce}}),Object.values(T).forEach(v=>{if(v.type!=="group")return;let I=v.children.filter(ce=>R.shapes[ce]!==void 0),J=Dt.Utils.getCommonBounds(I.map(ce=>R.shapes[ce]).filter(Boolean).map(ce=>k.getRotatedBounds(ce)));R.shapes[v.id]=w(S({},v),{point:[J.minX,J.minY],size:[J.width,J.height],children:I})}),this.state.document=y.document,y},!0),this});l(this,"updateBounds",e=>{this.rendererBounds=e;let{point:t,zoom:n}=this.camera;this.updateViewport(t,n),!this.readOnly&&this.session&&this.session.update()});l(this,"updateViewport",(e,t)=>{let{width:n,height:o}=this.rendererBounds,[s,a]=xe.Vec.sub(xe.Vec.div([0,0],t),e),[d,i]=xe.Vec.sub(xe.Vec.div([n,o],t),e);this.viewport={minX:s,minY:a,maxX:d,maxY:i,width:d-s,height:i-a}});l(this,"setEditingId",(e,t=!1)=>{if(!this.readOnly){if(e)this.startSession("edit",e,t);else{if(!this.pageState.editingId)return;this.completeSession()}this.editingStartTime=performance.now(),this.patchState({document:{pageStates:{[this.currentPageId]:{editingId:e}}}},"set_editing_id")}});l(this,"setHoveredId",e=>{this.patchState({document:{pageStates:{[this.currentPageId]:{hoveredId:e}}}},"set_hovered_id")});l(this,"setSetting",(e,t)=>{if(this.session)return this;let n={settings:{[e]:typeof t=="function"?t(this.settings[e]):t}};return this.patchState(n,`settings:${e}`),this.persist(n),this});l(this,"toggleFocusMode",()=>{if(this.session)return this;let e={settings:{isFocusMode:!this.settings.isFocusMode}};return this.patchState(e,"settings:toggled_focus_mode"),this.persist(e),this});l(this,"togglePenMode",()=>{if(this.session)return this;let e={settings:{isPenMode:!this.settings.isPenMode}};return this.patchState(e,"settings:toggled_pen_mode"),this.persist(e),this});l(this,"toggleDarkMode",()=>{if(this.session)return this;let e={settings:{isDarkMode:!this.settings.isDarkMode}};return this.patchState(e,"settings:toggled_dark_mode"),this.persist(e),this});l(this,"toggleZoomSnap",()=>{if(this.session)return this;let e={settings:{isZoomSnap:!this.settings.isZoomSnap}};return this.patchState(e,"settings:toggled_zoom_snap"),this.persist(e),this});l(this,"toggleDebugMode",()=>{if(this.session)return this;let e={settings:{isDebugMode:!this.settings.isDebugMode}};return this.patchState(e,"settings:toggled_debug"),this.persist(e),this});l(this,"setMenuOpen",e=>{let t={appState:{isMenuOpen:e}};return this.patchState(t,"ui:toggled_menu_opened"),this.persist(t),this});l(this,"setIsLoading",e=>{let t={appState:{isLoading:e}};return this.patchState(t,"ui:toggled_is_loading"),this.persist(t),this});l(this,"setDisableAssets",e=>(this.patchState({appState:{disableAssets:e}},"ui:toggled_disable_images"),this));l(this,"toggleGrid",()=>{if(this.session)return this;let e={settings:{showGrid:!this.settings.showGrid}};return this.patchState(e,"settings:toggled_grid"),this.persist(e),this});l(this,"selectTool",e=>{if(this.readOnly||this.session)return this;this.isPointing=!1;let t=this.tools[e];return t===this.currentTool?(this.patchState({appState:{isToolLocked:!1}}),this):(this.currentTool.onExit(),t.previous=this.currentTool.type,this.currentTool=t,this.currentTool.onEnter(),this.patchState({appState:{activeTool:e,isToolLocked:!1}},`selected_tool:${e}`))});l(this,"toggleToolLock",()=>this.session?this:this.patchState({appState:{isToolLocked:!this.appState.isToolLocked}},"toggled_tool_lock"));l(this,"resetDocument",()=>{if(this.session)return this;this.session=void 0,this.currentTool=this.tools.select;let e=ht.defaultDocument;return e.pages.page.name="Page 1",this.resetHistory().clearSelectHistory().loadDocument(ht.defaultDocument).persist({}),this});l(this,"updateUsers",(e,t=!1)=>{this.patchState({room:{users:Object.fromEntries(e.map(n=>[n.id,n]))}},t?"room:self:update":"room:user:update")});l(this,"removeUser",e=>{this.patchState({room:{users:{[e]:void 0}}})});l(this,"mergeDocument",e=>{if(this.document.id!==e.id)return this.replaceState(w(S({},An(w(S({},this.state),{document:e}),ht.version)),{appState:w(S({},this.appState),{currentPageId:Object.keys(e.pages)[0]})})),this;let t=S({},this.document.pageStates),n=w(S({},this.appState),{currentPageId:e.pages[this.currentPageId]?this.currentPageId:Object.keys(e.pages)[0],pages:Object.values(e.pages).map((s,a)=>({id:s.id,name:s.name,childIndex:s.childIndex||a}))});this.resetHistory(),Object.keys(this.document.pages).forEach(s=>{e.pages[s]||(s===this.appState.currentPageId&&(this.cancelSession(),this.selectNone()),t[s]=void 0)}),this.session&&this.selectedIds.filter(s=>!e.pages[this.currentPageId].shapes[s]).forEach(s=>e.pages[this.currentPageId].shapes[s]=this.page.shapes[s]),Object.entries(t).forEach(([s,a])=>{a.selectedIds=a.selectedIds.filter(d=>!!e.pages[s].shapes[d])});let{editingId:o}=this.pageState;return o&&(e.pages[this.currentPageId].shapes[o]=this.page.shapes[o],t[this.currentPageId].selectedIds=[o]),this.replaceState(w(S({},An(w(S({},this.state),{document:w(S({},e),{pageStates:t})}),ht.version)),{appState:n}),"merge")});l(this,"updateDocument",(e,t="updated_document")=>{let n=this.state,o=w(S({},n),{document:w(S({},n.document),{assets:e.assets})});e.pages[this.currentPageId]||(o.appState=w(S({},n.appState),{currentPageId:Object.keys(e.pages)[0]}));let s=1;for(let a of Object.values(e.pages))a!==n.document.pages[a.id]&&(o.document.pages[a.id]=a,a.name||(o.document.pages[a.id].name=`Page ${s+1}`,s++));for(let a of Object.values(e.pageStates))if(a!==n.document.pageStates[a.id]){o.document.pageStates[a.id]=a;let d=e.pages[a.id],i=["bindingId","editingId","hoveredId","pointedId"];for(let c of i)d.shapes[c]||(a[c]=void 0);a.selectedIds=a.selectedIds.filter(c=>!!e.pages[d.id].shapes[c])}return this.replaceState(An(o,o.document.version||0),`${t}:${e.id}`)});l(this,"loadRoom",e=>(this.patchState({room:{id:e,userId:Ya,users:{[Ya]:{id:Ya,color:Fi[Math.floor(Math.random()*Fi.length)],point:[100,100],selectedIds:[],activeShapes:[]}}}}),this));l(this,"loadDocument",e=>{this.setIsLoading(!0),this.selectNone(),this.resetHistory(),this.clearSelectHistory(),this.session=void 0;let t=w(S({},ht.defaultState),{settings:S({},this.state.settings),document:e,appState:w(S(S({},ht.defaultState.appState),this.state.appState),{currentPageId:Object.keys(e.pages)[0],disableAssets:this.disableAssets})});this.replaceState(An(t,ht.version),"loaded_document");let{point:n,zoom:o}=this.camera;return this.updateViewport(n,o),this.setIsLoading(!1),this});l(this,"loadPageFromURL",(e,t)=>{let n=e.id,o=w(S({},this.state.document),{pageStates:w(S({},this.state.document.pageStates),{[n]:t}),pages:w(S({},this.document.pages),{[n]:e})});this.loadDocument(o),this.persist({})});l(this,"newProject",()=>{!this.isLocal||(this.fileSystemHandle=null,this.resetDocument())});l(this,"saveProject",()=>ue(this,null,function*(){if(this.readOnly)return;let e=yield ei(An(this.state,ht.version).document,this.fileSystemHandle);return this.fileSystemHandle=e,this.persist({}),this.isDirty=!1,this}));l(this,"saveProjectAs",e=>ue(this,null,function*(){try{let t=yield ei(this.document,null,e);this.fileSystemHandle=t,this.persist({}),this.isDirty=!1}catch(t){console.error(t.message)}return this}));l(this,"openProject",()=>ue(this,null,function*(){if(!!this.isLocal)try{let e=yield Ca();if(!e)throw Error();let{fileHandle:t,document:n}=e;this.loadDocument(n),this.fileSystemHandle=t,this.zoomToFit(),this.persist({})}catch(e){console.error(e)}finally{this.persist({})}}));l(this,"openAsset",()=>ue(this,null,function*(){if(!this.disableAssets)try{let e=yield Da();if(Array.isArray(e))this.addMediaFromFiles(e,this.centerPoint);else{if(!e)return;this.addMediaFromFiles([e])}}catch(e){console.error(e)}finally{this.persist({})}}));l(this,"signOut",()=>{});l(this,"getAppState",()=>this.appState);l(this,"getPage",(e=this.currentPageId)=>k.getPage(this.state,e||this.currentPageId));l(this,"getShapes",(e=this.currentPageId)=>k.getShapes(this.state,e||this.currentPageId));l(this,"getBindings",(e=this.currentPageId)=>k.getBindings(this.state,e||this.currentPageId));l(this,"getShape",(e,t=this.currentPageId)=>k.getShape(this.state,e,t));l(this,"getShapeBounds",(e,t=this.currentPageId)=>k.getBounds(this.getShape(e,t)));l(this,"getBinding",(e,t=this.currentPageId)=>k.getBinding(this.state,e,t));l(this,"getPageState",(e=this.currentPageId)=>k.getPageState(this.state,e||this.currentPageId));l(this,"getPagePoint",(e,t=this.currentPageId)=>{let{camera:n}=this.getPageState(t);return xe.Vec.sub(xe.Vec.div(e,n.zoom),n.point)});l(this,"createPage",(e,t)=>{if(this.readOnly)return this;let{width:n,height:o}=this.rendererBounds;return this.setState(ap(this,[-n/2,-o/2],e,t))});l(this,"changePage",e=>this.setState(op(this,e)));l(this,"movePage",(e,t)=>this.readOnly?this:this.setState(Sp(this,e,t)));l(this,"renamePage",(e,t)=>this.readOnly?this:this.setState(bp(this,e,t)));l(this,"duplicatePage",e=>this.readOnly?this:this.setState(pp(this,e)));l(this,"deletePage",e=>this.readOnly?this:Object.values(this.document.pages).length<=1?this:this.setState(lp(this,e||this.currentPageId)));l(this,"cut",(e=this.selectedIds,t)=>(t==null||t.preventDefault(),this.copy(e,t),this.readOnly||this.delete(e),this));l(this,"copy",(e=this.selectedIds,t)=>{var s;t==null||t.preventDefault(),this.clipboard=this.getContent(e);let o=`<tldraw>${JSON.stringify(S({type:"tldr/clipboard",shapes:[],assets:[],bindings:[]},this.clipboard))}</tldraw>`;return qc(o),t&&((s=t.clipboardData)==null||s.setData("text/html",o)),navigator.clipboard&&window.ClipboardItem&&navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([o],{type:"text/html"})})]),this});l(this,"paste",(e,t)=>ue(this,null,function*(){var c,u;if(this.readOnly)return;let n=[],o=[],s,a=p=>ue(this,null,function*(){let m=document.createElement("div");m.innerHTML=p;let h=m.firstChild;h.style.setProperty("background-color","transparent");let g=yield k.getImageForSvg(h,"svg",{scale:1,quality:1});if(g){let f=new File([g],"image.svg");n.push(f)}else d(p)}),d=p=>{let m=this.getPagePoint(e!=null?e:this.centerPoint,this.currentPageId),h=p.includes(`
 `);o.push(k.getShapeUtil("text").getShape({id:Dt.Utils.uniqueId(),type:"text",parentId:this.appState.currentPageId,text:k.normalizeText(p.trim()),point:m,style:w(S({},this.appState.currentStyle),{textAlign:h?"start":this.appState.currentStyle.textAlign})}))},i=p=>{var m;try{let h=(m=p.match(/<tldraw>(.*)<\/tldraw>/))==null?void 0:m[1];if(!h)return;let g=JSON.parse(h);if(g.type==="tldr/clipboard"){s=g;return}else throw Error("Not tldraw data!")}catch(h){d(p)}};if(t!==void 0){let p=Array.from((u=(c=t.clipboardData)==null?void 0:c.items)!=null?u:[]);yield Promise.all(p.map(m=>ue(this,null,function*(){var f;let{type:h,kind:g}=m;switch(g){case"string":{let T=yield new Promise(x=>m.getAsString(x));switch(h){case"text/html":{if((f=T.match(/<tldraw>(.*)<\/tldraw>/))==null?void 0:f[1]){i(T);return}break}case"text/plain":{T.startsWith("<svg")?yield a(T):d(T);break}}break}case"file":{let T=m.getAsFile();T&&n.push(T);break}}})))}if(s)return this.insertContent(s,{point:e,select:!0}),this;if(n.length)return this.addMediaFromFiles(n,e),this;if(o.length){let p=this.getPagePoint(e!=null?e:this.centerPoint,this.currentPageId),m=xe.Vec.add(p,[0,0]);return o.forEach((h,g)=>{let f=k.getBounds(h);g===0&&(m[0]-=f.width/2,m[1]-=f.height/2),h.point=[...m],m[0]+=f.width}),this.createShapes(...o),this}return this.clipboard?this.insertContent(this.clipboard):Xc().then(p=>{p&&i(p)}),this}));l(this,"getSvg",(...n)=>ue(this,[...n],function*(e=this.selectedIds.length?this.selectedIds:Object.keys(this.page.shapes),t={}){if(e.length===0)return;let o=document.createElementNS("http://www.w3.org/2000/svg","svg"),s=document.createElementNS("http://www.w3.org/2000/svg","defs"),a=document.createElementNS("http://www.w3.org/2000/svg","style");if(typeof window!="undefined"&&window.focus(),t.includeFonts)try{let{fonts:h}=yield fetch(ht.assetSrc,{mode:"no-cors"}).then(g=>g.json());a.textContent=`
           @font-face {
             font-family: 'Caveat Brush';
diff --git a/node_modules/@tldraw/tldraw/dist/index.mjs b/node_modules/@tldraw/tldraw/dist/index.mjs
index 01912f3..5ea6ad7 100644
--- a/node_modules/@tldraw/tldraw/dist/index.mjs
+++ b/node_modules/@tldraw/tldraw/dist/index.mjs
@@ -1,4 +1,4 @@
-var rs=Object.defineProperty,fc=Object.defineProperties,Sc=Object.getOwnPropertyDescriptor,bc=Object.getOwnPropertyDescriptors,Tc=Object.getOwnPropertyNames,gr=Object.getOwnPropertySymbols;var ss=Object.prototype.hasOwnProperty,Xi=Object.prototype.propertyIsEnumerable;var os=(r,e,t)=>e in r?rs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,S=(r,e)=>{for(var t in e||(e={}))ss.call(e,t)&&os(r,t,e[t]);if(gr)for(var t of gr(e))Xi.call(e,t)&&os(r,t,e[t]);return r},w=(r,e)=>fc(r,bc(e));var Je=(r,e)=>{var t={};for(var n in r)ss.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&gr)for(var n of gr(r))e.indexOf(n)<0&&Xi.call(r,n)&&(t[n]=r[n]);return t};var yc=(r,e)=>{for(var t in e)rs(r,t,{get:e[t],enumerable:!0})},fr=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Tc(e))!ss.call(r,o)&&(t||o!=="default")&&rs(r,o,{get:()=>e[o],enumerable:!(n=Sc(e,o))||n.enumerable});return r};var l=(r,e,t)=>(os(r,typeof e!="symbol"?e+"":e,t),t);var pe=(r,e,t)=>new Promise((n,o)=>{var s=i=>{try{d(t.next(i))}catch(c){o(c)}},a=i=>{try{d(t.throw(i))}catch(c){o(c)}},d=i=>i.done?n(i.value):Promise.resolve(i.value).then(s,a);d((t=t.apply(r,e)).next())});import"@fontsource/caveat-brush";import"@fontsource/crimson-pro";import"@fontsource/recursive";import"@fontsource/source-code-pro";import"@fontsource/source-sans-pro";import{Renderer as Kpe}from"@tldraw/core";import*as Se from"react";import{ErrorBoundary as _pe}from"react-error-boundary";import{IntlProvider as Ype}from"react-intl";import*as Fe from"@radix-ui/react-context-menu";import{AlignBottomIcon as _se,AlignCenterHorizontallyIcon as Yse,AlignCenterVerticallyIcon as Zse,AlignLeftIcon as Xse,AlignRightIcon as qse,AlignTopIcon as Jse,SpaceEvenlyHorizontallyIcon as Qse,SpaceEvenlyVerticallyIcon as eie,StretchHorizontallyIcon as tie,StretchVerticallyIcon as nie}from"@radix-ui/react-icons";import*as C from"react";import{FormattedMessage as ot,useIntl as oie}from"react-intl";import{createStitches as xc,defaultThemeMap as wc}from"@stitches/react";var{styled:H,createTheme:kc}=xc({themeMap:S({},wc),theme:{colors:{bounds:"rgba(65, 132, 244, 1.000)",boundsBg:"rgba(65, 132, 244, 0.05)",hover:"#ececec",overlay:"rgba(0, 0, 0, 0.15)",overlayContrast:"rgba(255, 255, 255, 0.15)",panel:"#fefefe",panelContrast:"#ffffff",selected:"rgba(66, 133, 244, 1.000)",selectedContrast:"#fefefe",text:"#333333",tooltip:"#1d1d1d",tooltipContrast:"#ffffff",warn:"rgba(255, 100, 100, 1)",canvas:"rgb(248, 249, 250)"},shadows:{2:"0px 1px 1px rgba(0, 0, 0, 0.14)",3:"0px 2px 3px rgba(0, 0, 0, 0.14)",4:"0px 4px 5px -1px rgba(0, 0, 0, 0.14)",8:"0px 12px 17px rgba(0, 0, 0, 0.14)",12:"0px 12px 17px rgba(0, 0, 0, 0.14)",24:"0px 24px 38px rgba(0, 0, 0, 0.14)",key:"1px 1px rgba(0,0,0,1)",panel:`0px 0px 16px -1px rgba(0, 0, 0, 0.05), 
+var rs=Object.defineProperty,fc=Object.defineProperties,Sc=Object.getOwnPropertyDescriptor,bc=Object.getOwnPropertyDescriptors,Tc=Object.getOwnPropertyNames,gr=Object.getOwnPropertySymbols;var ss=Object.prototype.hasOwnProperty,Xi=Object.prototype.propertyIsEnumerable;var os=(r,e,t)=>e in r?rs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,S=(r,e)=>{for(var t in e||(e={}))ss.call(e,t)&&os(r,t,e[t]);if(gr)for(var t of gr(e))Xi.call(e,t)&&os(r,t,e[t]);return r},w=(r,e)=>fc(r,bc(e));var Je=(r,e)=>{var t={};for(var n in r)ss.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&gr)for(var n of gr(r))e.indexOf(n)<0&&Xi.call(r,n)&&(t[n]=r[n]);return t};var yc=(r,e)=>{for(var t in e)rs(r,t,{get:e[t],enumerable:!0})},fr=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Tc(e))!ss.call(r,o)&&(t||o!=="default")&&rs(r,o,{get:()=>e[o],enumerable:!(n=Sc(e,o))||n.enumerable});return r};var l=(r,e,t)=>(os(r,typeof e!="symbol"?e+"":e,t),t);var pe=(r,e,t)=>new Promise((n,o)=>{var s=i=>{try{d(t.next(i))}catch(c){o(c)}},a=i=>{try{d(t.throw(i))}catch(c){o(c)}},d=i=>i.done?n(i.value):Promise.resolve(i.value).then(s,a);d((t=t.apply(r,e)).next())});import{Renderer as Kpe}from"@tldraw/core";import*as Se from"react";import{ErrorBoundary as _pe}from"react-error-boundary";import{IntlProvider as Ype}from"react-intl";import*as Fe from"@radix-ui/react-context-menu";import{AlignBottomIcon as _se,AlignCenterHorizontallyIcon as Yse,AlignCenterVerticallyIcon as Zse,AlignLeftIcon as Xse,AlignRightIcon as qse,AlignTopIcon as Jse,SpaceEvenlyHorizontallyIcon as Qse,SpaceEvenlyVerticallyIcon as eie,StretchHorizontallyIcon as tie,StretchVerticallyIcon as nie}from"@radix-ui/react-icons";import*as C from"react";import{FormattedMessage as ot,useIntl as oie}from"react-intl";import{createStitches as xc,defaultThemeMap as wc}from"@stitches/react";var{styled:H,createTheme:kc}=xc({themeMap:S({},wc),theme:{colors:{bounds:"rgba(65, 132, 244, 1.000)",boundsBg:"rgba(65, 132, 244, 0.05)",hover:"#ececec",overlay:"rgba(0, 0, 0, 0.15)",overlayContrast:"rgba(255, 255, 255, 0.15)",panel:"#fefefe",panelContrast:"#ffffff",selected:"rgba(66, 133, 244, 1.000)",selectedContrast:"#fefefe",text:"#333333",tooltip:"#1d1d1d",tooltipContrast:"#ffffff",warn:"rgba(255, 100, 100, 1)",canvas:"rgb(248, 249, 250)"},shadows:{2:"0px 1px 1px rgba(0, 0, 0, 0.14)",3:"0px 2px 3px rgba(0, 0, 0, 0.14)",4:"0px 4px 5px -1px rgba(0, 0, 0, 0.14)",8:"0px 12px 17px rgba(0, 0, 0, 0.14)",12:"0px 12px 17px rgba(0, 0, 0, 0.14)",24:"0px 24px 38px rgba(0, 0, 0, 0.14)",key:"1px 1px rgba(0,0,0,1)",panel:`0px 0px 16px -1px rgba(0, 0, 0, 0.05), 
         0px 0px 16px -8px rgba(0, 0, 0, 0.05), 
         0px 0px 16px -12px rgba(0, 0, 0, 0.12),
         0px 0px 2px 0px rgba(0, 0, 0, 0.08)`},space:{0:"2px",1:"3px",2:"4px",3:"8px",4:"12px",5:"16px",6:"32px",7:"48px"},fontSizes:{0:"10px",1:"12px",2:"13px",3:"16px",4:"18px"},fonts:{ui:'"Recursive", system-ui, sans-serif',body:'"Recursive", system-ui, sans-serif',mono:'"Recursive Mono", monospace'},fontWeights:{},lineHeights:{},letterSpacings:{},sizes:{},borderWidths:{0:"$1"},borderStyles:{},radii:{0:"2px",1:"4px",2:"8px",3:"12px",4:"16px"},zIndices:{},transitions:{}},media:{micro:"(max-width: 370px)",sm:"(min-width: 640px)",md:"(min-width: 768px)",lg:"(min-width: 1024px)"},utils:{zStrokeWidth:()=>r=>Array.isArray(r)?{strokeWidth:`calc(${r[0]}px / var(--camera-zoom))`}:{strokeWidth:`calc(${r}px / var(--camera-zoom))`}}}),is=kc({colors:{bounds:"rgba(38, 150, 255, 1.000)",boundsBg:"rgba(38, 150, 255, 0.05)",hover:"#444A50",overlay:"rgba(0, 0, 0, 0.15)",overlayContrast:"rgba(255, 255, 255, 0.15)",panel:"#363D44",panelContrast:"#49555f",selected:"rgba(38, 150, 255, 1.000)",selectedContrast:"#fefefe",text:"#f8f9fa",tooltip:"#1d1d1d",tooltipContrast:"#ffffff",canvas:"#212529"},shadows:{2:"0px 1px 1px rgba(0, 0, 0, 0.24)",3:"0px 2px 3px rgba(0, 0, 0, 0.24)",4:"0px 4px 5px -1px rgba(0, 0, 0, 0.24)",8:"0px 12px 17px rgba(0, 0, 0, 0.24)",12:"0px 12px 17px rgba(0, 0, 0, 0.24)",24:"0px 24px 38px rgba(0, 0, 0, 0.24)",panel:`0px 0px 16px -1px rgba(0, 0, 0, 0.05), 
